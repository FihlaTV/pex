!function t(e,i,n){function r(s,a){if(!i[s]){if(!e[s]){var h="function"==typeof require&&require;if(!a&&h)return h(s,!0);if(o)return o(s,!0);throw new Error("Cannot find module '"+s+"'")}var l=i[s]={exports:{}};e[s][0].call(l.exports,function(t){var i=e[s][1][t];return r(i?i:t)},l,l.exports,t,e,i,n)}return i[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)r(n[s]);return r}({1:[function(t,e){!function(t){function i(t,e){if("object"!==r(t))return e;for(var n in e)t[n]="object"===r(t[n])&&"object"===r(e[n])?i(t[n],e[n]):e[n];return t}function n(t,e,n){var s=n[0],a=n.length;(t||"object"!==r(s))&&(s={});for(var h=0;a>h;++h){var l=n[h],c=r(l);if("object"===c)for(var u in l){var p=t?o.clone(l[u]):l[u];s[u]=e?i(s[u],p):p}}return s}function r(t){return{}.toString.call(t).slice(8,-1).toLowerCase()}var o=function(t){return n(t===!0,!1,arguments)},s="merge";o.recursive=function(t){return n(t===!0,!0,arguments)},o.clone=function(t){var e,i,n=t,s=r(t);if("array"===s)for(n=[],i=t.length,e=0;i>e;++e)n[e]=o.clone(t[e]);else if("object"===s){n={};for(e in t)n[e]=o.clone(t[e])}return n},t?e.exports=o:window[s]=o}("object"==typeof e&&e&&"object"==typeof e.exports&&e.exports)},{}],2:[function(t,e){e.exports.Color=t("./lib/Color")},{"./lib/Color":3}],3:[function(t,e){function i(t,e,i,n){this.r=null!=t?t:0,this.g=null!=e?e:0,this.b=null!=i?i:0,this.a=null!=n?n:1}var n=function(t,e,i){return t+(e-t)*i};i.create=function(t,e,n,r){return new i(t,e,n,r)},i.fromArray=function(t){return new i(t[0],t[1],t[2],t[3])},i.fromRGB=i.create,i.fromHSV=function(t,e,n,r){var o=new i;return o.setHSV(t,e,n,r),o},i.fromHSL=function(t,e,n,r){var o=new i;return o.setHSL(t,e,n,r),o},i.prototype.set=function(t,e,i,n){return this.r=t,this.g=e,this.b=i,this.a=null!=n?n:1,this},i.prototype.hash=function(){return 1*this.r+12*this.g+123*this.b+1234*this.a},i.prototype.setHSV=function(t,e,i,n){n=null!=n?n:1;var r=Math.floor(6*t),o=6*t-r,s=i*(1-e),a=i*(1-o*e),h=i*(1-(1-o)*e);switch(r%6){case 0:this.r=i,this.g=h,this.b=s;break;case 1:this.r=a,this.g=i,this.b=s;break;case 2:this.r=s,this.g=i,this.b=h;break;case 3:this.r=s,this.g=a,this.b=i;break;case 4:this.r=h,this.g=s,this.b=i;break;case 5:this.r=i,this.g=s,this.b=a}return this.a=n,this},i.prototype.getHSV=function(){var t,e=this.r,i=this.g,n=this.b,r=Math.max(e,i,n),o=Math.min(e,i,n),s=r,a=r-o,h=0==r?0:a/r;if(r==o)t=0;else{switch(r){case e:t=(i-n)/a+(n>i?6:0);break;case i:t=(n-e)/a+2;break;case n:t=(e-i)/a+4}t/=6}return{h:t,s:h,v:s,a:this.a}},i.prototype.setHSL=function(t,e,i,n){function r(t,e,i){return 0>i&&(i+=1),i>1&&(i-=1),1/6>i?t+6*(e-t)*i:.5>i?e:2/3>i?t+(e-t)*(2/3-i)*6:t}if(n=null!=n?n:1,0==e)this.r=this.g=this.b=i;else{var o=.5>i?i*(1+e):i+e-i*e,s=2*i-o;this.r=r(s,o,t+1/3),this.g=r(s,o,t),this.b=r(s,o,t-1/3),this.a=n}},i.prototype.getHSL=function(){var t,e,i=this.r,n=this.g,r=this.b,o=Math.max(i,n,r),s=Math.min(i,n,r),a=(o+s)/2;if(o==s)t=e=0;else{var h=o-s;switch(e=a>.5?h/(2-o-s):h/(o+s),o){case i:t=(n-r)/h+(r>n?6:0);break;case n:t=(r-i)/h+2;break;case r:t=(i-n)/h+4}t/=6}return{h:t,s:e,l:a,a:this.a}},i.prototype.copy=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},i.prototype.clone=function(){return new i(this.r,this.g,this.b,this.a)},i.lerp=function(t,e,r,o){if(o=o||"rgb","rgb"==o)return i.fromRGB(n(t.r,e.r,r),n(t.g,e.g,r),n(t.b,e.b,r),n(t.a,e.a,r));if("hsv"==o){var s=t.getHSV(),a=e.getHSV();return i.fromHSV(n(s.h,a.h,r),n(s.s,a.s,r),n(s.v,a.v,r),n(s.a,a.a,r))}if("hsl"==o){var h=t.getHSL(),l=e.getHSL();return i.fromHSL(n(h.h,l.h,r),n(h.s,l.s,r),n(h.l,l.l,r),n(h.a,l.a,r))}return t},i.Transparent=new i(0,0,0,0),i.None=new i(0,0,0,0),i.Black=new i(0,0,0,1),i.White=new i(1,1,1,1),i.DarkGrey=new i(.25,.25,.25,1),i.Grey=new i(.5,.5,.5,1),i.Red=new i(1,0,0,1),i.Green=new i(0,1,0,1),i.Blue=new i(0,0,1,1),i.Yellow=new i(1,1,0,1),i.Pink=new i(1,0,1,1),i.Cyan=new i(0,1,1,1),i.Orange=new i(1,.5,0,1),e.exports=i},{}],4:[function(){},{}],5:[function(t,e){function i(){}var n=e.exports={};n.nextTick=function(){var t="undefined"!=typeof window&&window.setImmediate,e="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(t)return function(t){return window.setImmediate(t)};if(e){var i=[];return window.addEventListener("message",function(t){var e=t.source;if((e===window||null===e)&&"process-tick"===t.data&&(t.stopPropagation(),i.length>0)){var n=i.shift();n()}},!0),function(t){i.push(t),window.postMessage("process-tick","*")}}return function(t){setTimeout(t,0)}}(),n.title="browser",n.browser=!0,n.env={},n.argv=[],n.on=i,n.once=i,n.off=i,n.emit=i,n.binding=function(){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(){throw new Error("process.chdir is not supported")}},{}],6:[function(t,e,i){(function(t){function e(t,e){for(var i=0,n=t.length-1;n>=0;n--){var r=t[n];"."===r?t.splice(n,1):".."===r?(t.splice(n,1),i++):i&&(t.splice(n,1),i--)}if(e)for(;i--;i)t.unshift("..");return t}function n(t,e){if(t.filter)return t.filter(e);for(var i=[],n=0;n<t.length;n++)e(t[n],n,t)&&i.push(t[n]);return i}var r=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,o=function(t){return r.exec(t).slice(1)};i.resolve=function(){for(var i="",r=!1,o=arguments.length-1;o>=-1&&!r;o--){var s=o>=0?arguments[o]:t.cwd();if("string"!=typeof s)throw new TypeError("Arguments to path.resolve must be strings");s&&(i=s+"/"+i,r="/"===s.charAt(0))}return i=e(n(i.split("/"),function(t){return!!t}),!r).join("/"),(r?"/":"")+i||"."},i.normalize=function(t){var r=i.isAbsolute(t),o="/"===s(t,-1);return t=e(n(t.split("/"),function(t){return!!t}),!r).join("/"),t||r||(t="."),t&&o&&(t+="/"),(r?"/":"")+t},i.isAbsolute=function(t){return"/"===t.charAt(0)},i.join=function(){var t=Array.prototype.slice.call(arguments,0);return i.normalize(n(t,function(t){if("string"!=typeof t)throw new TypeError("Arguments to path.join must be strings");return t}).join("/"))},i.relative=function(t,e){function n(t){for(var e=0;e<t.length&&""===t[e];e++);for(var i=t.length-1;i>=0&&""===t[i];i--);return e>i?[]:t.slice(e,i-e+1)}t=i.resolve(t).substr(1),e=i.resolve(e).substr(1);for(var r=n(t.split("/")),o=n(e.split("/")),s=Math.min(r.length,o.length),a=s,h=0;s>h;h++)if(r[h]!==o[h]){a=h;break}for(var l=[],h=a;h<r.length;h++)l.push("..");return l=l.concat(o.slice(a)),l.join("/")},i.sep="/",i.delimiter=":",i.dirname=function(t){var e=o(t),i=e[0],n=e[1];return i||n?(n&&(n=n.substr(0,n.length-1)),i+n):"."},i.basename=function(t,e){var i=o(t)[2];return e&&i.substr(-1*e.length)===e&&(i=i.substr(0,i.length-e.length)),i},i.extname=function(t){return o(t)[3]};var s="b"==="ab".substr(-1)?function(t,e,i){return t.substr(e,i)}:function(t,e,i){return 0>e&&(e=t.length+e),t.substr(e,i)}}).call(this,t("/Users/vorg/Workspace/vorg-pex/experiments/v3/node_modules/pex-examples/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))},{"/Users/vorg/Workspace/vorg-pex/experiments/v3/node_modules/pex-examples/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":5}],7:[function(t){var e=t("pex-sys"),i=t("pex-glu"),n=t("pex-geom"),r=t("pex-gen"),o=t("pex-color"),s=t("pex-materials"),a=t("pex-gui"),h=(a.GUI,e.Window),l=r.Cube,c=(i.Mesh,i.PerspectiveCamera),u=i.Arcball,p=o.Color,d=n.Vec2,f=n.Vec3,g=i.Texture2D,m=e.Time,v=(s.ShowNormals,s.SolidColor,s.ShowColors,s.Textured,s.FlatToonShading,s.MatCap,1);h.create({settings:{width:1024*v,height:768*v,type:"3d",fullscreen:e.Platform.isBrowser,highdpi:v},color:p.create(.2,.2,.4,1),materials:[],materialIndex:1,distance:2,rotate:!1,rotationAxis:f.create(0,1,0),rotationSpeed:1,rotationAngle:0,viewport:new d(1,1),init:function(){this.gui=new a.GUI(this),this.camera=new c(60,this.width/this.height),this.arcball=new u(this,this.camera),this.texture=g.load("../../assets/textures/opengl.png"),this.materials.push(new s.SolidColor),this.materials.push(new s.ShowNormals),this.materials.push(new s.Textured({texture:this.texture})),this.materials.push(new s.Textured({texture:this.texture}));i.Context.currentContext;this.mesh=new i.Mesh(new l,this.materials[1]),this.gui.addLabel("GUI Test"),this.gui.addLabel("g - toggle gui on/off"),this.gui.addLabel("S - save settings"),this.gui.addLabel("L - load settings"),this.gui.addLabel(""),this.gui.addLabel("CUBE"),this.gui.addParam("Viewport",this,"viewport"),this.gui.addParam("Scale",this.mesh,"scale"),this.gui.addParam("Color",this,"color"),this.gui.addLabel("ROTATION"),this.gui.addParam("Rotate",this,"rotate"),this.gui.addParam("Rotate speed",this,"rotationSpeed",{min:0,max:5}),this.gui.addLabel("CAMERA"),this.gui.addParam("Distance",this,"distance",{min:.5,max:5}),this.gui.addTexture2D("Texture",this.texture);var t=(this.gui.addRadioList("MATERIAL",this,"materialIndex",[{name:"None",value:0},{name:"Normal",value:1},{name:"Textured",value:2},{name:"Textured with Alpha",value:3}],function(t){console.log("Material changed",t)}).setPosition(180,10),this);t.gui.load("client.gui.settings.txt"),this.on("keyDown",function(e){switch(e.str){case"g":t.gui.toggleEnabled();case"S":t.gui.save("client.gui.settings.txt");break;case"L":t.gui.load("client.gui.settings.txt")}})},draw:function(){i.clearColorAndDepth(p.Black),i.enableDepthReadAndWrite(!0,!0);i.Context.currentContext;this.arcball.distance=this.distance,this.arcball.updateCamera();var t=Math.floor(this.viewport.x*this.width),e=Math.floor(this.viewport.y*this.height);i.viewport((this.width-t)/2,(this.height-e)/2,t,e),this.rotate&&(this.rotationAngle+=m.delta*this.rotationSpeed*10,this.mesh.rotation.setAxisAngle(this.rotationAxis,this.rotationAngle)),this.mesh.setMaterial(this.materials[this.materialIndex]),3==this.materialIndex?(i.enableAdditiveBlending(),i.enableDepthReadAndWrite(!1,!1)):(i.enableDepthReadAndWrite(!0,!0),i.enableBlending(!1)),i.clearColorAndDepth(this.color),this.mesh.draw(this.camera),i.viewport(0,0,this.width,this.height),this.gui.draw()}})},{"pex-color":2,"pex-gen":8,"pex-geom":23,"pex-glu":43,"pex-gui":59,"pex-materials":64,"pex-sys":82}],8:[function(t,e){e.exports.Plane=t("./lib/Plane"),e.exports.Cube=t("./lib/Cube"),e.exports.Box=t("./lib/Box"),e.exports.Sphere=t("./lib/Sphere"),e.exports.Tetrahedron=t("./lib/Tetrahedron"),e.exports.Octahedron=t("./lib/Octahedron"),e.exports.Icosahedron=t("./lib/Icosahedron"),e.exports.Dodecahedron=t("./lib/Dodecahedron"),e.exports.HexSphere=t("./lib/HexSphere"),e.exports.LineBuilder=t("./lib/LineBuilder"),e.exports.Loft=t("./lib/Loft"),e.exports.IsoSurface=t("./lib/IsoSurface"),e.exports.Cylinder=t("./lib/Cylinder")},{"./lib/Box":9,"./lib/Cube":10,"./lib/Cylinder":11,"./lib/Dodecahedron":12,"./lib/HexSphere":13,"./lib/Icosahedron":14,"./lib/IsoSurface":15,"./lib/LineBuilder":16,"./lib/Loft":17,"./lib/Octahedron":18,"./lib/Plane":19,"./lib/Sphere":20,"./lib/Tetrahedron":21}],9:[function(t,e){function i(t,e,i){t=null!=t?t:1,e=null!=e?e:null!=t?t:1,i=null!=i?i:null!=t?t:1,o.call(this,{vertices:!0,faces:!0});var n=this.vertices,s=this.faces,a=t/2,h=e/2,l=i/2;n.push(new r(-a,-h,-l)),n.push(new r(-a,-h,l)),n.push(new r(a,-h,l)),n.push(new r(a,-h,-l)),n.push(new r(-a,h,-l)),n.push(new r(-a,h,l)),n.push(new r(a,h,l)),n.push(new r(a,h,-l)),s.push([0,3,2,1]),s.push([4,5,6,7]),s.push([0,1,5,4]),s.push([2,3,7,6]),s.push([1,2,6,5]),s.push([3,0,4,7]),this.computeNormals()}var n=t("pex-geom"),r=(n.Vec2,n.Vec3),o=n.Geometry;i.prototype=Object.create(o.prototype),e.exports=i},{"pex-geom":23}],10:[function(t,e){function i(t,e,i,n,a,h){function l(t,e,i,n,s,a,h,l,g,m){for(var v=f,x=0;h>=x;x++)for(var y=0;a>=y;y++)vert=c[f]=o.create(),vert[t]=(-n/2+y*n/a)*g,vert[e]=(-s/2+x*s/h)*m,vert[i]=l,normal=p[f]=o.create(),normal[t]=0,normal[e]=0,normal[i]=l/Math.abs(l),texCoord=u[f]=r.create(),texCoord.x=y/a,texCoord.y=1-x/h,++f;for(var x=0;h-1>=x;x++)for(var y=0;a-1>=y;y++){var w=v+x*(a+1)+y;d.push([w,w+a+1,w+a+2,w+1])}}t=null!=t?t:1,e=null!=e?e:null!=t?t:1,i=null!=i?i:null!=t?t:1,n=n||1,a=a||1,h=h||1,s.call(this,{vertices:!0,normals:!0,texCoords:!0,faces:!0});var c=this.vertices,u=this.texCoords,p=this.normals,d=this.faces,f=0;l("x","y","z",t,e,n,a,i/2,1,-1),l("x","y","z",t,e,n,a,-i/2,-1,-1),l("z","y","x",i,e,h,a,-t/2,1,-1),l("z","y","x",i,e,h,a,t/2,-1,-1),l("x","z","y",t,i,n,h,e/2,1,1),l("x","z","y",t,i,n,h,-e/2,1,-1),this.computeEdges()}var n=t("pex-geom"),r=n.Vec2,o=n.Vec3,s=n.Geometry;i.prototype=Object.create(s.prototype),e.exports=i},{"pex-geom":23}],11:[function(t,e){function i(t,e,i,n,a,h,l,c){e=null!=e?e:.5,t=null!=t?t:.5,i=null!=i?i:1,n=null!=n?n:8,a=null!=a?a:4,h=null!=h?h:!0,l=null!=l?l:!0,c=null!=c?c:!0,s.call(this,{vertices:!0,normals:!0,texCoords:!0,faces:!0});var u=this.vertices,p=this.texCoords,d=this.normals,f=this.faces,g=0,m=-i/2;c||(m=0);for(var v=0;a>=v;v++)for(var x=0;n>=x;x++){var y=t+(e-t)*v/a,w=m+i*v/a,b=y*Math.cos(x/n*Math.PI*2),C=y*Math.sin(x/n*Math.PI*2);u.push(new o(b,w,C)),d.push(new o(b,0,C)),p.push(new r(x/n,v/a)),n>x&&a>v&&f.push([g+1,g,g+n+1,g+n+1+1]),g++}if(h){u.push(new o(0,m,0)),d.push(new o(0,-1,0)),p.push(new r(0,0));var P=g;g++;for(var x=0;n>=x;x++){var w=m,b=t*Math.cos(x/n*Math.PI*2),C=t*Math.sin(x/n*Math.PI*2);u.push(new o(b,w,C)),n>x&&f.push([g,g+1,P]),d.push(new o(0,-1,0)),p.push(new r(0,0)),g++}}if(l){u.push(new o(0,m+i,0)),d.push(new o(0,1,0)),p.push(new r(0,0));var P=g;g++;for(var x=0;n>=x;x++){var w=m+i,b=e*Math.cos(x/n*Math.PI*2),C=e*Math.sin(x/n*Math.PI*2);u.push(new o(b,w,C)),n>x&&f.push([g+1,g,P]),d.push(new o(0,1,0)),p.push(new r(1,1)),g++}}this.computeEdges()}var n=t("pex-geom"),r=n.Vec2,o=n.Vec3,s=n.Geometry;i.prototype=Object.create(s.prototype),e.exports=i},{"pex-geom":23}],12:[function(t,e){function i(t){t=t||.5;var e=(1+Math.sqrt(5))/2,i=.5,n=.5/e,s=.5*(2-e),a=[new r(s,0,i),new r(-s,0,i),new r(-n,n,n),new r(0,i,s),new r(n,n,n),new r(n,-n,n),new r(0,-i,s),new r(-n,-n,n),new r(s,0,-i),new r(-s,0,-i),new r(-n,-n,-n),new r(0,-i,-s),new r(n,-n,-n),new r(n,n,-n),new r(0,i,-s),new r(-n,n,-n),new r(i,s,0),new r(-i,s,0),new r(-i,-s,0),new r(i,-s,0)];a=a.map(function(e){return e.normalize().scale(t)});var h=[[4,3,2,1,0],[7,6,5,0,1],[12,11,10,9,8],[15,14,13,8,9],[14,3,4,16,13],[3,14,15,17,2],[11,6,7,18,10],[6,11,12,19,5],[4,0,5,19,16],[12,8,13,16,19],[15,9,10,18,17],[7,1,2,17,18]],l=[[0,1],[0,4],[0,5],[1,2],[1,7],[2,3],[2,17],[3,4],[3,14],[4,16],[5,6],[5,19],[6,7],[6,11],[7,18],[8,9],[8,12],[8,13],[9,10],[9,15],[10,11],[10,18],[11,12],[12,19],[13,14],[13,16],[14,15],[15,17],[16,19],[17,18]];o.call(this,{vertices:a,faces:h,edges:l})}var n=t("pex-geom"),r=n.Vec3,o=n.Geometry;i.prototype=Object.create(o.prototype),e.exports=i},{"pex-geom":23}],13:[function(t,e){function i(t){return t.face.halfEdges[(t.slot-1+t.face.length)%t.face.length]}function n(t,e){var n=t;do e(n),n=i(n).opposite;while(n!=t)}function r(t){var e=(t.length,t.reduce(function(t,e){return t.add(e)},new h(0,0,0)));return e.scale(1/t.length),e}function o(t,e){return e.map(function(e){return t[e]})}function s(t,e){t=t||.5,e=e||1;for(var i=new c(t),s=0;e>s;s++)i=i.subdivideEdges();var a=[],h=[],u=[],p=i.computeHalfEdges();p.forEach(function(t){u[t.face[t.slot]]=t});for(var s=0;s<i.vertices.length;s++){var d=a.length,f=[];n(u[s],function(t){var e=r(o(i.vertices,t.face));f.push(e)}),f.forEach(function(t){a.push(t)}),5==f.length&&h.push([d,d+1,d+2,d+3,d+4]),6==f.length&&h.push([d,d+1,d+2,d+3,d+4,d+5])}a.forEach(function(e){e.normalize().scale(t)}),l.call(this,{vertices:a,faces:h}),this.computeEdges()}var a=t("pex-geom"),h=a.Vec3,l=a.Geometry,c=t("./Icosahedron");s.prototype=Object.create(l.prototype),e.exports=s},{"./Icosahedron":14,"pex-geom":23}],14:[function(t,e){function i(t){t=t||.5;var e=(1+Math.sqrt(5))/2,i=.5,n=1/(2*e),s=[new r(0,n,-i),new r(n,i,0),new r(-n,i,0),new r(0,n,i),new r(0,-n,i),new r(-i,0,n),new r(i,0,n),new r(0,-n,-i),new r(i,0,-n),new r(-i,0,-n),new r(n,-i,0),new r(-n,-i,0)];s=s.map(function(e){return e.normalize().scale(t)});var a=[[1,0,2],[2,3,1],[4,3,5],[6,3,4],[7,0,8],[9,0,7],[10,4,11],[11,7,10],[5,2,9],[9,11,5],[8,1,6],[6,10,8],[5,3,2],[1,3,6],[2,0,9],[8,0,1],[9,7,11],[10,7,8],[11,4,5],[6,4,10]],h=[[0,1],[0,2],[0,7],[0,8],[0,9],[1,2],[1,3],[1,6],[1,8],[2,3],[2,5],[2,9],[3,4],[3,5],[3,6],[4,5],[4,6],[4,10],[4,11],[5,9],[5,11],[6,8],[6,10],[7,8],[7,9],[7,10],[7,11],[8,10],[9,11],[10,11]];o.call(this,{vertices:s,faces:a,edges:h})}var n=t("pex-geom"),r=n.Vec3,o=n.Geometry;i.prototype=Object.create(o.prototype),e.exports=i},{"pex-geom":23}],15:[function(t,e){function i(t,e){e=e||1,this.numOfGridPts=t,this.tresholdValue=1,this.makeGrid(e)}var n=t("pex-geom"),r=n.Vec2,o=n.Vec3,s=n.Geometry;i.prototype.makeGrid=function(t){2/(this.numOfGridPts-1);this.grid=[];for(var e=0;e<this.numOfGridPts;e++){this.grid[e]=[];for(var i=0;i<this.numOfGridPts;i++){this.grid[e][i]=[];for(var n=0;n<this.numOfGridPts;n++)this.grid[e][i][n]={value:0,position:new o((e/(this.numOfGridPts-1)-.5)*t,(i/(this.numOfGridPts-1)-.5)*t,(n/(this.numOfGridPts-1)-.5)*t),normal:new o(0,0,0)}}}this.cubes=[];for(var e=0;e<this.numOfGridPts-1;e++){this.cubes[e]=[];for(var i=0;i<this.numOfGridPts-1;i++){this.cubes[e][i]=[];for(var n=0;n<this.numOfGridPts-1;n++)this.cubes[e][i][n]={vert:[]},this.cubes[e][i][n].vert[0]=this.grid[e][i][n],this.cubes[e][i][n].vert[1]=this.grid[e+1][i][n],this.cubes[e][i][n].vert[2]=this.grid[e+1][i][n+1],this.cubes[e][i][n].vert[3]=this.grid[e][i][n+1],this.cubes[e][i][n].vert[4]=this.grid[e][i+1][n],this.cubes[e][i][n].vert[5]=this.grid[e+1][i+1][n],this.cubes[e][i][n].vert[6]=this.grid[e+1][i+1][n+1],this.cubes[e][i][n].vert[7]=this.grid[e][i+1][n+1]}}},i.prototype.update=function(t){for(var e=this.grid,i=0;i<this.numOfGridPts;i++)for(var n=0;n<this.numOfGridPts;n++)for(var r=0;r<this.numOfGridPts;r++)e[i][n][r].value=this.findValue(e[i][n][r].position,t);for(i=1;i<this.numOfGridPts-1;i++)for(n=1;n<this.numOfGridPts-1;n++)for(r=1;r<this.numOfGridPts-1;r++)e[i][n][r].normal.x=e[i-1][n][r].value-e[i+1][n][r].value,e[i][n][r].normal.y=e[i][n-1][r].value-e[i][n+1][r].value,e[i][n][r].normal.z=e[i][n][r-1].value-e[i][n][r+1].value;this.geom?(this.geom.vertices.length=0,this.geom.normals.length=0,this.geom.texCoords.length=0,this.geom.faces.length=0,this.geom.vertices.dirty=!0,this.geom.normals.dirty=!0,this.geom.texCoords.dirty=!0,this.geom.faces.dirty=!0):this.geom=new s({vertices:!0,normals:!0,texCoords:!0,faces:!0});for(var i=0;i<this.numOfGridPts-1;i++)for(var n=0;n<this.numOfGridPts-1;n++)for(var r=0;r<this.numOfGridPts-1;r++)this.marchCube(i,n,r);return this.geom},i.prototype.marchCube=function(t,e,i){var n,o,s,l,c=0,u=[{},{},{},{},{},{},{},{},{},{},{},{}],p=this.cubes[t][e][i];if(p.vert[0].value>this.tresholdValue&&(c|=1),p.vert[1].value>this.tresholdValue&&(c|=2),p.vert[2].value>this.tresholdValue&&(c|=4),p.vert[3].value>this.tresholdValue&&(c|=8),p.vert[4].value>this.tresholdValue&&(c|=16),p.vert[5].value>this.tresholdValue&&(c|=32),p.vert[6].value>this.tresholdValue&&(c|=64),p.vert[7].value>this.tresholdValue&&(c|=128),n=a[c],0!=n){1&n&&this.interpolate(p.vert[0],p.vert[1],u[0]),2&n&&this.interpolate(p.vert[1],p.vert[2],u[1]),4&n&&this.interpolate(p.vert[2],p.vert[3],u[2]),8&n&&this.interpolate(p.vert[3],p.vert[0],u[3]),16&n&&this.interpolate(p.vert[4],p.vert[5],u[4]),32&n&&this.interpolate(p.vert[5],p.vert[6],u[5]),64&n&&this.interpolate(p.vert[6],p.vert[7],u[6]),128&n&&this.interpolate(p.vert[7],p.vert[4],u[7]),256&n&&this.interpolate(p.vert[0],p.vert[4],u[8]),512&n&&this.interpolate(p.vert[1],p.vert[5],u[9]),1024&n&&this.interpolate(p.vert[2],p.vert[6],u[10]),2048&n&&this.interpolate(p.vert[3],p.vert[7],u[11]);var d=this.geom.vertices.length;for(o=0;5>o&&!(h[c][3*o]<0);o++){for(var f=u[h[c][3*o+1]].position.dup().sub(u[h[c][3*o+0]].position),g=u[h[c][3*o+2]].position.dup().sub(u[h[c][3*o+0]].position),s=(f.dup().cross(g),0);3>s;s++)l=u[h[c][3*o+s]],this.geom.vertices.push(l.position),this.geom.normals.push(l.normal),this.geom.texCoords.push(new r(.5*l.normal.x+.5,.5*l.normal.y+.5));this.geom.faces.push([d++,d++,d++])}}},i.prototype.interpolate=function(t,e,i){var n=e.value-t.value;0==n&&(n=0);var r=(this.tresholdValue-t.value)/n;i.position=t.position.dup().add(e.position.dup().sub(t.position).dup().scale(r)),i.normal=t.normal.dup().add(e.normal.dup().sub(t.normal).dup().scale(r));var o=i.normal.length();o=0==o?1:1/o,i.normal=i.normal.dup().scale(o)},i.prototype.findValue=function(t,e){for(var i=0,n=0;n<e.length;n++){var r=t.squareDistance(e[n].position);0==r&&(len=1);var o=e[n].radius,s=e[n].force;i+=s*o*o*e[n].radius/r}return i};var a=[0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0],h=[[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1],[3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1],[3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1],[3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1],[9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1],[1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1],[9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1],[2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1],[8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1],[9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1],[4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1],[3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1],[1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1],[4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1],[4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1],[9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1],[1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1],[5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1],[2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1],[9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1],[0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1],[2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1],[10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1],[4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1],[5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1],[5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1],[9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1],[0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1],[1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1],[10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1],[8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1],[2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1],[7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1],[9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1],[2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1],[11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1],[9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1],[5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1],[11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1],[11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1],[1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1],[9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1],[5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1],[2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1],[0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1],[5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1],[6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1],[0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1],[3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1],[6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1],[5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1],[1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1],[10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1],[6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1],[1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1],[8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1],[7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1],[3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1],[5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1],[0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1],[9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1],[8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1],[5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1],[0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1],[6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1],[10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1],[10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1],[8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1],[1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1],[3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1],[0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1],[10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1],[0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1],[3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1],[6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1],[9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1],[8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1],[3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1],[6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1],[0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1],[10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1],[10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1],[1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1],[2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1],[7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1],[7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1],[2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1],[1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1],[11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1],[8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1],[0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1],[7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1],[10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1],[2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1],[6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1],[7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1],[2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1],[1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1],[10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1],[10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1],[0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1],[7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1],[6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1],[8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1],[9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1],[6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1],[1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1],[4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1],[10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1],[8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1],[0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1],[1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1],[8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1],[10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1],[4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1],[10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1],[5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1],[11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1],[9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1],[6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1],[7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1],[3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1],[7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1],[9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1],[3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1],[6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1],[9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1],[1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1],[4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1],[7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1],[6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1],[3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1],[0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1],[6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1],[1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1],[0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1],[11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1],[6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1],[5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1],[9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1],[1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1],[1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1],[10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1],[0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1],[5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1],[10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1],[11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1],[0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1],[9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1],[7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1],[2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1],[8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1],[9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1],[9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1],[1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1],[9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1],[9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1],[5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1],[0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1],[10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1],[2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1],[0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1],[0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1],[9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1],[5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1],[3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1],[5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1],[8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1],[0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1],[9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1],[0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1],[1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1],[3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1],[4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1],[9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1],[11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1],[11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1],[2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1],[9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1],[3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1],[1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1],[4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1],[4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1],[0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1],[3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1],[3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1],[0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1],[9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1],[1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]];
e.exports=i},{"pex-geom":23}],16:[function(t,e){function i(){o.call(this,{vertices:!0,colors:!0})}var n=t("pex-geom"),r=n.Vec3,o=n.Geometry;i.prototype=Object.create(o.prototype),i.prototype.addLine=function(t,e,i,n){return i=i||{r:1,g:1,b:1,a:1},n=n||i,this.vertices.push(r.create().copy(t)),this.vertices.push(r.create().copy(e)),this.colors.push(i),this.colors.push(n),this.vertices.dirty=!0,this.colors.dirty=!0,this},i.prototype.addPath=function(t,e,i,n){i=i||t.points.length,e=e||{r:1,g:1,b:1,a:1};var r=t.getPointAt(0);n&&this.addCross(r,.1,e);for(var o=1;i>o;o++){var s;s=t.points.length==i?t.getPoint(o/(i-1)):t.getPointAt(o/(i-1)),this.addLine(r,s,e),r=s,n&&this.addCross(r,.1,e)}return this.vertices.dirty=!0,this.colors.dirty=!0,this},i.prototype.addCross=function(t,e,i){e=e||.1;var n=e/2;return i=i||{r:1,g:1,b:1,a:1},this.vertices.push(r.create().set(t.x-n,t.y,t.z)),this.vertices.push(r.create().set(t.x+n,t.y,t.z)),this.vertices.push(r.create().set(t.x,t.y-n,t.z)),this.vertices.push(r.create().set(t.x,t.y+n,t.z)),this.vertices.push(r.create().set(t.x,t.y,t.z-n)),this.vertices.push(r.create().set(t.x,t.y,t.z+n)),this.colors.push(i),this.colors.push(i),this.colors.push(i),this.colors.push(i),this.colors.push(i),this.colors.push(i),this},i.prototype.reset=function(){return this.vertices.length=0,this.colors.length=0,this.vertices.dirty=!0,this.colors.dirty=!0,this},e.exports=i},{"pex-geom":23}],17:[function(t,e){function i(t,e,i){return Math.max(e,Math.min(t,i))}function n(t,e){e=e||{},s.call(this,{vertices:!0,normals:!0,texCoords:!0,edges:!1,faces:!0});var i={numSteps:200,numSegments:8,r:.3,shapePath:null,xShapeScale:1,caps:!1,initialNormal:null,adjustAngle:0};t.samplesCount=5e3,e.shapePath&&!e.numSegments&&(e.numSegments=e.shapePath.points.length),this.options=e=r(i,e),this.path=t,t.isClosed()&&(e.caps=!1),this.shapePath=e.shapePath||this.makeShapePath(e.numSegments),this.adjustAngle=e.adjustAngle,this.rfunc=this.makeRadiusFunction(e.r),this.rufunc=e.ru?this.makeRadiusFunction(e.ru):this.rfunc,this.rvfunc=e.rv?this.makeRadiusFunction(e.rv):e.ru?this.rufunc:this.rfunc,this.points=this.samplePoints(t,e.numSteps,t.isClosed()),this.tangents=this.sampleTangents(t,e.numSteps,t.isClosed()),this.frames=this.makeFrames(this.points,this.tangents,t.isClosed()),this.buildGeometry(e.caps)}var r=t("merge"),o=t("pex-geom"),s=o.Geometry,a=o.Vec2,h=o.Vec3,l=o.Mat4,c=o.Quat,u=o.Path,d=o.Spline1D,f=(o.Spline3D,Math.acos),g=Math.PI,m=(Math.min,t("./LineBuilder")),v=1e-5;n.prototype=Object.create(s.prototype),n.prototype.buildGeometry=function(t){t="undefined"!=typeof t?t:!1;for(var e=0,i=this.options.numSteps,n=this.options.numSegments,r=0;r<this.frames.length;r++)for(var o=this.frames[r],s=this.rufunc(r,i),h=this.rvfunc(r,i),l=0;n>l;l++)p=n==this.shapePath.points.length?this.shapePath.getPoint(l/(n-1)):this.shapePath.getPointAt(l/(n-1)),p.x*=s,p.y*=h,p=p.transformMat4(o.m).add(o.position),this.vertices.push(p),this.texCoords.push(new a(l/n,r/i)),this.normals.push(p.dup().sub(o.position).normalize());t&&(this.vertices.push(this.frames[0].position),this.texCoords.push(new a(0,0)),this.normals.push(this.frames[0].tangent.dup().scale(-1)),this.vertices.push(this.frames[this.frames.length-1].position),this.texCoords.push(new a(0,0)),this.normals.push(this.frames[this.frames.length-1].tangent.dup().scale(-1))),e=0;for(var r=0;r<this.frames.length;r++){for(var l=0;n>l;l++)i-1>r&&this.faces.push([e+(l+1)%n+n,e+(l+1)%n,e+l,e+l+n]);e+=n}if(this.path.isClosed()){e-=n;for(var l=0;n>l;l++)this.faces.push([(l+1)%n,e+(l+1)%n,e+l,l])}if(t)for(var l=0;n>l;l++)this.faces.push([l,(l+1)%n,this.vertices.length-2]),this.faces.push([this.vertices.length-1,e-n+(l+1)%n,e-n+l])},n.prototype.makeShapePath=function(t){for(var e=new u,i=0;t>i;i++){var n=i/t,r=2*n*Math.PI,o=new h(Math.cos(r),Math.sin(r),0);e.addPoint(o)}return e.close(),e},n.prototype.makeFrames=function(t,e,n,r){null==r&&(r=0);var o=e[0],s=Math.abs(o.x),a=Math.abs(o.y),u=Math.abs(o.z),p=null;p=o.dup().cross(u>s&&u>=a?new h(0,1,0):a>s&&a>=u?new h(1,0,0):new h(0,0,1));var d=this.options.initialNormal||h.create().asCross(o,p).normalize(),m=h.create().asCross(o,d).normalize(),x=[],y=new c;p=new h;for(var w=0;w<this.points.length;w++){var b=t[w];o=e[w],w>0&&(d=d.dup(),m=m.dup(),prevTangent=e[w-1],p.asCross(prevTangent,o),p.length()>v&&(p.normalize(),theta=f(prevTangent.dot(o)),y.setAxisAngle(p,180*theta/g),d.transformQuat(y)),m.asCross(o,d));var C=(new l).set4x4r(m.x,d.x,o.x,0,m.y,d.y,o.y,0,m.z,d.z,o.z,0,0,0,0,1);x.push({tangent:o,normal:d,binormal:m,position:b,m:C})}return n&&(firstNormal=x[0].normal,lastNormal=x[x.length-1].normal,theta=Math.acos(i(firstNormal.dot(lastNormal),0,1)),theta/=x.length-1,e[0].dot(p.asCross(firstNormal,lastNormal))>0&&(theta=-theta),x.forEach(function(t,e){y.setAxisAngle(t.tangent,theta*e*180/g),t.normal.transformQuat(y),t.binormal.asCross(t.tangent,t.normal),t.m.set4x4r(t.binormal.x,t.normal.x,t.tangent.x,0,t.binormal.y,t.normal.y,t.tangent.y,0,t.binormal.z,t.normal.z,t.tangent.z,0,0,0,0,1)})),x},n.prototype.samplePoints=function(t,e,i){for(var n=[],r=i?e:e-1,o=0;e>o;o++)n.push(t.getPointAt(o/r));return n},n.prototype.sampleTangents=function(t,e,i){for(var n=[],r=i?e:e-1,o=0;e>o;o++)n.push(t.getTangentAt(o/r));return n},n.prototype.makeRadiusFunction=function(t){var e;return e=t instanceof d?function(e,i){return t.getPointAt(e/(i-1))}:function(){return t}},n.prototype.toDebugLines=function(t){t=t||.5;var e=new m,i={r:1,g:0,b:0,a:1},n={r:0,g:1,b:0,a:1},r={r:0,g:.5,b:1,a:1};return this.frames.forEach(function(o){e.addLine(o.position,o.position.dup().add(o.tangent.dup().scale(t)),i,i),e.addLine(o.position,o.position.dup().add(o.normal.dup().scale(t)),n,n),e.addLine(o.position,o.position.dup().add(o.binormal.dup().scale(t)),r,r)}),e},e.exports=n},{"./LineBuilder":16,merge:22,"pex-geom":23}],18:[function(t,e){function i(t){t=t||.5;var e=1/(2*Math.sqrt(2)),i=.5,n=(Math.sqrt(3),Math.sqrt(6),[new r(-e,0,e),new r(e,0,e),new r(e,0,-e),new r(-e,0,-e),new r(0,i,0),new r(0,-i,0)]);n=n.map(function(e){return e.normalize().scale(t)});var s=[[3,0,4],[2,3,4],[1,2,4],[0,1,4],[3,2,5],[0,3,5],[2,1,5],[1,0,5]],a=[[0,1],[1,2],[2,3],[3,0],[0,4],[1,4],[2,4],[3,4],[0,5],[1,5],[2,5],[3,5]];o.call(this,{vertices:n,faces:s,edges:a})}var n=t("pex-geom"),r=n.Vec3,o=n.Geometry;i.prototype=Object.create(o.prototype),e.exports=i},{"pex-geom":23}],19:[function(t,e){function i(t,e,i,n,a,h){t=t||1,e=e||t||1,i=i||1,n=n||i||1,a=a||"x",h=h||"y",s.call(this,{vertices:!0,normals:!0,texCoords:!0,faces:!0,edges:!0});var l=["x","y","z"];l.splice(l.indexOf(a),1),l.splice(l.indexOf(h),1),l=l[0];for(var c=this.vertices,u=this.texCoords,p=this.normals,d=this.faces,f=this.edges,g=c.length,m=0;n>=m;++m)for(var v=0;i>=v;++v){var x=new o;x[a]=-t/2+v*t/i,x[h]=e/2-m*e/n,x[l]=0,c.push(x);var y=new r(v/i,1-m/n);u.push(y);var w=new o;w[a]=0,w[h]=0,w[l]=1,p.push(w)}for(var m=0;n>m;++m)for(var v=0;i>v;++v){var b=g+m*(i+1)+v,C=[b,b+i+1,b+i+2,b+1];f.push([b,b+1]),f.push([b,b+i+1]),m==n-1&&f.push([b+i+1,b+i+2]),v==i-1&&f.push([b+1,b+i+2]),d.push(C)}}var n=t("pex-geom"),r=n.Vec2,o=n.Vec3,s=n.Geometry;i.prototype=Object.create(s.prototype),e.exports=i},{"pex-geom":23}],20:[function(t,e){function i(t,e,i){function n(e,i){var n=new o;return n.x=t*Math.sin(e*u)*Math.sin(i*u),n.y=t*Math.cos(e*u),n.z=t*Math.sin(e*u)*Math.cos(i*u),n}t=t||.5,e=e||36,i=i||18,s.call(this,{vertices:!0,normals:!0,texCoords:!0,faces:!0});for(var a=this.vertices,h=this.texCoords,l=this.normals,c=this.faces,u=1/180*Math.PI,p=360/e,d=180/i,f=0;i>=f;++f)for(var g=f*d,m=0;e>=m;++m){var v=m*p,x=n(g,v),y=x.dup().normalize(),w=new r(v/360,g/180);a.push(x),l.push(y),h.push(w),f!=i&&m!=e&&c.push(0==f?[f*(e+1)+m,(f+1)*(e+1)+m,(f+1)*(e+1)+m+1]:f==i-1?[f*(e+1)+m,(f+1)*(e+1)+m+1,f*(e+1)+m+1]:[f*(e+1)+m,(f+1)*(e+1)+m,(f+1)*(e+1)+m+1,f*(e+1)+m+1])}this.computeEdges()}var n=t("pex-geom"),r=n.Vec2,o=n.Vec3,s=n.Geometry;i.prototype=Object.create(s.prototype),e.exports=i},{"pex-geom":23}],21:[function(t,e){function i(t){t=t||.5;var e=Math.sqrt(3),i=Math.sqrt(6),n=[new r(e/3,-i/3*.333+.025*i,0),new r(-e/6,-i/3*.333+.025*i,.5),new r(-e/6,-i/3*.333+.025*i,-0.5),new r(0,i/3*.666+.025*i,0)];n=n.map(function(e){return e.normalize().scale(t)});var s=[[0,1,2],[3,1,0],[3,0,2],[3,2,1]],a=[[0,1],[0,2],[0,3],[1,2],[1,3],[2,3]];o.call(this,{vertices:n,faces:s,edges:a})}var n=t("pex-geom"),r=n.Vec3,o=n.Geometry;i.prototype=Object.create(o.prototype),e.exports=i},{"pex-geom":23}],22:[function(t,e){!function(t){function i(){var t,e,i,o=Array.prototype.slice.call(arguments),s=o.shift(),a=s===!0,h=o.length;for((a||"object"!==r(s))&&(s={}),e=0;h>e;++e)if("object"===r(t=o[e]))for(i in t)s[i]=a?n(t[i]):t[i];return s}function n(t){var e,i,o=t,s=r(t);if("array"===s)for(o=[],i=t.length,e=0;i>e;++e)o[e]=n(t[e]);else if("object"===s){o={};for(e in t)o[e]=n(t[e])}return o}function r(t){return{}.toString.call(t).match(/\s([\w]+)/)[1].toLowerCase()}t?e.exports=i:window.merge=i}("object"==typeof e&&e&&"object"==typeof e.exports&&e.exports)},{}],23:[function(t,e){e.exports.Vec2=t("./lib/Vec2"),e.exports.Vec3=t("./lib/Vec3"),e.exports.Vec4=t("./lib/Vec4"),e.exports.Mat4=t("./lib/Mat4"),e.exports.Quat=t("./lib/Quat"),e.exports.Path=t("./lib/Path"),e.exports.Rect=t("./lib/Rect"),e.exports.Spline3D=t("./lib/Spline3D"),e.exports.Spline2D=t("./lib/Spline2D"),e.exports.Spline1D=t("./lib/Spline1D"),e.exports.Ray=t("./lib/Ray"),e.exports.Plane=t("./lib/Plane"),e.exports.Geometry=t("./lib/Geometry"),e.exports.Random=t("./lib/Random"),e.exports.BoundingBox=t("./lib/BoundingBox"),e.exports.Triangle2D=t("./lib/Triangle2D"),e.exports.Triangle3D=t("./lib/Triangle3D"),e.exports.Octree=t("./lib/Octree");for(var i in e.exports.Random)e.exports[i]=e.exports.Random[i]},{"./lib/BoundingBox":24,"./lib/Geometry":25,"./lib/Mat4":26,"./lib/Octree":27,"./lib/Path":28,"./lib/Plane":29,"./lib/Quat":30,"./lib/Random":31,"./lib/Ray":32,"./lib/Rect":33,"./lib/Spline1D":34,"./lib/Spline2D":35,"./lib/Spline3D":36,"./lib/Triangle2D":37,"./lib/Triangle3D":38,"./lib/Vec2":39,"./lib/Vec3":40,"./lib/Vec4":41}],24:[function(t,e){function i(t,e){this.min=t,this.max=e}var n=t("./Vec3");i.fromPositionSize=function(t,e){return new i(n.create(t.x-e.x/2,t.y-e.y/2,t.z-e.z/2),n.create(t.x+e.x/2,t.y+e.y/2,t.z+e.z/2))},i.fromPoints=function(t){var e=new i(t[0].clone(),t[0].clone());return t.forEach(e.addPoint.bind(e)),e},i.prototype.isEmpty=function(){return this.min&&this.max?!1:!0},i.prototype.addPoint=function(t){this.isEmpty()&&(this.min=t.clone(),this.max=t.clone()),t.x<this.min.x&&(this.min.x=t.x),t.y<this.min.y&&(this.min.y=t.y),t.z<this.min.z&&(this.min.z=t.z),t.x>this.max.x&&(this.max.x=t.x),t.y>this.max.y&&(this.max.y=t.y),t.z>this.max.z&&(this.max.z=t.z)},i.prototype.getSize=function(){return n.create(this.max.x-this.min.x,this.max.y-this.min.y,this.max.z-this.min.z)},i.prototype.getCenter=function(){return n.create(this.min.x+(this.max.x-this.min.x)/2,this.min.y+(this.max.y-this.min.y)/2,this.min.z+(this.max.z-this.min.z)/2)},e.exports=i},{"./Vec3":40}],25:[function(t,e){function i(t){var e=(t.length,t.reduce(function(t,e){return t.add(e)},new c(0,0,0)));return e.scale(1/t.length),e}function n(t,e){var i=t,n=0;do e(i,n++),i=o(i);while(i!=t)}function r(t,e){var i=t;do e(i),i=s(i).opposite;while(i!=t)}function o(t){return t.face.halfEdges[(t.slot+1)%t.face.length]}function s(t){return t.face.halfEdges[(t.slot-1+t.face.length)%t.face.length]}function a(t,e){return e.map(function(e){return t[e]})}function h(t,e,i){return e.dup().sub(t).normalize().scale(i).add(t)}function l(t){t=t||{},this.attribs={},t.vertices&&this.addAttrib("vertices","position",t.vertices,!1),t.normals&&this.addAttrib("normals","normal",t.normals,!1),t.texCoords&&this.addAttrib("texCoords","texCoord",t.texCoords,!1),t.tangents&&this.addAttrib("tangents","tangent",t.tangents,!1),t.colors&&this.addAttrib("colors","color",t.colors,!1),t.indices&&this.addIndices(t.indices),t.edges&&this.addEdges(t.edges),t.faces&&this.addFaces(t.faces)}var c=t("./Vec3"),u=t("./Ray"),p=t("./BoundingBox");l.prototype.generateVolumePoints=function(t){t=t||5e3;for(var e=p.fromPoints(this.vertices),i=-e.min.x+e.max.x,n=-e.min.y+e.max.y,r=-e.min.z+e.max.z,o=0,s=[],a=[],h=0;!(o>=t);h++){var l=Math.floor(6*Math.random())+1,d=bottomX=(Math.random()-.5)*i,f=(Math.random()+.5)*n,g=bottomZ=(Math.random()-.5)*r,m=-f,v=-(Math.random()+.5)*i,x=rightY=(Math.random()-.5)*n,y=rightZ=(Math.random()-.5)*r,w=-v,b=frontX=(Math.random()-.5)*i,C=frontY=(Math.random()-.5)*n,P=-(Math.random()+.5)*r,M=-P;switch(l){case 1:var E=new c(v,x,y),T=new c(w,rightY,rightZ);break;case 2:var E=new c(w,rightY,rightZ),T=new c(v,x,y);break;case 3:var E=new c(d,f,g),T=new c(bottomX,m,m);break;case 4:var E=new c(bottomX,m,bottomZ),T=new c(d,f,g);break;case 5:var E=new c(b,C,P),T=new c(frontX,frontY,M);break;case 6:var E=new c(frontX,frontY,M),T=new c(b,C,P)}var R=E.dup(),A=T.dup().sub(E).normalize(),S=this.clone().triangulate(),z=0,_=[];if(S.faces.forEach(function(t){var e={};e.a=S.vertices[t[0]],e.b=S.vertices[t[1]],e.c=S.vertices[t[2]];var i=new u(R,A),n=i.hitTestTriangle(e);isNaN(n)&&(o++,z++,_.push(n))}),_.forEach(function(t){z%2===0&&s.push(t)}),!(s.length<2)){var N=s[s.length-2],L=s[s.length-1],D=L.dup().sub(N),B=N.dup().addScaled(D,Math.random());a.push(B)}}return a},l.prototype.generateSurfacePoints=function(t){t=t||5e3;for(var e=[],i=[],n=0,r=this.faces.length;r>n;n++){var o={},s=this.faces[n][0],a=this.faces[n][1],h=this.faces[n][2],l=this.vertices[s],c=this.vertices[a],u=this.vertices[h],p=c.dup().sub(l),d=u.dup().sub(l),f=p.cross(d),g=.5*Math.sqrt(f.x*f.x+f.y*f.y+f.z*f.z);o.A=l,o.B=c,o.C=u,i.push(o),e.push(g)}var m=Math.min.apply(Math,e),v=e.map(function(t){return Math.ceil(t/m)}),x=[];v.forEach(function(t,e){for(var i=0;t>i;i++)x.push(e)});for(var y=[],w=0;t>w;w++){var b=Math.ceil(Math.random()*x.length)-1,o=i[x[b]],l=o.A.clone(),c=o.B.clone(),u=o.C.clone(),C=Math.random(),P=Math.random();C+P>1&&(C=1-C,P=1-P);var M=1-(C+P),E=l.dup().scale(C),T=c.dup().scale(P),R=u.dup().scale(M),A=E.add(T).add(R);y.push(A)}return y},l.prototype.addAttrib=function(t,e,i,n){return null==i&&(i=null),null==n&&(n=!1),this[t]=i&&i.length?i:[],this[t].name=e,this[t].dirty=!0,this[t].dynamic=n,this.attribs[t]=this[t],this},l.prototype.addFaces=function(t,e){return null==t&&(t=null),null==e&&(e=!1),this.faces=t&&t.length?t:[],this.faces.dirty=!0,this.faces.dynamic=!1,this},l.prototype.addEdges=function(t,e){return null==t&&(t=null),null==e&&(e=!1),this.edges=t&&t.length?t:[],this.edges.dirty=!0,this.edges.dynamic=!1,this},l.prototype.addIndices=function(t,e){return null==t&&(t=null),null==e&&(e=!1),this.indices=t&&t.length?t:[],this.indices.dirty=!0,this.indices.dynamic=!1,this},l.prototype.isDirty=function(){var t=!1;t||(t=this.faces&&this.faces.dirty),t||(t=this.edges&&this.edges.dirty);for(attribAlias in this.attribs){var e=this.attribs[attribAlias];t||(t=e.dirty)}return t},l.prototype.addEdge=function(t,e){this.edges||this.addEdges(),this.edgeHash||(this.edgeHash={});var i=t+"_"+e,n=e+"_"+t;return this.edgeHash[i]||this.edgeHash[n]?void 0:(this.edges.push([t,e]),this.edgeHash[i]=this.edgeHash[n]=!0)},l.prototype.computeEdges=function(){if(this.edges?(this.edgeHash=null,this.edges.length=0):this.addEdges(),this.faces&&this.faces.length)this.faces.forEach(function(t){for(var e=0;e<t.length;e++)this.addEdge(t[e],t[(e+1)%t.length])}.bind(this));else for(var t=0;t<this.vertices.length-1;t++)this.addEdge(t,t+1)},l.prototype.computeNormals=function(){if(!this.faces)throw"Geometry[2]omputeSmoothNormals no faces found";if(this.normals||this.addAttrib("normals","normal",null,!1),this.normals.length>this.vertices.length)this.normals.length=this.vertices.length;else for(;this.normals.length<this.vertices.length;)this.normals.push(new c(0,0,0));var t=[];this.vertices.forEach(function(e,i){t[i]=0}.bind(this));var e=new c,i=new c,n=new c;this.faces.forEach(function(r){var o=this.vertices[r[0]],s=this.vertices[r[1]],a=this.vertices[r[2]];e.asSub(s,o).normalize(),i.asSub(a,o).normalize(),n.asCross(e,i);for(var h=0;h<r.length;h++)this.normals[r[h]].add(n),t[r[h]]++}.bind(this)),this.normals.forEach(function(t){t.normalize()})},l.prototype.toFlatGeometry=function(){var t=new l({vertices:!0,faces:!0}),e=this.vertices;return this.faces.forEach(function(i){var n=[];i.forEach(function(i){n.push(t.vertices.length),t.vertices.push(e[i])}),t.faces.push(n)}),t},l.prototype.clone=function(){var t=null,e=this.vertices.map(function(t){return t.dup()}),i=this.texCoords?this.texCoords.map(function(t){return t.dup()}):null,n=this.faces.map(function(t){return t.slice(0)}),t=this.edges?this.edges.map(function(t){return t.slice(0)}):null;return new l({vertices:e,texCoords:i,faces:n,edges:t})},l.prototype.triangulate=function(){var t=this.clone();return t.faces=[],this.faces.forEach(function(e){t.faces.push([e[0],e[1],e[2]]);for(var i=2;i<e.length-1;i++)t.faces.push([e[0],e[i],e[i+1]])}),t},l.prototype.computeHalfEdges=function(){var t=this.halfEdges=[],e=this.faces;e.forEach(function(e,i){e.halfEdges=[],e.forEach(function(n,r){var o=n,s=e[(r+1)%e.length],a={edgeIndex:t.length,face:e,faceIndex:i,slot:r,opposite:null,v0:Math.min(o,s),v1:Math.max(o,s)};e.halfEdges.push(a),t.push(a)})}),t.sort(function(t,e){return t.v0>e.v0?1:t.v0<e.v0?-1:t.v1>e.v1?1:t.v1<e.v1?-1:0});for(var i=1;i<t.length;i++){var n=t[i-1],r=t[i];n.v0==r.v0&&n.v1==r.v1&&(n.opposite=r,r.opposite=n)}return t},l.prototype.subdivideEdges=function(){var t=this.vertices,e=this.faces,s=this.computeHalfEdges(),a=t.map(function(t){return t}),h=[],c=[];s.forEach(function(e){if(!c[e.edgeIndex]){var n=i([t[e.face[e.slot]],t[o(e).face[o(e).slot]]]);c[e.edgeIndex]=n,c[e.opposite.edgeIndex]=n,a.push(n)}}),e.forEach(function(t){var e=[];n(t.halfEdges[0],function(t){e.push(a.indexOf(c[t.edgeIndex]))}),h.push(e)});var u=[];s.forEach(function(t){if(-1===u.indexOf(t.face[t.slot])){u.push(t.face[t.slot]);var e=[];r(t,function(t){e.push(a.indexOf(c[t.edgeIndex]))}),e.forEach(function(i,n){var r=e[(n+1)%e.length];h.push([t.face[t.slot],i,r])})}});var p=new l({vertices:a,faces:h});return p.computeEdges(),p},l.prototype.getFaceVertices=function(t){return t.map(function(t){return this.vertices[t]}.bind(this))},l.prototype.catmullClark=function(){var t=this.vertices,e=this.faces,s=this.computeHalfEdges(),a=e.map(this.getFaceVertices.bind(this)).map(i),h=[];s.forEach(function(e){if(!h[e.edgeIndex]){var n=i([t[e.v0],t[e.v1],a[e.faceIndex],a[e.opposite.faceIndex]]);h[e.edgeIndex]=n,h[e.opposite.edgeIndex]=n}});var u=[];s.map(function(n){var o=e[n.faceIndex][n.slot],s=t[o];if(!u[o]){var h=[],l=[];r(n,function(e){h.push(a[e.faceIndex]),l.push(i([t[e.v0],t[e.v1]]))});var p=i(h),d=i(l),f=h.length,g=new c(0,0,0);g.add(p),g.add(d.dup().scale(2)),g.add(s.dup().scale(f-3)),g.scale(1/f),u[o]=g}});var p=u.concat(a);s.forEach(function(t){t.added>-1||(t.added=p.length,t.opposite.added=p.length,p.push(h[t.edgeIndex]))});var d=[],f=[];return e.forEach(function(t,e){var i=e+u.length;n(t.halfEdges[0],function(e){var n=e.added,r=o(e),s=t[r.slot],a=r.added;f.push([i,n]),f.push([n,s]),d.push([i,n,s,a])})}),new l({vertices:p,faces:d,edges:f})},l.prototype.dooSabin=function(t){var e=this.vertices,c=this.faces,u=this.computeHalfEdges(),p=[],d=[],f=[];t=t||.1;var g=[];return c.forEach(function(r,o){var l=g[o]=[];return n(r.halfEdges[0],function(n){var r=e[n.face[n.slot]],o=i([r,i(a(e,n.face)),i(a(e,[n.v0,n.v1])),i(a(e,[s(n).v0,s(n).v1]))]);l.push(p.length),p.push(h(r,o,t))}),l}),c.forEach(function(t,e){d.push(g[e])}),u.forEach(function(t){if(!t.edgeVisited){t.edgeVisited=!0,t.opposite.edgeVisited=!0;var e=t,i=o(e.opposite),n=e.opposite,r=o(e),s=[g[e.faceIndex][e.slot],g[i.faceIndex][i.slot],g[n.faceIndex][n.slot],g[r.faceIndex][r.slot]];d.push(s),f.push([s[0],s[3]]),f.push([s[1],s[2]])}}),u.forEach(function(t){if(!t.vertexVisited){var e=[];r(t,function(t){t.vertexVisited=!0,e.push(g[t.faceIndex][t.slot])}),d.push(e),e.forEach(function(t,i){f.push([t,e[(i+1)%e.length]])})}}),new l({vertices:p,faces:d,edges:f})},l.prototype.wire=function(t,e){e=null!=e?e:t||.1,t=t||.1;var i=this.dooSabin(t);i.computeNormals();var r=(i.computeHalfEdges(),this.dooSabin(t));r.computeNormals(),r.vertices.forEach(function(t,i){t.sub(r.normals[i].dup().scale(e))});var o=i.faces.splice(0,this.faces.length);r.faces.splice(0,this.faces.length);var a=i.vertices.length;return r.vertices.forEach(function(t){i.vertices.push(t)}),r.faces.forEach(function(t){i.faces.push(t.map(function(t){return t+a}).reverse())}),r.edges.forEach(function(t){i.edges.push(t.map(function(t){return t+a}))}),o.forEach(function(t){n(t.halfEdges[0],function(t){var e=s(t);i.faces.push([e.face[e.slot],t.face[t.slot],t.face[t.slot]+a,e.face[e.slot]+a]),i.edges.push([e.face[e.slot],e.face[e.slot]+a]),i.edges.push([t.face[t.slot],t.face[t.slot]+a])})}),i},l.prototype.extrude=function(t,e,r){t=t||.1,r=r||0,e||(e=this.faces.map(function(t,e){return e}));var s=this.clone(),h=(s.computeHalfEdges(),new c),l=new c,u=new c,p=new c;return e.forEach(function(e){var c=s.faces[e],d=a(s.vertices,c),f=s.texCoords?a(s.texCoords,c):null,g=d[0],m=d[1],v=d[2];h.asSub(m,g).normalize(),l.asSub(v,g).normalize(),u.asCross(h,l).normalize(),u.scale(t);var x=d.map(function(t){return t.dup().add(u)}),y=[];if(x.forEach(function(t){y.push(s.vertices.length),s.vertices.push(t)}),f){var w=f.map(function(t){return t.dup()});w.forEach(function(t){s.texCoords.push(t)})}if(r){var v=i(x);x.forEach(function(t){p.asSub(v,t),p.scale(r),t.add(p)})}n(c.halfEdges[0],function(t){s.faces.push([c[t.slot],c[o(t).slot],y[o(t).slot],y[t.slot]])}),s.edges&&(y.forEach(function(t,e){s.edges.push([t,c[e]])}),y.forEach(function(t,e){s.edges.push([t,y[(e+1)%y.length]])})),y.forEach(function(t,e){c[e]=t})}),s},e.exports=l},{"./BoundingBox":24,"./Ray":32,"./Vec3":40}],26:[function(t,e){function i(){this.reset()}var n=t("./Vec3");i.create=function(){return new i},i.prototype.equals=function(t,e){return null==e&&(e=1e-7),Math.abs(t.a11-this.a11)<=e&&Math.abs(t.a12-this.a12)<=e&&Math.abs(t.a13-this.a13)<=e&&Math.abs(t.a14-this.a14)<=e&&Math.abs(t.a21-this.a21)<=e&&Math.abs(t.a22-this.a22)<=e&&Math.abs(t.a23-this.a23)<=e&&Math.abs(t.a24-this.a24)<=e&&Math.abs(t.a31-this.a31)<=e&&Math.abs(t.a32-this.a32)<=e&&Math.abs(t.a33-this.a33)<=e&&Math.abs(t.a34-this.a34)<=e&&Math.abs(t.a41-this.a41)<=e&&Math.abs(t.a42-this.a42)<=e&&Math.abs(t.a43-this.a43)<=e&&Math.abs(t.a44-this.a44)<=e},i.prototype.hash=function(){return.01*this.a11+.02*this.a12+.03*this.a13+.04*this.a14+.05*this.a21+.06*this.a22+.07*this.a23+.08*this.a24+.09*this.a31+.1*this.a32+.11*this.a33+.12*this.a34+.13*this.a41+.14*this.a42+.15*this.a43+.16*this.a44},i.prototype.set4x4r=function(t,e,i,n,r,o,s,a,h,l,c,u,p,d,f,g){return this.a11=t,this.a12=e,this.a13=i,this.a14=n,this.a21=r,this.a22=o,this.a23=s,this.a24=a,this.a31=h,this.a32=l,this.a33=c,this.a34=u,this.a41=p,this.a42=d,this.a43=f,this.a44=g,this},i.prototype.copy=function(t){return this.a11=t.a11,this.a12=t.a12,this.a13=t.a13,this.a14=t.a14,this.a21=t.a21,this.a22=t.a22,this.a23=t.a23,this.a24=t.a24,this.a31=t.a31,this.a32=t.a32,this.a33=t.a33,this.a34=t.a34,this.a41=t.a41,this.a42=t.a42,this.a43=t.a43,this.a44=t.a44,this},i.prototype.dup=function(){return i.create().copy(this)},i.prototype.reset=function(){return this.set4x4r(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},i.prototype.identity=function(){return this.reset(),this},i.prototype.mul4x4r=function(t,e,i,n,r,o,s,a,h,l,c,u,p,d,f,g){var m=this.a11,v=this.a12,x=this.a13,y=this.a14,w=this.a21,b=this.a22,C=this.a23,P=this.a24,M=this.a31,E=this.a32,T=this.a33,R=this.a34,A=this.a41,S=this.a42,z=this.a43,_=this.a44;return this.a11=m*t+v*r+x*h+y*p,this.a12=m*e+v*o+x*l+y*d,this.a13=m*i+v*s+x*c+y*f,this.a14=m*n+v*a+x*u+y*g,this.a21=w*t+b*r+C*h+P*p,this.a22=w*e+b*o+C*l+P*d,this.a23=w*i+b*s+C*c+P*f,this.a24=w*n+b*a+C*u+P*g,this.a31=M*t+E*r+T*h+R*p,this.a32=M*e+E*o+T*l+R*d,this.a33=M*i+E*s+T*c+R*f,this.a34=M*n+E*a+T*u+R*g,this.a41=A*t+S*r+z*h+_*p,this.a42=A*e+S*o+z*l+_*d,this.a43=A*i+S*s+z*c+_*f,this.a44=A*n+S*a+z*u+_*g,this},i.prototype.perspective=function(t,e,i,n){var r=1/Math.tan(t/180*Math.PI/2),o=1/(n-i);return this.mul4x4r(r/e,0,0,0,0,r,0,0,0,0,-(n+i)*o,-2*n*i*o,0,0,-1,0),this},i.prototype.ortho=function(t,e,i,n,r,o){return this.mul4x4r(2/(e-t),0,0,(e+t)/(t-e),0,2/(n-i),0,(n+i)/(i-n),0,0,2/(r-o),(o+r)/(r-o),0,0,0,1),this},i.prototype.lookAt=function(t,e,i){var r=n.create(t.x-e.x,t.y-e.y,t.z-e.z).normalize(),o=n.create(i.x,i.y,i.z).cross(r).normalize(),s=n.create().copy(r).cross(o).normalize();return this.mul4x4r(o.x,o.y,o.z,0,s.x,s.y,s.z,0,r.x,r.y,r.z,0,0,0,0,1),this.translate(-t.x,-t.y,-t.z),this},i.prototype.translate=function(t,e,i){return this.mul4x4r(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this},i.prototype.rotate=function(t,e,i,n){var r=Math.sin(t),o=Math.cos(t);return this.mul4x4r(e*e*(1-o)+o,e*i*(1-o)-n*r,e*n*(1-o)+i*r,0,i*e*(1-o)+n*r,i*i*(1-o)+o,i*n*(1-o)-e*r,0,e*n*(1-o)-i*r,i*n*(1-o)+e*r,n*n*(1-o)+o,0,0,0,0,1),this},i.prototype.asMul=function(t,e){var i=t.a11,n=t.a12,r=t.a13,o=t.a14,s=t.a21,a=t.a22,h=t.a23,l=t.a24,c=t.a31,u=t.a32,p=t.a33,d=t.a34,f=t.a41,g=t.a42,m=t.a43,v=t.a44,x=e.a11,y=e.a12,w=e.a13,b=e.a14,C=e.a21,P=e.a22,M=e.a23,E=e.a24,T=e.a31,R=e.a32,A=e.a33,S=e.a34,z=e.a41,_=e.a42,N=e.a43,L=e.a44;return this.a11=i*x+n*C+r*T+o*z,this.a12=i*y+n*P+r*R+o*_,this.a13=i*w+n*M+r*A+o*N,this.a14=i*b+n*E+r*S+o*L,this.a21=s*x+a*C+h*T+l*z,this.a22=s*y+a*P+h*R+l*_,this.a23=s*w+a*M+h*A+l*N,this.a24=s*b+a*E+h*S+l*L,this.a31=c*x+u*C+p*T+d*z,this.a32=c*y+u*P+p*R+d*_,this.a33=c*w+u*M+p*A+d*N,this.a34=c*b+u*E+p*S+d*L,this.a41=f*x+g*C+m*T+v*z,this.a42=f*y+g*P+m*R+v*_,this.a43=f*w+g*M+m*A+v*N,this.a44=f*b+g*E+m*S+v*L,this},i.prototype.mul=function(t){return this.asMul(this,t)},i.prototype.scale=function(t,e,i){return this.mul4x4r(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this},i.prototype.invert=function(){var t=this.a11,e=this.a12,i=this.a13,n=this.a14,r=this.a21,o=this.a22,s=this.a23,a=this.a24,h=this.a31,l=this.a32,c=this.a33,u=this.a34,p=this.a41,d=this.a42,f=this.a43,g=this.a44,m=t*o-e*r,v=t*s-i*r,x=t*a-n*r,y=e*s-i*o,w=e*a-n*o,b=i*a-n*s,C=h*d-l*p,P=h*f-c*p,M=h*g-u*p,E=l*f-c*d,T=l*g-u*d,R=c*g-u*f,A=1/(m*R-v*T+x*E+y*M-w*P+b*C);return this.a11=(+o*R-s*T+a*E)*A,this.a12=(-e*R+i*T-n*E)*A,this.a13=(+d*b-f*w+g*y)*A,this.a14=(-l*b+c*w-u*y)*A,this.a21=(-r*R+s*M-a*P)*A,this.a22=(+t*R-i*M+n*P)*A,this.a23=(-p*b+f*x-g*v)*A,this.a24=(+h*b-c*x+u*v)*A,this.a31=(+r*T-o*M+a*C)*A,this.a32=(-t*T+e*M-n*C)*A,this.a33=(+p*w-d*x+g*m)*A,this.a34=(-h*w+l*x-u*m)*A,this.a41=(-r*E+o*P-s*C)*A,this.a42=(+t*E-e*P+i*C)*A,this.a43=(-p*y+d*v-f*m)*A,this.a44=(+h*y-l*v+c*m)*A,this},i.prototype.transpose=function(){var t=this.a11,e=this.a12,i=this.a13,n=this.a14,r=this.a21,o=this.a22,s=this.a23,a=this.a24,h=this.a31,l=this.a32,c=this.a33,u=this.a34,p=this.a41,d=this.a42,f=this.a43,g=this.a44;return this.a11=t,this.a12=r,this.a13=h,this.a14=p,this.a21=e,this.a22=o,this.a23=l,this.a24=d,this.a31=i,this.a32=s,this.a33=c,this.a34=f,this.a41=n,this.a42=a,this.a43=u,this.a44=g,this},i.prototype.toArray=function(){return[this.a11,this.a21,this.a31,this.a41,this.a12,this.a22,this.a32,this.a42,this.a13,this.a23,this.a33,this.a43,this.a14,this.a24,this.a34,this.a44]},i.prototype.fromArray=function(t){return this.a11=t[0](this.a21=t[1](this.a31=t[2](this.a41=t[3]))),this.a12=t[4](this.a22=t[5](this.a32=t[6](this.a42=t[7]))),this.a13=t[8](this.a23=t[9](this.a33=t[10](this.a43=t[11]))),this.a14=t[12](this.a24=t[13](this.a34=t[14](this.a44=t[15]))),this},e.exports=i},{"./Vec3":40}],27:[function(t,e){function i(t,e){this.maxDistance=Math.max(e.x,Math.max(e.y,e.z)),this.accuracy=0,this.root=new i.Cell(this,t,e,0)}var n=t("pex-geom"),r=n.Vec3;i.fromBoundingBox=function(t){return new i(t.min.clone(),t.getSize().clone())},i.MaxLevel=8,i.prototype.add=function(t,e){this.root.add(t,e)},i.prototype.has=function(t){return this.root.has(t)},i.prototype.findNearestPoint=function(t,e){e.includeData=e.includeData?e.includeData:!1,e.bestDist=e.maxDist?e.maxDist:1/0,e.notSelf=e.notSelf?e.notSelf:!1;var i=this.root.findNearestPoint(t,e);return i?e.includeData?i:i.point:null},i.prototype.findNearbyPoints=function(t,e,i){i=i||{};var n={points:[],data:[]};return this.root.findNearbyPoints(t,e,n,i),n},i.prototype.getAllCellsAtLevel=function(t,e,i){return"undefined"==typeof e&&(e=t,t=this.root),i=i||[],t.level==e?(t.points.length>0&&i.push(t),i):(t.children.forEach(function(t){this.getAllCellsAtLevel(t,e,i)}.bind(this)),i)},i.Cell=function(t,e,i,n){this.tree=t,this.position=e,this.size=i,this.level=n,this.points=[],this.data=[],this.temp=new r,this.children=[]},i.Cell.prototype.has=function(t){if(!this.contains(t))return null;if(this.children.length>0){for(var e=0;e<this.children.length;e++){var i=this.children[e].has(t);if(i)return i}return null}for(var n=this.tree.accuracy*this.tree.accuracy,e=0;e<this.points.length;e++){var r=this.points[e],o=t.squareDistance(r);if(n>=o)return r}return null},i.Cell.prototype.add=function(t,e){this.points.push(t),this.data.push(e),this.children.length>0?this.addToChildren(t,e):this.points.length>1&&this.level<i.MaxLevel&&this.split()},i.Cell.prototype.addToChildren=function(t,e){for(var i=0;i<this.children.length;i++)if(this.children[i].contains(t)){this.children[i].add(t,e);break}},i.Cell.prototype.contains=function(t){return t.x>=this.position.x-this.tree.accuracy&&t.y>=this.position.y-this.tree.accuracy&&t.z>=this.position.z-this.tree.accuracy&&t.x<this.position.x+this.size.x+this.tree.accuracy&&t.y<this.position.y+this.size.y+this.tree.accuracy&&t.z<this.position.z+this.size.z+this.tree.accuracy},i.Cell.prototype.split=function(){var t=this.position.x,e=this.position.y,n=this.position.z,o=this.size.x/2,s=this.size.y/2,a=this.size.z/2;this.children.push(new i.Cell(this.tree,r.create(t,e,n),r.create(o,s,a),this.level+1)),this.children.push(new i.Cell(this.tree,r.create(t+o,e,n),r.create(o,s,a),this.level+1)),this.children.push(new i.Cell(this.tree,r.create(t,e,n+a),r.create(o,s,a),this.level+1)),this.children.push(new i.Cell(this.tree,r.create(t+o,e,n+a),r.create(o,s,a),this.level+1)),this.children.push(new i.Cell(this.tree,r.create(t,e+s,n),r.create(o,s,a),this.level+1)),this.children.push(new i.Cell(this.tree,r.create(t+o,e+s,n),r.create(o,s,a),this.level+1)),this.children.push(new i.Cell(this.tree,r.create(t,e+s,n+a),r.create(o,s,a),this.level+1)),this.children.push(new i.Cell(this.tree,r.create(t+o,e+s,n+a),r.create(o,s,a),this.level+1));for(var h=0;h<this.points.length;h++)this.addToChildren(this.points[h],this.data[h])},i.Cell.prototype.squareDistanceToCenter=function(t){var e=t.x-(this.position.x+this.size.x/2),i=t.y-(this.position.y+this.size.y/2),n=t.z-(this.position.z+this.size.z/2);return e*e+i*i+n*n},i.Cell.prototype.findNearestPoint=function(t,e){var i=null,n=null,r=e.bestDist;if(this.points.length>0&&0==this.children.length)for(var o=0;o<this.points.length;o++){var s=this.points[o].distance(t);if(r>=s){if(0==s&&e.notSelf)continue;r=s,i=this.points[o],n=this.data[o]}}var a=this.children,a=this.children.map(function(e){return{child:e,dist:e.squareDistanceToCenter(t)}}).sort(function(t,e){return t.dist-e.dist}).map(function(t){return t.child});if(a.length>0)for(var o=0;o<a.length;o++){var h=a[o];if(h.points.length>0){if(t.x<h.position.x-r||t.x>h.position.x+h.size.x+r||t.y<h.position.y-r||t.y>h.position.y+h.size.y+r||t.z<h.position.z-r||t.z>h.position.z+h.size.z+r)continue;var l=h.findNearestPoint(t,e);if(!l||!l.point)continue;var c=l.point.distance(t);r>c&&(i=l.point,r=c,n=l.data)}}return{point:i,data:n}},i.Cell.prototype.findNearbyPoints=function(t,e,i,n){if(this.points.length>0&&0==this.children.length)for(var r=0;r<this.points.length;r++){var o=this.points[r].distance(t);if(e>=o){if(0==o&&n.notSelf)continue;i.points.push(this.points[r]),n.includeData&&i.data.push(this.data[r])}}var s=this.children;if(s.length>0)for(var r=0;r<s.length;r++){var a=s[r];if(a.points.length>0){if(t.x<a.position.x-e||t.x>a.position.x+a.size.x+e||t.y<a.position.y-e||t.y>a.position.y+a.size.y+e||t.z<a.position.z-e||t.z>a.position.z+a.size.z+e)continue;
a.findNearbyPoints(t,e,i,n)}}},e.exports=i},{"pex-geom":23}],28:[function(t,e){function i(t,e){this.points=t||[],this.dirtyLength=!0,this.closed=e||!1,this.samplesCount=1e3}var n=t("./Vec3");i.prototype.addPoint=function(t){return this.points.push(t)},i.prototype.getPoint=function(t){var e=t*(this.points.length-1),i=Math.floor(e),r=e-i,o=i,s=i+1;i===this.points.length-1&&(o=i,s=i);var a=new n;return a.x=this.points[o].x+(this.points[s].x-this.points[o].x)*r,a.y=this.points[o].y+(this.points[s].y-this.points[o].y)*r,a.z=this.points[o].z+(this.points[s].z-this.points[o].z)*r,a},i.prototype.getPointAt=function(t){this.closed||(t=Math.max(0,Math.min(t,1))),this.dirtyLength&&this.precalculateLength();for(var e=0,i=0;i<this.accumulatedLengthRatios.length;i++)if(this.accumulatedLengthRatios[i]>t-1/this.samplesCount){e=this.accumulatedRatios[i];break}return this.getPoint(e,!0)},i.prototype.getClosestPoint=function(t){this.dirtyLength&&this.precalculateLength();var e=this.precalculatedPoints.reduce(function(e,i){var n=t.squareDistance(i);return n<e.dist?{dist:n,point:i}:e},{dist:1/0,point:null});return e.point},i.prototype.getClosestPointRatio=function(t){this.dirtyLength&&this.precalculateLength();var e=this.precalculatedPoints.reduce(function(e,i,n){var r=t.squareDistance(i);return r<e.dist?{dist:r,point:i,index:n}:e},{dist:1/0,point:null,index:-1});return this.accumulatedLengthRatios[e.index]},i.prototype.close=function(){return this.closed=!0},i.prototype.isClosed=function(){return this.closed},i.prototype.reverse=function(){return this.points=this.points.reverse(),this.dirtyLength=!0},i.prototype.precalculateLength=function(){this.accumulatedRatios=[],this.accumulatedLengthRatios=[],this.accumulatedLengths=[],this.precalculatedPoints=[];for(var t=1/this.samplesCount,e=0,i=0,n=null,r=null,o=0;o<this.samplesCount;o++)r=n,n=this.getPoint(e),o>0&&(i+=n.dup().sub(r).length()),this.accumulatedRatios.push(e),this.accumulatedLengths.push(i),this.precalculatedPoints.push(n),e+=t;for(var o=0;o<this.accumulatedLengths.length-1;o++)this.accumulatedLengthRatios.push(this.accumulatedLengths[o]/i);return this.length=i,this.dirtyLength=!1},e.exports=i},{"./Vec3":40}],29:[function(t,e){function i(t,e){this.point=t,this.normal=e,this.u=new r,this.v=new r,this.updateUV()}var n=t("./Vec2"),r=t("./Vec3");i.prototype.set=function(t,e){this.point=t,this.normal=e},i.prototype.setPoint=function(t){this.point=t},i.prototype.setNormal=function(t){this.normal=t},i.prototype.project=function(t){var e=r.create().asSub(t,this.point),i=e.dot(this.normal),n=this.normal.clone().scale(i),o=t.clone().sub(n);return o},i.prototype.intersectRay=function(t){return t.hitTestPlane(this.point,this.normal)[0]},i.prototype.updateUV=function(){if(Math.abs(this.normal.x)>Math.abs(this.normal.y)){var t=1/Math.sqrt(this.normal.x*this.normal.x+this.normal.z*this.normal.z);this.u.set(this.normal.x*t,0,-this.normal.z*t)}else{var t=1/Math.sqrt(this.normal.y*this.normal.y+this.normal.z*this.normal.z);this.u.set(0,this.normal.z*t,-this.normal.y*t)}this.v.setVec3(this.normal).cross(this.u)},i.prototype.project=function(t){var e=r.create().asSub(t,this.point),i=e.dot(this.normal),n=this.normal.clone().scale(i),o=t.clone().sub(n);return o},i.prototype.rebase=function(t){var e=t.dup().sub(this.point),i=this.u.dot(e),r=this.v.dot(e);return new n(i,r)},e.exports=i},{"./Vec2":39,"./Vec3":40}],30:[function(t,e){function i(t,e,i,n){this.x=null!=t?t:0,this.y=null!=e?e:0,this.z=null!=i?i:0,this.w=null!=n?n:1}var n=t("./Mat4"),r=t("./Vec3"),o=Math.pow(2,-24);i.create=function(t,e,n,r){return new i(t,e,n,r)},i.fromArray=function(t){return new i(t[0],t[1],t[2],t[3])},i.prototype.identity=function(){return this.set(0,0,0,1),this},i.prototype.equals=function(t,e){return null==e&&(e=1e-7),Math.abs(t.x-this.x)<=e&&Math.abs(t.y-this.y)<=e&&Math.abs(t.z-this.z)<=e&&Math.abs(t.w-this.w)<=e},i.prototype.hash=function(){return 1*this.x+12*this.y+123*this.z+1234*this.w},i.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},i.prototype.clone=function(){return new i(this.x,this.y,this.z,this.w)},i.prototype.dup=function(){return this.clone()},i.prototype.setAxisAngle=function(t,e){e=.5*e;var i=Math.sin(e/180*Math.PI);return this.x=i*t.x,this.y=i*t.y,this.z=i*t.z,this.w=Math.cos(e/180*Math.PI),this},i.prototype.setQuat=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},i.prototype.set=function(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this},i.prototype.asMul=function(t,e){var i=t.x,n=t.y,r=t.z,o=t.w,s=e.x,a=e.y,h=e.z,l=e.w;return this.x=i*l+o*s+n*h-r*a,this.y=n*l+o*a+r*s-i*h,this.z=r*l+o*h+i*a-n*s,this.w=o*l-i*s-n*a-r*h,this},i.prototype.mul=function(t){return this.asMul(this,t),this},i.prototype.mul4=function(t,e,i,n){var r=this.x,o=this.y,s=this.z,a=this.w;return this.x=n*r+t*a+e*s-i*o,this.y=n*o+e*a+i*r-t*s,this.z=n*s+i*a+t*o-e*r,this.w=n*a-t*r-e*o-i*s,this},i.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},i.prototype.normalize=function(){var t=this.length();return t>o&&(this.x/=t,this.y/=t,this.z/=t,this.w/=t),this},i.prototype.toMat4=function(t){var e=this.x+this.x,i=this.y+this.y,r=this.z+this.z,o=this.w*e,s=this.w*i,a=this.w*r,h=this.x*e,l=this.x*i,c=this.x*r,u=this.y*i,p=this.y*r,d=this.z*r,f=t||new n;return f.set4x4r(1-(u+d),l-a,c+s,0,l+a,1-(h+d),p-o,0,c-s,p+o,1-(h+u),0,0,0,0,1)},i.prototype.setDirection=function(t,e){var o=r.create().copy(t).normalize(),s=r.create(0,1,0),a=r.create().asCross(s,o);0==a.length()&&(s.set(1,0,0),a.asCross(s,o)),s.asCross(o,a),a.normalize(),s.normalize(),e&&console.log("dir",o),e&&console.log("up",s),e&&console.log("right",a);var h=new n;h.set4x4r(a.x,a.y,a.z,0,s.x,s.y,s.z,0,o.x,o.y,o.z,0,0,0,0,1);var l=new i;if(1+h.a11+h.a22+h.a33<.001){e&&console.log("singularity"),o=t.dup(),o.z*=-1,o.normalize(),s.set(0,1,0),a.asCross(s,o),s.asCross(o,a),a.normalize(),s.normalize(),h=new n,h.set4x4r(a.x,a.y,a.z,0,s.x,s.y,s.z,0,o.x,o.y,o.z,0,0,0,0,1),l.w=Math.sqrt(1+h.a11+h.a22+h.a33)/2;var c=4*l.w;return l.x=(h.a23-h.a32)/c,l.y=(h.a31-h.a13)/c,l.z=(h.a12-h.a21)/c,e&&console.log("dir",o),e&&console.log("up",s),e&&console.log("right",a),q2=new i,q2.setAxisAngle(new r(0,1,0),180),q2.mul(l),q2}return l.w=Math.sqrt(1+h.a11+h.a22+h.a33)/2,c=4*l.w,l.x=(h.a23-h.a32)/c,l.y=(h.a31-h.a13)/c,l.z=(h.a12-h.a21)/c,this.copy(l),this},i.prototype.slerp=function(t,e){var i=this,n=i.w*t.w+i.x*t.x+i.y*t.y+i.z*t.z;if(Math.abs(n)>=1)return this;var r=Math.acos(n),o=Math.sqrt(1-n*n);if(Math.abs(o)<.001)return this.w=.5*i.w+.5*t.w,this.x=.5*i.x+.5*t.x,this.y=.5*i.y+.5*t.y,this.z=.5*i.z+.5*t.z,this;var s=Math.sin((1-e)*r)/o,a=Math.sin(e*r)/o;return this.w=i.w*s+t.w*a,this.x=i.x*s+t.x*a,this.y=i.y*s+t.y*a,this.z=i.z*s+t.z*a,this},i.fromAxisAngle=function(t,e){return(new i).setAxisAngle(t,e)},i.fromDirection=function(t){return(new i).setDirection(t)},e.exports=i},{"./Mat4":26,"./Vec3":40}],31:[function(t,e){function i(){}var n=(t("seedrandom"),t("./Vec2")),r=t("./Vec3");i.randomSeed=function(t){Math.seedrandom(t)},i.randomFloat=function(t,e){return"undefined"==typeof e&&(t=1),"undefined"==typeof e&&(e=t,t=0),t+(e-t)*Math.random()},i.randomInt=function(t,e){return Math.floor(i.randomFloat(t,e))},i.randomVec3=function(t){t=t||.5;var e=2*Math.random()-1,i=2*Math.random()-1,n=2*Math.random()-1;return r.create(e*t,i*t,n*t)},i.randomVec3InBoundingBox=function(t){var e=t.min.x+Math.random()*(t.max.x-t.min.x),i=t.min.y+Math.random()*(t.max.y-t.min.y),n=t.min.z+Math.random()*(t.max.z-t.min.z);return r.create(e,i,n)},i.randomVec2InRect=function(t){return n.create(t.x+Math.random()*t.width,t.y+Math.random()*t.height)},i.randomChance=function(t){return Math.random()<=t},i.randomElement=function(t){return t[Math.floor(Math.random()*t.length)]},e.exports=i},{"./Vec2":39,"./Vec3":40,seedrandom:42}],32:[function(t,e){function i(t,e){this.origin=t||new n(0,0,0),this.direction=e||new n(0,0,1)}var n=t("./Vec3"),r=1e-4;i.prototype.hitTestSphere=function(t,e){var i=[],n=this.direction,r=this.origin,o=r.dup().sub(t),s=n.dot(n);if(0==s)return i;var a=2*o.dot(n),h=o.dot(o)-e*e,l=Math.sqrt(a*a-4*s*h);if(isNaN(l))return i;var c=(-a-l)/(2*s),u=(-a+l)/(2*s);return i.push(r.dup().add(n.dup().scale(c))),c!=u&&i.push(r.dup().add(n.dup().scale(u))),i},i.prototype.hitTestPlane=function(t,e){if(0==this.direction.dot(e))return[];var i=e.dup().scale(-1).dot(this.origin.dup().sub(t))/this.direction.dot(e);return[this.origin.dup().add(this.direction.dup().scale(i))]},i.prototype.hitTestBoundingBox=function(t){function e(t,e,n,o,s){var a=r.hitTestPlane(t,n);if(a.length>0){var h=a[0];h[o]>t[o]-e[o]/2&&h[o]<t[o]+e[o]/2&&h[s]>t[s]-e[s]/2&&h[s]<t[s]+e[s]/2&&i.push(h)}}var i=[],r=this,o=t.getCenter(),s=t.getSize();return e(o.dup().add(new n(0,0,s.z/2)),s,new n(0,0,1),"x","y"),e(o.dup().add(new n(0,0,-s.z/2)),s,new n(0,0,-1),"x","y"),e(o.dup().add(new n(s.x/2,0,0)),s,new n(1,0,0),"y","z"),e(o.dup().add(new n(-s.x/2,0,0)),s,new n(-1,0,0),"y","z"),e(o.dup().add(new n(0,s.y/2,0)),s,new n(0,1,0),"x","z"),e(o.dup().add(new n(0,-s.y/2,0)),s,new n(0,-1,0),"x","z"),i.forEach(function(t){t._distance=t.distance(r.origin)}),i.sort(function(t,e){return t._distance-e._distance}),i.forEach(function(t){delete t._distance}),i.length>0&&(i=[i[0]]),i},i.prototype.hitTestTriangle=function(t){var e=this,i=t.b.dup().sub(t.a),o=t.c.dup().sub(t.a),s=n.create().asCross(i,o);if(s.length()<r)return-1;var a=e.origin.dup().sub(t.a),h=-s.dot(a),l=s.dot(e.direction);if(Math.abs(l)<r)return 0==h?-2:-3;var c=h/l;if(-r>c)return-4;var u=e.origin.dup().add(e.direction.dup().scale(c)),p=i.dot(i),d=i.dot(o),f=o.dot(o),g=u.dup().sub(t.a),m=g.dot(i),v=g.dot(o),x=d*d-p*f,y=(d*v-f*m)/x;if(-r>y||y>1+r)return-5;var w=(d*m-p*v)/x;return-r>w||y+w>1+r?-6:i.scale(y).add(o.scale(w)).add(t.a)},e.exports=i},{"./Vec3":40}],33:[function(t,e){function i(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n}i.prototype.set=function(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n},i.prototype.contains=function(t){return t.x>=this.x&&t.x<=this.x+this.width&&t.y>=this.y&&t.y<=this.y+this.height},e.exports=i},{}],34:[function(t,e){function i(t,e){this.points=t||[],this.dirtyLength=!0,this.closed=e||!1,this.samplesCount=2e3}i.prototype.getPoint=function(t){t=this.closed?(t+1)%1:Math.max(0,Math.min(t,1));var e,i,n,r,o=this.points,s=this.closed?o.length:o.length-1,a=t*s,h=Math.floor(a),l=a-h;return this.closed?(e=(h-1+o.length)%o.length,i=h%o.length,n=(h+1)%o.length,r=(h+2)%o.length):(e=0==h?h:h-1,i=h,n=h>o.length-2?h:h+1,r=h>o.length-3?h:h+2),this.interpolate(o[e],o[i],o[n],o[r],l)},i.prototype.addPoint=function(t){this.dirtyLength=!0,this.points.push(t)},i.prototype.getPointAt=function(t){t=this.closed?(t+1)%1:Math.max(0,Math.min(t,1)),this.dirtyLength&&this.precalculateLength();for(var e=0,i=0;i<this.accumulatedLengthRatios.length;i++)if(this.accumulatedLengthRatios[i]>t-1/this.samplesCount){e=this.accumulatedRatios[i];break}return this.getPoint(e)},i.prototype.getPointAtIndex=function(t){return t<this.points.length?this.points[t]:null},i.prototype.getNumPoints=function(){return this.points.length},i.prototype.getLength=function(){return this.dirtyLength&&this.precalculateLength(),this.length},i.prototype.precalculateLength=function(){var t=1/this.samplesCount,e=0,i=0;this.accumulatedRatios=[],this.accumulatedLengthRatios=[],this.accumulatedLengths=[];for(var n,r,e=0,o=0;o<this.samplesCount;o++){if(r=n,n=this.getPoint(e),o>0){var s=Math.sqrt(1+(n-r)*(n-r));i+=s}this.accumulatedRatios.push(e),this.accumulatedLengths.push(i),e+=t}for(var o=0;o<this.samplesCount;o++)this.accumulatedLengthRatios.push(this.accumulatedLengths[o]/i);this.length=i,this.dirtyLength=!1},i.prototype.close=function(){this.closed=!0},i.prototype.isClosed=function(){return this.closed},i.prototype.interpolate=function(t,e,i,n,r){var o=.5*(i-t),s=.5*(n-e),a=r*r,h=r*a;return(2*e-2*i+o+s)*h+(-3*e+3*i-2*o-s)*a+o*r+e},e.exports=i},{}],35:[function(t,e){function i(t,e){this.points=t||[],this.dirtyLength=!0,this.closed=e||!1,this.samplesCount=100}var n=t("./Vec2");i.prototype.getPoint=function(t){t=this.closed?(t+1)%1:Math.max(0,Math.min(t,1));var e,i,r,o,s=this.points,a=this.closed?s.length:s.length-1,h=t*a,l=Math.floor(h),c=h-l;this.closed?(e=(l-1+s.length)%s.length,i=l%s.length,r=(l+1)%s.length,o=(l+2)%s.length):(e=0==l?l:l-1,i=l,r=l>s.length-2?l:l+1,o=l>s.length-3?l:l+2);var u=new n;return u.x=this.interpolate(s[e].x,s[i].x,s[r].x,s[o].x,c),u.y=this.interpolate(s[e].y,s[i].y,s[r].y,s[o].y,c),u},i.prototype.addPoint=function(t){this.dirtyLength=!0,this.points.push(t)},i.prototype.getPointAt=function(t){t=this.closed?(t+1)%1:Math.max(0,Math.min(t,1)),this.dirtyLength&&this.precalculateLength();for(var e=0,i=0;i<this.accumulatedLengthRatios.length;i++)if(this.accumulatedLengthRatios[i]>t-1/this.samplesCount){e=this.accumulatedRatios[i];break}return this.getPoint(e)},i.prototype.getClosestPoint=function(t){this.dirtyLength&&this.precalculateLength();var e=this.precalculatedPoints.reduce(function(e,i){var n=t.squareDistance(i);return n<e.dist?{dist:n,point:i}:e},{dist:1/0,point:null});return e.point},i.prototype.getClosestPointRatio=function(t){this.dirtyLength&&this.precalculateLength();var e=this.precalculatedPoints.reduce(function(e,i,n){var r=t.squareDistance(i);return r<e.dist?{dist:r,point:i,index:n}:e},{dist:1/0,point:null,index:-1});return this.accumulatedLengthRatios[e.index]},i.prototype.getPointAtIndex=function(t){return t<this.points.length?this.points[t]:null},i.prototype.getNumPoints=function(){return this.points.length},i.prototype.getLength=function(){return this.dirtyLength&&this.precalculateLength(),this.length},i.prototype.precalculateLength=function(){var t=1/this.samplesCount,e=0,i=0;this.accumulatedRatios=[],this.accumulatedLengthRatios=[],this.accumulatedLengths=[],this.precalculatedPoints=[];for(var n,r,o=0;o<this.samplesCount;o++){if(r=n,n=this.getPoint(e),o>0){var s=n.dup().sub(r).length();i+=s}this.accumulatedRatios.push(e),this.accumulatedLengths.push(i),this.precalculatedPoints.push(n),e+=t}for(var o=0;o<this.samplesCount;o++)this.accumulatedLengthRatios.push(this.accumulatedLengths[o]/i);this.length=i,this.dirtyLength=!1},i.prototype.close=function(){this.closed=!0},i.prototype.isClosed=function(){return this.closed},i.prototype.interpolate=function(t,e,i,n,r){var o=.5*(i-t),s=.5*(n-e),a=r*r,h=r*a;return(2*e-2*i+o+s)*h+(-3*e+3*i-2*o-s)*a+o*r+e},e.exports=i},{"./Vec2":39}],36:[function(t,e){function i(t,e){this.points=t||[],this.dirtyLength=!0,this.closed=e||!1,this.samplesCount=1e3}var n=t("./Vec3");i.prototype.getPoint=function(t){t=this.closed?(t+1)%1:Math.max(0,Math.min(t,1));var e,i,r,o,s=this.points,a=this.closed?s.length:s.length-1,h=t*a,l=Math.floor(h),c=h-l;this.closed?(e=(l-1+s.length)%s.length,i=l%s.length,r=(l+1)%s.length,o=(l+2)%s.length):(e=0==l?l:l-1,i=l,r=l>s.length-2?l:l+1,o=l>s.length-3?l:l+2);var u=new n;return u.x=this.interpolate(s[e].x,s[i].x,s[r].x,s[o].x,c),u.y=this.interpolate(s[e].y,s[i].y,s[r].y,s[o].y,c),u.z=this.interpolate(s[e].z,s[i].z,s[r].z,s[o].z,c),u},i.prototype.addPoint=function(t){this.dirtyLength=!0,this.points.push(t)},i.prototype.getPointAt=function(t){t=this.closed?(t+1)%1:Math.max(0,Math.min(t,1)),this.dirtyLength&&this.precalculateLength();for(var e=0,i=0;i<this.accumulatedLengthRatios.length;i++)if(this.accumulatedLengthRatios[i]>t-1/this.samplesCount){e=this.accumulatedRatios[i];break}return this.getPoint(e)},i.prototype.getClosestPoint=function(t){this.dirtyLength&&this.precalculateLength();var e=this.precalculatedPoints.reduce(function(e,i){var n=t.squareDistance(i);return n<e.dist?{dist:n,point:i}:e},{dist:1/0,point:null});return e.point},i.prototype.getClosestPointRatio=function(t){this.dirtyLength&&this.precalculateLength();var e=this.precalculatedPoints.reduce(function(e,i,n){var r=t.squareDistance(i);return r<e.dist?{dist:r,point:i,index:n}:e},{dist:1/0,point:null,index:-1});return this.accumulatedLengthRatios[e.index]},i.prototype.getTangentAt=function(t){var e=.99>t?t:t-.01,i=.99>t?t+.01:t,r=this.getPointAt(e),o=this.getPointAt(i);return n.create().asSub(o,r).normalize()},i.prototype.getPointAtIndex=function(t){return t<this.points.length?this.points[t]:null},i.prototype.getNumPoints=function(){return this.points.length},i.prototype.getLength=function(){return this.dirtyLength&&this.precalculateLength(),this.length},i.prototype.precalculateLength=function(){var t=1/this.samplesCount,e=0,i=0;this.accumulatedRatios=[],this.accumulatedLengthRatios=[],this.accumulatedLengths=[],this.precalculatedPoints=[];for(var n,r,o=0;o<this.samplesCount;o++){if(r=n,n=this.getPoint(e),o>0){var s=n.dup().sub(r).length();i+=s}this.accumulatedRatios.push(e),this.accumulatedLengths.push(i),this.precalculatedPoints.push(n),e+=t}for(var o=0;o<this.samplesCount;o++)this.accumulatedLengthRatios.push(this.accumulatedLengths[o]/i);this.length=i,this.dirtyLength=!1},i.prototype.close=function(){this.closed=!0},i.prototype.isClosed=function(){return this.closed},i.prototype.interpolate=function(t,e,i,n,r){var o=.5*(i-t),s=.5*(n-e),a=r*r,h=r*a;return(2*e-2*i+o+s)*h+(-3*e+3*i-2*o-s)*a+o*r+e},e.exports=i},{"./Vec3":40}],37:[function(t,e){function i(t,e,i){return(t.x-i.x)*(e.y-i.y)-(e.x-i.x)*(t.y-i.y)}function n(t,e,i){this.a=t,this.b=e,this.c=i}n.prototype.contains=function(t){var e=i(this.a,this.b,t)<0,n=i(this.b,this.c,t)<0,r=i(this.c,this.a,t)<0;return e==n&&n==r},n.prototype.getArea=function(){var t=this.a.distance(this.b),e=this.a.distance(this.c),i=this.b.distance(this.c),n=(t+e+i)/2;return Math.sqrt(n*(n-t)*(n-e)*(n-i))},e.exports=n},{}],38:[function(t,e){function i(t,e,i){this.a=t,this.b=e,this.c=i}i.prototype.getArea=function(){var t=this.a.distance(this.b),e=this.a.distance(this.c),i=this.b.distance(this.c),n=(t+e+i)/2;return Math.sqrt(n*(n-t)*(n-e)*(n-i))},e.exports=i},{}],39:[function(t,e){function i(t,e){this.x=null!=t?t:0,this.y=null!=e?e:0}i.create=function(t,e){return new i(t,e)},i.fromArray=function(t){return new i(t[0],t[1])},i.prototype.set=function(t,e){return this.x=t,this.y=e,this},i.prototype.equals=function(t,e){return null==e&&(e=1e-7),Math.abs(t.x-this.x)<=e&&Math.abs(t.y-this.y)<=e},i.prototype.hash=function(){return 1*this.x+12*this.y},i.prototype.setVec2=function(t){return this.x=t.x,this.y=t.y,this},i.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},i.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},i.prototype.scale=function(t){return this.x*=t,this.y*=t,this},i.prototype.distance=function(t){var e=t.x-this.x,i=t.y-this.y;return Math.sqrt(e*e+i*i)},i.prototype.squareDistance=function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},i.prototype.dot=function(t){return this.x*t.x+this.y*t.y},i.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},i.prototype.clone=function(){return new i(this.x,this.y)},i.prototype.dup=function(){return this.clone()},i.prototype.asAdd=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},i.prototype.asSub=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},i.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},i.prototype.normalize=function(){var t=this.length();return t>0&&this.scale(1/t),this},i.prototype.lerp=function(t,e){this.x=this.x+(t.x-this.x)*e,this.y=this.y+(t.y-this.y)*e},i.prototype.toString=function(){return"{"+Math.floor(1e3*this.x)/1e3+", "+Math.floor(1e3*this.y)/1e3+"}"},e.exports=i},{}],40:[function(t,e){function i(t,e,i){this.x=null!=t?t:0,this.y=null!=e?e:0,this.z=null!=i?i:0}i.create=function(t,e,n){return new i(t,e,n)},i.fromArray=function(t){return new i(t[0],t[1],t[2])},i.prototype.hash=function(){return 1*this.x+12*this.y+123*this.z},i.prototype.set=function(t,e,i){return this.x=t,this.y=e,this.z=i,this},i.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},i.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},i.prototype.scale=function(t){return this.x*=t,this.y*=t,this.z*=t,this},i.prototype.distance=function(t){var e=t.x-this.x,i=t.y-this.y,n=t.z-this.z;return Math.sqrt(e*e+i*i+n*n)},i.prototype.squareDistance=function(t){var e=t.x-this.x,i=t.y-this.y,n=t.z-this.z;return e*e+i*i+n*n},i.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},i.prototype.setVec3=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},i.prototype.clone=function(){return new i(this.x,this.y,this.z)},i.prototype.dup=function(){return this.clone()},i.prototype.cross=function(t){var e=this.x,i=this.y,n=this.z,r=t.x,o=t.y,s=t.z;return this.x=i*s-n*o,this.y=n*r-e*s,this.z=e*o-i*r,this},i.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},i.prototype.asAdd=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},i.prototype.asSub=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},i.prototype.asCross=function(t,e){return this.copy(t).cross(e)},i.prototype.addScaled=function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},i.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},i.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},i.prototype.normalize=function(){var t=this.length();return t>0&&this.scale(1/t),this},i.prototype.transformQuat=function(t){var e=this.x,i=this.y,n=this.z,r=t.x,o=t.y,s=t.z,a=t.w,h=a*e+o*n-s*i,l=a*i+s*e-r*n,c=a*n+r*i-o*e,u=-r*e-o*i-s*n;return this.x=h*a+u*-r+l*-s-c*-o,this.y=l*a+u*-o+c*-r-h*-s,this.z=c*a+u*-s+h*-o-l*-r,this},i.prototype.transformMat4=function(t){var e=t.a14+t.a11*this.x+t.a12*this.y+t.a13*this.z,i=t.a24+t.a21*this.x+t.a22*this.y+t.a23*this.z,n=t.a34+t.a31*this.x+t.a32*this.y+t.a33*this.z;return this.x=e,this.y=i,this.z=n,this},i.prototype.equals=function(t,e){return e=null!=e?e:1e-7,Math.abs(t.x-this.x)<=e&&Math.abs(t.y-this.y)<=e&&Math.abs(t.z-this.z)<=e},i.prototype.toString=function(){return"{"+Math.floor(1e3*this.x)/1e3+", "+Math.floor(1e3*this.y)/1e3+", "+Math.floor(1e3*this.z)/1e3+"}"},i.prototype.lerp=function(t,e){this.x=this.x+(t.x-this.x)*e,this.y=this.y+(t.y-this.y)*e,this.z=this.z+(t.z-this.z)*e},i.Zero=new i(0,0,0),e.exports=i},{}],41:[function(t,e){function i(t,e,i,n){this.x=null!=t?t:0,this.y=null!=e?e:0,this.z=null!=i?i:0,this.w=null!=n?n:0}i.prototype.equals=function(t,e){return null==e&&(e=1e-7),Math.abs(t.x-this.x)<=e&&Math.abs(t.y-this.y)<=e&&Math.abs(t.z-this.z)<=e&&Math.abs(t.w-this.w)<=e},i.prototype.hash=function(){return 1*this.x+12*this.y+123*this.z+1234*this.w},i.create=function(t,e,n,r){return new i(t,e,n,r)},i.fromArray=function(t){return new i(t[0],t[1],t[2],t[3])},i.prototype.set=function(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this},i.prototype.setVec4=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},i.prototype.transformMat4=function(t){var e=t.a14*this.w+t.a11*this.x+t.a12*this.y+t.a13*this.z,i=t.a24*this.w+t.a21*this.x+t.a22*this.y+t.a23*this.z,n=t.a34*this.w+t.a31*this.x+t.a32*this.y+t.a33*this.z,r=t.a44*this.w+t.a41*this.x+t.a42*this.y+t.a43*this.z;return this.x=e,this.y=i,this.z=n,this.w=r,this},i.prototype.toString=function(){return"{"+Math.floor(1e3*this.x)/1e3+", "+Math.floor(1e3*this.y)/1e3+", "+Math.floor(1e3*this.z)/1e3+", "+Math.floor(1e3*this.w)/1e3+"}"},e.exports=i},{}],42:[function(t,e){!function(t,e,i,n,r,o,s,a,h){function l(t){var e,i=t.length,r=this,o=0,s=r.i=r.j=0,a=r.S=[];for(i||(t=[i++]);n>o;)a[o]=o++;for(o=0;n>o;o++)a[o]=a[s=v&s+t[o%i]+(e=a[o])],a[s]=e;(r.g=function(t){for(var e,i=0,o=r.i,s=r.j,a=r.S;t--;)e=a[o=v&o+1],i=i*n+a[v&(a[o]=a[s=v&s+e])+(a[s]=e)];return r.i=o,r.j=s,i})(n)}function c(t,e){var i,n=[],r=typeof t;if(e&&"object"==r)for(i in t)try{n.push(c(t[i],e-1))}catch(o){}return n.length?n:"string"==r?t:t+"\x00"}function u(t,e){for(var i,n=t+"",r=0;r<n.length;)e[v&r]=v&(i^=19*e[v&r])+n.charCodeAt(r++);return d(e)}function p(i){try{return t.crypto.getRandomValues(i=new Uint8Array(n)),d(i)}catch(r){return[+new Date,t,(i=t.navigator)&&i.plugins,t.screen,d(e)]}}function d(t){return String.fromCharCode.apply(0,t)}var f=i.pow(n,r),g=i.pow(2,o),m=2*g,v=n-1,x=i["seed"+h]=function(t,o,s){var a=[],v=u(c(o?[t,d(e)]:null==t?p():t,3),a),x=new l(a);return u(d(x.S),e),(s||function(t,e,n){return n?(i[h]=t,e):t})(function(){for(var t=x.g(r),e=f,i=0;g>t;)t=(t+i)*n,e*=n,i=x.g(1);for(;t>=m;)t/=2,e/=2,i>>>=1;return(t+i)/e},v,this==i)};u(i[h](),e),s&&s.exports?s.exports=x:a&&a.amd&&a(function(){return x})}(this,[],Math,256,6,52,"object"==typeof e&&e,"function"==typeof define&&define,"random")},{}],43:[function(t,e){e.exports.Context=t("./lib/Context"),e.exports.Texture=t("./lib/Texture"),e.exports.Texture2D=t("./lib/Texture2D"),e.exports.TextureCube=t("./lib/TextureCube"),e.exports.Program=t("./lib/Program"),e.exports.Material=t("./lib/Material"),e.exports.Mesh=t("./lib/Mesh"),e.exports.OrthographicCamera=t("./lib/OrthographicCamera"),e.exports.PerspectiveCamera=t("./lib/PerspectiveCamera"),e.exports.Arcball=t("./lib/Arcball"),e.exports.ScreenImage=t("./lib/ScreenImage"),e.exports.RenderTarget=t("./lib/RenderTarget");var i=t("./lib/Utils");for(var n in i)e.exports[n]=i[n]},{"./lib/Arcball":44,"./lib/Context":46,"./lib/Material":47,"./lib/Mesh":48,"./lib/OrthographicCamera":49,"./lib/PerspectiveCamera":50,"./lib/Program":51,"./lib/RenderTarget":52,"./lib/ScreenImage":54,"./lib/Texture":55,"./lib/Texture2D":56,"./lib/TextureCube":57,"./lib/Utils":58}],44:[function(t,e){var i,n,r,o,s,a,h,l;l=t("pex-geom"),s=l.Vec2,a=l.Vec3,h=l.Vec4,o=l.Quat,n=l.Mat4,r=l.Plane,i=function(){function t(t,e,i){this.camera=e,this.window=t,this.radius=2*Math.min(t.width/2,t.height/2),this.center=s.create(t.width/2,t.height/2),this.currRot=o.create(),this.currRot.setAxisAngle(a.create(0,1,0),0),this.clickRot=o.create(),this.dragRot=o.create(),this.clickPos=a.create(),this.clickPosWindow=s.create(),this.dragPos=a.create(),this.dragPosWindow=s.create(),this.rotAxis=a.create(),this.allowZooming=!0,this.enabled=!0,this.clickTarget=a.create(0,0,0),this.setDistance(i||2),this.updateCamera(),this.addEventHanlders()}return t.prototype.setTarget=function(t){return this.camera.setTarget(t),this.updateCamera()},t.prototype.setOrientation=function(t){return this.currRot.setDirection(t),this.currRot.w*=-1,this.updateCamera(),this},t.prototype.setPosition=function(t){var e;return e=a.create().asSub(t,this.camera.getTarget()),this.setOrientation(e.dup().normalize()),this.setDistance(e.length()),this.updateCamera()},t.prototype.addEventHanlders=function(){return this.window.on("leftMouseDown",function(t){return function(e){return!e.handled&&t.enabled?t.down(e.x,e.y,e.shift):void 0}}(this)),this.window.on("leftMouseUp",function(t){return function(e){return t.up(e.x,e.y,e.shift)}}(this)),this.window.on("mouseDragged",function(t){return function(e){return!e.handled&&t.enabled?t.drag(e.x,e.y,e.shift):void 0}}(this)),this.window.on("scrollWheel",function(t){return function(e){return!e.handled&&t.enabled&&t.allowZooming?(t.distance=Math.min(t.maxDistance,Math.max(t.distance+e.dy/100*(t.maxDistance-t.minDistance),t.minDistance)),t.updateCamera()):void 0}}(this))},t.prototype.mouseToSphere=function(t,e){var i,n;return e=this.window.height-e,n=a.create((t-this.center.x)/this.radius,(e-this.center.y)/this.radius,0),i=n.x*n.x+n.y*n.y,i>1?n.normalize():n.z=Math.sqrt(1-i),n},t.prototype.down=function(t,e,i){var n,o;return this.dragging=!0,this.clickPos=this.mouseToSphere(t,e),this.clickRot.copy(this.currRot),this.updateCamera(),i?(this.clickPosWindow.set(t,e),n=this.camera.getTarget(),this.clickTarget=n.dup(),o=n.dup().transformMat4(this.camera.getViewMatrix()),this.panPlane=new r(o,new a(0,0,1)),this.clickPosPlane=this.panPlane.intersectRay(this.camera.getViewRay(this.clickPosWindow.x,this.clickPosWindow.y,this.window.width,this.window.height)),this.dragPosPlane=this.panPlane.intersectRay(this.camera.getViewRay(this.dragPosWindow.x,this.dragPosWindow.y,this.window.width,this.window.height))):this.panPlane=null},t.prototype.up=function(){return this.dragging=!1,this.panPlane=null},t.prototype.drag=function(t,e,i){var n,r;if(this.dragging)return i&&this.panPlane?(this.dragPosWindow.set(t,e),this.clickPosPlane=this.panPlane.intersectRay(this.camera.getViewRay(this.clickPosWindow.x,this.clickPosWindow.y,this.window.width,this.window.height)),this.dragPosPlane=this.panPlane.intersectRay(this.camera.getViewRay(this.dragPosWindow.x,this.dragPosWindow.y,this.window.width,this.window.height)),n=this.camera.getViewMatrix().dup().invert(),this.clickPosWorld=this.clickPosPlane.dup().transformMat4(n),this.dragPosWorld=this.dragPosPlane.dup().transformMat4(n),this.diffWorld=this.dragPosWorld.dup().sub(this.clickPosWorld),this.camera.setTarget(this.clickTarget.dup().sub(this.diffWorld)),this.updateCamera()):(this.dragPos=this.mouseToSphere(t,e),this.rotAxis.asCross(this.clickPos,this.dragPos),r=this.clickPos.dot(this.dragPos),this.dragRot.set(this.rotAxis.x,this.rotAxis.y,this.rotAxis.z,r),this.currRot.asMul(this.dragRot,this.clickRot)),this.updateCamera()},t.prototype.updateCamera=function(){var t,e,i,n,r;return i=this.currRot.clone(),i.w*=-1,n=this.camera.getTarget(),e=a.create(0,0,this.distance).transformQuat(i),t=a.create().asAdd(n,e),r=a.create(0,1,0).transformQuat(i),this.camera.lookAt(n,t,r)},t.prototype.disableZoom=function(){return this.allowZooming=!1},t.prototype.setDistance=function(t){return this.distance=t||2,this.minDistance=t/2||.3,this.maxDistance=2*t||5,this.updateCamera()},t}(),e.exports=i},{"pex-geom":23}],45:[function(t,e){var i,n,r,o,s,a,h,l,c,u,p,d;d=t("pex-geom"),l=d.Vec2,c=d.Vec3,u=d.Vec4,o=d.Edge,s=d.Face3,a=d.Face4,h=d.FacePolygon,n=t("pex-color").Color,r=t("./Context"),p=function(t,e){var i,n,r;for(n=0,r=e.length;r>n;n++)if(i=e[n],"undefined"==typeof t[i])return!1;return!0},i=function(){function t(t,e,i,n){this.gl=r.currentContext,this.target=t,this.type=e,this.usage=n||gl.STATIC_DRAW,this.dataBuf=null,i&&this.update(i,this.usage)}return t.prototype.dispose=function(){return this.gl.deleteBuffer(this.handle),this.handle=null},t.prototype.update=function(t,e){var i,n,r,o,s,a,h,l,c,u,d,f,g,m,v,x,y,w,b,C,P,M;if(this.handle||(this.handle=this.gl.createBuffer()),this.usage=e||this.usage,t&&0!==t.length){if(isNaN(t[0]))if(p(t[0],["x","y","z","w"]))for(this.dataBuf&&this.dataBuf.length===4*t.length||(this.dataBuf=new this.type(4*t.length),this.elementSize=4),r=l=0,f=t.length;f>l;r=++l)a=t[r],this.dataBuf[4*r+0]=a.x,this.dataBuf[4*r+1]=a.y,this.dataBuf[4*r+2]=a.z,this.dataBuf[4*r+3]=a.w;else if(p(t[0],["x","y","z"]))for(this.dataBuf&&this.dataBuf.length===3*t.length||(this.dataBuf=new this.type(3*t.length),this.elementSize=3),r=c=0,g=t.length;g>c;r=++c)a=t[r],this.dataBuf[3*r+0]=a.x,this.dataBuf[3*r+1]=a.y,this.dataBuf[3*r+2]=a.z;else if(p(t[0],["x","y"]))for(this.dataBuf&&this.dataBuf.length===2*t.length||(this.dataBuf=new this.type(2*t.length),this.elementSize=2),r=u=0,m=t.length;m>u;r=++u)a=t[r],this.dataBuf[2*r+0]=a.x,this.dataBuf[2*r+1]=a.y;else if(p(t[0],["r","g","b","a"]))for(this.dataBuf&&this.dataBuf.length===4*t.length||(this.dataBuf=new this.type(4*t.length),this.elementSize=4),r=b=0,v=t.length;v>b;r=++b)a=t[r],this.dataBuf[4*r+0]=a.r,this.dataBuf[4*r+1]=a.g,this.dataBuf[4*r+2]=a.b,this.dataBuf[4*r+3]=a.a;else if(2===t[0].length)for(this.dataBuf&&this.dataBuf.length===2*t.length||(this.dataBuf=new this.type(2*t.length),this.elementSize=1),r=C=0,x=t.length;x>C;r=++C)i=t[r],this.dataBuf[2*r+0]=i[0],this.dataBuf[2*r+1]=i[1];else if(t[0].length>=3){for(s=0,P=0,y=t.length;y>P;P++)if(n=t[P],3===n.length&&(s+=3),4===n.length&&(s+=6),n.length>4)throw"FacePolygons "+n.length+" + are not supported in RenderableGeometry Buffers";for(this.dataBuf&&this.dataBuf.length===s||(this.dataBuf=new this.type(s),this.elementSize=1),o=0,M=0,w=t.length;w>M;M++)n=t[M],3===n.length&&(this.dataBuf[o+0]=n[0],this.dataBuf[o+1]=n[1],this.dataBuf[o+2]=n[2],o+=3),4===n.length&&(this.dataBuf[o+0]=n[0],this.dataBuf[o+1]=n[1],this.dataBuf[o+2]=n[3],this.dataBuf[o+3]=n[3],this.dataBuf[o+4]=n[1],this.dataBuf[o+5]=n[2],o+=6)
}else console.log("Buffer.unknown type",t.name,t[0]);else for(this.dataBuf&&this.dataBuf.length===t.length||(this.dataBuf=new this.type(t.length)),r=h=0,d=t.length;d>h;r=++h)a=t[r],this.dataBuf[r]=a,this.elementSize=1;return this.gl.bindBuffer(this.target,this.handle),this.gl.bufferData(this.target,this.dataBuf,this.usage)}},t}(),e.exports=i},{"./Context":46,"pex-color":2,"pex-geom":23}],46:[function(t,e){var i=t("pex-sys"),n=null,r={};Object.defineProperty(r,"currentContext",{get:function(){return n?n:i.Window.currentWindow?i.Window.currentWindow.gl:null},set:function(t){n=t},enumerable:!0,configurable:!0}),e.exports=r},{"pex-sys":82}],47:[function(t,e){function i(t,e){this.gl=n.currentContext,this.program=t,this.uniforms=e||{},this.prevUniforms={}}var n=t("./Context");i.prototype.use=function(){this.program.use();var t=0;for(var e in this.program.uniforms)if(null==this.uniforms[e]&&(-1==e.indexOf("[")&&console.log("WARN","Uniform",e,"is null"),this.uniforms[e]=0),this.program.uniforms[e].type==this.gl.SAMPLER_2D||this.program.uniforms[e].type==this.gl.SAMPLER_CUBE)this.gl.activeTexture(this.gl.TEXTURE0+t),this.uniforms[e],this.uniforms[e].width>0&&this.uniforms[e].height>0&&(this.gl.bindTexture(this.uniforms[e].target,this.uniforms[e].handle),this.program.uniforms[e](t)),t++;else{var i=this.uniforms[e],n=this.prevUniforms[e],r=null;if(null!==n)if(i.hash){if(r=i.hash(),r==n)continue}else if(i==n)continue;this.program.uniforms[e](this.uniforms[e]),this.prevUniforms[e]=r?r:i}},e.exports=i},{"./Context":46}],48:[function(t,e){var i,n,r,o,s,a,h,l,c;l=t("merge"),c=t("pex-geom"),h=c.Vec3,s=c.Quat,r=c.Mat4,i=c.BoundingBox,n=t("./Context"),a=t("./RenderableGeometry"),o=function(){function t(t,e,i){this.gl=n.currentContext,this.geometry=l(t,a),this.material=e,i=i||{},this.primitiveType=i.primitiveType,null==this.primitiveType&&(this.primitiveType=this.gl.TRIANGLES),i.lines&&(this.primitiveType=this.gl.LINES),i.triangles&&(this.primitiveType=this.gl.TRIANGLES),i.points&&(this.primitiveType=this.gl.POINTS),this.position=h.create(0,0,0),this.rotation=s.create(),this.scale=h.create(1,1,1),this.projectionMatrix=r.create(),this.viewMatrix=r.create(),this.invViewMatrix=r.create(),this.modelWorldMatrix=r.create(),this.modelViewMatrix=r.create(),this.rotationMatrix=r.create(),this.normalMatrix=r.create()}return t.prototype.draw=function(t){var e;return this.geometry.isDirty()&&this.geometry.compile(),t&&(this.updateMatrices(t),this.updateMatricesUniforms(this.material)),this.material.use(),this.bindAttribs(),this.geometry.faces&&this.geometry.faces.length>0&&this.primitiveType!==this.gl.LINES&&this.primitiveType!==this.gl.POINTS?(this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.geometry.faces.buffer.handle),this.gl.drawElements(this.primitiveType,this.geometry.faces.buffer.dataBuf.length,this.gl.UNSIGNED_SHORT,0)):this.geometry.edges&&this.geometry.edges.length>0&&this.primitiveType===this.gl.LINES?(this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.geometry.edges.buffer.handle),this.gl.drawElements(this.primitiveType,this.geometry.edges.buffer.dataBuf.length,this.gl.UNSIGNED_SHORT,0)):this.geometry.vertices&&(e=this.geometry.vertices.length,this.gl.drawArrays(this.primitiveType,0,e)),this.unbindAttribs()},t.prototype.drawInstances=function(t,e){var i,n,r,o,s,a,h,l;if(this.geometry.isDirty()&&this.geometry.compile(),this.material.use(),this.bindAttribs(),this.geometry.faces&&this.geometry.faces.length>0&&!this.useEdges)for(this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.geometry.faces.buffer.handle),r=0,a=e.length;a>r;r++)i=e[r],t&&(this.updateMatrices(t,i),this.updateMatricesUniforms(this.material),this.updateUniforms(this.material,i),this.material.use()),this.gl.drawElements(this.primitiveType,this.geometry.faces.buffer.dataBuf.length,this.gl.UNSIGNED_SHORT,0);else if(this.geometry.edges&&this.useEdges)for(this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.geometry.edges.buffer.handle),o=0,h=e.length;h>o;o++)i=e[o],t&&(this.updateMatrices(t,i),this.updateMatricesUniforms(this.material),this.updateUniforms(this.material,i),this.material.use()),this.gl.drawElements(this.primitiveType,this.geometry.edges.buffer.dataBuf.length,this.gl.UNSIGNED_SHORT,0);else if(this.geometry.vertices)for(n=this.geometry.vertices.length,s=0,l=e.length;l>s;s++)i=e[s],t&&(this.updateMatrices(t,i),this.updateMatricesUniforms(this.material),this.updateUniforms(this.material,i),this.material.use()),this.gl.drawArrays(this.primitiveType,0,n);return this.unbindAttribs()},t.prototype.bindAttribs=function(){var t,e,i,n,r;i=this.material.program,n=this.geometry.attribs,r=[];for(e in n)t=n[e],t.location=this.gl.getAttribLocation(i.handle,t.name),t.location>=0?(this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t.buffer.handle),this.gl.vertexAttribPointer(t.location,t.buffer.elementSize,this.gl.FLOAT,!1,0,0),r.push(this.gl.enableVertexAttribArray(t.location))):r.push(void 0);return r},t.prototype.unbindAttribs=function(){var t,e,i,n;i=this.geometry.attribs,n=[];for(e in i)t=i[e],n.push(t.location>=0?this.gl.disableVertexAttribArray(t.location):void 0);return n},t.prototype.resetAttribLocations=function(){var t,e,i;i=[];for(e in this.attributes)t=this.attributes[e],i.push(t.location=-1);return i},t.prototype.updateMatrices=function(t,e){var i,n,r;return i=e&&e.position?e.position:this.position,n=e&&e.rotation?e.rotation:this.rotation,r=e&&e.scale?e.scale:this.scale,n.toMat4(this.rotationMatrix),this.modelWorldMatrix.identity().translate(i.x,i.y,i.z).mul(this.rotationMatrix).scale(r.x,r.y,r.z),t?(this.projectionMatrix.copy(t.getProjectionMatrix()),this.viewMatrix.copy(t.getViewMatrix()),this.invViewMatrix.copy(t.getViewMatrix().dup().invert()),this.modelViewMatrix.copy(t.getViewMatrix()).mul(this.modelWorldMatrix),this.normalMatrix.copy(this.modelViewMatrix).invert().transpose()):void 0},t.prototype.updateUniforms=function(t,e){var i,n,r,o;r=e.uniforms,o=[];for(i in r)n=r[i],o.push(t.uniforms[i]=n);return o},t.prototype.updateMatricesUniforms=function(){var t,e;return e=this.material.program.uniforms,t=this.material.uniforms,e.projectionMatrix&&(t.projectionMatrix=this.projectionMatrix),e.viewMatrix&&(t.viewMatrix=this.viewMatrix),e.invViewMatrix&&(t.invViewMatrix=this.invViewMatrix),e.modelWorldMatrix&&(t.modelWorldMatrix=this.modelWorldMatrix),e.modelViewMatrix&&(t.modelViewMatrix=this.modelViewMatrix),e.normalMatrix?t.normalMatrix=this.normalMatrix:void 0},t.prototype.getMaterial=function(){return this.material},t.prototype.setMaterial=function(t){return this.material=t,this.resetAttribLocations()},t.prototype.getProgram=function(){return this.material.program},t.prototype.setProgram=function(t){return this.material.program=t,this.resetAttribLocations()},t.prototype.dispose=function(){return this.geometry.dispose()},t.prototype.getBoundingBox=function(){return this.boundingBox||this.updateBoundingBox(),this.boundingBox},t.prototype.updateBoundingBox=function(){return this.updateMatrices(),this.boundingBox=i.fromPoints(this.geometry.vertices.map(function(t){return function(e){return e.dup().transformMat4(t.modelWorldMatrix)}}(this)))},t}(),e.exports=o},{"./Context":46,"./RenderableGeometry":53,merge:1,"pex-geom":23}],49:[function(t,e){var i,n,r,o,s,a,h;h=t("pex-geom"),o=h.Vec2,s=h.Vec3,a=h.Vec4,i=h.Mat4,r=h.Ray,n=function(){function t(t,e,n,r,o,a,h,l,c){var u,p,d,f;p=t,d=t+n,f=e,u=e+r,this.left=p,this.right=d,this.bottom=u,this.top=f,this.near=o||.1,this.far=a||100,this.position=h||s.create(0,0,5),this.target=l||s.create(0,0,0),this.up=c||s.create(0,1,0),this.projectionMatrix=i.create(),this.viewMatrix=i.create(),this.updateMatrices()}var e;return t.prototype.getFov=function(){return this.fov},t.prototype.getAspectRatio=function(){return this.aspectRatio},t.prototype.getNear=function(){return this.near},t.prototype.getFar=function(){return this.far},t.prototype.getPosition=function(){return this.position},t.prototype.getTarget=function(){return this.target},t.prototype.getUp=function(){return this.up},t.prototype.getViewMatrix=function(){return this.viewMatrix},t.prototype.getProjectionMatrix=function(){return this.projectionMatrix},t.prototype.setFov=function(t){return this.fov=t,this.updateMatrices()},t.prototype.setAspectRatio=function(t){return this.aspectRatio=t,this.updateMatrices()},t.prototype.setFar=function(t){return this.far=t,this.updateMatrices()},t.prototype.setNear=function(t){return this.near=t,this.updateMatrices()},t.prototype.setPosition=function(t){return this.position=t,this.updateMatrices()},t.prototype.setTarget=function(t){return this.target=t,this.updateMatrices()},t.prototype.setUp=function(t){return this.up=t,this.updateMatrices()},t.prototype.lookAt=function(t,e,i){return t&&(this.target=t),e&&(this.position=e),i&&(this.up=i),this.updateMatrices()},t.prototype.updateMatrices=function(){return this.projectionMatrix.identity().ortho(this.left,this.right,this.bottom,this.top,this.near,this.far),this.viewMatrix.identity().lookAt(this.position,this.target,this.up)},e=a.create(),t.prototype.getScreenPos=function(t,i,n){var r;return e.set(t.x,t.y,t.z,1),e.transformMat4(this.viewMatrix),e.transformMat4(this.projectionMatrix),r=o.create().set(e.x,e.y),r.x/=e.w,r.y/=e.w,r.x=.5*r.x+.5,r.y=.5*r.y+.5,r.x*=i,r.y*=n,r},t.prototype.getWorldRay=function(t,e,i,n){var o,a,h,l,c,u,p,d;return t=(t-i/2)/(i/2),e=-(e-n/2)/(n/2),o=2*Math.tan(this.getFov()/180*Math.PI/2)*this.getNear(),u=o*this.getAspectRatio(),t*=u/2,e*=o/2,h=new s(0,0,0),l=new s(t,e,-this.getNear()),a=this.getViewMatrix().dup().invert(),p=h.dup().transformMat4(a),d=l.dup().transformMat4(a),c=d.dup().sub(p),new r(p,c)},t}(),e.exports=n},{"pex-geom":23}],50:[function(t,e){var i,n,r,o,s,a,h;h=t("pex-geom"),o=h.Vec2,s=h.Vec3,a=h.Vec4,i=h.Mat4,r=h.Ray,n=function(){function t(t,e,n,r,o,a,h){this.fov=t||60,this.aspectRatio=e||4/3,this.near=n||.1,this.far=r||100,this.position=o||s.create(0,0,5),this.target=a||s.create(0,0,0),this.up=h||s.create(0,1,0),this.projectionMatrix=i.create(),this.viewMatrix=i.create(),this.updateMatrices()}var e;return t.prototype.getFov=function(){return this.fov},t.prototype.getAspectRatio=function(){return this.aspectRatio},t.prototype.getNear=function(){return this.near},t.prototype.getFar=function(){return this.far},t.prototype.getPosition=function(){return this.position},t.prototype.getTarget=function(){return this.target},t.prototype.getUp=function(){return this.up},t.prototype.getViewMatrix=function(){return this.viewMatrix},t.prototype.getProjectionMatrix=function(){return this.projectionMatrix},t.prototype.setFov=function(t){return this.fov=t,this.updateMatrices()},t.prototype.setAspectRatio=function(t){return this.aspectRatio=t,this.updateMatrices()},t.prototype.setFar=function(t){return this.far=t,this.updateMatrices()},t.prototype.setNear=function(t){return this.near=t,this.updateMatrices()},t.prototype.setPosition=function(t){return this.position=t,this.updateMatrices()},t.prototype.setTarget=function(t){return this.target=t,this.updateMatrices()},t.prototype.setUp=function(t){return this.up=t,this.updateMatrices()},t.prototype.lookAt=function(t,e,i){return t&&(this.target=t),e&&(this.position=e),i&&(this.up=i),this.updateMatrices()},t.prototype.updateMatrices=function(){return this.projectionMatrix.identity().perspective(this.fov,this.aspectRatio,this.near,this.far),this.viewMatrix.identity().lookAt(this.position,this.target,this.up)},e=a.create(),t.prototype.getScreenPos=function(t,i,n){var r;return e.set(t.x,t.y,t.z,1),e.transformMat4(this.viewMatrix),e.transformMat4(this.projectionMatrix),r=o.create().set(e.x,e.y),r.x/=e.w,r.y/=e.w,r.x=.5*r.x+.5,r.y=.5*r.y+.5,r.x*=i,r.y*=n,r},t.prototype.getViewRay=function(t,e,i,n){var o,a,h,l,c,u,p;return a=(t-i/2)/(i/2),h=-(e-n/2)/(n/2),o=2*Math.tan(this.getFov()/180*Math.PI/2)*this.getNear(),p=o*this.getAspectRatio(),a*=p/2,h*=o/2,c=new s(0,0,0),u=new s(a,h,-this.getNear()),l=u.dup().sub(c).normalize(),new r(c,l)},t.prototype.getWorldRay=function(t,e,i,n){var o,a,h,l,c,u,p,d;return t=(t-i/2)/(i/2),e=-(e-n/2)/(n/2),o=2*Math.tan(this.getFov()/180*Math.PI/2)*this.getNear(),u=o*this.getAspectRatio(),t*=u/2,e*=o/2,h=new s(0,0,0),l=new s(t,e,-this.getNear()),a=this.getViewMatrix().dup().invert(),p=h.dup().transformMat4(a),d=l.dup().transformMat4(a),c=d.dup().sub(p),new r(p,c)},t}(),e.exports=n},{"pex-geom":23}],51:[function(t,e){function i(t,e){this.gl=n.currentContext,this.handle=this.gl.createProgram(),this.uniforms={},this.attributes={},this.addSources(t,e),this.ready=!1,this.vertShader&&this.fragShader&&this.link()}var n=t("./Context"),r=t("pex-sys"),o=r.IO,s="#ifdef GL_ES\nprecision highp float;\n#endif\n#define VERT\n",a="#ifdef GL_ES\n#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n#else\n  precision mediump float;\n#endif\n#endif\n#define FRAG\n";i.prototype.addSources=function(t,e){return null==e&&(e=t),t&&this.addVertexSource(t),e?this.addFragmentSource(e):void 0},i.prototype.addVertexSource=function(t){if(this.vertShader=this.gl.createShader(this.gl.VERTEX_SHADER),this.gl.shaderSource(this.vertShader,s+t+"\n"),this.gl.compileShader(this.vertShader),!this.gl.getShaderParameter(this.vertShader,this.gl.COMPILE_STATUS))throw new Error(this.gl.getShaderInfoLog(this.vertShader))},i.prototype.addFragmentSource=function(t){if(this.fragShader=this.gl.createShader(this.gl.FRAGMENT_SHADER),this.gl.shaderSource(this.fragShader,a+t+"\n"),this.gl.compileShader(this.fragShader),!this.gl.getShaderParameter(this.fragShader,this.gl.COMPILE_STATUS))throw new Error(this.gl.getShaderInfoLog(this.fragShader))},i.prototype.link=function(){if(this.gl.attachShader(this.handle,this.vertShader),this.gl.attachShader(this.handle,this.fragShader),this.gl.linkProgram(this.handle),!this.gl.getProgramParameter(this.handle,this.gl.LINK_STATUS))throw new Error(this.gl.getProgramInfoLog(this.handle));for(var t=this.gl.getProgramParameter(this.handle,this.gl.ACTIVE_UNIFORMS),e=0;t>e;e++){var n=this.gl.getActiveUniform(this.handle,e);if(n.size>1)for(var r=0;r<n.size;r++){var o=n.name.replace(/\[\d+\]/,"["+r+"]"),s=this.gl.getUniformLocation(this.handle,o);this.uniforms[o]=i.makeUniformSetter(this.gl,n.type,s)}else{var s=this.gl.getUniformLocation(this.handle,n.name);this.uniforms[n.name]=i.makeUniformSetter(this.gl,n.type,s)}}for(var a=this.gl.getProgramParameter(this.handle,this.gl.ACTIVE_ATTRIBUTES),e=0;a>e;e++){n=this.gl.getActiveAttrib(this.handle,e);var s=this.gl.getAttribLocation(this.handle,n.name);this.attributes[n.name]=s}return this.ready=!0,this},i.prototype.use=function(){return i.currentProgram!==this.handle?(i.currentProgram=this.handle,this.gl.useProgram(this.handle)):void 0},i.prototype.dispose=function(){return this.gl.deleteShader(this.vertShader),this.gl.deleteShader(this.fragShader),this.gl.deleteProgram(this.handle)},i.load=function(t,e,n){var r;return r=new i,o.loadTextFile(t,function(i){return console.log("Program.Compiling "+t),r.addSources(i),r.link(),e&&e(),n&&n.autoreload?o.watchTextFile(t,function(e){var i;try{return r.gl.detachShader(r.handle,r.vertShader),r.gl.detachShader(r.handle,r.fragShader),r.addSources(e),r.link()}catch(n){return i=n,console.log("Program.load : failed to reload "+t),console.log(i)}}):void 0}),r},i.makeUniformSetter=function(t,e,i){var n=null;switch(e){case t.BOOL:case t.INT:n=function(e){return t.uniform1i(i,e)};break;case t.SAMPLER_2D:case t.SAMPLER_CUBE:n=function(e){return t.uniform1i(i,e)};break;case t.FLOAT:n=function(e){return t.uniform1f(i,e)};break;case t.FLOAT_VEC2:n=function(e){return t.uniform2f(i,e.x,e.y)};break;case t.FLOAT_VEC3:n=function(e){return t.uniform3f(i,e.x,e.y,e.z)};break;case t.FLOAT_VEC4:n=function(e){return null!=e.r&&t.uniform4f(i,e.r,e.g,e.b,e.a),null!=e.x?t.uniform4f(i,e.x,e.y,e.z,e.w):void 0};break;case t.FLOAT_MAT4:var r=new Float32Array(16);n=function(e){return r[0]=e.a11,r[1]=e.a21,r[2]=e.a31,r[3]=e.a41,r[4]=e.a12,r[5]=e.a22,r[6]=e.a32,r[7]=e.a42,r[8]=e.a13,r[9]=e.a23,r[10]=e.a33,r[11]=e.a43,r[12]=e.a14,r[13]=e.a24,r[14]=e.a34,r[15]=e.a44,t.uniformMatrix4fv(i,!1,r)}}return n?(n.type=e,n):function(){throw new Error("Unknown uniform type: "+e)}},e.exports=i},{"./Context":46,"pex-sys":82}],52:[function(t,e){function i(t,e,i){var s=this.gl=n.currentContext,a={color:!0,depth:!1};if(i=o(a,i),this.width=t,this.height=e,this.oldBinding=s.getParameter(s.FRAMEBUFFER_BINDING),this.handle=s.createFramebuffer(),s.bindFramebuffer(s.FRAMEBUFFER,this.handle),this.colorAttachments=[],this.colorAttachmentsPositions=[],this.depthAttachments=[],i.color===!0){var h=r.create(t,e,i);s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,h.target,h.handle,0),this.colorAttachments.push(h),this.colorAttachmentsPositions.push(s.COLOR_ATTACHMENT0)}else void 0!==i.color.length&&i.color.length>0?i.color.forEach(function(t,e){s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0+e,t.target,t.handle,0),this.colorAttachments.push(t),this.colorAttachmentsPositions.push(s.COLOR_ATTACHMENT0+e)}.bind(this)):i.color!==!1&&(s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,i.color.target,i.color.handle,0),this.colorAttachments.push(i.color),this.colorAttachmentsPositions.push(s.COLOR_ATTACHMENT0));if(i.depth)if(i.depth===!0){var l=s.getParameter(s.RENDERBUFFER_BINDING);this.depthAttachments[0]={handle:s.createRenderbuffer()},s.bindRenderbuffer(s.RENDERBUFFER,this.depthAttachments[0].handle),s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_COMPONENT16,this.width,this.height),s.bindRenderbuffer(s.RENDERBUFFER,l),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,this.depthAttachments[0].handle)}else this.depthAttachments[0]=i.depth,s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.TEXTURE_2D,this.depthAttachments[0].handle,0);this.checkFramebuffer(),this.checkExtensions(),s.bindFramebuffer(s.FRAMEBUFFER,this.oldBinding),this.oldBinding=null}var n=t("./Context"),r=t("./Texture2D"),o=t("merge"),s=t("pex-sys"),a=s.Platform;i.prototype.checkExtensions=function(){var t=this.gl;if(a.isBrowser&&this.colorAttachments.length>1&&(this.webglDrawBuffersExt=t.getExtension("WEBGL_draw_buffers"),!this.webglDrawBuffersExt))throw"RenderTarget creating multiple render targets:"+this.colorAttachments.length+" but WEBGL_draw_buffers is not available"},i.prototype.bind=function(){var t=this.gl;this.oldBinding=t.getParameter(t.FRAMEBUFFER_BINDING),t.bindFramebuffer(t.FRAMEBUFFER,this.handle),this.colorAttachmentsPositions.length>1&&(a.isBrowser?this.webglDrawBuffersExt.drawBuffersWEBGL(this.colorAttachmentsPositions):t.drawBuffers(this.colorAttachmentsPositions))},i.prototype.bindAndClear=function(){var t=this.gl;this.bind(),t.clearColor(0,0,0,1),t.clear(this.depthAttachments.length>0?t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT:t.COLOR_BUFFER_BIT)},i.prototype.unbind=function(){var t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,this.oldBinding),this.oldBinding=null,this.colorAttachmentsPositions.length>1&&(a.isBrowser?this.webglDrawBuffersExt.drawBuffersWEBGL([t.COLOR_ATTACHMENT0]):t.drawBuffers([t.COLOR_ATTACHMENT0]))},i.prototype.checkFramebuffer=function(){var t=this.gl,e=t.checkFramebufferStatus(t.FRAMEBUFFER);switch(e){case t.FRAMEBUFFER_UNSUPPORTED:throw"Framebuffer is unsupported";case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw"Framebuffer incomplete attachment";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw"Framebuffer incomplete dimensions";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw"Framebuffer incomplete missing attachment"}},i.prototype.getColorAttachment=function(t){return t=t||0,this.colorAttachments[t]},i.prototype.getDepthAttachement=function(){return this.depthAttachments[0]},e.exports=i},{"./Context":46,"./Texture2D":56,merge:1,"pex-sys":82}],53:[function(t,e){var i,n,r,o,s;r=t("pex-geom").Geometry,n=t("./Context"),i=t("./Buffer"),s=["faces","edges","indices"],o={compile:function(){var t,e,r,o,a,h,l,c;null==this.gl&&(this.gl=n.currentContext),l=this.attribs;for(e in l)t=l[e],t.buffer||(o=t.dynamic?this.gl.DYNAMIC_DRAW:this.gl.STATIC_DRAW,t.buffer=new i(this.gl.ARRAY_BUFFER,Float32Array,null,o),t.dirty=!0),t.dirty&&(t.buffer.update(t),t.dirty=!1);for(c=[],a=0,h=s.length;h>a;a++)r=s[a],this[r]?(this[r].buffer||(o=this[r].dynamic?this.gl.DYNAMIC_DRAW:this.gl.STATIC_DRAW,this[r].buffer=new i(this.gl.ELEMENT_ARRAY_BUFFER,Uint16Array,null,o),this[r].dirty=!0),this[r].dirty?(this[r].buffer.update(this[r]),c.push(this[r].dirty=!1)):c.push(void 0)):c.push(void 0);return c},dispose:function(){var t,e,i,n,r,o,a;o=this.attribs;for(e in o)t=o[e],t&&t.buffer&&t.buffer.dispose();for(a=[],n=0,r=s.length;r>n;n++)i=s[n],a.push(this[i]&&this[i].buffer?this[i].buffer.dispose():void 0);return a}},e.exports=o},{"./Buffer":45,"./Context":46,"pex-geom":23}],54:[function(t,e){(function(){function i(t,e,i,n,c,u,p){e=void 0!==e?e:0,i=void 0!==i?i:0,n=void 0!==n?n:1,c=void 0!==c?c:1,u=void 0!==u?u:1,p=void 0!==p?p:1,this.image=t;var d=new s(l),f={screenSize:r.create(u,p),pixelPosition:r.create(e,i),pixelSize:r.create(n,c),alpha:1};t&&(f.image=t);var g=new a(d,f),m=[new r(-1,1),new r(-1,-1),new r(1,-1),new r(1,1)],v=[new r(0,1),new r(0,0),new r(1,0),new r(1,1)],x=new o({vertices:m,texCoords:v,faces:!0});x.faces.push([0,1,2]),x.faces.push([0,2,3]),this.mesh=new h(x,g)}var n=t("pex-geom"),r=n.Vec2,o=n.Geometry,s=t("./Program"),a=t("./Material"),h=t("./Mesh"),l="#ifdef VERT\n\nattribute vec2 position;\nattribute vec2 texCoord;\nuniform vec2 screenSize;\nuniform vec2 pixelPosition;\nuniform vec2 pixelSize;\nvarying vec2 vTexCoord;\n\nvoid main() {\n  float tx = position.x * 0.5 + 0.5; //-1 -> 0, 1 -> 1\n  float ty = -position.y * 0.5 + 0.5; //-1 -> 1, 1 -> 0\n  //(x + 0)/sw * 2 - 1, (x + w)/sw * 2 - 1\n  float x = (pixelPosition.x + pixelSize.x * tx)/screenSize.x * 2.0 - 1.0;  //0 -> -1, 1 -> 1\n  //1.0 - (y + h)/sh * 2, 1.0 - (y + h)/sh * 2\n  float y = 1.0 - (pixelPosition.y + pixelSize.y * ty)/screenSize.y * 2.0;  //0 -> 1, 1 -> -1\n  gl_Position = vec4(x, y, 0.0, 1.0);\n  vTexCoord = texCoord;\n}\n\n#endif\n\n#ifdef FRAG\n\nvarying vec2 vTexCoord;\nuniform sampler2D image;\nuniform float alpha;\n\nvoid main() {\n  gl_FragColor = texture2D(image, vTexCoord);\n  gl_FragColor.a *= alpha;\n}\n\n#endif";i.prototype.setAlpha=function(t){this.mesh.material.uniforms.alpha=t},i.prototype.setPosition=function(t){this.mesh.material.uniforms.pixelPosition=t},i.prototype.setSize=function(t){this.mesh.material.uniforms.pixelSize=t},i.prototype.setWindowSize=function(t){this.mesh.material.uniforms.windowSize=t},i.prototype.setBounds=function(t){this.mesh.material.uniforms.pixelPosition.x=t.x,this.mesh.material.uniforms.pixelPosition.y=t.y,this.mesh.material.uniforms.pixelSize.x=t.width,this.mesh.material.uniforms.pixelSize.y=t.height},i.prototype.setImage=function(t){this.image=t,this.mesh.material.uniforms.image=t},i.prototype.draw=function(t,e){var i=null;t&&(i=this.mesh.material.uniforms.image,this.mesh.material.uniforms.image=t);var n=null;e&&(n=this.mesh.getProgram(),this.mesh.setProgram(e)),this.mesh.draw(),n&&this.mesh.setProgram(n),i&&(this.mesh.material.uniforms.image=i)},e.exports=i}).call(this,"/../../../pex-glu/lib")},{"./Material":47,"./Mesh":48,"./Program":51,"pex-geom":23}],55:[function(t,e){function i(t){t&&this.init(t)}var n=t("./Context");i.RGBA32F=34836,i.prototype.init=function(t){this.gl=n.currentContext,this.target=t,this.handle=this.gl.createTexture()},i.prototype.bind=function(t){t=t?t:0,this.gl.activeTexture(this.gl.TEXTURE0+t),this.gl.bindTexture(this.target,this.handle)},e.exports=i},{"./Context":46}],56:[function(t,e){function i(){this.gl=s.currentContext,a.call(this,this.gl.TEXTURE_2D)}var n=t("pex-sys"),r=t("merge"),o=n.IO,s=t("./Context"),a=t("./Texture"),h=n.Platform;i.prototype=Object.create(a.prototype),i.create=function(t,e,n){var o=s.currentContext,a={repeat:!1,mipmap:!1,nearest:!1,internalFormat:o.RGBA,format:o.RGBA,type:o.UNSIGNED_BYTE};n=r(a,n);var h=new i;h.bind();var l=o.getExtension?!0:!1;32==n.bpp?(n.internalFormat=l?o.RGBA:34836,n.type=o.FLOAT):n.internalFormat=n.format,h.checkExtensions(n),o.texImage2D(o.TEXTURE_2D,0,n.format,t,e,0,n.format,n.type,null);var c=n.repeat?o.REPEAT:o.CLAMP_TO_EDGE,u=n.repeat?o.REPEAT:o.CLAMP_TO_EDGE,p=o.LINEAR,d=o.LINEAR;return n.nearest&&(p=o.NEAREST,d=o.NEAREST),n.mipmap&&(d=o.LINEAR_MIPMAP_LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,p),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,d),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,c),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,u),o.bindTexture(o.TEXTURE_2D,null),h.width=t,h.height=e,h.target=o.TEXTURE_2D,h},i.prototype.checkExtensions=function(t){var e=this.gl;if(h.isBrowser){if(t.format==e.DEPTH_COMPONENT){var i=e.getExtension("WEBGL_depth_texture");if(!i)throw"Texture2D creating texture with format:gl.DEPTH_COMPONENT but WEBGL_depth_texture is not available"}if(t.type==e.FLOAT){var n=e.getExtension("OES_texture_float");if(!n)throw"Texture2D creating texture with type:gl.FLOAT but OES_texture_float is not available"}}},i.prototype.bind=function(t){t=t?t:0,this.gl.activeTexture(this.gl.TEXTURE0+t),this.gl.bindTexture(this.gl.TEXTURE_2D,this.handle)},i.genNoise=function(t,e){t=t||256,e=e||256;var n=s.currentContext,r=new i;r.bind();for(var o=new ArrayBuffer(t*e*2),a=new Uint8Array(o),h=0;e>h;h++)for(var l=0;t>l;l++)a[h*t+l]=Math.floor(255*Math.random());return n.texImage2D(n.TEXTURE_2D,0,n.LUMINANCE,t,e,0,n.LUMINANCE,n.UNSIGNED_BYTE,a),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.bindTexture(n.TEXTURE_2D,null),r.width=t,r.height=e,r},i.genNoiseRGBA=function(t,e){t=t||256,e=e||256;var n=s.currentContext,r=n.createTexture();n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,r);for(var o=new ArrayBuffer(t*e*4),a=new Uint8Array(o),h=0;e>h;h++)for(var l=0;t>l;l++)a[4*(h*t+l)+0]=h,a[4*(h*t+l)+1]=Math.floor(255*Math.random()),a[4*(h*t+l)+2]=Math.floor(255*Math.random()),a[4*(h*t+l)+3]=Math.floor(255*Math.random());n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t,e,0,n.RGBA,n.UNSIGNED_BYTE,a),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!0),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.bindTexture(n.TEXTURE_2D,null);var c=new i;return c.handle=r,c.width=t,c.height=e,c.target=n.TEXTURE_2D,c.gl=n,c},i.load=function(t,e,n){n||"function"!=typeof e||(n=e,optiosn=null);var a={repeat:!1,mipmap:!1,nearest:!1};e=r(a,e);var h=s.currentContext,l=i.create(0,0,e);return l.ready=!1,o.loadImageData(h,l.handle,l.target,l.target,t,{flip:!0,crossOrigin:e.crossOrigin},function(t){if(!t){l.dispose();var r=i.getNoise();l.handle=r.handle,l.width=r.width,l.height=r.height}e.mipmap&&l.generateMipmap(),h.bindTexture(l.target,null),l.width=t.width,l.height=t.height,l.ready=!0,n&&n(l)}),l},i.prototype.dispose=function(){this.handle&&(this.gl.deleteTexture(this.handle),this.handle=null)},i.prototype.generateMipmap=function(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.handle),this.gl.generateMipmap(this.gl.TEXTURE_2D)},e.exports=i},{"./Context":46,"./Texture":55,merge:1,"pex-sys":82}],57:[function(t,e){function i(){this.gl=o.currentContext,s.call(this,this.gl.TEXTURE_CUBE_MAP)}var n=t("pex-sys"),r=n.IO,o=(n.Platform,t("./Context")),s=t("./Texture"),a=t("merge");i.prototype=Object.create(s.prototype),i.load=function(t,e,n){var s={mipmap:!1,nearest:!1};e=a(s,e);var h=o.currentContext,l=new i,c=[h.TEXTURE_CUBE_MAP_POSITIVE_X,h.TEXTURE_CUBE_MAP_NEGATIVE_X,h.TEXTURE_CUBE_MAP_POSITIVE_Y,h.TEXTURE_CUBE_MAP_NEGATIVE_Y,h.TEXTURE_CUBE_MAP_POSITIVE_Z,h.TEXTURE_CUBE_MAP_NEGATIVE_Z],u=h.LINEAR,p=h.LINEAR;e.nearest&&(p=h.NEAREST,u=h.NEAREST),(e.mipmap||t.length>6)&&(u=h.LINEAR_MIPMAP_LINEAR),h.bindTexture(l.target,l.handle),h.texParameteri(l.target,h.TEXTURE_MAG_FILTER,p),h.texParameteri(l.target,h.TEXTURE_MIN_FILTER,u),h.texParameteri(l.target,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(l.target,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),l.ready=!1;for(var d=0,f=0;f<t.length;f++)r.loadImageData(h,l.handle,l.target,c[f%6],t[f],{flip:!1,lod:Math.floor(f/6)},function(i){l.width=i.width,l.height=i.height,++d==t.length&&(e.mipmap&&(h.bindTexture(l.target,l.handle),h.generateMipmap(l.target)),l.ready=!0,n&&n(l))});return l},i.prototype.dispose=function(){this.handle&&(this.gl.deleteTexture(this.handle),this.handle=null)},e.exports=i},{"./Context":46,"./Texture":55,merge:1,"pex-sys":82}],58:[function(t,e){var i=t("./Context");e.exports.getCurrentContext=function(){return i.currentContext},e.exports.clearColor=function(t){var e=i.currentContext;return t&&e.clearColor(t.r,t.g,t.b,t.a),e.clear(e.COLOR_BUFFER_BIT),this},e.exports.clearDepth=function(){var t=i.currentContext;return t.clear(t.DEPTH_BUFFER_BIT),this},e.exports.clearColorAndDepth=function(t){var e=i.currentContext;return t=t||{r:0,g:0,b:0,a:1},e.clearColor(t.r,t.g,t.b,t.a),e.depthMask(1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),this},e.exports.enableDepthReadAndWrite=function(t,e){2==arguments.length||(1==arguments.length?e=t:(t=!0,e=!0));var n=i.currentContext;return n.depthMask(e?1:0),t?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this},e.exports.enableAdditiveBlending=function(){return this.enableBlending("ONE","ONE")},e.exports.enableAlphaBlending=function(){return this.enableBlending("SRC_ALPHA","ONE_MINUS_SRC_ALPHA")},e.exports.enableBlending=function(t,e){var n=i.currentContext;return t===!1?(n.disable(n.BLEND),this):(n.enable(n.BLEND),n.blendFunc(n[t],n[e]),this)},e.exports.viewport=function(t,e,n,r){var o=i.currentContext;return o.viewport(t,e,n,r),this},e.exports.scissor=function(t,e,n,r){var o=i.currentContext;if(t===!1)o.disable(o.SCISSOR_TEST);else if(null!=t.width){var s=t;o.enable(o.SCISSOR_TEST),o.scissor(s.x,s.y,s.width,s.height)}else o.enable(o.SCISSOR_TEST),o.scissor(t,e,n,r);return this},e.exports.cullFace=function(t){t=void 0!==t?t:!0;var e=i.currentContext;return t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),e.cullFace(e.BACK),this},e.exports.lineWidth=function(t){var e=i.currentContext;return e.lineWidth(t),this}},{"./Context":46}],59:[function(t,e){e.exports.GUI=t("./lib/GUI")},{"./lib/GUI":60}],60:[function(t,e){function i(t,e,i,n){this.gl=u.currentContext,this.window=t,this.x=void 0===e?0:e,this.y=void 0===i?0:i,this.mousePos=d.create(),this.scale=n||1,this.highdpi=t.settings.highdpi||1,a.isPlask?this.renderer=new l(t.width,t.height,this.highdpi):a.isBrowser&&(this.renderer=new c(t.width,t.height,this.highdpi)),this.screenBounds=new g(this.x,this.y,t.width,t.height),this.screenImage=new p(this.renderer.getTexture(),this.x,this.y,t.width,t.height,t.width,t.height),this.items=[],this.bindEventListeners(t),this.enabled=!0}var n=t("pex-glu"),r=t("pex-geom"),o=t("pex-sys"),s=t("pex-color"),a=o.Platform,h=t("./GUIControl"),l=t("./SkiaRenderer"),c=t("./HTMLCanvasRenderer"),u=n.Context,p=n.ScreenImage,d=r.Vec2,f=r.Vec3,g=r.Rect,m=r.Spline1D,v=r.Spline2D,x=o.IO,y=s.Color;i.prototype.bindEventListeners=function(t){var e=this;t.on("leftMouseDown",function(t){e.onMouseDown(t)}),t.on("mouseDragged",function(t){e.onMouseDrag(t)}),t.on("leftMouseUp",function(t){e.onMouseUp(t)})},i.prototype.onMouseDown=function(t){if(this.enabled){this.activeControl=null,this.mousePos.set(t.x/this.highdpi-this.x,t.y/this.highdpi-this.y);for(var e=0;e<this.items.length;e++)if(this.items[e].activeArea.contains(this.mousePos)){if(this.activeControl=this.items[e],this.activeControl.active=!0,this.activeControl.dirty=!0,"button"==this.activeControl.type)this.activeControl.contextObject[this.activeControl.methodName]();else if("toggle"==this.activeControl.type)this.activeControl.contextObject[this.activeControl.attributeName]=!this.activeControl.contextObject[this.activeControl.attributeName],this.activeControl.onchange&&this.activeControl.onchange(this.activeControl.contextObject[this.activeControl.attributeName]);
else if("radiolist"==this.activeControl.type){var i=this.mousePos.y-this.activeControl.activeArea.y,n=Math.floor(this.activeControl.items.length*i/this.activeControl.activeArea.height);if(0>n)continue;if(n>=this.activeControl.items.length)continue;this.activeControl.contextObject[this.activeControl.attributeName]=this.activeControl.items[n].value,this.activeControl.onchange&&this.activeControl.onchange(this.activeControl.items[n].value)}else if("texturelist"==this.activeControl.type){var r=null;if(this.activeControl.items.forEach(function(t){t.activeArea.contains(this.mousePos)&&(r=t)}.bind(this)),!r)continue;this.activeControl.contextObject[this.activeControl.attributeName]=r.value,this.activeControl.onchange&&this.activeControl.onchange(r.value)}else if("color"==this.activeControl.type){var o=this.activeControl.activeArea,s=(this.activeControl.options.alpha?4:3,o.height);if(this.activeControl.options.palette){var a=this.activeControl.options.paletteImage.width,h=this.activeControl.options.paletteImage.height,l=t.y/this.highdpi-o.y;s=o.height-o.width*h/a;var c=o.width*h/a,u=o.height-c;if(l>u){var p=(t.x/this.highdpi-o.x)/o.width,d=(l-u)/c,f=Math.floor(a*p),l=Math.floor(h*d),g=this.renderer.getImageColor(this.activeControl.options.paletteImage,f,l);this.activeControl.dirty=!0,this.activeControl.contextObject[this.activeControl.attributeName].r=g.r,this.activeControl.contextObject[this.activeControl.attributeName].g=g.g,this.activeControl.contextObject[this.activeControl.attributeName].b=g.b,this.activeControl.onchange&&this.activeControl.onchange(this.activeControl.contextObject[this.activeControl.attributeName]);continue}}}t.handled=!0,this.onMouseDrag(t);break}}},i.prototype.onMouseDrag=function(t){if(this.enabled&&this.activeControl){var e=this.activeControl.activeArea;if("slider"==this.activeControl.type){var i=(t.x/this.highdpi-e.x)/e.width;i=Math.max(0,Math.min(i,1)),this.activeControl.setNormalizedValue(i),this.activeControl.onchange&&this.activeControl.onchange(this.activeControl.contextObject[this.activeControl.attributeName]),this.activeControl.dirty=!0}else if("multislider"==this.activeControl.type){var i=(t.x/this.highdpi-e.x)/e.width;i=Math.max(0,Math.min(i,1));var n=Math.floor(this.activeControl.getValue().length*(t.y/this.highdpi-e.y)/e.height);isNaN(this.activeControl.clickedSlider)?this.activeControl.clickedSlider=n:n=this.activeControl.clickedSlider,this.activeControl.setNormalizedValue(i,n),this.activeControl.onchange&&this.activeControl.onchange(this.activeControl.contextObject[this.activeControl.attributeName]),this.activeControl.dirty=!0}else if("vec2"==this.activeControl.type){var r=2,i=(t.x/this.highdpi-e.x)/e.width;i=Math.max(0,Math.min(i,1));var n=Math.floor(r*(t.y/this.highdpi-e.y)/e.height);isNaN(this.activeControl.clickedSlider)?this.activeControl.clickedSlider=n:n=this.activeControl.clickedSlider,this.activeControl.setNormalizedValue(i,n),this.activeControl.onchange&&this.activeControl.onchange(this.activeControl.contextObject[this.activeControl.attributeName]),this.activeControl.dirty=!0}else if("vec3"==this.activeControl.type){var r=3,i=(t.x/this.highdpi-e.x)/e.width;i=Math.max(0,Math.min(i,1));var n=Math.floor(r*(t.y/this.highdpi-e.y)/e.height);isNaN(this.activeControl.clickedSlider)?this.activeControl.clickedSlider=n:n=this.activeControl.clickedSlider,this.activeControl.setNormalizedValue(i,n),this.activeControl.onchange&&this.activeControl.onchange(this.activeControl.contextObject[this.activeControl.attributeName]),this.activeControl.dirty=!0}else if("color"==this.activeControl.type){var r=this.activeControl.options.alpha?4:3,o=e.height;if(this.activeControl.options.palette){var s=this.activeControl.options.paletteImage.width,a=this.activeControl.options.paletteImage.height,h=t.y/this.highdpi-e.y;o=e.height-e.width*a/s;var l=e.width*a/s,c=e.height-l;if(h>c&&isNaN(this.activeControl.clickedSlider)){var u=(t.x/this.highdpi-e.x)/e.width,p=(h-c)/l,d=Math.floor(s*u),h=Math.floor(a*p),f=this.renderer.getImageColor(this.activeControl.options.paletteImage,d,h);return this.activeControl.dirty=!0,this.activeControl.contextObject[this.activeControl.attributeName].r=f.r,this.activeControl.contextObject[this.activeControl.attributeName].g=f.g,this.activeControl.contextObject[this.activeControl.attributeName].b=f.b,this.activeControl.onchange&&this.activeControl.onchange(this.activeControl.contextObject[this.activeControl.attributeName]),void(t.handled=!0)}}var i=(t.x/this.highdpi-e.x)/e.width;i=Math.max(0,Math.min(i,1));var n=Math.floor(r*(t.y/this.highdpi-e.y)/o);isNaN(this.activeControl.clickedSlider)?this.activeControl.clickedSlider=n:n=this.activeControl.clickedSlider,this.activeControl.setNormalizedValue(i,n),this.activeControl.onchange&&this.activeControl.onchange(this.activeControl.contextObject[this.activeControl.attributeName]),this.activeControl.dirty=!0}t.handled=!0}},i.prototype.onMouseUp=function(){this.enabled&&this.activeControl&&(this.activeControl.active=!1,this.activeControl.dirty=!0,this.activeControl.clickedSlider=void 0,this.activeControl=null)},i.prototype.addHeader=function(t){var e=new h({type:"header",title:t,dirty:!0,activeArea:new g(0,0,0,0),setTitle:function(t){this.title=t,this.dirty=!0}});return this.items.push(e),e},i.prototype.addLabel=function(t){var e=new h({type:"label",title:t,dirty:!0,activeArea:new g(0,0,0,0),setTitle:function(t){this.title=t,this.dirty=!0}});return this.items.push(e),e},i.prototype.addParam=function(t,e,i,n,r){if(n=n||{},"undefined"==typeof n.min&&(n.min=0),"undefined"==typeof n.max&&(n.max=1),e[i]===!1||e[i]===!0){var o=new h({type:"toggle",title:t,contextObject:e,attributeName:i,activeArea:new g(0,0,0,0),options:n,onchange:r,dirty:!0});return this.items.push(o),o}if(!isNaN(e[i])){var o=new h({type:"slider",title:t,contextObject:e,attributeName:i,activeArea:new g(0,0,0,0),options:n,onchange:r,dirty:!0});return this.items.push(o),o}if(e[i]instanceof Array){var o=new h({type:"multislider",title:t,contextObject:e,attributeName:i,activeArea:new g(0,0,0,0),options:n,onchange:r,dirty:!0});return this.items.push(o),o}if(e[i]instanceof d){var o=new h({type:"vec2",title:t,contextObject:e,attributeName:i,activeArea:new g(0,0,0,0),options:n,onchange:r,dirty:!0});return this.items.push(o),o}if(e[i]instanceof f){var o=new h({type:"vec3",title:t,contextObject:e,attributeName:i,activeArea:new g(0,0,0,0),options:n,onchange:r,dirty:!0});return this.items.push(o),o}if(e[i]instanceof y){var o=new h({type:"color",title:t,contextObject:e,attributeName:i,activeArea:new g(0,0,0,0),options:n,onchange:r,dirty:!0});return this.items.push(o),o}if(e[i]instanceof m){var o=new h({type:"spline1D",title:t,contextObject:e,attributeName:i,activeArea:new g(0,0,0,0),options:n,onchange:r,dirty:!0});return this.items.push(o),o}if(e[i]instanceof v){var o=new h({type:"spline2D",title:t,contextObject:e,attributeName:i,activeArea:new g(0,0,0,0),options:n,onchange:r,dirty:!0});return this.items.push(o),o}},i.prototype.addButton=function(t,e,i,n){var r=new h({type:"button",title:t,contextObject:e,methodName:i,activeArea:new g(0,0,0,0),dirty:!0,options:n||{}});return this.items.push(r),r},i.prototype.addRadioList=function(t,e,i,n,r){var o=new h({type:"radiolist",title:t,contextObject:e,attributeName:i,activeArea:new g(0,0,0,0),items:n,onchange:r,dirty:!0});return this.items.push(o),o},i.prototype.addTextureList=function(t,e,i,n,r,o){var s=new h({type:"texturelist",title:t,contextObject:e,attributeName:i,activeArea:new g(0,0,0,0),items:n,itemsPerRow:r||4,onchange:o,dirty:!0});return this.items.push(s),s},i.prototype.addTexture2D=function(t,e){var i=new h({type:"texture2D",title:t,texture:e,activeArea:new g(0,0,0,0),dirty:!0});return this.items.push(i),i},i.prototype.dispose=function(){},i.prototype.draw=function(){if(this.enabled&&0!==this.items.length){this.renderer.draw(this.items,this.scale),n.enableDepthReadAndWrite(!1,!1);var t=u.currentContext;t.disable(t.DEPTH_TEST),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),this.screenImage.draw(),t.disable(t.BLEND),t.enable(t.DEPTH_TEST),this.drawTextures()}},i.prototype.drawTextures=function(){for(var t=0;t<this.items.length;t++){var e=this.items[t],i=this.scale*this.highdpi;if("texture2D"==e.type){var n=new g(e.activeArea.x*i,e.activeArea.y*i,e.activeArea.width*i,e.activeArea.height*i);this.screenImage.setBounds(n),this.screenImage.setImage(e.texture),this.screenImage.draw()}"texturelist"==e.type&&e.items.forEach(function(t){var e=new g(t.activeArea.x*i,t.activeArea.y*i,t.activeArea.width*i,t.activeArea.height*i);this.screenImage.setBounds(e),this.screenImage.setImage(t.texture),this.screenImage.draw()}.bind(this))}this.screenImage.setBounds(this.screenBounds),this.screenImage.setImage(this.renderer.getTexture())},i.prototype.serialize=function(){var t={};return this.items.forEach(function(e){t[e.title]=e.getSerializedValue()}),t},i.prototype.deserialize=function(t){this.items.forEach(function(e){void 0!==t[e.title]&&(e.setSerializedValue(t[e.title]),e.dirty=!0)})},i.prototype.save=function(t){var e=this.serialize();x.saveTextFile(t,JSON.stringify(e))},i.prototype.load=function(t,e){var i=this;x.loadTextFile(t,function(t){var n=JSON.parse(t);i.deserialize(n),e&&e()})},i.prototype.setEnabled=function(t){this.enabled=t},i.prototype.isEnabled=function(){return this.enabled},i.prototype.toggleEnabled=function(){return this.enabled=!this.enabled},e.exports=i},{"./GUIControl":61,"./HTMLCanvasRenderer":62,"./SkiaRenderer":63,"pex-color":2,"pex-geom":23,"pex-glu":43,"pex-sys":82}],61:[function(t,e){function i(t){for(var e in t)this[e]=t[e]}i.prototype.setPosition=function(t,e){this.px=t,this.py=e},i.prototype.getNormalizedValue=function(t){if(!this.contextObject)return 0;var e=this.contextObject[this.attributeName],i=this.options;if(i&&void 0!==i.min&&void 0!==i.max)if("multislider"==this.type)e=(e[t]-i.min)/(i.max-i.min);else if("vec2"==this.type)0==t&&(e=e.x),1==t&&(e=e.y),e=(e-i.min)/(i.max-i.min);else if("vec3"==this.type)0==t&&(e=e.x),1==t&&(e=e.y),2==t&&(e=e.z),e=(e-i.min)/(i.max-i.min);else if("color"==this.type){var n=e.getHSL();0==t&&(e=n.h),1==t&&(e=n.s),2==t&&(e=n.l),3==t&&(e=n.a)}else e=(e-i.min)/(i.max-i.min);return e},i.prototype.setNormalizedValue=function(t,e){if(this.contextObject){var i=this.options;if(i&&void 0!==i.min&&void 0!==i.max){if("multislider"==this.type){var n=this.contextObject[this.attributeName];if(e>=n.length)return;n[e]=i.min+t*(i.max-i.min),t=n}else if("vec2"==this.type){var r=this.contextObject[this.attributeName],t=i.min+t*(i.max-i.min);0==e&&(r.x=t),1==e&&(r.y=t),t=r}else if("vec3"==this.type){var t=i.min+t*(i.max-i.min),r=this.contextObject[this.attributeName];0==e&&(r.x=t),1==e&&(r.y=t),2==e&&(r.z=t),t=r}else if("color"==this.type){var r=this.contextObject[this.attributeName],o=r.getHSL();0==e&&(o.h=t),1==e&&(o.s=t),2==e&&(o.l=t),3==e&&(o.a=t),r.setHSL(o.h,o.s,o.l,o.a),t=r}else t=i.min+t*(i.max-i.min);i&&i.step&&(t-=t%i.step)}this.contextObject[this.attributeName]=t}},i.prototype.getSerializedValue=function(){return this.contextObject?this.contextObject[this.attributeName]:""},i.prototype.setSerializedValue=function(t){"slider"==this.type?this.contextObject[this.attributeName]=t:"multislider"==this.type?this.contextObject[this.attributeName]=t:"vec2"==this.type?(this.contextObject[this.attributeName].x=t.x,this.contextObject[this.attributeName].y=t.y):"vec3"==this.type?(this.contextObject[this.attributeName].x=t.x,this.contextObject[this.attributeName].y=t.y,this.contextObject[this.attributeName].z=t.z):"color"==this.type?(this.contextObject[this.attributeName].r=t.r,this.contextObject[this.attributeName].g=t.g,this.contextObject[this.attributeName].b=t.b,this.contextObject[this.attributeName].a=t.a):"toggle"==this.type?this.contextObject[this.attributeName]=t:"radiolist"==this.type&&(this.contextObject[this.attributeName]=t)},i.prototype.getValue=function(){return"slider"==this.type?this.contextObject[this.attributeName]:"multislider"==this.type?this.contextObject[this.attributeName]:"vec2"==this.type?this.contextObject[this.attributeName]:"vec3"==this.type?this.contextObject[this.attributeName]:"color"==this.type?this.contextObject[this.attributeName]:"toggle"==this.type?this.contextObject[this.attributeName]:0},i.prototype.getStrValue=function(){if("slider"==this.type){var t=""+this.contextObject[this.attributeName],e=t.indexOf(".")+1;if(0===e)return t+".0";for(;"0"==t.charAt(e);)e++;return t.substr(0,e+2)}return"vec2"==this.type?"XY":"vec3"==this.type?"XYZ":"color"==this.type?"HSLA":"toggle"==this.type?this.contextObject[this.attributeName]:""},e.exports=i},{}],62:[function(t,e){function i(t,e,i){this.gl=o.currentContext,this.highdpi=i||1,this.canvas=document.createElement("canvas"),this.tex=s.create(t,e),this.canvas.width=t,this.canvas.height=e,this.ctx=this.canvas.getContext("2d"),this.dirty=!0}var n=t("pex-glu"),r=t("pex-geom"),o=(t("plask"),n.Context),s=n.Texture2D,a=r.Rect;i.prototype.isAnyItemDirty=function(t){var e=!1;return t.forEach(function(t){t.dirty&&(t.dirty=!1,e=!0)}),e},i.prototype.draw=function(t,e){function i(t){var e=new Image;e.src=t.options.palette,e.onload=function(){var i=document.createElement("canvas");i.width=s,i.height=s*e.height/e.width;var n=i.getContext("2d");n.drawImage(e,0,0,i.width,i.height),t.options.paletteImage=i,t.options.paletteImage.ctx=n,t.options.paletteImage.data=n.getImageData(0,0,i.width,i.height).data,t.dirty=!0}}if(this.isAnyItemDirty(t)){var n=this.ctx;n.save(),n.scale(this.highdpi,this.highdpi),n.clearRect(0,0,this.canvas.width,this.canvas.height),n.font="10px Monaco";for(var r=10,o=10,s=160,h=0,l=0,c=3,u=0;u<t.length;u++){var p=t[u];p.px&&p.px&&(o=p.px/this.highdpi,r=p.py/this.highdpi);var d=20*e;if("slider"==p.type&&(d=20*e+14),"toggle"==p.type&&(d=20*e),"multislider"==p.type&&(d=18+20*p.getValue().length*e),"vec2"==p.type&&(d=20+28*e),"vec3"==p.type&&(d=20+42*e),"color"==p.type&&(d=20+14*(p.options.alpha?4:3)*e),"color"==p.type&&p.options.paletteImage&&(d+=(s*p.options.paletteImage.height/p.options.paletteImage.width+2)*e),"button"==p.type&&(d=24*e),"texture2D"==p.type&&(d=24+p.texture.height*s/p.texture.width),"radiolist"==p.type&&(d=18+20*p.items.length*e),"texturelist"==p.type&&(h=Math.floor((s-2*c)/p.itemsPerRow),l=Math.ceil(p.items.length/p.itemsPerRow),d=21+l*h),("spline1D"==p.type||"spline2D"==p.type)&&(d=24+s),"header"==p.type&&(d=26*e),n.fillStyle="rgba(0, 0, 0, 0.56)",n.fillRect(o,r,s,d-2),p.options&&p.options.palette&&!p.options.paletteImage&&i(p),"slider"==p.type)n.fillStyle="rgba(150, 150, 150, 1)",n.fillRect(o+3,r+18,s-3-3,d-5-18),n.fillStyle="rgba(255, 255, 0, 1)",n.fillRect(o+3,r+18,(s-3-3)*p.getNormalizedValue(),d-5-18),p.activeArea.set(o+3,r+18,s-3-3,d-5-18),n.fillStyle="rgba(255, 255, 255, 1)",n.fillText(t[u].title+" : "+p.getStrValue(),o+4,r+13);else if("vec2"==p.type){for(var f=2,g=0;f>g;g++)n.fillStyle="rgba(150, 150, 150, 1)",n.fillRect(o+3,r+18+14*g*e,s-6,14*e-3),n.fillStyle="rgba(255, 255, 0, 1)",n.fillRect(o+3,r+18+14*g*e,(s-6)*p.getNormalizedValue(g),14*e-3);n.fillStyle="rgba(255, 255, 255, 1)",n.fillText(t[u].title+" : "+p.getStrValue(),o+4,r+13),p.activeArea.set(o+3,r+18,s-3-3,d-5-18)}else if("vec3"==p.type){for(var f=3,g=0;f>g;g++)n.fillStyle="rgba(150, 150, 150, 1)",n.fillRect(o+3,r+18+14*g*e,s-6,14*e-3),n.fillStyle="rgba(255, 255, 0, 1)",n.fillRect(o+3,r+18+14*g*e,(s-6)*p.getNormalizedValue(g),14*e-3);n.fillStyle="rgba(255, 255, 255, 1)",n.fillText(t[u].title+" : "+p.getStrValue(),o+4,r+13),p.activeArea.set(o+3,r+18,s-3-3,d-5-18)}else if("color"==p.type){for(var f=p.options.alpha?4:3,g=0;f>g;g++)n.fillStyle="rgba(150, 150, 150, 1)",n.fillRect(o+3,r+18+14*g*e,s-6,14*e-3),n.fillStyle="rgba(255, 255, 0, 1)",n.fillRect(o+3,r+18+14*g*e,(s-6)*p.getNormalizedValue(g),14*e-3);p.options.paletteImage&&(console.log("e.options.paletteImage"),n.drawImage(p.options.paletteImage,o+3,r+18+14*f,s-6,s*p.options.paletteImage.height/p.options.paletteImage.width)),n.fillStyle="rgba(255, 255, 255, 1)",n.fillText(t[u].title+" : "+p.getStrValue(),o+4,r+13),p.activeArea.set(o+3,r+18,s-3-3,d-5-18)}else if("button"==p.type){if(n.fillStyle=p.active?"rgba(255, 255, 0, 1)":"rgba(150, 150, 150, 1)",n.fillRect(o+3,r+3,s-3-3,d-5-3),p.activeArea.set(o+3,r+3,s-3-3,d-5-3),n.fillStyle=p.active?"rgba(100, 100, 100, 1)":"rgba(255, 255, 255, 1)",n.fillText(t[u].title,o+5,r+15),p.options.color){var m=p.options.color;n.fillStyle="rgba("+255*m.x+", "+255*m.y+", "+255*m.z+", 1)",n.fillRect(o+s-8,r+3,5,d-5-3)}}else if("toggle"==p.type){var v=p.contextObject[p.attributeName];n.fillStyle=v?"rgba(255, 255, 0, 1)":"rgba(150, 150, 150, 1)",n.fillRect(o+3,r+3,d-5-3,d-5-3),p.activeArea.set(o+3,r+3,d-5-3,d-5-3),n.fillStyle="rgba(255, 255, 255, 1)",n.fillText(t[u].title,o+d,r+12)}else if("radiolist"==p.type){n.fillStyle="rgba(255, 255, 255, 1)",n.fillText(p.title,o+4,r+13);for(var x=20*e,g=0;g<p.items.length;g++){var y=p.items[g],v=p.contextObject[p.attributeName]==y.value;n.fillStyle=v?"rgba(255, 255, 0, 1)":"rgba(150, 150, 150, 1)",n.fillRect(o+3,18+g*x+r+3,x-5-3,x-5-3),n.fillStyle="rgba(255, 255, 255, 1)",n.fillText(y.name,o+5+x-5,18+g*x+r+13)}p.activeArea.set(o+3,18+r+3,x-5,p.items.length*x-5)}else if("texturelist"==p.type){n.fillStyle="rgba(255, 255, 255, 1)",n.fillText(p.title,o+4,r+13);for(var g=0;g<p.items.length;g++){var w=g%p.itemsPerRow,b=Math.floor(g/p.itemsPerRow),C=(this.controlBgPaint,0);p.items[g].value==p.contextObject[p.attributeName]&&(n.fillStyle="none",n.strokeStyle="rgba(255, 255, 0, 1)",n.lineWidth="2",n.strokeRect(o+3+w*h+1,r+18+b*h+1,h-1-2,h-1-2),n.lineWidth="1",C=2),p.items[g].activeArea||(p.items[g].activeArea=new a),p.items[g].activeArea.set(o+3+w*h+C,r+18+b*h+C,h-1-2*C,h-1-2*C)}p.activeArea.set(o+3,18+r+3,s-3-3,h*l-5)}else"texture2D"==p.type?(n.fillStyle="rgba(255, 255, 255, 1)",n.fillText(t[u].title,o+5,r+15),p.activeArea.set(o+3,r+18,s-3-3,d-5-18)):"header"==p.type?(n.fillStyle="rgba(255, 255, 255, 1)",n.fillRect(o+3,r+3,s-3-3,d-5-3),n.fillStyle="rgba(0, 0, 0, 1)",n.fillText(t[u].title,o+5,r+16)):(n.fillStyle="rgba(255, 255, 255, 1)",n.fillText(t[u].title,o+5,r+13));r+=d}n.restore(),this.updateTexture()}},i.prototype.getTexture=function(){return this.tex},i.prototype.getImageColor=function(t,e,i){var n=t.data[4*(e+i*t.width)+0]/255,r=t.data[4*(e+i*t.width)+1]/255,o=t.data[4*(e+i*t.width)+2]/255;return{r:n,g:r,b:o}},i.prototype.updateTexture=function(){var t=this.gl;this.tex.bind(),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.canvas),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindTexture(t.TEXTURE_2D,null)},e.exports=i},{"pex-geom":23,"pex-glu":43,plask:4}],63:[function(t,e){function i(t,e,i){this.tex=a.create(t,e),this.highdpi=i||1,this.gl=s.currentContext,this.tex=a.create(t,e),this.canvas=new h.create(t,e),this.fontPaint=new l,this.fontPaint.setStyle(l.kFillStyle),this.fontPaint.setColor(255,255,255,255),this.fontPaint.setTextSize(10),this.fontPaint.setFontFamily("Monaco"),this.fontPaint.setStrokeWidth(0),this.headerFontPaint=new l,this.headerFontPaint.setStyle(l.kFillStyle),this.headerFontPaint.setColor(0,0,0,255),this.headerFontPaint.setTextSize(10),this.headerFontPaint.setFontFamily("Monaco"),this.headerFontPaint.setStrokeWidth(0),this.fontHighlightPaint=new l,this.fontHighlightPaint.setStyle(l.kFillStyle),this.fontHighlightPaint.setColor(100,100,100,255),this.fontHighlightPaint.setTextSize(10),this.fontHighlightPaint.setFontFamily("Monaco"),this.fontHighlightPaint.setStrokeWidth(0),this.panelBgPaint=new l,this.panelBgPaint.setStyle(l.kFillStyle),this.panelBgPaint.setColor(0,0,0,150),this.headerBgPaint=new l,this.headerBgPaint.setStyle(l.kFillStyle),this.headerBgPaint.setColor(255,255,255,255),this.controlBgPaint=new l,this.controlBgPaint.setStyle(l.kFillStyle),this.controlBgPaint.setColor(150,150,150,255),this.controlHighlightPaint=new l,this.controlHighlightPaint.setStyle(l.kFillStyle),this.controlHighlightPaint.setColor(255,255,0,255),this.controlHighlightPaint.setAntiAlias(!0),this.controlStrokeHighlightPaint=new l,this.controlStrokeHighlightPaint.setStyle(l.kStrokeStyle),this.controlStrokeHighlightPaint.setColor(255,255,0,255),this.controlStrokeHighlightPaint.setAntiAlias(!1),this.controlStrokeHighlightPaint.setStrokeWidth(2),this.controlFeaturePaint=new l,this.controlFeaturePaint.setStyle(l.kFillStyle),this.controlFeaturePaint.setColor(255,255,255,255),this.controlFeaturePaint.setAntiAlias(!0),this.imagePaint=new l,this.imagePaint.setStyle(l.kFillStyle),this.imagePaint.setColor(255,255,255,255),this.colorPaint=new l,this.colorPaint.setStyle(l.kFillStyle),this.colorPaint.setColor(255,255,255,255)}var n=t("pex-glu"),r=t("pex-geom"),o=t("plask"),s=n.Context,a=n.Texture2D,h=o.SkCanvas,l=o.SkPaint,c=r.Rect;i.prototype.isAnyItemDirty=function(t){var e=!1;return t.forEach(function(t){t.dirty&&(t.dirty=!1,e=!0)}),e},i.prototype.draw=function(t,e){if(this.isAnyItemDirty(t)){var i=this.canvas;i.save(),i.scale(this.highdpi,this.highdpi),i.drawColor(0,0,0,0,o.SkPaint.kClearMode);for(var n=10,r=10,s=160,a=0,h=0,l=3,u=0;u<t.length;u++){var p=t[u];p.px&&p.px&&(r=p.px/this.highdpi,n=p.py/this.highdpi);var d=20;if(p.options&&p.options.palette&&!p.options.paletteImage&&(p.options.paletteImage=o.SkCanvas.createFromImage(p.options.palette)),"slider"==p.type&&(d=20*e+14),"toggle"==p.type&&(d=20*e),"multislider"==p.type&&(d=18+20*p.getValue().length*e),"vec2"==p.type&&(d=20+28*e),"vec3"==p.type&&(d=20+42*e),"color"==p.type&&(d=20+14*(p.options.alpha?4:3)*e),"color"==p.type&&p.options.paletteImage&&(d+=(s*p.options.paletteImage.height/p.options.paletteImage.width+2)*e),"button"==p.type&&(d=24*e),"texture2D"==p.type&&(d=24+p.texture.height*s/p.texture.width),"radiolist"==p.type&&(d=18+20*p.items.length*e),"texturelist"==p.type&&(a=Math.floor((s-2*l)/p.itemsPerRow),h=Math.ceil(p.items.length/p.itemsPerRow),d=21+h*a),("spline1D"==p.type||"spline2D"==p.type)&&(d=24+s),"header"==p.type&&(d=26*e),i.drawRect(this.panelBgPaint,r,n,r+s,n+d-2),"slider"==p.type){{p.getValue()}i.drawRect(this.controlBgPaint,r+3,n+18,r+s-3,n+d-5),i.drawRect(this.controlHighlightPaint,r+3,n+18,r+3+(s-6)*p.getNormalizedValue(),n+d-5),p.activeArea.set(r+3,n+18,s-3-3,d-5-18),i.drawText(this.fontPaint,t[u].title+" : "+p.getStrValue(),r+4,n+13)}else if("multislider"==p.type){for(var f=0;f<p.getValue().length;f++)i.drawRect(this.controlBgPaint,r+3,n+18+20*f*e,r+s-3,n+18+20*(f+1)*e-6),i.drawRect(this.controlHighlightPaint,r+3,n+18+20*f*e,r+3+(s-6)*p.getNormalizedValue(f),n+18+20*(f+1)*e-6);i.drawText(this.fontPaint,t[u].title+" : "+p.getStrValue(),r+4,n+13),p.activeArea.set(r+4,n+18,s-3-3,d-5-18)}else if("vec2"==p.type){for(var g=2,f=0;g>f;f++)i.drawRect(this.controlBgPaint,r+3,n+18+14*f*e,r+s-3,n+18+14*(f+1)*e-3),i.drawRect(this.controlHighlightPaint,r+3,n+18+14*f*e,r+3+(s-6)*p.getNormalizedValue(f),n+18+14*(f+1)*e-3);i.drawText(this.fontPaint,t[u].title+" : "+p.getStrValue(),r+3,n+13),p.activeArea.set(r+4,n+18,s-3-3,d-5-18)}else if("vec3"==p.type){for(var g=3,f=0;g>f;f++)i.drawRect(this.controlBgPaint,r+3,n+18+14*f*e,r+s-3,n+18+14*(f+1)*e-3),i.drawRect(this.controlHighlightPaint,r+3,n+18+14*f*e,r+3+(s-6)*p.getNormalizedValue(f),n+18+14*(f+1)*e-3);i.drawText(this.fontPaint,t[u].title+" : "+p.getStrValue(),r+3,n+13),p.activeArea.set(r+4,n+18,s-3-3,d-5-18)}else if("color"==p.type){for(var g=p.options.alpha?4:3,f=0;g>f;f++)i.drawRect(this.controlBgPaint,r+3,n+18+14*f*e,r+s-3,n+18+14*(f+1)*e-3),i.drawRect(this.controlHighlightPaint,r+3,n+18+14*f*e,r+3+(s-6)*p.getNormalizedValue(f),n+18+14*(f+1)*e-3);var m=p.getValue();this.colorPaint.setColor(255*m.r,255*m.g,255*m.b,255),i.drawRect(this.colorPaint,r+s-12-3,n+3,r+s-3,n+3+12),p.options.paletteImage&&i.drawCanvas(this.imagePaint,p.options.paletteImage,r+3,n+18+14*g,r+s-3,n+18+14*g+s*p.options.paletteImage.height/p.options.paletteImage.width),i.drawText(this.fontPaint,t[u].title+" : "+p.getStrValue(),r+3,n+13),p.activeArea.set(r+4,n+18,s-3-3,d-5-18)}else if("button"==p.type){var v=p.active?this.controlHighlightPaint:this.controlBgPaint,x=p.active?this.fontHighlightPaint:this.fontPaint;if(i.drawRect(v,r+3,n+3,r+s-3,n+d-5),p.activeArea.set(r+3,n+3,s-3-3,d-5),p.options.color){var m=p.options.color;this.controlFeaturePaint.setColor(255*m.x,255*m.y,255*m.z,255),i.drawRect(this.controlFeaturePaint,r+s-8,n+3,r+s-3,n+d-5)}i.drawText(x,t[u].title,r+5,n+15)}else if("toggle"==p.type){var y=p.contextObject[p.attributeName],w=y?this.controlHighlightPaint:this.controlBgPaint;i.drawRect(w,r+3,n+3,r+d-5,n+d-5),p.activeArea.set(r+3,n+3,d-5,d-5),i.drawText(this.fontPaint,t[u].title,r+d,n+13)}else if("radiolist"==p.type){i.drawText(this.fontPaint,p.title,r+4,n+14);for(var b=this.controlBgPaint,C=20*e,f=0;f<p.items.length;f++){var P=p.items[f],y=p.contextObject[p.attributeName]==P.value,b=y?this.controlHighlightPaint:this.controlBgPaint;i.drawRect(b,r+3,18+f*C+n+3,r+C-5,C+f*C+n+18-5),i.drawText(this.fontPaint,P.name,r+C,18+f*C+n+13)}p.activeArea.set(r+3,18+n+3,C-5,p.items.length*C-5)}else if("texturelist"==p.type){i.drawText(this.fontPaint,p.title,r+4,n+14);for(var f=0;f<p.items.length;f++){var M=f%p.itemsPerRow,E=Math.floor(f/p.itemsPerRow),b=this.controlBgPaint,T=0;if(i.drawRect(b,r+3+M*a,n+18+E*a,r+3+(M+1)*a-1,n+18+(E+1)*a-1),p.items[f].value==p.contextObject[p.attributeName]){var R=this.controlStrokeHighlightPaint;i.drawRect(R,r+3+M*a+1,n+18+E*a+1,r+3+(M+1)*a-1-1,n+18+(E+1)*a-1-1),T=2}p.items[f].activeArea||(p.items[f].activeArea=new c),p.items[f].activeArea.set(r+3+M*a+T,n+18+E*a+T,a-1-2*T,a-1-2*T)}p.activeArea.set(r+3,18+n+3,s-3-3,a*h-5)}else if("texture2D"==p.type)i.drawText(this.fontPaint,p.title,r+3,n+13),p.activeArea.set(r+3,n+18,s-3-3,d-5-18);else if("spline1D"==p.type){i.drawText(this.fontPaint,p.title,r+3,n+13);var C=s,b=this.controlBgPaint;i.drawRect(b,r+3,18+n+3,r+C-5,C+n+18);var A=new o.SkPath;A.moveTo(r+3,C+n+18);for(var f=0;20>=f;f++){var S=p.contextObject[p.attributeName].getPointAt(f/20),z=f/20*(s-r),_=S*C*.99;A.lineTo(r+3+z,C+n+18-_)}this.controlHighlightPaint.setStroke(),i.drawPath(this.controlHighlightPaint,A),this.controlHighlightPaint.setFill(),"undefined"!=typeof p.contextObject.animParam.highlight&&(this.controlFeaturePaint.setStroke(),i.drawLine(this.controlFeaturePaint,r+3+s*p.contextObject.animParam.highlight,18+n+3,r+3+s*p.contextObject.animParam.highlight,C+n+18),this.controlFeaturePaint.setFill()),p.activeArea.set(r+3,n+18,s-3-3,s-5-18)}else if("spline2D"==p.type){i.drawText(this.fontPaint,p.title,r+3,n+13);var C=s,b=this.controlBgPaint;i.drawRect(b,r+3,18+n+3,r+C-5,C+n+18);var A=new o.SkPath;A.moveTo(r+3,C+n+18);for(var f=0;40>=f;f++){var S=p.contextObject[p.attributeName].getPointAt(f/40),z=S.x*(s-r),_=S.y*C*.99;A.lineTo(r+3+z,C+n+18-_)}this.controlHighlightPaint.setStroke(),i.drawPath(this.controlHighlightPaint,A),this.controlHighlightPaint.setFill(),"undefined"!=typeof p.contextObject.animParam.highlight&&(this.controlFeaturePaint.setStroke(),i.drawLine(this.controlFeaturePaint,r+3+s*p.contextObject.animParam.highlight,18+n+3,r+3+s*p.contextObject.animParam.highlight,C+n+18),this.controlFeaturePaint.setFill())}else"header"==p.type?(i.drawRect(this.headerBgPaint,r+3,n+3,r+s-3,n+d-5),i.drawText(this.headerFontPaint,t[u].title,r+6,n+16)):i.drawText(this.fontPaint,t[u].title,r+3,n+13);n+=d}i.restore(),this.updateTexture()}},i.prototype.getImageColor=function(t,e,i){var n=t[4*(e+i*t.width)+2]/255,r=t[4*(e+i*t.width)+1]/255,o=t[4*(e+i*t.width)+0]/255;return{r:n,g:r,b:o}},i.prototype.getTexture=function(){return this.tex},i.prototype.updateTexture=function(){var t=this.gl;this.tex.bind(),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR),t.texImage2DSkCanvas(t.TEXTURE_2D,0,this.canvas),t.generateMipmap(t.TEXTURE_2D),t.bindTexture(t.TEXTURE_2D,null)},e.exports=i},{"pex-geom":23,"pex-glu":43,plask:4}],64:[function(t,e){e.exports.SolidColor=t("./lib/SolidColor"),e.exports.ShowNormals=t("./lib/ShowNormals"),e.exports.ShowColors=t("./lib/ShowColors"),e.exports.ShowPosition=t("./lib/ShowPosition"),e.exports.ShowTexCoords=t("./lib/ShowTexCoords"),e.exports.Textured=t("./lib/Textured"),e.exports.TexturedTriPlanar=t("./lib/TexturedTriPlanar"),e.exports.TexturedCubeMap=t("./lib/TexturedCubeMap"),e.exports.TexturedEnvMap=t("./lib/TexturedEnvMap"),e.exports.SkyBox=t("./lib/SkyBox"),e.exports.SkyBoxEnvMap=t("./lib/SkyBoxEnvMap"),e.exports.FlatToonShading=t("./lib/FlatToonShading"),e.exports.MatCap=t("./lib/MatCap"),e.exports.Diffuse=t("./lib/Diffuse"),e.exports.BlinnPhong=t("./lib/BlinnPhong"),e.exports.ShowDepth=t("./lib/ShowDepth")},{"./lib/BlinnPhong":65,"./lib/Diffuse":66,"./lib/FlatToonShading":67,"./lib/MatCap":68,"./lib/ShowColors":69,"./lib/ShowDepth":70,"./lib/ShowNormals":71,"./lib/ShowPosition":72,"./lib/ShowTexCoords":73,"./lib/SkyBox":74,"./lib/SkyBoxEnvMap":75,"./lib/SolidColor":76,"./lib/Textured":77,"./lib/TexturedCubeMap":78,"./lib/TexturedEnvMap":79,"./lib/TexturedTriPlanar":80}],65:[function(t,e){(function(){function i(t){this.gl=s.currentContext;var e=new h(p),i={wrap:0,pointSize:1,lightPos:c.create(10,20,30),ambientColor:l.create(0,0,0,1),diffuseColor:l.create(.9,.9,.9,1),specularColor:l.create(1,1,1,1),shininess:256,useBlinnPhong:!0};t=u(i,t),a.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=t("pex-geom"),s=n.Context,a=n.Material,h=n.Program,l=r.Color,c=o.Vec3,u=t("merge"),p="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 modelWorldMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 normalMatrix;\nuniform float pointSize;\nuniform vec3 lightPos;\nuniform vec3 cameraPos;\nattribute vec3 position;\nattribute vec3 normal;\nvarying vec3 vNormal;\nvarying vec3 vLightPos;\nvarying vec3 vEyePos;\n\nvoid main() {\n  vec4 worldPos = modelWorldMatrix * vec4(position, 1.0);\n  vec4 eyePos = modelViewMatrix * vec4(position, 1.0);\n  gl_Position = projectionMatrix * eyePos;\n  vEyePos = eyePos.xyz;\n  gl_PointSize = pointSize;\n  vNormal = (normalMatrix * vec4(normal, 0.0)).xyz;\n  vLightPos = (viewMatrix * vec4(lightPos, 1.0)).xyz;\n}\n\n#endif\n\n#ifdef FRAG\n\nuniform vec4 ambientColor;\nuniform vec4 diffuseColor;\nuniform vec4 specularColor;\nuniform float shininess;\nuniform float wrap;\nuniform bool useBlinnPhong;\nvarying vec3 vNormal;\nvarying vec3 vLightPos;\nvarying vec3 vEyePos;\n\nfloat phong(vec3 L, vec3 E, vec3 N) {\n  vec3 R = reflect(-L, N);\n  return max(0.0, dot(R, E));\n}\n\nfloat blinnPhong(vec3 L, vec3 E, vec3 N) {\n  vec3 halfVec = normalize(L + E);\n  return max(0.0, dot(halfVec, N));\n}\n\nvoid main() {\n  vec3 L = normalize(vLightPos - vEyePos); //lightDir\n  vec3 E = normalize(-vEyePos); //viewDir\n  vec3 N = normalize(vNormal); //normal\n\n  float NdotL = max(0.0, (dot(N, L) + wrap) / (1.0 + wrap));\n  vec4 color = ambientColor + NdotL * diffuseColor;\n\n  float specular = 0.0;\n  if (useBlinnPhong)\n    specular = blinnPhong(L, E, N);\n  else\n    specular = phong(L, E, N);\n\n  color += max(pow(specular, shininess), 0.0) * specularColor;\n\n  gl_FragColor = color;\n}\n\n#endif\n";i.prototype=Object.create(a.prototype),e.exports=i}).call(this,"/../../../pex-materials/lib")},{merge:81,"pex-color":2,"pex-geom":23,"pex-glu":43}],66:[function(t,e){(function(){function i(t){this.gl=s.currentContext;var e=new h(p),i={wrap:0,pointSize:1,lightPos:c.create(10,20,30),ambientColor:l.create(0,0,0,1),diffuseColor:l.create(1,1,1,1)};t=u(i,t),a.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=t("pex-geom"),s=n.Context,a=n.Material,h=n.Program,l=r.Color,c=o.Vec3,u=t("merge"),p="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 normalMatrix;\nuniform mat4 viewMatrix;\nuniform float pointSize;\nuniform vec3 lightPos;\nattribute vec3 position;\nattribute vec3 normal;\nvarying vec3 vNormal;\nvarying vec3 vLightPos;\nvarying vec3 vPosition;\n\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  gl_PointSize = pointSize;\n  vNormal = (normalMatrix * vec4(normal, 1.0)).xyz;\n  vLightPos = (viewMatrix * vec4(lightPos, 1.0)).xyz;\n  vPosition = (modelViewMatrix * vec4(position, 1.0)).xyz;\n}\n\n#endif\n\n#ifdef FRAG\n\nuniform vec4 ambientColor;\nuniform vec4 diffuseColor;\nuniform float wrap;\nvarying vec3 vNormal;\nvarying vec3 vLightPos;\nvarying vec3 vPosition;\n\nvoid main() {\n  vec3 L = normalize(vLightPos - vPosition);\n  vec3 N = normalize(vNormal);\n  float NdotL = max(0.0, (dot(N, L) + wrap) / (1.0 + wrap));\n  gl_FragColor = ambientColor + NdotL * diffuseColor;\n}\n\n#endif\n";
i.prototype=Object.create(a.prototype),e.exports=i}).call(this,"/../../../pex-materials/lib")},{merge:81,"pex-color":2,"pex-geom":23,"pex-glu":43}],67:[function(t,e){(function(){function i(t){this.gl=s.currentContext.gl;var e=new h(u),i={wrap:1,pointSize:1,lightPos:l.create(10,20,30)},t=c(i,t);a.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=t("pex-geom"),s=n.Context,a=n.Material,h=n.Program,l=(r.Color,o.Vec3),c=t("merge"),u="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform float pointSize;\nattribute vec3 position;\nattribute vec3 normal;\nvarying vec3 vNormal;\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  gl_PointSize = pointSize;\n  vNormal = normal;\n}\n\n#endif\n\n#ifdef FRAG\n\nuniform vec3 lightPos;\nuniform sampler2D colorBands;\nuniform float wrap;\nvarying vec3 vNormal;\n\nvoid main() {\n  vec3 L = normalize(lightPos);\n  vec3 N = normalize(vNormal);\n  float NdotL = max(0.0, (dot(N, L) + wrap) / (1.0 + wrap));\n  gl_FragColor.rgb = N*0.5 + vec3(0.5);\n  gl_FragColor.rgb = vec3(NdotL);\n  gl_FragColor.a = 1.0;\n\n  gl_FragColor = texture2D(colorBands, vec2(NdotL, 0.5));\n}\n\n#endif\n";i.prototype=Object.create(a.prototype),e.exports=i}).call(this,"/../../../pex-materials/lib")},{merge:81,"pex-color":2,"pex-geom":23,"pex-glu":43}],68:[function(t,e){(function(){function i(t){this.gl=o.currentContext;var e=new a(l),i={};t=h(i,t),s.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=n.Context,s=n.Material,a=n.Program,h=(r.Color,t("merge")),l="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 normalMatrix;\nuniform float pointSize;\nattribute vec3 position;\nattribute vec3 normal;\n\nvarying vec3 e;\nvarying vec3 n;\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\n  e = normalize(vec3(modelViewMatrix * vec4(position, 1.0)));\n  n = normalize(vec3(normalMatrix * vec4(normal, 1.0)));\n}\n\n#endif\n\n#ifdef FRAG\n\nuniform sampler2D texture;\n\nvarying vec3 e;\nvarying vec3 n;\n\nvoid main() {\n  vec3 r = reflect(e, n);\n  float m = 2.0 * sqrt(\n    pow(r.x, 2.0) +\n    pow(r.y, 2.0) +\n    pow(r.z + 1.0, 2.0)\n  );\n  vec2 N = r.xy / m + 0.5;\n  vec3 base = texture2D( texture, N ).rgb;\n  gl_FragColor = vec4( base, 1.0 );\n}\n\n#endif\n";i.prototype=Object.create(s.prototype),e.exports=i}).call(this,"/../../../pex-materials/lib")},{merge:81,"pex-color":2,"pex-glu":43}],69:[function(t,e){(function(){function i(t){this.gl=o.currentContext;var e=new a(l),i={pointSize:1};t=h(i,t),s.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=n.Context,s=n.Material,a=n.Program,h=(r.Color,t("merge")),l="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform float pointSize;\nattribute vec3 position;\nattribute vec4 color;\nvarying vec4 vColor;\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  gl_PointSize = pointSize;\n  vColor = color;\n}\n\n#endif\n\n#ifdef FRAG\n\nvarying vec4 vColor;\n\nvoid main() {\n  gl_FragColor = vColor;\n}\n\n#endif\n";i.prototype=Object.create(s.prototype),e.exports=i}).call(this,"/../../../pex-materials/lib")},{merge:81,"pex-color":2,"pex-glu":43}],70:[function(t,e){(function(){function i(t){this.gl=s.currentContext;var e=new h(c),i={near:0,far:10};t=l(i,t),a.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=t("pex-geom"),s=n.Context,a=n.Material,h=n.Program,l=(r.Color,o.Vec3,t("merge")),c="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\n\nattribute vec3 position;\n\n//position in eye space coordinates (camera space, view space)\nvarying vec3 ecPosition;\n\nvoid main() {\n  vec4 ecPos = modelViewMatrix * vec4(position, 1.0);\n  gl_Position = projectionMatrix * ecPos;\n\n  ecPosition = ecPos.xyz;\n}\n\n#endif\n\n#ifdef FRAG\n\nvarying vec3 ecPosition;\nuniform float near;\nuniform float far;\n\n//Z in Normalized Device Coordinates\n//http://www.songho.ca/opengl/gl_projectionmatrix.html\nfloat eyeSpaceDepthToNDC(float zEye) {\n  float A = -(far + near) / (far - near); //projectionMatrix[2].z\n  float B = -2.0 * far * near / (far - near); //projectionMatrix[3].z; //\n\n  float zNDC = (A * zEye + B) / -zEye;\n  return zNDC;\n}\n\n//depth buffer encoding\n//http://stackoverflow.com/questions/6652253/getting-the-true-z-value-from-the-depth-buffer\nfloat ndcDepthToDepthBuf(float zNDC) {\n  return 0.5 * zNDC + 0.5;\n}\n\nvoid main() {\n  float zEye = ecPosition.z;\n  float zNDC = eyeSpaceDepthToNDC(zEye);\n  float zBuf = ndcDepthToDepthBuf(zNDC);\n\n  gl_FragColor = vec4(zBuf);\n}\n\n#endif\n";i.prototype=Object.create(a.prototype),e.exports=i}).call(this,"/../../../pex-materials/lib")},{merge:81,"pex-color":2,"pex-geom":23,"pex-glu":43}],71:[function(t,e){(function(){function i(t){this.gl=o.currentContext;var e=new a(l),i={pointSize:1};t=h(i,t),s.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=n.Context,s=n.Material,a=n.Program,h=(r.Color,t("merge")),l="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 normalMatrix;\nuniform float pointSize;\nattribute vec3 position;\nattribute vec3 normal;\nvarying vec4 vColor;\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  gl_PointSize = pointSize;\n  vec3 N = normalize((normalMatrix * vec4(normal, 1.0)).xyz);\n  vColor = vec4(N * 0.5 + 0.5, 1.0);\n}\n\n#endif\n\n#ifdef FRAG\n\nvarying vec4 vColor;\n\nvoid main() {\n  gl_FragColor = vColor;\n}\n\n#endif\n";i.prototype=Object.create(s.prototype),e.exports=i}).call(this,"/../../../pex-materials/lib")},{merge:81,"pex-color":2,"pex-glu":43}],72:[function(t,e){(function(){function i(t){this.gl=s.currentContext;var e=new h(c),i={};t=l(i,t),a.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=t("pex-geom"),s=n.Context,a=n.Material,h=n.Program,l=(r.Color,o.Vec3,t("merge")),c="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nattribute vec3 position;\nvarying vec4 vColor;\nvoid main() {\n  vec4 pos = modelViewMatrix * vec4(position, 1.0);\n  gl_Position = projectionMatrix * pos;\n  vColor = pos;\n}\n\n#endif\n\n#ifdef FRAG\n\nvarying vec4 vColor;\n\nvoid main() {\n  gl_FragColor = vColor;\n}\n\n#endif\n";i.prototype=Object.create(a.prototype),e.exports=i}).call(this,"/../../../pex-materials/lib")},{merge:81,"pex-color":2,"pex-geom":23,"pex-glu":43}],73:[function(t,e){(function(){function i(t){this.gl=s.currentContext;var e=new h(c),i={};t=l(i,t),a.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=t("pex-geom"),s=n.Context,a=n.Material,h=n.Program,l=(r.Color,o.Vec3,t("merge")),c="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform float pointSize;\nattribute vec3 position;\nattribute vec2 texCoord;\nvarying vec4 vColor;\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  gl_PointSize = pointSize;\n  vColor = vec4(texCoord, 0.0, 1.0);\n}\n\n#endif\n\n#ifdef FRAG\n\nvarying vec4 vColor;\n\nvoid main() {\n  gl_FragColor = vColor;\n}\n\n#endif";i.prototype=Object.create(a.prototype),e.exports=i}).call(this,"/../../../pex-materials/lib")},{merge:81,"pex-color":2,"pex-geom":23,"pex-glu":43}],74:[function(t,e){(function(){function i(t){this.gl=o.currentContext;var e=new a(l),i={};t=h(i,t),s.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=n.Context,s=n.Material,a=n.Program,h=(r.Color,t("merge")),l="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nattribute vec3 position;\nattribute vec3 normal;\nvarying vec3 vNormal;\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  vNormal = position * vec3(1.0, 1.0, 1.0);\n}\n\n#endif\n\n#ifdef FRAG\n\nuniform samplerCube texture;\nvarying vec3 vNormal;\n\nvoid main() {\n  vec3 N = normalize(vNormal);\n  gl_FragColor = textureCube(texture, N);\n}\n\n#endif\n";i.prototype=Object.create(s.prototype),e.exports=i}).call(this,"/../../../pex-materials/lib")},{merge:81,"pex-color":2,"pex-glu":43}],75:[function(t,e){(function(){function i(t){this.gl=o.currentContext;var e=new a(l),i={};t=h(i,t),s.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=n.Context,s=n.Material,a=n.Program,h=(r.Color,t("merge")),l="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nattribute vec3 position;\nattribute vec3 normal;\nvarying vec3 vNormal;\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  vNormal = position;\n}\n\n#endif\n\n#ifdef FRAG\n\nuniform sampler2D texture;\nvarying vec3 vNormal;\n\nvoid main() {\n  vec3 N = normalize(vNormal);\n  vec2 texCoord = vec2((1.0 + atan(-N.z, N.x)/3.14159265359)/2.0, acos(-N.y)/3.14159265359);\n\n  gl_FragColor = texture2D(texture, texCoord);\n}\n\n#endif\n";i.prototype=Object.create(s.prototype),e.exports=i}).call(this,"/../../../pex-materials/lib")},{merge:81,"pex-color":2,"pex-glu":43}],76:[function(t,e){(function(){function i(t){this.gl=o.currentContext;var e=new a(c),i={color:h.create(1,1,1,1),pointSize:1,premultiplied:0};t=l(i,t),s.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=n.Context,s=n.Material,a=n.Program,h=r.Color,l=t("merge"),c="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform float pointSize;\nattribute vec3 position;\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  gl_PointSize = pointSize;\n}\n\n#endif\n\n#ifdef FRAG\n\nuniform vec4 color;\nuniform bool premultiplied;\n\nvoid main() {\n  gl_FragColor = color;\n  if (premultiplied) {\n    gl_FragColor.rgb *= color.a;\n  }\n}\n\n#endif\n";i.prototype=Object.create(s.prototype),e.exports=i}).call(this,"/../../../pex-materials/lib")},{merge:81,"pex-color":2,"pex-glu":43}],77:[function(t,e){(function(){function i(t){this.gl=s.currentContext;var e=new h(p),i={scale:new c(1,1),color:new l(1,1,1,1)};t=u(i,t),a.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=t("pex-geom"),s=n.Context,a=n.Material,h=n.Program,l=r.Color,c=o.Vec2,u=t("merge"),p="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nattribute vec3 position;\nattribute vec2 texCoord;\nvarying vec2 vTexCoord;\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  vTexCoord = texCoord;\n}\n\n#endif\n\n#ifdef FRAG\n\nuniform sampler2D texture;\nuniform vec2 scale;\nuniform vec4 color;\nvarying vec2 vTexCoord;\n\nvoid main() {\n  gl_FragColor = texture2D(texture, vTexCoord * scale) * color;\n}\n\n#endif\n";i.prototype=Object.create(a.prototype),e.exports=i}).call(this,"/../../../pex-materials/lib")},{merge:81,"pex-color":2,"pex-geom":23,"pex-glu":43}],78:[function(t,e){(function(){function i(t){this.gl=s.currentContext,c.isBrowser&&(this.lodExt=this.gl.getExtension("EXT_shader_texture_lod"),this.lodExt&&(u="#define LOD_ENABLED 1\n"+u,u="#define WEBGL 1\n"+u,u="#define textureCubeLod textureCubeLodEXT\n"+u));var e=new h(u),i={lod:-1};t=l(i,t),a.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=t("pex-sys"),s=n.Context,a=n.Material,h=n.Program,l=(r.Color,t("merge")),c=o.Platform,u="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 normalMatrix;\n\nattribute vec3 position;\nattribute vec3 normal;\n\nvarying vec3 ecNormal;\nvarying vec3 ecPos;\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  ecPos = (modelViewMatrix * vec4(position, 1.0)).xyz;\n  ecNormal = (normalMatrix * vec4(normal, 1.0)).xyz;\n}\n\n#endif\n\n#ifdef FRAG\n\n#ifdef LOD_ENABLED\n#ifdef WEBGL\n  #extension GL_EXT_shader_texture_lod : require\n#else\n  #extension GL_ARB_shader_texture_lod : require\n#endif\n#endif\n\nuniform mat4 invViewMatrix;\n\nuniform samplerCube texture;\nuniform float lod;\nvarying vec3 ecNormal;\nvarying vec3 ecPos;\n\nvoid main() {\n  vec3 eyeDir = normalize(ecPos); //Direction to eye = camPos (0,0,0) - ecPos\n  vec3 ecN = normalize(ecNormal);\n  vec3 ecReflected = reflect(eyeDir, ecN); //eye coordinates reflection vector\n  vec3 wcReflected = vec3(invViewMatrix * vec4(ecReflected, 0.0)); //world coordinates reflection vector\n\n  #ifdef LOD_ENABLED\n  gl_FragColor = textureCubeLod(texture, wcReflected, lod);\n  #else\n  gl_FragColor = textureCube(texture, wcReflected);\n  #endif\n}\n\n#endif\n";i.prototype=Object.create(a.prototype),e.exports=i}).call(this,"/../../../pex-materials/lib")},{merge:81,"pex-color":2,"pex-glu":43,"pex-sys":82}],79:[function(t,e){(function(){function i(t){this.gl=o.currentContext;var e=new a(l),i={};t=h(i,t),s.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=n.Context,s=n.Material,a=n.Program,h=(r.Color,t("merge")),l="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 normalMatrix;\nattribute vec3 position;\nattribute vec3 normal;\nvarying vec3 vNormal;\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  vNormal = (normalMatrix * vec4(normal, 1.0)).xyz;\n}\n\n#endif\n\n#ifdef FRAG\n\nuniform sampler2D texture;\nvarying vec3 vNormal;\n\nvoid main() {\n  vec3 N = normalize(vNormal);\n  vec2 texCoord = vec2((1.0 + atan(-N.z, N.x)/3.14159265359)/2.0, acos(-N.y)/3.14159265359);\n  gl_FragColor = texture2D(texture, texCoord);\n}\n\n#endif\n";i.prototype=Object.create(s.prototype),e.exports=i}).call(this,"/../../../pex-materials/lib")},{merge:81,"pex-color":2,"pex-glu":43}],80:[function(t,e){(function(){function i(t){this.gl=s.currentContext;var e=new h(c),i={scale:1};t=l(i,t),a.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=t("pex-geom"),s=n.Context,a=n.Material,h=n.Program,l=(r.Color,o.Vec3,t("merge")),c="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 modelWorldMatrix;\nattribute vec3 position;\nattribute vec3 normal;\nvarying vec3 wcNormal;\nvarying vec3 wcCoords;\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  wcNormal = normal; //this is not correct, shoud go from model -> world\n  wcCoords = (modelWorldMatrix * vec4(position, 1.0)).xyz;\n}\n\n#endif\n\n#ifdef FRAG\n\nuniform sampler2D texture;\nuniform float scale;\nvarying vec3 wcNormal;\nvarying vec3 wcCoords;\n\nvoid main() {\n  vec3 blending = abs( normalize(wcNormal) );\n  blending = normalize(max(blending, 0.00001)); // Force weights to sum to 1.0\n  float b = (blending.x + blending.y + blending.z);\n  blending /= vec3(b, b, b);\n\n  vec4 xaxis = texture2D( texture, wcCoords.zy * scale);\n  vec4 yaxis = texture2D( texture, wcCoords.xz * scale);\n  vec4 zaxis = texture2D( texture, wcCoords.xy * scale);\n  // blend the results of the 3 planar projections.\n  vec4 tex = xaxis * blending.x + yaxis * blending.y + zaxis * blending.z;\n\n  gl_FragColor = tex;\n}\n\n#endif\n";i.prototype=Object.create(a.prototype),e.exports=i}).call(this,"/../../../pex-materials/lib")},{merge:81,"pex-color":2,"pex-geom":23,"pex-glu":43}],81:[function(t,e){e.exports=t(22)},{}],82:[function(t,e){e.exports.Platform=t("./lib/Platform"),e.exports.Window=t("./lib/Window"),e.exports.Time=t("./lib/Time"),e.exports.IO=t("./lib/IO"),e.exports.Log=t("./lib/Log")},{"./lib/IO":84,"./lib/Log":85,"./lib/Platform":86,"./lib/Time":87,"./lib/Window":88}],83:[function(t,e){function i(t,e){for(var i=0;i<v.length;i++)v[i].eventType==t&&v[i].handler(e)}function n(t){r(t),o(t),s(t),a(t),h(t),l(t),c(t),u(t),p(t)}function r(t){t.addEventListener("mousedown",function(t){i("leftMouseDown",{x:(t.offsetX||t.layerX||t.clientX-t.target.offsetLeft)*window.devicePixelRatio,y:(t.offsetY||t.layerY||t.clientY-t.target.offsetTop)*window.devicePixelRatio,option:t.altKey,shift:t.shiftKey,control:t.ctrlKey})})}function o(t){t.addEventListener("mouseup",function(t){i("leftMouseUp",{x:(t.offsetX||t.layerX||t.clientX-t.target.offsetLeft)*window.devicePixelRatio,y:(t.offsetY||t.layerY||t.clientY-t.target.offsetTop)*window.devicePixelRatio,option:t.altKey,shift:t.shiftKey,control:t.ctrlKey})})}function s(t){var e=!1,n=0,r=0;t.addEventListener("mousedown",function(t){e=!0,n=(t.offsetX||t.layerX||t.clientX-t.target.offsetLeft)*window.devicePixelRatio,r=(t.offsetY||t.layerY||t.clientY-t.target.offsetTop)*window.devicePixelRatio}),t.addEventListener("mouseup",function(){e=!1}),t.addEventListener("mousemove",function(t){if(e){var o=(t.offsetX||t.layerX||t.clientX-t.target.offsetLeft)*window.devicePixelRatio,s=(t.offsetY||t.layerY||t.clientY-t.target.offsetTop)*window.devicePixelRatio;i("mouseDragged",{x:o,y:s,dx:o-n,dy:s-r,option:t.altKey,shift:t.shiftKey,control:t.ctrlKey}),n=o,r=s}})}function a(t){t.addEventListener("mousemove",function(t){i("mouseMoved",{x:(t.offsetX||t.layerX||t.clientX-t.target.offsetLeft)*window.devicePixelRatio,y:(t.offsetY||t.layerY||t.clientY-t.target.offsetTop)*window.devicePixelRatio,option:t.altKey,shift:t.shiftKey,control:t.ctrlKey})})}function h(){var t=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";document.addEventListener(t,function(t){i("scrollWheel",{x:(t.offsetX||t.layerX)*window.devicePixelRatio,y:(t.offsetY||t.layerY)*window.devicePixelRatio,dy:t.wheelDelta/10||-t.detail/10,option:t.altKey,shift:t.shiftKey,control:t.ctrlKey})})}function l(t){t.addEventListener("touchstart",function(t){x={clientX:t.touches[0].clientX*window.devicePixelRatio,clientY:t.touches[0].clientY*window.devicePixelRatio};var e=t.touches.map(function(t){return t.x=t.clientX*window.devicePixelRatio,t.y=t.clientY*window.devicePixelRatio,t});i("leftMouseDown",{x:t.touches[0].clientX*window.devicePixelRatio,y:t.touches[0].clientY*window.devicePixelRatio,option:!1,shift:!1,control:!1,touches:e})})}function c(t){t.addEventListener("touchend",function(t){var e=t.touches.map(function(t){return t.x=t.clientX*window.devicePixelRatio,t.y=t.clientY*window.devicePixelRatio,t});i("leftMouseUp",{x:x?x.clientX:0,y:x?x.clientY:0,option:!1,shift:!1,control:!1,touches:e}),x=null})}function u(t){t.addEventListener("touchmove",function(t){x={clientX:t.touches[0].clientX*window.devicePixelRatio,clientY:t.touches[0].clientY*window.devicePixelRatio};var e=t.touches.map(function(t){return t.x=t.clientX*window.devicePixelRatio,t.y=t.clientY*window.devicePixelRatio,t});i("mouseDragged",{x:t.touches[0].clientX*window.devicePixelRatio,y:t.touches[0].clientY*window.devicePixelRatio,option:!1,shift:!1,control:!1,touches:e})})}function p(){var t=0;window.addEventListener("keydown",function(e){t=setTimeout(function(){i("keyDown",{str:"",keyCode:e.keyCode,option:e.altKey,shift:e.shiftKey,control:e.ctrlKey},1)})}),window.addEventListener("keypress",function(e){t&&(clearTimeout(t),t=0),i("keyDown",{str:String.fromCharCode(e.charCode),keyCode:e.keyCode,option:e.altKey,shift:e.shiftKey,control:e.ctrlKey})})}function d(t){function e(){function e(){t.__disposed||(t.draw(),requestAnimFrame(e))}void 0===t.stencil&&(t.stencil=!1),t.settings.fullscreen&&(document.body.style.margin="0",document.body.style.padding="0",document.body.style.overflow="hidden");var r=null,o=null;if("3d"==t.settings.type){try{r=i.getContext("experimental-webgl",{antialias:!0,stencil:t.settings.stencil,premultipliedAlpha:t.settings.premultipliedAlpha,preserveDrawingBuffer:t.settings.preserveDrawingBuffer})}catch(s){return void g.error(s.message)}if(null===r)throw"No WebGL context is available."}else"2d"==t.settings.type&&(o=i.getContext("2d"));t.framerate=function(t){m=t},t.on=function(t,e){v.push({eventType:t,handler:e})},n(i),t.dispose=function(){t.__disposed=!0},t.gl=r,t.ctx=o,t.init(),requestAnimFrame(e)}var i=t.settings.canvas;return t.settings.fullscreen&&(t.settings.width=window.innerWidth,t.settings.height=window.innerHeight),i?t.settings.width&&t.settings.height?(i.width=t.settings.width,i.height=t.settings.height):(t.settings.width=i.width,t.settings.height=i.height):i=document.getElementById("canvas"),i||(i=document.createElement("canvas"),i.width=t.settings.width,i.height=t.settings.height),2==window.devicePixelRatio&&(i.width=2*t.settings.width,i.height=2*t.settings.height,i.style.width=t.settings.width+"px",i.style.height=t.settings.height+"px",i.msaaEnabled=!0,i.msaaSamples=2,t.settings.width*=2,t.settings.height*=2,t.settings.highdpi=2),t.width=t.settings.width,t.height=t.settings.height,t.canvas=i,i.style.backgroundColor="#000000",i.parentNode?e():document.body?(document.body.appendChild(i),e()):window.addEventListener("load",function(){document.body.appendChild(i),e()},!1),t}var f=t("./Platform"),g=t("./Log"),m=(t("merge"),60);f.isBrowser&&(window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/m)}}());var v=[],x=null,y={simpleWindow:d};e.exports=y},{"./Log":85,"./Platform":86,merge:1}],84:[function(t,e){(function(i){var n=t("./Platform"),r=t("./Log"),o=t("plask"),s=t("path"),a=t("merge"),h=function(){function t(){}return t.loadTextFile=function(e,i){var n=s.resolve(t.getWorkingDirectory(),e);if(!fs.existsSync(n)&&i)return i(null);var r=fs.readFileSync(n,"utf8");i&&i(r)},t.getWorkingDirectory=function(){return s.dirname(i.mainModule.filename)},t.loadImageData=function(e,i,n,r,h,l,c){var u={flip:!1,lod:0};l=a(u,l);var p=s.resolve(t.getWorkingDirectory(),h);e.activeTexture(e.TEXTURE0),e.bindTexture(n,i);var d=o.SkCanvas.createFromImage(p);l.flip?e.texImage2DSkCanvas(r,l.lod,d):e.texImage2DSkCanvasNoFlip(r,l.lod,d),c&&c(d)},t.watchTextFile=function(t,e){fs.watch(t,{},function(i){if("change"==i){var n=fs.readFileSync(t,"utf8");e&&e(n)}})},t.saveTextFile=function(t,e){fs.writeFileSync(t,e)},t},l=function(){function t(){}return t.getWorkingDirectory=function(){return"."},t.loadTextFile=function(t,e){var i=new XMLHttpRequest;i.open("GET",t,!0),i.onreadystatechange=function(){4==i.readyState&&(200==i.status?e&&e(i.responseText):r.error("WebIO.loadTextFile error : "+i.statusText))},i.send(null)},t.loadImageData=function(t,e,i,n,r,o,s){var h={flip:!1,lod:0};o=a(h,o);var l=new Image;o.crossOrigin&&(l.crossOrigin=o.crossOrigin),l.onload=function(){t.activeTexture(t.TEXTURE0),t.bindTexture(i,e),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,o.flip),t.texImage2D(n,o.lod,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,l),s&&s(l)},l.src=r},t.watchTextFile=function(){console.log("Warning: WebIO.watch is not implemented!")},t.saveTextFile=function(t,e,i){var n=new XMLHttpRequest;n.open("POST",t,!0),n.onreadystatechange=function(){4==n.readyState&&(200==n.status?i&&i(n.responseText,n):r.error("WebIO.saveTextFile error : "+n.statusText))},n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send("data="+encodeURIComponent(e))},t};n.isPlask?e.exports=h():n.isBrowser&&(e.exports=l())}).call(this,t("/Users/vorg/Workspace/vorg-pex/experiments/v3/node_modules/pex-examples/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))},{"./Log":85,"./Platform":86,"/Users/vorg/Workspace/vorg-pex/experiments/v3/node_modules/pex-examples/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":5,merge:1,path:6,plask:4}],85:[function(t,e){function i(){}i.message=function(){if(void 0!==console){var t=Array.prototype.slice.call(arguments);console.log(t.join(" "))}},i.error=function(){var t=Array.prototype.slice.call(arguments);void 0!==console&&console.log("ERROR: "+t.join(" "))},e.exports=i},{}],86:[function(t,e){(function(t){e.exports.isPlask="undefined"==typeof window&&"object"==typeof t,e.exports.isBrowser="object"==typeof window&&"object"==typeof document,e.exports.isEjecta="object"==typeof ejecta&&"function"==typeof ejecta.include}).call(this,t("/Users/vorg/Workspace/vorg-pex/experiments/v3/node_modules/pex-examples/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))},{"/Users/vorg/Workspace/vorg-pex/experiments/v3/node_modules/pex-examples/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":5}],87:[function(t,e){var i=t("./Log"),n={now:0,prev:0,delta:0,seconds:0,frameNumber:0,fpsFrames:0,fpsTime:0,fps:0,fpsFrequency:3,paused:!1,verbose:!1};n.update=function(t){return n.paused?void 0:(0===n.prev&&(n.prev=Date.now()),n.now=Date.now(),n.delta=void 0!==t?t:(n.now-n.prev)/1e3,n.delta>1&&(n.delta=0),n.prev=n.now,n.seconds+=n.delta,n.fpsTime+=n.delta,n.frameNumber++,n.fpsFrames++,n.fpsTime>n.fpsFrequency&&(n.fps=n.fpsFrames/n.fpsTime,n.fpsTime=0,n.fpsFrames=0,this.verbose&&i.message("FPS: "+n.fps)),n.seconds)};var r=0;n.startMeasuringTime=function(){r=Date.now()},n.stopMeasuringTime=function(t){var e=Date.now(),i=(e-r)/1e3;return t&&console.log(t+i),i},n.pause=function(){n.paused=!0},n.togglePause=function(){n.paused=!n.paused},e.exports=n},{"./Log":85}],88:[function(t,e){var i=t("./Platform"),n=t("./BrowserWindow"),r=t("./Time"),o=(t("./Log"),t("merge")),s=t("plask"),a={width:1280,height:720,type:"3d",vsync:!0,multisample:!0,fullscreen:!1,center:!0,hdpi:1,stencil:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1},h={currentWindow:null,create:function(t){t.settings=t.settings||{},t.settings=o(a,t.settings),t.__init=t.init,t.init=function(){h.currentWindow=this,t.framerate(60),t.__init&&t.__init()},t.__draw=t.draw,t.draw=function(){h.currentWindow=this,r.update(),t.__draw&&t.__draw()},i.isPlask?s.simpleWindow(t):(i.isBrowser||i.isEjecta)&&n.simpleWindow(t)}};e.exports=h},{"./BrowserWindow":83,"./Log":85,"./Platform":86,"./Time":87,merge:1,plask:4}]},{},[7]);