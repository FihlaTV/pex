/** vim: et:ts=4:sw=4:sts=4
 * @license RequireJS 2.1.11 Copyright (c) 2010-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/requirejs for details
 */

// seedrandom.js version 2.0.
// Author: David Bau 4/2/2011
//
// Defines a method Math.seedrandom() that, when called, substitutes
// an explicitly seeded RC4-based algorithm for Math.random().  Also
// supports automatic seeding from local or network sources of entropy.
//
// Usage:
//
//   <script src=http://davidbau.com/encode/seedrandom-min.js></script>
//
//   Math.seedrandom('yipee'); Sets Math.random to a function that is
//                             initialized using the given explicit seed.
//
//   Math.seedrandom();        Sets Math.random to a function that is
//                             seeded using the current time, dom state,
//                             and other accumulated local entropy.
//                             The generated seed string is returned.
//
//   Math.seedrandom('yowza', true);
//                             Seeds using the given explicit seed mixed
//                             together with accumulated entropy.
//
//   <script src="http://bit.ly/srandom-512"></script>
//                             Seeds using physical random bits downloaded
//                             from random.org.
//
//   <script src="https://jsonlib.appspot.com/urandom?callback=Math.seedrandom">
//   </script>                 Seeds using urandom bits from call.jsonlib.com,
//                             which is faster than random.org.
//
// Examples:
//
//   Math.seedrandom("hello");            // Use "hello" as the seed.
//   document.write(Math.random());       // Always 0.5463663768140734
//   document.write(Math.random());       // Always 0.43973793770592234
//   var rng1 = Math.random;              // Remember the current prng.
//
//   var autoseed = Math.seedrandom();    // New prng with an automatic seed.
//   document.write(Math.random());       // Pretty much unpredictable.
//
//   Math.random = rng1;                  // Continue "hello" prng sequence.
//   document.write(Math.random());       // Always 0.554769432473455
//
//   Math.seedrandom(autoseed);           // Restart at the previous seed.
//   document.write(Math.random());       // Repeat the 'unpredictable' value.
//
// Notes:
//
// Each time seedrandom('arg') is called, entropy from the passed seed
// is accumulated in a pool to help generate future seeds for the
// zero-argument form of Math.seedrandom, so entropy can be injected over
// time by calling seedrandom with explicit data repeatedly.
//
// On speed - This javascript implementation of Math.random() is about
// 3-10x slower than the built-in Math.random() because it is not native
// code, but this is typically fast enough anyway.  Seeding is more expensive,
// especially if you use auto-seeding.  Some details (timings on Chrome 4):
//
// Our Math.random()            - avg less than 0.002 milliseconds per call
// seedrandom('explicit')       - avg less than 0.5 milliseconds per call
// seedrandom('explicit', true) - avg less than 2 milliseconds per call
// seedrandom()                 - avg about 38 milliseconds per call
//
// LICENSE (BSD):
//
// Copyright 2010 David Bau, all rights reserved.
//
// Redistribution and use in source and binary forms, with or without
// modification, are permitted provided that the following conditions are met:
//
//   1. Redistributions of source code must retain the above copyright
//      notice, this list of conditions and the following disclaimer.
//
//   2. Redistributions in binary form must reproduce the above copyright
//      notice, this list of conditions and the following disclaimer in the
//      documentation and/or other materials provided with the distribution.
//
//   3. Neither the name of this module nor the names of its contributors may
//      be used to endorse or promote products derived from this software
//      without specific prior written permission.
//
// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
// "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
// OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
// SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
// LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
// DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
// THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
//

/**
 * @license RequireJS text 1.0.2 Copyright (c) 2010-2011, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/requirejs for details
 */

// (c) Dean McNamee <dean@gmail.com>, 2012.
//
// https://github.com/deanm/css-color-parser-js
//
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to
// deal in the Software without restriction, including without limitation the
// rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
// sell copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
// FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
// IN THE SOFTWARE.
//wrapped with AMD by Marcin Ignac on 2013-05-31

// (c) Dean McNamee <dean@gmail.com>, 2012.
//
// https://github.com/deanm/omgcanvas
//
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to
// deal in the Software without restriction, including without limitation the
// rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
// sell copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
// FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
// IN THE SOFTWARE.
//wrapped with AMD by Marcin Ignac on 2013-05-31

var requirejs,require,define;if(function(global){function isFunction(e){return"[object Function]"===ostring.call(e)}function isArray(e){return"[object Array]"===ostring.call(e)}function each(e,t){if(e){var i;for(i=0;i<e.length&&(!e[i]||!t(e[i],i,e));i+=1);}}function eachReverse(e,t){if(e){var i;for(i=e.length-1;i>-1&&(!e[i]||!t(e[i],i,e));i-=1);}}function hasProp(e,t){return hasOwn.call(e,t)}function getOwn(e,t){return hasProp(e,t)&&e[t]}function eachProp(e,t){var i;for(i in e)if(hasProp(e,i)&&t(e[i],i))break}function mixin(e,t,i,n){return t&&eachProp(t,function(t,r){(i||!hasProp(e,r))&&(!n||"object"!=typeof t||!t||isArray(t)||isFunction(t)||t instanceof RegExp?e[r]=t:(e[r]||(e[r]={}),mixin(e[r],t,i,n)))}),e}function bind(e,t){return function(){return t.apply(e,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(e){throw e}function getGlobal(e){if(!e)return e;var t=global;return each(e.split("."),function(e){t=t[e]}),t}function makeError(e,t,i,n){var r=new Error(t+"\nhttp://requirejs.org/docs/errors.html#"+e);return r.requireType=e,r.requireModules=n,i&&(r.originalError=i),r}function newContext(e){function t(e){var t,i,n=e.length;for(t=0;n>t;t++)if(i=e[t],"."===i)e.splice(t,1),t-=1;else if(".."===i){if(1===t&&(".."===e[2]||".."===e[0]))break;t>0&&(e.splice(t-1,2),t-=2)}}function i(e,i,n){var r,o,s,a,h,c,l,u,p,f,d,g=i&&i.split("/"),m=g,x=M.map,v=x&&x["*"];if(e&&"."===e.charAt(0)&&(i?(m=g.slice(0,g.length-1),e=e.split("/"),l=e.length-1,M.nodeIdCompat&&jsSuffixRegExp.test(e[l])&&(e[l]=e[l].replace(jsSuffixRegExp,"")),e=m.concat(e),t(e),e=e.join("/")):0===e.indexOf("./")&&(e=e.substring(2))),n&&x&&(g||v)){s=e.split("/");e:for(a=s.length;a>0;a-=1){if(c=s.slice(0,a).join("/"),g)for(h=g.length;h>0;h-=1)if(o=getOwn(x,g.slice(0,h).join("/")),o&&(o=getOwn(o,c))){u=o,p=a;break e}!f&&v&&getOwn(v,c)&&(f=getOwn(v,c),d=a)}!u&&f&&(u=f,p=d),u&&(s.splice(0,p,u),e=s.join("/"))}return r=getOwn(M.pkgs,e),r?r:e}function n(e){isBrowser&&each(scripts(),function(t){return t.getAttribute("data-requiremodule")===e&&t.getAttribute("data-requirecontext")===w.contextName?(t.parentNode.removeChild(t),!0):void 0})}function r(e){var t=getOwn(M.paths,e);return t&&isArray(t)&&t.length>1?(t.shift(),w.require.undef(e),w.require([e]),!0):void 0}function o(e){var t,i=e?e.indexOf("!"):-1;return i>-1&&(t=e.substring(0,i),e=e.substring(i+1,e.length)),[t,e]}function s(e,t,n,r){var s,a,h,c,l=null,u=t?t.name:null,p=e,f=!0,d="";return e||(f=!1,e="_@r"+(R+=1)),c=o(e),l=c[0],e=c[1],l&&(l=i(l,u,r),a=getOwn(T,l)),e&&(l?d=a&&a.normalize?a.normalize(e,function(e){return i(e,u,r)}):i(e,u,r):(d=i(e,u,r),c=o(d),l=c[0],d=c[1],n=!0,s=w.nameToUrl(d))),h=!l||a||n?"":"_unnormalized"+(_+=1),{prefix:l,name:d,parentMap:t,unnormalized:!!h,url:s,originalName:p,isDefine:f,id:(l?l+"!"+d:d)+h}}function a(e){var t=e.id,i=getOwn(S,t);return i||(i=S[t]=new w.Module(e)),i}function h(e,t,i){var n=e.id,r=getOwn(S,n);!hasProp(T,n)||r&&!r.defineEmitComplete?(r=a(e),r.error&&"error"===t?i(r.error):r.on(t,i)):"defined"===t&&i(T[n])}function c(e,t){var i=e.requireModules,n=!1;t?t(e):(each(i,function(t){var i=getOwn(S,t);i&&(i.error=e,i.events.error&&(n=!0,i.emit("error",e)))}),n||req.onError(e))}function l(){globalDefQueue.length&&(apsp.apply(z,[z.length,0].concat(globalDefQueue)),globalDefQueue=[])}function u(e){delete S[e],delete C[e]}function p(e,t,i){var n=e.map.id;e.error?e.emit("error",e.error):(t[n]=!0,each(e.depMaps,function(n,r){var o=n.id,s=getOwn(S,o);!s||e.depMatched[r]||i[o]||(getOwn(t,o)?(e.defineDep(r,T[o]),e.check()):p(s,t,i))}),i[n]=!0)}function f(){var e,t,i=1e3*M.waitSeconds,o=i&&w.startTime+i<(new Date).getTime(),s=[],a=[],h=!1,l=!0;if(!v){if(v=!0,eachProp(C,function(e){var i=e.map,c=i.id;if(e.enabled&&(i.isDefine||a.push(e),!e.error))if(!e.inited&&o)r(c)?(t=!0,h=!0):(s.push(c),n(c));else if(!e.inited&&e.fetched&&i.isDefine&&(h=!0,!i.prefix))return l=!1}),o&&s.length)return e=makeError("timeout","Load timeout for modules: "+s,null,s),e.contextName=w.contextName,c(e);l&&each(a,function(e){p(e,{},{})}),o&&!t||!h||!isBrowser&&!isWebWorker||E||(E=setTimeout(function(){E=0,f()},50)),v=!1}}function d(e){hasProp(T,e[0])||a(s(e[0],null,!0)).init(e[1],e[2])}function g(e,t,i,n){e.detachEvent&&!isOpera?n&&e.detachEvent(n,t):e.removeEventListener(i,t,!1)}function m(e){var t=e.currentTarget||e.srcElement;return g(t,w.onScriptLoad,"load","onreadystatechange"),g(t,w.onScriptError,"error"),{node:t,id:t&&t.getAttribute("data-requiremodule")}}function x(){var e;for(l();z.length;){if(e=z.shift(),null===e[0])return c(makeError("mismatch","Mismatched anonymous define() module: "+e[e.length-1]));d(e)}}var v,y,w,b,E,M={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},S={},C={},P={},z=[],T={},k={},F={},R=1,_=1;return b={require:function(e){return e.require?e.require:e.require=w.makeRequire(e.map)},exports:function(e){return e.usingExports=!0,e.map.isDefine?e.exports?T[e.map.id]=e.exports:e.exports=T[e.map.id]={}:void 0},module:function(e){return e.module?e.module:e.module={id:e.map.id,uri:e.map.url,config:function(){return getOwn(M.config,e.map.id)||{}},exports:e.exports||(e.exports={})}}},y=function(e){this.events=getOwn(P,e.id)||{},this.map=e,this.shim=getOwn(M.shim,e.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},y.prototype={init:function(e,t,i,n){n=n||{},this.inited||(this.factory=t,i?this.on("error",i):this.events.error&&(i=bind(this,function(e){this.emit("error",e)})),this.depMaps=e&&e.slice(0),this.errback=i,this.inited=!0,this.ignore=n.ignore,n.enabled||this.enabled?this.enable():this.check())},defineDep:function(e,t){this.depMatched[e]||(this.depMatched[e]=!0,this.depCount-=1,this.depExports[e]=t)},fetch:function(){if(!this.fetched){this.fetched=!0,w.startTime=(new Date).getTime();var e=this.map;return this.shim?void w.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return e.prefix?this.callPlugin():this.load()})):e.prefix?this.callPlugin():this.load()}},load:function(){var e=this.map.url;k[e]||(k[e]=!0,w.load(this.map.id,e))},check:function(){if(this.enabled&&!this.enabling){var e,t,i=this.map.id,n=this.depExports,r=this.exports,o=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(o)){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)try{r=w.execCb(i,o,n,r)}catch(s){e=s}else r=w.execCb(i,o,n,r);if(this.map.isDefine&&void 0===r&&(t=this.module,t?r=t.exports:this.usingExports&&(r=this.exports)),e)return e.requireMap=this.map,e.requireModules=this.map.isDefine?[this.map.id]:null,e.requireType=this.map.isDefine?"define":"require",c(this.error=e)}else r=o;this.exports=r,this.map.isDefine&&!this.ignore&&(T[i]=r,req.onResourceLoad&&req.onResourceLoad(w,this.map,this.depMaps)),u(i),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else this.fetch()}},callPlugin:function(){var e=this.map,t=e.id,n=s(e.prefix);this.depMaps.push(n),h(n,"defined",bind(this,function(n){var r,o,l,p=getOwn(F,this.map.id),f=this.map.name,d=this.map.parentMap?this.map.parentMap.name:null,g=w.makeRequire(e.parentMap,{enableBuildCallback:!0});return this.map.unnormalized?(n.normalize&&(f=n.normalize(f,function(e){return i(e,d,!0)})||""),o=s(e.prefix+"!"+f,this.map.parentMap),h(o,"defined",bind(this,function(e){this.init([],function(){return e},null,{enabled:!0,ignore:!0})})),l=getOwn(S,o.id),void(l&&(this.depMaps.push(o),this.events.error&&l.on("error",bind(this,function(e){this.emit("error",e)})),l.enable()))):p?(this.map.url=w.nameToUrl(p),void this.load()):(r=bind(this,function(e){this.init([],function(){return e},null,{enabled:!0})}),r.error=bind(this,function(e){this.inited=!0,this.error=e,e.requireModules=[t],eachProp(S,function(e){0===e.map.id.indexOf(t+"_unnormalized")&&u(e.map.id)}),c(e)}),r.fromText=bind(this,function(i,n){var o=e.name,h=s(o),l=useInteractive;n&&(i=n),l&&(useInteractive=!1),a(h),hasProp(M.config,t)&&(M.config[o]=M.config[t]);try{req.exec(i)}catch(u){return c(makeError("fromtexteval","fromText eval for "+t+" failed: "+u,u,[t]))}l&&(useInteractive=!0),this.depMaps.push(h),w.completeLoad(o),g([o],r)}),void n.load(e.name,g,r,M))})),w.enable(n,this),this.pluginMaps[n.id]=n},enable:function(){C[this.map.id]=this,this.enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(e,t){var i,n,r;if("string"==typeof e){if(e=s(e,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[t]=e,r=getOwn(b,e.id))return void(this.depExports[t]=r(this));this.depCount+=1,h(e,"defined",bind(this,function(e){this.defineDep(t,e),this.check()})),this.errback&&h(e,"error",bind(this,this.errback))}i=e.id,n=S[i],hasProp(b,i)||!n||n.enabled||w.enable(e,this)})),eachProp(this.pluginMaps,bind(this,function(e){var t=getOwn(S,e.id);t&&!t.enabled&&w.enable(e,this)})),this.enabling=!1,this.check()},on:function(e,t){var i=this.events[e];i||(i=this.events[e]=[]),i.push(t)},emit:function(e,t){each(this.events[e],function(e){e(t)}),"error"===e&&delete this.events[e]}},w={config:M,contextName:e,registry:S,defined:T,urlFetched:k,defQueue:z,Module:y,makeModuleMap:s,nextTick:req.nextTick,onError:c,configure:function(e){e.baseUrl&&"/"!==e.baseUrl.charAt(e.baseUrl.length-1)&&(e.baseUrl+="/");var t=M.shim,i={paths:!0,bundles:!0,config:!0,map:!0};eachProp(e,function(e,t){i[t]?(M[t]||(M[t]={}),mixin(M[t],e,!0,!0)):M[t]=e}),e.bundles&&eachProp(e.bundles,function(e,t){each(e,function(e){e!==t&&(F[e]=t)})}),e.shim&&(eachProp(e.shim,function(e,i){isArray(e)&&(e={deps:e}),!e.exports&&!e.init||e.exportsFn||(e.exportsFn=w.makeShimExports(e)),t[i]=e}),M.shim=t),e.packages&&each(e.packages,function(e){var t,i;e="string"==typeof e?{name:e}:e,i=e.name,t=e.location,t&&(M.paths[i]=e.location),M.pkgs[i]=e.name+"/"+(e.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}),eachProp(S,function(e,t){e.inited||e.map.unnormalized||(e.map=s(t))}),(e.deps||e.callback)&&w.require(e.deps||[],e.callback)},makeShimExports:function(e){function t(){var t;return e.init&&(t=e.init.apply(global,arguments)),t||e.exports&&getGlobal(e.exports)}return t},makeRequire:function(t,r){function o(i,n,h){var l,u,p;return r.enableBuildCallback&&n&&isFunction(n)&&(n.__requireJsBuild=!0),"string"==typeof i?isFunction(n)?c(makeError("requireargs","Invalid require call"),h):t&&hasProp(b,i)?b[i](S[t.id]):req.get?req.get(w,i,t,o):(u=s(i,t,!1,!0),l=u.id,hasProp(T,l)?T[l]:c(makeError("notloaded",'Module name "'+l+'" has not been loaded yet for context: '+e+(t?"":". Use require([])")))):(x(),w.nextTick(function(){x(),p=a(s(null,t)),p.skipMap=r.skipMap,p.init(i,n,h,{enabled:!0}),f()}),o)}return r=r||{},mixin(o,{isBrowser:isBrowser,toUrl:function(e){var n,r=e.lastIndexOf("."),o=e.split("/")[0],s="."===o||".."===o;return-1!==r&&(!s||r>1)&&(n=e.substring(r,e.length),e=e.substring(0,r)),w.nameToUrl(i(e,t&&t.id,!0),n,!0)},defined:function(e){return hasProp(T,s(e,t,!1,!0).id)},specified:function(e){return e=s(e,t,!1,!0).id,hasProp(T,e)||hasProp(S,e)}}),t||(o.undef=function(e){l();var i=s(e,t,!0),r=getOwn(S,e);n(e),delete T[e],delete k[i.url],delete P[e],eachReverse(z,function(t,i){t[0]===e&&z.splice(i,1)}),r&&(r.events.defined&&(P[e]=r.events),u(e))}),o},enable:function(e){var t=getOwn(S,e.id);t&&a(e).enable()},completeLoad:function(e){var t,i,n,o=getOwn(M.shim,e)||{},s=o.exports;for(l();z.length;){if(i=z.shift(),null===i[0]){if(i[0]=e,t)break;t=!0}else i[0]===e&&(t=!0);d(i)}if(n=getOwn(S,e),!t&&!hasProp(T,e)&&n&&!n.inited){if(!(!M.enforceDefine||s&&getGlobal(s)))return r(e)?void 0:c(makeError("nodefine","No define call for "+e,null,[e]));d([e,o.deps||[],o.exportsFn])}f()},nameToUrl:function(e,t,i){var n,r,o,s,a,h,c,l=getOwn(M.pkgs,e);if(l&&(e=l),c=getOwn(F,e))return w.nameToUrl(c,t,i);if(req.jsExtRegExp.test(e))a=e+(t||"");else{for(n=M.paths,r=e.split("/"),o=r.length;o>0;o-=1)if(s=r.slice(0,o).join("/"),h=getOwn(n,s)){isArray(h)&&(h=h[0]),r.splice(0,o,h);break}a=r.join("/"),a+=t||(/^data\:|\?/.test(a)||i?"":".js"),a=("/"===a.charAt(0)||a.match(/^[\w\+\.\-]+:/)?"":M.baseUrl)+a}return M.urlArgs?a+((-1===a.indexOf("?")?"?":"&")+M.urlArgs):a},load:function(e,t){req.load(w,e,t)},execCb:function(e,t,i,n){return t.apply(n,i)},onScriptLoad:function(e){if("load"===e.type||readyRegExp.test((e.currentTarget||e.srcElement).readyState)){interactiveScript=null;var t=m(e);w.completeLoad(t.id)}},onScriptError:function(e){var t=m(e);return r(t.id)?void 0:c(makeError("scripterror","Script error for: "+t.id,e,[t.id]))}},w.require=w.makeRequire(),w}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState?interactiveScript:(eachReverse(scripts(),function(e){return"interactive"===e.readyState?interactiveScript=e:void 0}),interactiveScript)}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.1.11",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,ap=Array.prototype,apsp=ap.splice,isBrowser=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if("undefined"==typeof define){if("undefined"!=typeof requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}"undefined"==typeof require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(e,t,i,n){var r,o,s=defContextName;return isArray(e)||"string"==typeof e||(o=e,isArray(t)?(e=t,t=i,i=n):e=[]),o&&o.context&&(s=o.context),r=getOwn(contexts,s),r||(r=contexts[s]=req.s.newContext(s)),o&&r.configure(o),r.require(e,t,i)},req.config=function(e){return req(e)},req.nextTick="undefined"!=typeof setTimeout?function(e){setTimeout(e,4)}:function(e){e()},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(e){req[e]=function(){var t=contexts[defContextName];return t.require[e].apply(t,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(e){var t=e.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return t.type=e.scriptType||"text/javascript",t.charset="utf-8",t.async=!0,t},req.load=function(e,t,i){var n,r=e&&e.config||{};if(isBrowser)return n=req.createNode(r,t,i),n.setAttribute("data-requirecontext",e.contextName),n.setAttribute("data-requiremodule",t),!n.attachEvent||n.attachEvent.toString&&n.attachEvent.toString().indexOf("[native code")<0||isOpera?(n.addEventListener("load",e.onScriptLoad,!1),n.addEventListener("error",e.onScriptError,!1)):(useInteractive=!0,n.attachEvent("onreadystatechange",e.onScriptLoad)),n.src=i,currentlyAddingScript=n,baseElement?head.insertBefore(n,baseElement):head.appendChild(n),currentlyAddingScript=null,n;if(isWebWorker)try{importScripts(i),e.completeLoad(t)}catch(o){e.onError(makeError("importscripts","importScripts failed for "+t+" at "+i,o,[t]))}},isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),function(e){return head||(head=e.parentNode),dataMain=e.getAttribute("data-main"),dataMain?(mainScript=dataMain,cfg.baseUrl||(src=mainScript.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0):void 0}),define=function(e,t,i){var n,r;"string"!=typeof e&&(i=t,t=e,e=null),isArray(t)||(i=t,t=null),!t&&isFunction(i)&&(t=[],i.length&&(i.toString().replace(commentRegExp,"").replace(cjsRequireRegExp,function(e,i){t.push(i)}),t=(1===i.length?["require"]:["require","exports","module"]).concat(t))),useInteractive&&(n=currentlyAddingScript||getInteractiveScript(),n&&(e||(e=n.getAttribute("data-requiremodule")),r=contexts[n.getAttribute("data-requirecontext")])),(r?r.defQueue:globalDefQueue).push([e,t,i])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}}(this),define("requireLib",function(){}),function(){define("pex/geom/Vec2",["require"],function(){var e;return e=function(){function e(t,i){this.x=null!=t?t:0,this.y=null!=i?i:0,e.count++}return e.prototype.x=0,e.prototype.y=0,e.count=0,e.create=function(t,i){return new e(t,i)},e.prototype.set=function(e,t){return this.x=e,this.y=t,this},e.prototype.equals=function(e,t){return null==t&&(t=1e-7),Math.abs(e.x-this.x)<=t&&Math.abs(e.y-this.y)<=t},e.prototype.hash=function(){return 1*this.x+12*this.y},e.prototype.setVec2=function(e){return this.x=e.x,this.y=e.y,this},e.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this},e.prototype.sub=function(e){return this.x-=e.x,this.y-=e.y,this},e.prototype.scale=function(e){return this.x*=e,this.y*=e,this},e.prototype.distance=function(e){var t,i;return t=e.x-this.x,i=e.y-this.y,Math.sqrt(t*t+i*i)},e.prototype.dot=function(e){return this.x*e.x+this.y*e.y},e.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this},e.prototype.clone=function(){return new e(this.x,this.y)},e.prototype.dup=function(){return this.clone()},e.prototype.asAdd=function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},e.prototype.asSub=function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},e.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},e.prototype.normalize=function(){var e;return e=this.length(),e>0&&this.scale(1/e),this},e.prototype.toString=function(){return"{"+this.x+","+this.y+"}"},e}()})}.call(this),function(){define("pex/geom/Vec3",["require"],function(){var e;return e=function(){function e(t,i,n){this.x=null!=t?t:0,this.y=null!=i?i:0,this.z=null!=n?n:0,e.count++}return e.prototype.x=0,e.prototype.y=0,e.prototype.z=0,e.count=0,e.create=function(t,i,n){return new e(t,i,n)},e.prototype.hash=function(){return 1*this.x+12*this.y+123*this.z},e.prototype.set=function(e,t,i){return this.x=e,this.y=t,this.z=i,this},e.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},e.prototype.sub=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},e.prototype.scale=function(e){return this.x*=e,this.y*=e,this.z*=e,this},e.prototype.distance=function(e){var t,i,n;return t=e.x-this.x,i=e.y-this.y,n=e.z-this.z,Math.sqrt(t*t+i*i+n*n)},e.prototype.squareDistance=function(e){var t,i,n;return t=e.x-this.x,i=e.y-this.y,n=e.z-this.z,t*t+i*i+n*n},e.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},e.prototype.setVec3=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},e.prototype.clone=function(){return new e(this.x,this.y,this.z)},e.prototype.dup=function(){return this.clone()},e.prototype.cross=function(e){var t,i,n,r,o,s;return r=this.x,o=this.y,s=this.z,t=e.x,i=e.y,n=e.z,this.x=o*n-s*i,this.y=s*t-r*n,this.z=r*i-o*t,this},e.prototype.dot=function(e){return this.x*e.x+this.y*e.y+this.z*e.z},e.prototype.asAdd=function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},e.prototype.asSub=function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},e.prototype.asCross=function(e,t){return this.copy(e).cross(t)},e.prototype.addScaled=function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},e.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},e.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},e.prototype.normalize=function(){var e;return e=this.length(),e>0&&this.scale(1/e),this},e.prototype.transformQuat=function(e){var t,i,n,r,o,s,a,h,c,l,u;return c=this.x,l=this.y,u=this.z,s=e.x,a=e.y,h=e.z,o=e.w,i=o*c+a*u-h*l,n=o*l+h*c-s*u,r=o*u+s*l-a*c,t=-s*c-a*l-h*u,this.x=i*o+t*-s+n*-h-r*-a,this.y=n*o+t*-a+r*-s-i*-h,this.z=r*o+t*-h+i*-a-n*-s,this},e.prototype.transformMat4=function(e){var t,i,n;return t=e.a14+e.a11*this.x+e.a12*this.y+e.a13*this.z,i=e.a24+e.a21*this.x+e.a22*this.y+e.a23*this.z,n=e.a34+e.a31*this.x+e.a32*this.y+e.a33*this.z,this.x=t,this.y=i,this.z=n,this},e.prototype.equals=function(e,t){return t=null!=t?t:1e-7,Math.abs(e.x-this.x)<=t&&Math.abs(e.y-this.y)<=t&&Math.abs(e.z-this.z)<=t},e.prototype.toString=function(){return"{"+this.x+","+this.y+","+this.z+"}"},e.Zero=new e(0,0,0),e}()})}.call(this),function(){define("pex/geom/Vec4",["require"],function(){var e;return e=function(){function e(t,i,n,r){this.x=null!=t?t:0,this.y=null!=i?i:0,this.z=null!=n?n:0,this.w=null!=r?r:0,e.count++}return e.prototype.x=0,e.prototype.y=0,e.prototype.z=0,e.prototype.w=0,e.count=0,e.prototype.equals=function(e,t){return null==t&&(t=1e-7),Math.abs(e.x-this.x)<=t&&Math.abs(e.y-this.y)<=t&&Math.abs(e.z-this.z)<=t&&Math.abs(e.w-this.w)<=t},e.prototype.hash=function(){return 1*this.x+12*this.y+123*this.z+1234*this.w},e.create=function(t,i,n,r){return new e(t,i,n,r)},e.prototype.set=function(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this},e.prototype.setVec4=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},e.prototype.transformMat4=function(e){var t,i,n,r;return i=e.a14*this.w+e.a11*this.x+e.a12*this.y+e.a13*this.z,n=e.a24*this.w+e.a21*this.x+e.a22*this.y+e.a23*this.z,r=e.a34*this.w+e.a31*this.x+e.a32*this.y+e.a33*this.z,t=e.a44*this.w+e.a41*this.x+e.a42*this.y+e.a43*this.z,this.x=i,this.y=n,this.z=r,this.w=t,this},e}()})}.call(this),function(){define("pex/geom/Mat4",["require","../geom/Vec3"],function(e){var t,i;return i=e("../geom/Vec3"),t=function(){function e(){e.count++,this.reset()}return e.count=0,e.create=function(){return new e},e.prototype.equals=function(e,t){return null==t&&(t=1e-7),Math.abs(e.a11-this.a11)<=t&&Math.abs(e.a12-this.a12)<=t&&Math.abs(e.a13-this.a13)<=t&&Math.abs(e.a14-this.a14)<=t&&Math.abs(e.a21-this.a21)<=t&&Math.abs(e.a22-this.a22)<=t&&Math.abs(e.a23-this.a23)<=t&&Math.abs(e.a24-this.a24)<=t&&Math.abs(e.a31-this.a31)<=t&&Math.abs(e.a32-this.a32)<=t&&Math.abs(e.a33-this.a33)<=t&&Math.abs(e.a34-this.a34)<=t&&Math.abs(e.a41-this.a41)<=t&&Math.abs(e.a42-this.a42)<=t&&Math.abs(e.a43-this.a43)<=t&&Math.abs(e.a44-this.a44)<=t},e.prototype.hash=function(){return.01*this.a11+.02*this.a12+.03*this.a13+.04*this.a14+.05*this.a21+.06*this.a22+.07*this.a23+.08*this.a24+.09*this.a31+.1*this.a32+.11*this.a33+.12*this.a34+.13*this.a41+.14*this.a42+.15*this.a43+.16*this.a44},e.prototype.set4x4r=function(e,t,i,n,r,o,s,a,h,c,l,u,p,f,d,g){return this.a11=e,this.a12=t,this.a13=i,this.a14=n,this.a21=r,this.a22=o,this.a23=s,this.a24=a,this.a31=h,this.a32=c,this.a33=l,this.a34=u,this.a41=p,this.a42=f,this.a43=d,this.a44=g,this},e.prototype.copy=function(e){return this.a11=e.a11,this.a12=e.a12,this.a13=e.a13,this.a14=e.a14,this.a21=e.a21,this.a22=e.a22,this.a23=e.a23,this.a24=e.a24,this.a31=e.a31,this.a32=e.a32,this.a33=e.a33,this.a34=e.a34,this.a41=e.a41,this.a42=e.a42,this.a43=e.a43,this.a44=e.a44,this},e.prototype.dup=function(){return e.create().copy(this)},e.prototype.reset=function(){return this.set4x4r(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},e.prototype.identity=function(){return this.reset(),this},e.prototype.mul4x4r=function(e,t,i,n,r,o,s,a,h,c,l,u,p,f,d,g){var m,x,v,y,w,b,E,M,S,C,P,z,T,k,F,R;return m=this.a11,x=this.a12,v=this.a13,y=this.a14,w=this.a21,b=this.a22,E=this.a23,M=this.a24,S=this.a31,C=this.a32,P=this.a33,z=this.a34,T=this.a41,k=this.a42,F=this.a43,R=this.a44,this.a11=m*e+x*r+v*h+y*p,this.a12=m*t+x*o+v*c+y*f,this.a13=m*i+x*s+v*l+y*d,this.a14=m*n+x*a+v*u+y*g,this.a21=w*e+b*r+E*h+M*p,this.a22=w*t+b*o+E*c+M*f,this.a23=w*i+b*s+E*l+M*d,this.a24=w*n+b*a+E*u+M*g,this.a31=S*e+C*r+P*h+z*p,this.a32=S*t+C*o+P*c+z*f,this.a33=S*i+C*s+P*l+z*d,this.a34=S*n+C*a+P*u+z*g,this.a41=T*e+k*r+F*h+R*p,this.a42=T*t+k*o+F*c+R*f,this.a43=T*i+k*s+F*l+R*d,this.a44=T*n+k*a+F*u+R*g,this},e.prototype.perspective=function(e,t,i,n){var r,o;return r=1/Math.tan(e/180*Math.PI/2),o=1/(i-n),this.mul4x4r(r/t,0,0,0,0,r,0,0,0,0,(n+i)*o,2*i*n*o,0,0,-1,0),this},e.prototype.ortho=function(e,t,i,n,r,o){return this.mul4x4r(2/(t-e),0,0,(t+e)/(e-t),0,2/(n-i),0,(n+i)/(i-n),0,0,2/(r-o),(o+r)/(r-o),0,0,0,1),this},e.prototype.lookAt=function(e,t,n){var r,o,s;return s=i.create(e.x-t.x,e.y-t.y,e.z-t.z).normalize(),r=i.create(n.x,n.y,n.z).cross(s).normalize(),o=i.create().copy(s).cross(r).normalize(),this.mul4x4r(r.x,r.y,r.z,0,o.x,o.y,o.z,0,s.x,s.y,s.z,0,0,0,0,1),this.translate(-e.x,-e.y,-e.z),this},e.prototype.translate=function(e,t,i){return this.mul4x4r(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},e.prototype.rotate=function(e,t,i,n){var r,o;return o=Math.sin(e),r=Math.cos(e),this.mul4x4r(t*t*(1-r)+r,t*i*(1-r)-n*o,t*n*(1-r)+i*o,0,i*t*(1-r)+n*o,i*i*(1-r)+r,i*n*(1-r)-t*o,0,t*n*(1-r)-i*o,i*n*(1-r)+t*o,n*n*(1-r)+r,0,0,0,0,1),this},e.prototype.asMul=function(e,t){var i,n,r,o,s,a,h,c,l,u,p,f,d,g,m,x,v,y,w,b,E,M,S,C,P,z,T,k,F,R,_,V;return i=e.a11,n=e.a12,r=e.a13,o=e.a14,s=e.a21,a=e.a22,h=e.a23,c=e.a24,l=e.a31,u=e.a32,p=e.a33,f=e.a34,d=e.a41,g=e.a42,m=e.a43,x=e.a44,v=t.a11,y=t.a12,w=t.a13,b=t.a14,E=t.a21,M=t.a22,S=t.a23,C=t.a24,P=t.a31,z=t.a32,T=t.a33,k=t.a34,F=t.a41,R=t.a42,_=t.a43,V=t.a44,this.a11=i*v+n*E+r*P+o*F,this.a12=i*y+n*M+r*z+o*R,this.a13=i*w+n*S+r*T+o*_,this.a14=i*b+n*C+r*k+o*V,this.a21=s*v+a*E+h*P+c*F,this.a22=s*y+a*M+h*z+c*R,this.a23=s*w+a*S+h*T+c*_,this.a24=s*b+a*C+h*k+c*V,this.a31=l*v+u*E+p*P+f*F,this.a32=l*y+u*M+p*z+f*R,this.a33=l*w+u*S+p*T+f*_,this.a34=l*b+u*C+p*k+f*V,this.a41=d*v+g*E+m*P+x*F,this.a42=d*y+g*M+m*z+x*R,this.a43=d*w+g*S+m*T+x*_,this.a44=d*b+g*C+m*k+x*V,this},e.prototype.mul=function(e){return this.asMul(this,e)},e.prototype.scale=function(e,t,i){return this.mul4x4r(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},e.prototype.invert=function(){var e,t,i,n,r,o,s,a,h,c,l,u,p,f,d,g,m,x,v,y,w,b,E,M,S,C,P,z,T;return f=this.a11,d=this.a12,b=this.a13,E=this.a14,M=this.a21,S=this.a22,C=this.a23,P=this.a24,z=this.a31,T=this.a32,g=this.a33,m=this.a34,x=this.a41,v=this.a42,y=this.a43,w=this.a44,e=f*S-d*M,t=f*C-b*M,i=f*P-E*M,n=d*C-b*S,r=d*P-E*S,o=b*P-E*C,s=z*v-T*x,a=z*y-g*x,h=z*w-m*x,c=T*y-g*v,l=T*w-m*v,u=g*w-m*y,p=1/(e*u-t*l+i*c+n*h-r*a+o*s),this.a11=(+S*u-C*l+P*c)*p,this.a12=(-d*u+b*l-E*c)*p,this.a13=(+v*o-y*r+w*n)*p,this.a14=(-T*o+g*r-m*n)*p,this.a21=(-M*u+C*h-P*a)*p,this.a22=(+f*u-b*h+E*a)*p,this.a23=(-x*o+y*i-w*t)*p,this.a24=(+z*o-g*i+m*t)*p,this.a31=(+M*l-S*h+P*s)*p,this.a32=(-f*l+d*h-E*s)*p,this.a33=(+x*r-v*i+w*e)*p,this.a34=(-z*r+T*i-m*e)*p,this.a41=(-M*c+S*a-C*s)*p,this.a42=(+f*c-d*a+b*s)*p,this.a43=(-x*n+v*t-y*e)*p,this.a44=(+z*n-T*t+g*e)*p,this},e.prototype.transpose=function(){var e,t,i,n,r,o,s,a,h,c,l,u,p,f,d,g;return e=this.a11,t=this.a12,i=this.a13,n=this.a14,r=this.a21,o=this.a22,s=this.a23,a=this.a24,h=this.a31,c=this.a32,l=this.a33,u=this.a34,p=this.a41,f=this.a42,d=this.a43,g=this.a44,this.a11=e,this.a12=r,this.a13=h,this.a14=p,this.a21=t,this.a22=o,this.a23=c,this.a24=f,this.a31=i,this.a32=s,this.a33=l,this.a34=d,this.a41=n,this.a42=a,this.a43=u,this.a44=g,this},e.prototype.toArray=function(){return[this.a11,this.a21,this.a31,this.a41,this.a12,this.a22,this.a32,this.a42,this.a13,this.a23,this.a33,this.a43,this.a14,this.a24,this.a34,this.a44]},e.prototype.fromArray=function(e){return this.a11=e[0](this.a21=e[1](this.a31=e[2](this.a41=e[3]))),this.a12=e[4](this.a22=e[5](this.a32=e[6](this.a42=e[7]))),this.a13=e[8](this.a23=e[9](this.a33=e[10](this.a43=e[11]))),this.a14=e[12](this.a24=e[13](this.a34=e[14](this.a44=e[15]))),this},e}(),t.count=0,t})}.call(this),function(){define("pex/geom/Quat",["require","pex/geom/Mat4"],function(e){var t,i,n;return n=Math.pow(2,-24),t=e("pex/geom/Mat4"),i=function(){function e(t,i,n,r){this.x=null!=t?t:0,this.y=null!=i?i:0,this.z=null!=n?n:0,this.w=null!=r?r:1,e.count++}return e.count=0,e.create=function(t,i,n,r){return new e(t,i,n,r)},e.prototype.identity=function(){return this.set(0,0,0,1),this},e.prototype.equals=function(e,t){return null==t&&(t=1e-7),Math.abs(e.x-this.x)<=t&&Math.abs(e.y-this.y)<=t&&Math.abs(e.z-this.z)<=t&&Math.abs(e.w-this.w)<=t},e.prototype.hash=function(){return 1*this.x+12*this.y+123*this.z+1234*this.w},e.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},e.prototype.clone=function(){return new e(this.x,this.y,this.z,this.w)},e.prototype.dup=function(){return this.clone()},e.prototype.setAxisAngle=function(e,t){var i;return t=.5*t,i=Math.sin(t/180*Math.PI),this.x=i*e.x,this.y=i*e.y,this.z=i*e.z,this.w=Math.cos(t/180*Math.PI),this},e.prototype.setQuat=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},e.prototype.set=function(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this},e.prototype.asMul=function(e,t){var i,n,r,o,s,a,h,c;return n=e.x,r=e.y,o=e.z,i=e.w,a=t.x,h=t.y,c=t.z,s=t.w,this.x=n*s+i*a+r*c-o*h,this.y=r*s+i*h+o*a-n*c,this.z=o*s+i*c+n*h-r*a,this.w=i*s-n*a-r*h-o*c,this},e.prototype.mul=function(e){return this.asMul(this,e),this},e.prototype.mul4=function(e,t,i,n){var r,o,s,a;return o=this.x,s=this.y,a=this.z,r=this.w,this.x=n*o+e*r+t*a-i*s,this.y=n*s+t*r+i*o-e*a,this.z=n*a+i*r+e*s-t*o,this.w=n*r-e*o-t*s-i*a,this},e.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},e.prototype.normalize=function(){var e;return e=this.length(),e>n&&(this.x/=e,this.y/=e,this.z/=e,this.w/=e),this},e.prototype.toMat4=function(e){var i,n,r,o,s,a,h,c,l,u,p,f,d;return s=this.x+this.x,l=this.y+this.y,f=this.z+this.z,n=this.w*s,r=this.w*l,o=this.w*f,a=this.x*s,h=this.x*l,c=this.x*f,u=this.y*l,p=this.y*f,d=this.z*f,i=e||new t,i.set4x4r(1-(u+d),h-o,c+r,0,h+o,1-(a+d),p-n,0,c-r,p+n,1-(a+u),0,0,0,0,1)},e}()})}.call(this),function(){define("pex/geom/Edge",["require"],function(){var e;return e=function(){function e(e,t){this.a=e,this.b=t}return e}()})}.call(this),function(){define("pex/geom/Face3",["require"],function(){var e;return e=function(){function e(e,t,i){this.a=e,this.b=t,this.c=i}return e}()})}.call(this),function(){define("pex/geom/Face4",["require"],function(){var e;return e=function(){function e(e,t,i,n){this.a=e,this.b=t,this.c=i,this.d=n}return e}()})}.call(this),define("lib/seedrandom",[],function(){!function(e,t,i,n,r,o,s){function a(e){var t,n,r=this,o=e.length,s=0,a=r.i=r.j=r.m=0;for(r.S=[],r.c=[],o||(e=[o++]);i>s;)r.S[s]=s++;for(s=0;i>s;s++)t=r.S[s],a=l(a+t+e[s%o]),n=r.S[a],r.S[s]=n,r.S[a]=t;r.g=function(e){var t=r.S,n=l(r.i+1),o=t[n],s=l(r.j+o),a=t[s];t[n]=a,t[s]=o;for(var h=t[l(o+a)];--e;)n=l(n+1),o=t[n],s=l(s+o),a=t[s],t[n]=a,t[s]=o,h=h*i+t[l(o+a)];return r.i=n,r.j=s,h},r.g(i)}function h(e,t,i,n,r){if(i=[],r=typeof e,t&&"object"==r)for(n in e)if(n.indexOf("S")<5)try{i.push(h(e[n],t-1))}catch(o){}return i.length?i:e+("string"!=r?"\x00":"")}function c(e,t,i,n){for(e+="",i=0,n=0;n<e.length;n++)t[l(n)]=l((i^=19*t[l(n)])+e.charCodeAt(n));e="";for(n in t)e+=String.fromCharCode(t[n]);return e}function l(e){return e&i-1}t.seedrandom=function(l,u){var p,f=[];return l=c(h(u?[l,e]:arguments.length?l:[(new Date).getTime(),e,window],3),f),p=new a(f),c(p.S,e),t.random=function(){for(var e=p.g(n),t=s,a=0;r>e;)e=(e+a)*i,t*=i,a=p.g(1);for(;e>=o;)e/=2,t/=2,a>>>=1;return(e+a)/t},l},s=t.pow(i,n),r=t.pow(2,r),o=2*r,c(t.random(),e)}([],Math,256,6,52)}),define("pex/utils/MathUtils",["lib/seedrandom","pex/geom/Vec2","pex/geom/Vec3","pex/geom/Vec4","pex/geom/Mat4","pex/geom/Quat"],function(e,t,i,n,r,o){function s(){}s.seed=function(e){Math.seedrandom(e)},s.randomFloat=function(e,t){return"undefined"==typeof t&&(e=1),"undefined"==typeof t&&(t=e,e=0),e+(t-e)*Math.random()
},s.randomInt=function(e,t){return Math.floor(s.randomFloat(e,t))},s.randomVec3=function(e){e=e||.5;var t=2*Math.random()-1,n=2*Math.random()-1,r=2*Math.random()-1;return i.create(t*e,n*e,r*e)},s.randomVec3InBoundingBox=function(e){var t=e.min.x+Math.random()*(e.max.x-e.min.x),n=e.min.y+Math.random()*(e.max.y-e.min.y),r=e.min.z+Math.random()*(e.max.z-e.min.z);return i.create(t,n,r)},s.randomVec2InRect=function(e){return t.create(e.x+Math.random()*e.width,e.y+Math.random()*e.height)},s.randomChance=function(e){return Math.random()<=e},s.randomElement=function(e){return e[Math.floor(Math.random()*e.length)]},s.mix=function(e,t,i){return e+(t-e)*i},s.map=function(e,t,i,n,r){return n+(e-t)/(i-t)*(r-n)},s.clamp=function(e,t,i){return Math.max(t,Math.min(e,i))};s.getTempVec2=function(e){var i=temporaryVec2[e];return i||(i=temporaryVec2[e]=t.create()),i.set(0,0,0),i};var a={};s.getTempVec3=function(e){var t=a[e];return t||(t=a[e]=i.create()),t.set(0,0,0),t};var h={};s.getTempVec4=function(e){var t=h[e];return t||(t=h[e]=n.create()),t.set(0,0,0),t};var c={};s.getTempMat4=function(e){var t=c[e];return t||(t=c[e]=r.create()),t.identity(),t};var l={};return s.getTempQuat=function(e){var t=l[e];return t||(t=l[e]=o.create()),t.identity(),t},s}),function(){define("pex/color/Color",["require","pex/utils/MathUtils"],function(e){var t,i,n;return i=e("pex/utils/MathUtils"),n=i.clamp,t=function(){function e(e,t,i,n){this.r=null!=e?e:0,this.g=null!=t?t:0,this.b=null!=i?i:0,this.a=null!=n?n:0}return e.prototype.r=0,e.prototype.g=0,e.prototype.b=0,e.prototype.a=0,e.create=function(t,i,n,r){return new e(t,i,n,r)},e.createHSV=function(t,i,n){var r;return r=new e,r.setHSV(t,i,n),r},e.prototype.set=function(e,t,i,n){return this.r=e,this.g=t,this.b=i,this.a=n,null==n&&(this.a=1),this},e.prototype.hash=function(){return 1*this.r+12*this.g+123*this.b+1234*this.a},e.prototype.setHSV=function(e,t,i){var r,o,s,a;return s=6*e,a=n(s-4,0,1)-n(s-1,0,1)+1,o=n(s,0,1)-n(s-3,0,1),r=n(s-2,0,1)-n(s-5,0,1),this.r=a*i*t+i*(1-t),this.g=o*i*t+i*(1-t),this.b=r*i*t+i*(1-t),this},e.prototype.copy=function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a,this},e.prototype.clone=function(){return new e(this.r,this.g,this.b,this.a)},e}(),t.Transparent=new t(0,0,0,0),t.None=new t(0,0,0,0),t.Black=new t(0,0,0,1),t.White=new t(1,1,1,1),t.Grey=new t(.5,.5,.5,1),t.Red=new t(1,0,0,1),t.Green=new t(0,1,0,1),t.Blue=new t(0,0,1,1),t.Yellow=new t(1,1,0,1),t.Pink=new t(1,0,1,1),t.Cyan=new t(0,1,1,1),t.Orange=new t(1,.5,0,1),t})}.call(this),function(){define("pex/geom/Geometry",["require","pex/geom/Vec2","pex/geom/Vec3","pex/geom/Vec4","pex/geom/Edge","pex/geom/Face3","pex/geom/Face4","pex/color/Color","pex/utils/MathUtils"],function(e){var t,i,n,r,o,s,a,h,c;return a=e("pex/geom/Vec2"),h=e("pex/geom/Vec3"),c=e("pex/geom/Vec4"),i=e("pex/geom/Edge"),n=e("pex/geom/Face3"),r=e("pex/geom/Face4"),t=e("pex/color/Color"),s=e("pex/utils/MathUtils"),o=function(){function e(e){var t,i,n,r,o,s,a,h;h=e.vertices,o=e.normals,a=e.texCoords,s=e.tangents,t=e.colors,r=e.indices,i=e.edges,n=e.faces,null==h&&(h=!0),null==o&&(o=!1),null==a&&(a=!1),null==s&&(s=!1),null==t&&(t=!1),null==r&&(r=!1),null==i&&(i=!1),null==n&&(n=!0),this.attribs={},h&&this.addAttrib("vertices","position",h,!1),o&&this.addAttrib("normals","normal",o,!1),a&&this.addAttrib("texCoords","texCoord",a,!1),s&&this.addAttrib("tangents","tangent",s,!1),t&&this.addAttrib("colors","color",t,!1),r&&this.addIndices(r),i&&this.addEdges(i),n&&this.addFaces(n)}return e.prototype.addAttrib=function(e,t,i,n){return null==i&&(i=null),null==n&&(n=!1),this[e]=i&&i.length?i:[],this[e].name=t,this[e].dirty=!0,this[e].dynamic=n,this.attribs[e]=this[e],this},e.prototype.addFaces=function(e,t){return null==e&&(e=null),null==t&&(t=!1),this.faces=e&&e.length?e:[],this.faces.dirty=!0,this.faces.dynamic=!1,this},e.prototype.addEdges=function(e,t){return null==e&&(e=null),null==t&&(t=!1),this.edges=e&&e.length?e:[],this.edges.dirty=!0,this.edges.dynamic=!1,this},e.prototype.addIndices=function(e,t){return null==e&&(e=null),null==t&&(t=!1),this.indices=e&&e.length?e:[],this.indices.dirty=!0,this.indices.dynamic=!1,this},e.prototype.isDirty=function(){var e,t,i,n;i=!1,i||(i=this.faces&&this.faces.dirty),i||(i=this.edges&&this.edges.dirty),n=this.attribs;for(t in n)e=n[t],i||(i=e.dirty);return i},e.prototype.addEdge=function(e,t){var n,r;return this.edges||this.addEdges(),this.edgeHash||(this.edgeHash=[]),n=e+"_"+t,r=t+"_"+e,this.edgeHash[n]||this.edgeHash[r]?void 0:(this.edges.push(new i(e,t)),this.edgeHash[n]=this.edgeHash[r]=!0)},e.prototype.computeEdges=function(){var e,t,i,o,s,a,h,c,l,u,p,f;if(this.edges?this.edges.length=0:this.edges=[],this.faces&&this.faces.length){for(l=this.faces,p=[],a=0,c=l.length;c>a;a++)o=l[a],o instanceof n&&(this.addEdge(o.a,o.b),this.addEdge(o.b,o.c),this.addEdge(o.c,o.a)),o instanceof r?(this.addEdge(o.a,o.b),this.addEdge(o.b,o.c),this.addEdge(o.c,o.d),p.push(this.addEdge(o.d,o.a))):p.push(void 0);return p}for(f=[],s=h=0,u=this.vertices.length-1;u>=h;s=h+=3)e=s,t=s+1,i=s+2,this.addEdge(e,t),this.addEdge(t,i),f.push(this.addEdge(i,e));return f},e.prototype.computeSmoothNormals=function(){var e;if(!this.faces)throw"Geometry.computeSmoothNormals no faces found";return this.normals||this.addAttrib("normals","normal",null,!1),e=[],this.vertices.forEach(function(t){return function(i,n){return t.normals.push(new h(0,0,0)),e[n]=0}}(this)),this.faces.forEach(function(t){return function(i){var n,r,o,a,c,l;return n=t.vertices[i.a],a=t.vertices[i.b],c=t.vertices[i.c],r=s.getTempVec3("ab").asSub(a,n).normalize(),o=s.getTempVec3("ac").asSub(c,n).normalize(),l=h.create().asCross(r,o),t.normals[i.a].add(l),e[i.a]++,t.normals[i.b].add(l),e[i.b]++,t.normals[i.c].add(l),e[i.c]++}}(this)),this.normals.forEach(function(t,i){return t.scale(1/e[i])})},e}()})}.call(this),function(){define("pex/geom/GeometryOperations",["require","pex/geom/Face3","pex/geom/Face4","pex/geom/Edge","pex/geom/Geometry"],function(e){var t,i,n,r;return i=e("pex/geom/Face3"),n=e("pex/geom/Face4"),t=e("pex/geom/Edge"),r=e("pex/geom/Geometry"),r.prototype.translate=function(e){return this.vertices.forEach(function(t){return t.add(e)}),this},r.prototype.scale=function(e){return this.vertices.forEach(function(t){return t.scale(e)}),this},r.prototype.rotate=function(e){return this.vertices.forEach(function(t){return t.transformQuat(e)}),this},r.merge=function(e,o){var s,a,h,c,l,u,p,f,d,g,m,x,v,y,w,b,E,M,S,C,P,z,T,k,F,R,_,V,A,O,q,L,j,B,D,N,H,U,I,G,W,X,Y;if(v=e.vertices.concat(o.vertices).map(function(e){return e.dup()}),p=new r({vertices:v}),x=e.vertices.length,e.faces&&o.faces){for(u=[],B=e.faces,y=0,M=B.length;M>y;y++)l=B[y],l instanceof i&&u.push(new i(l.a,l.b,l.c)),l instanceof n&&u.push(new n(l.a,l.b,l.c,l.d));for(D=o.faces,w=0,S=D.length;S>w;w++)l=D[w],l instanceof i&&u.push(new i(l.a+x,l.b+x,l.c+x)),l instanceof n&&u.push(new n(l.a+x,l.b+x,l.c+x,l.d+x));p.faces=u}if(e.edges&&o.edges){for(c=[],N=e.edges,b=0,C=N.length;C>b;b++)h=N[b],c.push(new t(h.a,h.b));for(H=o.edges,E=0,P=H.length;P>E;E++)h=H[E],c.push(new t(h.a+x,h.b+x));p.edges=c}if(e.normals&&o.normals){for(d=[],U=e.normals,V=0,z=U.length;z>V;V++)f=U[V],d.push(f.dup());for(I=o.normals,A=0,T=I.length;T>A;A++)f=I[A],d.push(f.dup());p.addAttrib("normals","normal",d)}if(e.texCoords&&o.texCoords){for(m=[],G=e.texCoords,O=0,k=G.length;k>O;O++)g=G[O],m.push(g.dup());for(W=o.texCoords,q=0,F=W.length;F>q;q++)g=W[q],m.push(g.dup());p.addAttrib("texCoords","texCoord",m)}if(e.colors&&o.colors){for(a=[],X=e.colors,L=0,R=X.length;R>L;L++)s=X[L],a.push(s.dup());for(Y=o.colors,j=0,_=Y.length;_>j;j++)s=Y[j],a.push(s.dup());p.addAttrib("colors","color",a)}return p},r})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};define("pex/geom/gen/Cube",["require","pex/geom/Vec2","pex/geom/Vec3","pex/geom/Face4","pex/geom/Geometry"],function(e){var i,n,r,o,s;return o=e("pex/geom/Vec2"),s=e("pex/geom/Vec3"),n=e("pex/geom/Face4"),r=e("pex/geom/Geometry"),i=function(e){function i(e,t,r,a,h,c){var l,u,p;e=null!=e?e:1,t=null!=t?t:null!=e?e:1,r=null!=r?r:null!=e?e:1,a=a||1,h=h||1,c=c||1,u=(a+1)*(h+1)*2+(a+1)*(c+1)*2+(c+1)*(h+1)*2,i.__super__.constructor.call(this,{vertices:!0,normals:!0,texCoords:!0,faces:!0}),p=0,l=function(e){return function(t,i,r,a,h,c,l,u,f,d){var g,m,x,v,y,w,b,E,M,S,C,P,z;for(E=p,x=M=0;l>=0?l>=M:M>=l;x=l>=0?++M:--M)for(m=S=0;c>=0?c>=S:S>=c;m=c>=0?++S:--S)b=e.vertices[p]=s.create(),b[t]=(-a/2+m*a/c)*f,b[i]=(-h/2+x*h/l)*d,b[r]=u,y=e.normals[p]=s.create(),y[t]=0,y[i]=0,y[r]=u/Math.abs(u),w=e.texCoords[p]=o.create(),w.x=m/c,w.y=1-x/l,++p;for(z=[],x=C=0,P=l-1;P>=0?P>=C:C>=P;x=P>=0?++C:--C)z.push(function(){var e,t,i;for(i=[],m=e=0,t=c-1;t>=0?t>=e:e>=t;m=t>=0?++e:--e)v=E+x*(c+1)+m,g=new n(v,v+c+1,v+c+2,v+1),i.push(this.faces.push(g));return i}.call(e));return z}}(this),l("x","y","z",e,t,a,h,r/2,1,-1),l("x","y","z",e,t,a,h,-r/2,-1,-1),l("z","y","x",r,t,c,h,-e/2,1,-1),l("z","y","x",r,t,c,h,e/2,-1,-1),l("x","z","y",e,r,a,c,t/2,1,1),l("x","z","y",e,r,a,c,-t/2,1,-1)}return t(i,e),i}(r)})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};define("pex/geom/gen/Sphere",["require","pex/geom/Vec2","pex/geom/Vec3","pex/geom/Face3","pex/geom/Face4","pex/geom/Geometry"],function(e){var i,n,r,o,s,a;return s=e("pex/geom/Vec2"),a=e("pex/geom/Vec3"),i=e("pex/geom/Face3"),n=e("pex/geom/Face4"),r=e("pex/geom/Geometry"),o=function(e){function n(e,t,r){var o,h,c,l,u,p,f,d,g,m,x,v,y,w,b;for(null==e&&(e=.5),null==t&&(t=36),null==r&&(r=18),p=(t+1)*(r+1),y=0,n.__super__.constructor.call(this,{vertices:!0,normals:!0,texCoords:!0,faces:!0}),o=1/180*Math.PI,c=180/r,h=360/t,l=function(t,i,n){return t.x=e*Math.sin(i*o)*Math.sin(n*o),t.y=e*Math.cos(i*o),t.z=e*Math.sin(i*o)*Math.cos(n*o)},x=0,d=0,d=w=0;r>=0?r>=w:w>=r;d=r>=0?++w:--w)for(x=d*c,g=b=0;t>=0?t>=b:b>=t;g=t>=0?++b:--b)f=g*h,v=this.vertices[y]=a.create(),u=this.normals[y]=a.create(),m=this.texCoords[y]=s.create(),l(v,x,f),u.copy(v).normalize(),m.set(f/360,x/180),++y,d!==r&&g!==t&&(r-1>d&&this.faces.push(new i(d*(t+1)+g,(d+1)*(t+1)+g,(d+1)*(t+1)+g+1)),d>0&&this.faces.push(new i(d*(t+1)+g,(d+1)*(t+1)+g+1,d*(t+1)+g+1)))}return t(n,e),n}(r)})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};define("pex/geom/gen/LineBuilder",["require","pex/geom/Vec3","pex/geom/Edge","pex/color/Color","pex/geom/Geometry"],function(e){var i,n,r,o,s;return s=e("pex/geom/Vec3"),n=e("pex/geom/Edge"),i=e("pex/color/Color"),r=e("pex/geom/Geometry"),o=function(e){function n(){n.__super__.constructor.call(this,{vertices:!0,colors:!0})}return t(n,e),n.prototype.addLine=function(e,t,n,r){return n=n||i.White,r=r||n,this.vertices.push(s.create().copy(e)),this.vertices.push(s.create().copy(t)),this.colors.push(i.create().copy(n)),this.colors.push(i.create().copy(r)),this.vertices.dirty=!0,this.colors.dirty=!0},n.prototype.addCross=function(e,t,n){var r;return t=t||.1,r=t/2,n=n||i.White,this.vertices.push(s.create().set(e.x-r,e.y,e.z)),this.vertices.push(s.create().set(e.x+r,e.y,e.z)),this.vertices.push(s.create().set(e.x,e.y-r,e.z)),this.vertices.push(s.create().set(e.x,e.y+r,e.z)),this.vertices.push(s.create().set(e.x,e.y,e.z-r)),this.vertices.push(s.create().set(e.x,e.y,e.z+r)),this.colors.push(i.create().copy(n)),this.colors.push(i.create().copy(n)),this.colors.push(i.create().copy(n)),this.colors.push(i.create().copy(n)),this.colors.push(i.create().copy(n)),this.colors.push(i.create().copy(n))},n.prototype.reset=function(){return this.vertices.length=0,this.colors.length=0,this.vertices.dirty=!0,this.colors.dirty=!0},n}(r)})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};define("pex/geom/gen/Tetrahedron",["require","pex/geom/Vec3","pex/geom/Face3","pex/geom/Edge","pex/geom/Geometry"],function(e){var i,n,r,o,s;return s=e("pex/geom/Vec3"),n=e("pex/geom/Face3"),i=e("pex/geom/Edge"),r=e("pex/geom/Geometry"),o=function(e){function r(e){var t,o,a,h,c;null==e&&(e=1),a=Math.sqrt(3),h=Math.sqrt(6),c=[new s(a/3*e,-h/3*e*.333+.025*h,0),new s(-a/6*e,-h/3*e*.333+.025*h,e/2),new s(-a/6*e,-h/3*e*.333+.025*h,-e/2),new s(0,h/3*e*.666+.025*h,0)],o=[new n(0,1,2),new n(3,1,0),new n(3,0,2),new n(3,2,1)],t=[new i(0,1),new i(0,2),new i(0,3),new i(1,2),new i(1,3),new i(2,3)],r.__super__.constructor.call(this,{vertices:c,faces:o,edges:t})}return t(r,e),r}(r)})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};define("pex/geom/gen/Icosahedron",["require","pex/geom/Vec3","pex/geom/Face3","pex/geom/Edge","pex/geom/Geometry"],function(e){var i,n,r,o,s;return s=e("pex/geom/Vec3"),n=e("pex/geom/Face3"),i=e("pex/geom/Edge"),r=e("pex/geom/Geometry"),o=function(e){function r(e){var t,o,a,h,c,l;null==e&&(e=1),e=e||1,c=(1+Math.sqrt(5))/2,t=1*e/2,o=1*e/(2*c),l=[new s(0,o,-t),new s(o,t,0),new s(-o,t,0),new s(0,o,t),new s(0,-o,t),new s(-t,0,o),new s(t,0,o),new s(0,-o,-t),new s(t,0,-o),new s(-t,0,-o),new s(o,-t,0),new s(-o,-t,0)],h=[new n(1,0,2),new n(2,3,1),new n(4,3,5),new n(6,3,4),new n(7,0,8),new n(9,0,7),new n(10,4,11),new n(11,7,10),new n(5,2,9),new n(9,11,5),new n(8,1,6),new n(6,10,8),new n(5,3,2),new n(1,3,6),new n(2,0,9),new n(8,0,1),new n(9,7,11),new n(10,7,8),new n(11,4,5),new n(6,4,10)],a=[new i(0,1),new i(0,2),new i(0,7),new i(0,8),new i(0,9),new i(1,2),new i(1,3),new i(1,6),new i(1,8),new i(2,3),new i(2,5),new i(2,9),new i(3,4),new i(3,5),new i(3,6),new i(4,5),new i(4,6),new i(4,10),new i(4,11),new i(5,9),new i(5,11),new i(6,8),new i(6,10),new i(7,8),new i(7,9),new i(7,10),new i(7,11),new i(8,10),new i(9,11),new i(10,11)],r.__super__.constructor.call(this,{vertices:l,faces:h,edges:a})}return t(r,e),r}(r)})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};define("pex/geom/gen/Octahedron",["require","pex/geom/Vec3","pex/geom/Face3","pex/geom/Edge","pex/geom/Geometry"],function(e){var i,n,r,o,s;return s=e("pex/geom/Vec3"),n=e("pex/geom/Face3"),i=e("pex/geom/Edge"),r=e("pex/geom/Geometry"),o=function(e){function r(e){var t,o,a,h,c,l,u;null==e&&(e=1),e=e||1,t=1*e/(2*Math.sqrt(2)),o=1*e/2,c=Math.sqrt(3),l=Math.sqrt(6),u=[new s(-t,0,t),new s(t,0,t),new s(t,0,-t),new s(-t,0,-t),new s(0,o,0),new s(0,-o,0)],h=[new n(3,0,4),new n(2,3,4),new n(1,2,4),new n(0,1,4),new n(3,2,5),new n(0,3,5),new n(2,1,5),new n(1,0,5)],a=[new i(0,1),new i(1,2),new i(2,3),new i(3,0),new i(0,4),new i(1,4),new i(2,4),new i(3,4),new i(0,5),new i(1,5),new i(2,5),new i(3,5)],r.__super__.constructor.call(this,{vertices:u,faces:h,edges:a})}return t(r,e),r}(r)})}.call(this),define("pex/geom/FacePolygon",[],function(){function e(e){this.numVertices=e.length;for(var t=["a","b","c","d","e","f","g","h","i","j"],i=0;i<e.length;i++)this[t[i]]=e[i]}return e}),function(){var e={}.hasOwnProperty,t=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};define("pex/geom/gen/Dodecahedron",["require","pex/geom/Vec3","pex/geom/FacePolygon","pex/geom/Edge","pex/geom/Geometry"],function(e){var i,n,r,o,s;return s=e("pex/geom/Vec3"),r=e("pex/geom/FacePolygon"),n=e("pex/geom/Edge"),o=e("pex/geom/Geometry"),i=function(e){function i(e){var t,o,a,h,c,l,u;null==e&&(e=1),l=(1+Math.sqrt(5))/2,t=.5*e,o=.5*e*1/l,a=.5*e*(2-l),u=[new s(a,0,t),new s(-a,0,t),new s(-o,o,o),new s(0,t,a),new s(o,o,o),new s(o,-o,o),new s(0,-t,a),new s(-o,-o,o),new s(a,0,-t),new s(-a,0,-t),new s(-o,-o,-o),new s(0,-t,-a),new s(o,-o,-o),new s(o,o,-o),new s(0,t,-a),new s(-o,o,-o),new s(t,a,0),new s(-t,a,0),new s(-t,-a,0),new s(t,-a,0)],c=[new r([4,3,2,1,0]),new r([7,6,5,0,1]),new r([12,11,10,9,8]),new r([15,14,13,8,9]),new r([14,3,4,16,13]),new r([3,14,15,17,2]),new r([11,6,7,18,10]),new r([6,11,12,19,5]),new r([4,0,5,19,16]),new r([12,8,13,16,19]),new r([15,9,10,18,17]),new r([7,1,2,17,18])],h=[new n(0,1),new n(0,4),new n(0,5),new n(1,2),new n(1,7),new n(2,3),new n(2,17),new n(3,4),new n(3,14),new n(4,16),new n(5,6),new n(5,19),new n(6,7),new n(6,11),new n(7,18),new n(8,9),new n(8,12),new n(8,13),new n(9,10),new n(9,15),new n(10,11),new n(10,18),new n(11,12),new n(12,19),new n(13,14),new n(13,16),new n(14,15),new n(15,17),new n(16,19),new n(17,18)],i.__super__.constructor.call(this,{vertices:u,faces:c,edges:h})}return t(i,e),i}(o)})}.call(this),define("pex/geom/hem/HEEdge",[],function(){function e(e,t,i,n){this.vert=e,this.pair=t,this.face=i,this.next=n,this.selected=0}return e.prototype.findPrev=function(){for(var e=this;e.next!=this;)e=e.next;return e},e}),define("pex/geom/hem/HEVertex",["pex/geom/Vec3"],function(e){function t(t,i,n,r){this.position=e.create(t,i,n),this.edge=r,this.selected=0}t.prototype.getNormal=function(){var t=[],i=this.edge;do t.push(i.face),i=i.pair.next;while(i!=this.edge);var n=e.create(0,0,0);for(var r in t)n.add(t[r].getNormal());return n.normalize(),n},t.prototype.forEachFace=function(e){var t=this.edge,i=t.face;do e(i),t=t.pair.next,i=t.face;while(t!=this.edge)},t.prototype.forEachEdge=function(e){var t=this.edge;do e(t),t=t.pair.next;while(t!=this.edge)},t.prototype.clearCaches=function(){this.edgesCache=null};var i=e.create();return t.prototype.forEachEdgeWithin=function(e,t){if(this.edgesCache)return void this.edgesCache.forEach(t);for(var n=[this.edge],r=0,o=e*e;r<n.length;){var s=n[r++],a=s;do{i.asSub(this.position,a.next.vert.position);var h=i.lengthSquared();-1==n.indexOf(a.next)&&o>h&&n.push(a.next),a=a.pair.next}while(a!=s)}n.shift(),n.forEach(t),this.edgesCache=n},t.prototype.getNeighbors=function(){var e=[];return this.forEachEdge(function(t){e.push(t.next.vert)}),e},t}),define("pex/geom/hem/HEFace",["pex/geom/Vec3"],function(e){function t(e){this.edge=e,this.selected=0,this.normal=null}return t.prototype.getNormal=function(){this.normal||(this.normal=e.create());var i=this.edge.vert.position,n=this.edge.next.vert.position,r=this.edge.next.next.vert.position,o=t.prototype.getNormal.ab=t.prototype.getNormal.ab||e.create(),s=t.prototype.getNormal.ac=t.prototype.getNormal.ac||e.create();return o.asSub(n,i),s.asSub(r,i),this.normal.asCross(o,s).normalize(),this.normal},t.prototype.getCenter=function(){this.center||(this.center=e.create()),this.center.set(0,0,0);var t=0,i=this.edge;do this.center.add(i.vert.position),t++,i=i.next;while(i!=this.edge);return this.center.scale(1/t),this.center},t.prototype.getAllVertices=function(){var e=[],t=this.edge;do e.push(t.vert),t=t.next;while(t!=this.edge);return e},t.prototype.edgePairLoop=function(e){var t=this.edge;do e(t,t.next),t=t.next;while(t!=this.edge)},t}),define("pex/geom/BoundingBox",["pex/geom/Vec3"],function(e){function t(e,t){this.min=e,this.max=t}return t.fromPositionSize=function(i,n){return new t(e.create(i.x-n.x/2,i.y-n.y/2,i.z-n.z/2),e.create(i.x+n.x/2,i.y+n.y/2,i.z+n.z/2))},t.fromPoints=function(e){var i=new t(e[0].clone(),e[0].clone());return e.forEach(i.addPoint.bind(i)),i},t.prototype.isEmpty=function(){return this.min&&this.max?!1:!0},t.prototype.addPoint=function(e){this.isEmpty()&&(this.min=e.clone(),this.max=e.clone()),e.x<this.min.x&&(this.min.x=e.x),e.y<this.min.y&&(this.min.y=e.y),e.z<this.min.z&&(this.min.z=e.z),e.x>this.max.x&&(this.max.x=e.x),e.y>this.max.y&&(this.max.y=e.y),e.z>this.max.z&&(this.max.z=e.z)},t.prototype.getSize=function(){return e.create(this.max.x-this.min.x,this.max.y-this.min.y,this.max.z-this.min.z)},t.prototype.getCenter=function(){return e.create(this.min.x+(this.max.x-this.min.x)/2,this.min.y+(this.max.y-this.min.y)/2,this.min.z+(this.max.z-this.min.z)/2)},t}),define("pex/geom/Octree",["pex/geom/Vec3"],function(e){function t(e,i,n){this.maxDistance=Math.max(i.x,Math.max(i.y,i.z)),this.accuracy="undefined"!=typeof n?n:this.maxDistance/1e5,this.root=new t.Cell(this,e,i,0)}return t.fromBoundingBox=function(e){return new t(e.min.clone(),e.getSize().clone())},t.MaxLevel=8,t.prototype.add=function(e){this.root.add(e)},t.prototype.has=function(e){return this.root.has(e)},t.prototype.findNearestPoint=function(e,t){return t=t||{},this.root.findNearestPoint(e,t)},t.prototype.getAllCellsAtLevel=function(e,t,i){return"undefined"==typeof t&&(t=e,e=this.root),i=i||[],e.level==t?(e.points.length>0&&i.push(e),i):(e.children.forEach(function(e){this.getAllCellsAtLevel(e,t,i)}.bind(this)),i)},t.Cell=function(e,t,i,n){this.tree=e,this.position=t,this.size=i,this.level=n,this.points=[],this.children=[]},t.Cell.prototype.has=function(e){if(!this.contains(e))return null;if(this.children.length>0){for(var t=0;t<this.children.length;t++){var i=this.children[t].has(e);if(i)return i}return null}for(var n=this.tree.accuracy*this.tree.accuracy,t=0;t<this.points.length;t++){var r=this.points[t],o=e.squareDistance(r);if(n>=o)return r}return null},t.Cell.prototype.add=function(e){this.points.push(e),this.children.length>0?this.addToChildren(e):this.points.length>1&&this.level<t.MaxLevel&&this.split()},t.Cell.prototype.addToChildren=function(e){for(var t=0;t<this.children.length;t++)if(this.children[t].contains(e)){this.children[t].add(e);break}},t.Cell.prototype.contains=function(e){return e.x>=this.position.x-this.tree.accuracy&&e.y>=this.position.y-this.tree.accuracy&&e.z>=this.position.z-this.tree.accuracy&&e.x<=this.position.x+this.size.x+this.tree.accuracy&&e.y<=this.position.y+this.size.y+this.tree.accuracy&&e.z<=this.position.z+this.size.z+this.tree.accuracy},t.Cell.prototype.split=function(){var i=this.position.x,n=this.position.y,r=this.position.z,o=this.size.x/2,s=this.size.y/2,a=this.size.z/2;this.children.push(new t.Cell(this.tree,e.create(i,n,r),e.create(o,s,a),this.level+1)),this.children.push(new t.Cell(this.tree,e.create(i+o,n,r),e.create(o,s,a),this.level+1)),this.children.push(new t.Cell(this.tree,e.create(i,n,r+a),e.create(o,s,a),this.level+1)),this.children.push(new t.Cell(this.tree,e.create(i+o,n,r+a),e.create(o,s,a),this.level+1)),this.children.push(new t.Cell(this.tree,e.create(i,n+s,r),e.create(o,s,a),this.level+1)),this.children.push(new t.Cell(this.tree,e.create(i+o,n+s,r),e.create(o,s,a),this.level+1)),this.children.push(new t.Cell(this.tree,e.create(i,n+s,r+a),e.create(o,s,a),this.level+1)),this.children.push(new t.Cell(this.tree,e.create(i+o,n+s,r+a),e.create(o,s,a),this.level+1));for(var h=0;h<this.points.length;h++)this.addToChildren(this.points[h])},t.Cell.prototype.findNearestPoint=function(e,t){var i=null;if(this.children.length>0)for(var n=0;n<this.children.length;n++){var r=this.children[n];if(r.points.length>0&&r.contains(e)&&(i=r.findNearestPoint(e,t)))break}if(!i&&this.points.length>0)for(var o=this.tree.maxDistance*this.tree.maxDistance,n=0;n<this.points.length;n++){var s=this.points[n].squareDistance(e);if(o>=s){if(0==s&&t.notSelf)continue;o=s,i=this.points[n]}}return i},t}),define("pex/geom/hem/HEMesh",["pex/geom/Vec3","pex/geom/hem/HEEdge","pex/geom/hem/HEVertex","pex/geom/hem/HEFace","pex/geom/BoundingBox","pex/geom/Octree"],function(e,t,i,n,r,o){function s(){this.vertices=[],this.faces=[],this.edges=[]}s.prototype.fixDuplicatedVertices=function(e){for(var t=r.fromPoints(this.vertices.map(function(e){return e.position})),i=o.fromBoundingBox(t),n=0;n<this.vertices.length;n++){var s=this.vertices[n],a=i.has(s.position);if(a){e&&console.log("HEMesh duplicated vert",s),this.vertices.splice(n,1),n--;for(var h=a.vertex,c=0;c<this.edges.length;c++)this.edges[c].vert==s&&(this.edges[c].vert=h)}else s.position.vertex=s,i.add(s.position)}return this},s.prototype.faceHash=function(e){var t=e.getAllVertices(),i=t.map(function(e){return this.vertices.indexOf(e)}.bind(this));i=i.sort();var n=i.join("_");return(i[0]==i[1]||i[1]==i[2])&&console.log(n),n},s.prototype.edgeHash=function(e){var t=this.vertices.indexOf(e.vert),i=this.vertices.indexOf(e.next.vert),n=t+"_"+i;return n},s.prototype.fixDuplicatedEdges=function(e){for(var t=[],i=0;i<this.edges.length;i++){var n=this.edges[i],r=this.edgeHash(n),o=t.indexOf(r),s=-1!==o;if(s){e&&console.log("HEMesh duplicated edge",r);var a=this.edges[o];this.edges.splice(i,1),i--,this.vertices.forEach(function(e){e.edge==n&&(e.edge=a)}),this.faces.forEach(function(e){e.edge==n&&(e.edge=a,e.edge.face=e)})}else t.push(r)}},s.prototype.fixVertexEdges=function(){this.vertices.forEach(function(e){e.edge=null});for(var e in this.edges){var t=this.edges[e];t.vert.edge=t}return this};return s.prototype.fixEdgePairs=function(){for(var e=0;e<this.edges.length;e++)this.edges[e].pair=null;for(var t={},e=0;e<this.vertices.length;e++)this.vertices[e].index=e;for(var e=0;e<this.edges.length;e++){var i=this.edges[e],n=i.vert.index+","+i.next.vert.index,r=i.next.vert.index+","+i.vert.index;t[n]=i,t[r]&&(i.pair=t[r],i.pair.pair=i)}for(var e=0;e<this.vertices.length;e++)this.vertices[e].index=-1;return this},s.prototype.check=function(){for(var e in this.vertices)null==this.vertices[e].edge?console.log("Missing vertex edge at ",e):this.vertices[e]!=this.vertices[e].edge.vert&&console.log("Edge doesn't point to it's vertex at ",e);for(var e in this.faces)null==this.faces[e].edge?console.log("Missing faces edge at ",e):this.faces[e]!=this.faces[e].edge.face&&console.log("Edge doesn't point to it's face at ",e),-1===this.edges.indexOf(this.faces[e].edge)&&console.log("Invalid face edge at ",e);for(var e in this.edges){var t=this.edges[e],i=t,n=0;t.next==t&&console.log("Edge refers to itself",e),t.next.vert==t.vert?console.log("Edge corner loop",e):null==t.pair?console.log("Edge doesn't have it's pair",e):t.pair.pair!=t&&console.log("Edge pair doesn't match",e,this.edges.indexOf(t),this.edges.indexOf(t.pair),this.edges.indexOf(t.pair.pair));do{if(++n>100){console.log("Edge watchDog break at",e," . Wrong edge loop pointers?");break}if(n>6&&console.log("Warning! Face with "+n+" vertices"),null==i.next){console.log("Missing edge next at ",e,". Open loop.");break}i=i.next}while(i!=t)}return this},s.prototype.splitVertex=function(e,n,r,o){var s=new i(n.x,n.y,n.z);if(this.vertices.push(s),null!=r&&r==o){var a=r,h=new t;h.vert=s,h.next=a.next,a.next=h,h.face=a.face,this.edges.push(h),s.edge=h;var c=r.pair,l=new t;return l.vert=s,l.next=c.next,c.next=l,l.face=c.face,this.edges.push(l),l.pair=a,a.pair=l,h.pair=c,c.pair=h,h}if(null==r&&null==o){var u=new t,p=new t,f=e.edge,d=f.findPrev();return u.vert=e,p.vert=s,u.face=f.face,p.face=f.face,u.next=p,p.next=f,u.pair=p,p.pair=u,e.edge=u,d.next=u,s.edge=p,this.edges.push(u),this.edges.push(p),u}},s.prototype.splitFace=function(e,i){var r=(e.next,i.next,e.findPrev()),o=i.findPrev(),s=e.face,a=new t,h=new t;this.edges.push(a),this.edges.push(h),a.pair=h,h.pair=a,a.vert=i.vert,h.vert=e.vert,a.next=e,o.next=a,h.next=i,r.next=h,a.face=e.face;var c=new n(h);this.faces.push(c);var l=h;do l.face=c,l=l.next;while(l!=h);return s.edge=e,s.color&&(c.color=s.color),c},s.prototype.splitEdge=function(t,i){i=i||.5;var n=e.create().asSub(t.next.vert.position,t.vert.position).scale(i).add(t.vert.position);return this.splitVertex(t.vert,n,t,t)},s.prototype.splitFaceAtPoint=function(e,t){var i=e.edge.vert,n=e.edge;i.edge=n;var r=this.splitVertex(i,t),o=r.next,s=o.next.next;do this.splitFace(o,s),o=s.findPrev(),s=o.next.next;while(s!=r);return r.next},s}),define("pex/utils/ArrayUtils",[],function(){function e(){}return e.range=function(e,t){for(var i=[],n=e;t>n;n++)i.push(n);return i},e.shuffled=function(t){var i,n=e.range(0,t.length);for(i=0;i<n.length;i++){var r=Math.floor(Math.random()*n.length),o=n[i];n[i]=n[r],n[r]=o}for(i=0;i<n.length;i++)n[i]=t[n[i]];return n},e.first=function(e,t){return t=t||1,e.slice(0,t)},e}),define("pex/geom/hem/HESelection",["pex/geom/hem/HEMesh","pex/utils/ArrayUtils"],function(e,t){function i(e){return e.selected}function n(){}return e.prototype.clearVerticesSelection=function(){for(var e=0;e<this.vertices.length;e++)this.vertices[e].selected=!1;return this},e.prototype.clearEdgeSelection=function(){for(var e=0;e<this.edges.length;e++)this.edges[e].selected=!1;return this},e.prototype.clearFaceSelection=function(){for(var e=0;e<this.faces.length;e++)this.faces[e].selected=!1;return this},e.prototype.clearSelection=function(){return this.clearVerticesSelection(),this.clearEdgeSelection(),this.clearFaceSelection(),this},e.prototype.selectRandomVertices=function(e){function i(e){n[e].selected=!0}e=void 0===e?this.vertices.length/2:e,e=Math.min(e,this.vertices.length),1>=e&&(e=Math.floor(e*this.vertices.length));var n=this.vertices;this.clearSelection();var r=t.range(0,this.vertices.length);return r=t.shuffled(r),r=t.first(r,e),r.forEach(i),this},e.prototype.selectRandomFaces=function(e){function i(e){n[e].selected=!0}e=void 0===e?this.faces.length/2:e,e=Math.min(e,this.faces.length),1>e&&(e=Math.floor(e*this.faces.length));var n=this.faces;this.clearSelection();var r=t.range(0,this.faces.length);return r=t.shuffled(r),r=t.first(r,e),r.forEach(i),this},e.prototype.selectAllFaces=function(){function e(e){e.selected=!0}return this.faces.forEach(e),this},e.prototype.selectFace=function(e){return e.selected=!0,this},e.prototype.expandVerticesSelectionToFaces=function(){return this.vertices.filter(i).forEach(function(e){e.forEachFace(function(e){e.selected=!0})}),this},e.prototype.expandFaceSelection=function(){function e(e){e.selected=!0}var t=[];return this.getSelectedFaces().forEach(function(e){e.getNeighborFaces().forEach(function(e){-1==t.indexOf(e)&&t.push(e)})}),t.forEach(e),this},e.prototype.getSelectedVertices=function(){return this.vertices.filter(i)},e.prototype.getSelectedFaces=function(){return this.faces.filter(i)},e.prototype.hasSelection=function(){var e=this.vertices.filter(i).length,t=this.edges.filter(i).length,n=this.faces.filter(i).length;return e+t+n>0},e.prototype.selectVerticesBy=function(e){return this.vertices.filter(e).forEach(function(e){e.selected=!0}),this},e.prototype.selectEdgesBy=function(e){return this.edges.filter(e).forEach(function(){edge.selected=!0}),this},e.prototype.selectFacesBy=function(e){return this.faces.filter(e).forEach(function(e){e.selected=!0}),this},n}),define("pex/geom/hem/HEMarking",["pex/geom/hem/HEMesh"],function(e){function t(){}function i(e){e.marked=!1}return e.prototype.clearMarking=function(){return this.vertices.forEach(i),this.edges.forEach(i),this.faces.forEach(i),this},t}),define("pex/geom/hem/HEGeometryConverter",["pex/geom/Vec3","pex/geom/Face3","pex/geom/Face4","pex/geom/FacePolygon","pex/geom/Geometry","pex/geom/hem/HEMesh","pex/geom/hem/HEVertex","pex/geom/hem/HEEdge","pex/geom/hem/HEFace","pex/geom/Edge","pex/geom/gen/LineBuilder","pex/color/Color"],function(e,t,i,n,r,o,s,a,h,c,l,u){function p(){}return o.prototype.fromGeometry=function(e){this.vertices.length=0,this.faces.length=0,this.edges.length=0;for(var r=e.vertices,o=0;o<r.length;o++){var c=r[o];this.vertices.push(new s(c.x,c.y,c.z))}var l=["a","b","c","d","e","f","g","h","i","j"],u=[null,null,null,null,null],p=3;if(e.faces&&e.faces.length>0)for(var o=0;o<e.faces.length;o++){var f=e.faces[o],d=new h;this.faces.push(d),f instanceof t&&(p=3),f instanceof i&&(p=4),f instanceof n&&(p=f.numVertices);for(var g=0;p>g;g++){u[g]=new a,this.edges.push(u[g]);var m=f[l[g]];u[g].vert=this.vertices[m],u[g].face=d}for(var x=0;p>x;x++)u[x].next=u[(x+1)%p];d.edge=u[0]}else for(var o=0;o<e.vertices.length;o+=3){var d=new h;this.faces.push(d);for(var p=3,g=0;p>g;g++){u[g]=new a,this.edges.push(u[g]);
var m=o+g;u[g].vert=this.vertices[m],u[g].face=d}for(var x=0;p>x;x++)u[x].next=u[(x+1)%p];d.edge=u[0]}return this.fixDuplicatedVertices(),this.fixDuplicatedEdges(),this.fixVertexEdges(),this.fixEdgePairs(),this.check(),this},o.prototype.toFlatGeometry=function(e,n){n="undefined"==typeof n?!1:n;var o=0,s=this.faces;n&&(s=this.getSelectedFaces());var a=!1;s.forEach(function(e){var t=e.getAllVertices().length;3==t?o+=3:4==t&&(o+=4),e.color&&(a=!0)}),e||(e=new r({vertices:!0,normals:!0,colors:a,faces:!0}));var h=e.vertices,c=e.normals,l=e.colors;c||(e.addAttrib("normals","normal"),c=e.normals),!l&&a&&(e.addAttrib("colors","color"),l=e.colors),e.vertices.dirty=!0,e.normals.dirty=!0,e.colors&&(e.colors.dirty=!0),e.faces.dirty=!0,e.faces.length=[];var p=0,f=[0,1,2,3];for(var d in s){var g=s[d],m=g.getAllVertices(),x=g.getNormal();if(3==m.length){for(var v=0;3>v;v++)if(h[p+v]?h[p+v].copy(m[v].position):h[p+v]=m[v].position.clone(),c[p+v]?c[p+v].copy(x):c[p+v]=x.clone(),a){var y=g.color||u.White;l[p+v]?l[p+v].copy(y):l[p+v]=y.clone()}e.faces.push(new t(p,p+1,p+2)),p+=3}else if(4==m.length){for(var v=0;4>v;v++)if(h[p+v]?h[p+v].copy(m[f[v]].position):h[p+v]=m[f[v]].position.clone(),c[p+v]?c[p+v].copy(x):c[p+v]=x.clone(),a){var y=g.color||u.White;l[p+v]?l[p+v].copy(y):l[p+v]=y.clone()}e.faces.push(new i(p,p+1,p+2,p+3)),p+=4}else console.log("HEGeometryConverter.thisToFlatGeometry: Unsupported face vertex count:"+m.length);h.length=p,c.length=p}return e},o.prototype.toSmoothGeometry=function(e){e||(e=new r({vertices:!0,normals:!0}));var t=e.vertices,i=e.normals;e.vertices.dirty=!0,e.normals.dirty=!0,e.faces.length=[];var n=0,o=[0,1,3,3,1,2];for(var s in this.faces){{var a=this.faces[s],h=a.getAllVertices();a.getNormal()}if(3==h.length){for(var c=0;3>c;c++)t[n+c]?t[n+c].copy(h[c].position):t[n+c]=h[c].position.clone(),i[n+c]?i[n+c].copy(h[c].getNormal()):i[n+c]=h[c].getNormal();n+=3}else if(4==h.length){for(var c=0;6>c;c++)t[n+c]?t[n+c].copy(h[o[c]].position):t[n+c]=h[o[c]].position.clone(),i[n+c]?i[n+c].copy(h[o[c]].getNormal()):i[n+c]=h[o[c]].getNormal();n+=6}else console.log("HEGeometryConverter.thisToFlatGeometry: Unsupported face vertex count:"+h.length);t.length=n,i.length=n}return e},o.prototype.toEdgesGeometry=function(t,i){t=void 0!==t?t:.1,i=void 0!==i?i:.001;var n=new l,r=e.create(),o=e.create();return this.edges.forEach(function(e){var s=e.face.getCenter(),a=e.face.getNormal().dup().scale(i);r.asSub(s,e.vert.position).normalize().scale(t).add(e.vert.position).add(a),o.asSub(s,e.next.vert.position).normalize().scale(t).add(e.next.vert.position).add(a),n.addLine(r,o)}),n},p}),define("pex/geom/hem/HEExtrude",["pex/geom/hem/HEMesh","pex/geom/hem/HEVertex","pex/geom/hem/HEEdge","pex/geom/hem/HEFace","pex/geom/Vec3"],function(e){function t(){}return e.prototype.extrude=function(e,t){e=e||.1;var i=(this.faces.length,this),n=this.faces,r=this.getSelectedFaces();return r.length>0&&(n=r),n.forEach(function(n,r){var o=t||n.getNormal(),s=n.edge,a=s.findPrev(),h=s,c=(n.getCenter(),[]);do{var l=o.clone().scale(e).add(h.vert.position);h.vert.edge=h;var u=i.splitVertex(h.vert,l);if(c.push(u),h==a)break;h=h.next}while(h!=s);for(var p=c[c.length-1].next,r=0;r<c.length;r++){{var f=c[r].next;i.splitFace(c[r].next,p)}p=f}}),this},t}),define("pex/geom/hem/HECatmullClark",["pex/geom/hem/HEMesh","pex/geom/hem/HEVertex","pex/geom/hem/HEEdge","pex/geom/hem/HEFace","pex/geom/Vec3"],function(e,t,i,n,r){function o(){}return e.prototype.catmullClark=function(){this.clearMarking();var e,t=this.faces.length,i=this.edges.length,n=this.vertices.length;for(e=0;t>e;e++)this.faces[e].facePoint=this.faces[e].getCenter();for(e=0;i>e;e++){var o=this.edges[e];if(null==o.edgePoint){var s=r.create();s.add(o.vert.position),s.add(o.next.vert.position),o.sharp?s.scale(.5):(s.add(o.face.facePoint),s.add(o.pair.face.facePoint),s.scale(.25)),o.edgePoint=s,o.pair.edgePoint=o.edgePoint}}for(e=0;n>e;e++){var a,h=this.vertices[e],c=h.edge,l=c.face,u=r.create(),p=r.create(),f=[],d=0,g=0;do u.add(l.facePoint),p.add(c.edgePoint),c.sharp&&(f.push(c),g++),++d,c=c.pair.next,l=c.face;while(c!=h.edge);if(!h.sharp&&2>g){u.scale(1/d),p.scale(1/d),a=r.create().asAdd(u,p);var m=h.position.clone().scale(d-2);a.add(m).scale(1/d)}else if(h.sharp||2!=g)a=h.position;else{a=r.create();for(var x=0;2>x;x++)a.add(f[x].vert==h?f[x].next.vert.position.dup().scale(1/8):f[x].findPrev().vert.position.dup().scale(1/8));a.add(h.position.dup().scale(.75))}h.position.copy(a)}var i=this.edges.length;for(e=0;i>e;e++){var o=this.edges[e];if(!o.marked){o.marked=!0,o.pair.marked=!0;var s=o.edgePoint;delete o.edgePoint,delete o.pair.edgePoint;var v=this.splitVertex(o.vert,s,o,o);o.sharp&&(v.sharp=!0,o.pair.sharp=!0),o.edgePointVertex=v.next.vert}}var t=this.faces.length;for(e=0;t>e;e++){var l=this.faces[e],y=l.edge.next.vert,o=l.edge.next;y.edge=o;var v=this.splitVertex(y,l.facePoint),w=v.next.next.next.next;do{{this.splitFace(v.next,w)}w=w.next.next}while(w!=v&&w.next!=v);delete l.faceVertex}return this.clearMarking(),this},e.prototype.subdivide=e.prototype.catmullClark,o}),define("pex/geom/hem/HETriangulate",["pex/geom/hem/HEMesh","pex/geom/hem/HEVertex","pex/geom/hem/HEEdge","pex/geom/hem/HEFace","pex/geom/Vec3"],function(e){function t(){}return e.prototype.triangulate=function(){var e=this.faces.length;for(i=0;e>i;i++)for(var t=this.faces[i],n=t.getAllVertices();n.length>3;){var r=t.edge;t=this.splitFace(r,r.next.next),n=t.getAllVertices()}return this},t}),define("pex/geom/hem/HESubdivideTriangles",["pex/geom/hem/HEMesh","pex/geom/hem/HEVertex","pex/geom/hem/HEEdge","pex/geom/hem/HEFace","pex/geom/Vec3"],function(e){function t(){}return e.prototype.subdivideTriangles=function(){this.clearMarking();{var e,t,i=this.faces.length,n=this.edges.length;this.vertices.length}for(e=0;n>e;e++)t=this.edges[e],t.marked||(t.marked=!0,t.pair.marked=!0,this.splitEdge(t,.5));for(e=0;i>e;e++){var r=this.faces[e],o=r.edge,s=o.next.next,a=s.next.next;this.splitFace(o.next,a.next),s=o.next.pair.next,this.splitFace(s,s.next.next),a=s.next.next.pair.next,this.splitFace(a,a.next.next)}return this.clearMarking(),this},t}),define("pex/geom/hem/HESubdivideFaceCenter",["pex/geom/hem/HEMesh","pex/geom/hem/HEVertex","pex/geom/hem/HEEdge","pex/geom/hem/HEFace","pex/geom/Vec3"],function(e){function t(){}return e.prototype.subdivideFaceCenter=function(){var e=[],t=this.faces,i=this.getSelectedFaces();return i.length>0&&(t=i),t.forEach(function(t){var i=this.splitFaceAtPoint(t,t.getCenter());e.push(i)}.bind(this)),this.clearSelection(),e.forEach(function(e){e.vert.selected=!0}),this},t}),define("pex/geom/hem/HEPull",["pex/geom/hem/HEMesh"],function(e){function t(){}return e.prototype.pull=function(e,t,i){i=i||0;var n=[];return this.getSelectedVertices().forEach(function(t,r){var o=e-e*Math.random()*i,s=t.getNormal();n[r]=s.dup().scale(o).add(t.position)}),this.getSelectedVertices().map(function(e,t){return e.position.x=n[t].x,e.position.y=n[t].y,e.position.z=n[t].z,n[t]}),this},t}),define("pex/geom/hem/HEDooSabin",["pex/geom/hem/HEMesh","pex/geom/hem/HEVertex","pex/geom/hem/HEEdge","pex/geom/hem/HEFace","pex/geom/Vec3"],function(e,t,i,n){function r(){}return e.prototype.smoothDooSabin=function(e){e&&(this.depth=e),this.clearMarking();var r,o=this.faces.length,s=this.edges.length,a=this.vertices.length;for(r=0;o>r;r++)this.faces[r].facePoint=this.faces[r].getCenter();for(r=0;s>r;r++){var h=this.edges[r];if(null==h.edgePoint){h.vert.position||console.log(h.vert);var c=h.vert.position.dup();c.add(h.next.vert.position),c.scale(.5),h.edgePoint=c,h.pair.edgePoint=h.edgePoint}}for(r=0;o>r;r++){var l=this.faces[r],h=l.edge;do{var u=h.vert.position,p=u.dup();if(p.add(l.facePoint),p.add(h.edgePoint),p.add(h.findPrev().edgePoint),p.scale(.25),this.depth){var f=p.dup().sub(u);f.normalize(),f.scale(this.depth),p=u.dup().add(f)}h.edgeFacePoint=new t(p.x,p.y,p.z),this.vertices.push(h.edgeFacePoint),h=h.next}while(h!=l.edge)}for(r=0;o>r;r++){var l=this.faces[r],h=l.edge,d=[];do{var g=new i(h.edgeFacePoint);g.face=l,d.push(g),this.edges.push(g),h=h.next}while(h!=l.edge);for(var m=0;m<d.length;m++)d[m].next=d[(m+1)%d.length];l.edge=d[0]}var x=0;for(r=0;s>r;r++){var h=this.edges[r];if(!h.marked){h.marked=!0,h.pair.marked=!0;var v=h.edgeFacePoint,y=h.next.edgeFacePoint,w=h.pair.edgeFacePoint,b=h.pair.next.edgeFacePoint,E=new i(v),M=new i(y),S=new i(w),C=new i(b);E.next=C,C.next=S,S.next=M,M.next=E;var P=new n(E);E.face=M.face=S.face=C.face=P,this.faces.push(P),this.edges.push(E),this.edges.push(M),this.edges.push(S),this.edges.push(C),E.face=P,C.face=P,S.face=P,M.face=P,x++}}for(var r=0;a>r;r++){var z=this.vertices[r],h=z.edge,T=null,k=null,F=new n;this.faces.push(F);do{var g=new i(h.edgeFacePoint);g.face=F,this.edges.push(g),k||(k=g,F.edge=g),T&&(g.next=T),T=g,h=h.pair.next}while(h!=z.edge);k.next=T}return this.vertices.splice(0,a),this.edges.splice(0,s),this.fixDuplicatedVertices(),this.fixVertexEdges(),this.fixEdgePairs(),this.check(),this},r}),define("pex/geom/hem",["pex/geom/hem/HEMesh","pex/geom/hem/HESelection","pex/geom/hem/HEMarking","pex/geom/hem/HEGeometryConverter","pex/geom/hem/HEExtrude","pex/geom/hem/HECatmullClark","pex/geom/hem/HETriangulate","pex/geom/hem/HESubdivideTriangles","pex/geom/hem/HESubdivideFaceCenter","pex/geom/hem/HEPull","pex/geom/hem/HEDooSabin"],function(e){return function(){return new e}}),function(){var e={}.hasOwnProperty,t=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};define("pex/geom/gen/HexSphere",["require","pex/geom/Vec3","pex/geom/FacePolygon","pex/geom/Edge","pex/geom/Geometry","pex/geom/gen/Icosahedron","pex/geom/hem"],function(e){var i,n,r,o,s,a,h;return a=e("pex/geom/Vec3"),n=e("pex/geom/FacePolygon"),i=e("pex/geom/Edge"),r=e("pex/geom/Geometry"),s=e("pex/geom/gen/Icosahedron"),h=e("pex/geom/hem"),o=function(e){function i(e,t){var r,o,c,l,u,p,f,d,g,m,x,v,y,w,b,E,M,S,C,P;for(null==e&&(e=1),null==t&&(t=2),r=new s(e),l=h().fromGeometry(r),u=v=0,C=t-1;C>=0?C>=v:v>=C;u=C>=0?++v:--v)l.subdivideTriangles();for(x=[],c=[],P=l.vertices,y=0,E=P.length;E>y;y++){for(g=P[y],m=x.length,p=[],g.forEachEdge(function(e){return p.push(e.face.getCenter())}),o=new a(0,0,0),w=0,M=p.length;M>w;w++)f=p[w],o.add(f);o.scale(1/p.length),x=x.concat(p),5===p.length&&c.push(new n([m+4,m+3,m+2,m+1,m])),6===p.length&&c.push(new n([m+5,m+4,m+3,m+2,m+1,m]))}for(b=0,S=x.length;S>b;b++)d=x[b],d.normalize().scale(e/2);i.__super__.constructor.call(this,{vertices:x,faces:c})}return t(i,e),i}(r)})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};define("pex/geom/gen/Plane",["require","pex/geom/Vec2","pex/geom/Vec3","pex/geom/Face4","pex/geom/Edge","pex/geom/Geometry"],function(e){var i,n,r,o,s,a;return s=e("pex/geom/Vec2"),a=e("pex/geom/Vec3"),n=e("pex/geom/Face4"),i=e("pex/geom/Edge"),r=e("pex/geom/Geometry"),o=function(e){function r(e,t,o,h,c,l){var u,p,f,d,g,m,x,v,y,w,b,E,M,S,C,P,z;for(e=e||1,t=t||e||1,o=o||1,h=h||o||1,c=c||"x",l=l||"y",M=["x","y","z"],M.splice(M.indexOf(c),1),M.splice(M.indexOf(l),1),M=M[0],E=[],w=[],v=[],f=[],u=[],g=S=0;h>=0?h>=S:S>=h;g=h>=0?++S:--S)for(d=C=0;o>=0?o>=C:C>=o;d=o>=0?++C:--C)b=new a,b[c]=-e/2+d*e/o,b[l]=-t/2+g*t/h,b[M]=0,E.push(b),y=new s(d/o,1-g/h),w.push(y),x=new a,x[c]=0,x[l]=0,x[M]=1,v.push(x);for(g=P=0;h>=0?h>=P:P>=h;g=h>=0?++P:--P)for(d=z=0;o>=0?o>=z:z>=o;d=o>=0?++z:--z)m=g*(o+1)+d,h>g&&o>d&&(p=new n(m,m+o+1,m+o+2,m+1)),u.push(new i(m,m+1)),u.push(new i(m,m+o+1)),g===h-1&&u.push(new i(m+o+1,m+o+2)),d===o-1&&u.push(new i(m+1,m+o+2)),f.push(p);r.__super__.constructor.call(this,{vertices:E,normals:v,texCoords:w,faces:f,edges:u})}return t(r,e),r}(r)})}.call(this),function(){define("pex/geom/gen",["require","pex/geom/gen/Cube","pex/geom/gen/Sphere","pex/geom/gen/LineBuilder","pex/geom/gen/Tetrahedron","pex/geom/gen/Icosahedron","pex/geom/gen/Octahedron","pex/geom/gen/Dodecahedron","pex/geom/gen/HexSphere","pex/geom/gen/Plane"],function(e){var t;return t={Cube:e("pex/geom/gen/Cube"),Sphere:e("pex/geom/gen/Sphere"),LineBuilder:e("pex/geom/gen/LineBuilder"),Tetrahedron:e("pex/geom/gen/Tetrahedron"),Icosahedron:e("pex/geom/gen/Icosahedron"),Octahedron:e("pex/geom/gen/Octahedron"),Dodecahedron:e("pex/geom/gen/Dodecahedron"),HexSphere:e("pex/geom/gen/HexSphere"),Plane:e("pex/geom/gen/Plane")}})}.call(this),function(){define("pex/geom/Line2D",["require","pex/geom/Vec2"],function(e){var t,i;return i=e("pex/geom/Vec2"),t=function(){function e(e,t){this.a=e,this.b=t}return e.prototype.isPointOnTheLeftSide=function(e){return(this.b.x-this.a.x)*(e.y-this.a.y)-(this.b.y-this.a.y)*(e.x-this.a.x)<=0},e.prototype.projectPoint=function(e){var t,n,r;return t=i.create().asSub(this.b,this.a).normalize(),n=i.create().asSub(e,this.a),r=t.dot(n),t.scale(r).add(this.a)},e.prototype.distanceToPoint=function(e){return this.projectPoint(e).distance(e)},e.prototype.intersect=function(e){var t,n,r,o,s,a,h,c,l,u,p,f,d;return l=1e-6,o=this.a,t=i.create().asSub(this.b,this.a),s=e.a,n=i.create().asSub(e.b,e.a),r=i.create().asSub(s,o),a=t.x*n.y-t.y*n.x,u=a*a,p=t.x*t.x+t.y*t.y,f=n.x*n.x+n.y*n.y,u>l*p*f?(c=(r.x*n.y-r.y*n.x)/a,h=i.create().copy(t).scale(c).add(o)):(d=r.x*r.x+r.y*r.y,a=r.x*t.y-r.y*t.x,u=a*a,u>l*p*d?null:null)},e}()})}.call(this),define("pex/geom/Rect",[],function(){function e(e,t,i,n){this.x=e,this.y=t,this.width=i,this.height=n}return e.prototype.set=function(e,t,i,n){this.x=e,this.y=t,this.width=i,this.height=n},e.prototype.contains=function(e){return e.x>=this.x&&e.x<=this.x+this.width&&e.y>=this.y&&e.y<=this.y+this.height},e}),define("pex/geom/Triangle2D",["pex/geom/Line2D"],function(){function e(e,t,i){return(e.x-i.x)*(t.y-i.y)-(t.x-i.x)*(e.y-i.y)}function t(e,t,i){this.a=e,this.b=t,this.c=i}return t.prototype.contains=function(t){var i=e(this.a,this.b,t)<0,n=e(this.b,this.c,t)<0,r=e(this.c,this.a,t)<0;return i==n&&n==r},t}),define("pex/geom/Polygon2D",["pex/geom/Line2D","pex/geom/Vec2"],function(e,t){function i(e){for(var t=0,i=e.length,n=0;i>n;n++){var r=e[n],o=e[(n+1)%i];t+=r.x*o.y-r.y*o.x}return.5*t}function n(e){this.vertices=e||[],this.center=t.create()}return n.prototype.getArea=function(){return Math.abs(i(this.vertices))},n.prototype.isClockwise=function(){return i(this.vertices)>0},n.prototype.flipVertexOrder=function(){this.vertices.reverse()},n.prototype.getCenter=function(){this.center.x=0,this.center.y=0;for(var e=0;e<this.vertices.length;e++)this.center.x+=this.vertices[e].x,this.center.y+=this.vertices[e].y;return this.center.x/=this.vertices.length,this.center.y/=this.vertices.length,this.center},n.prototype.clip=function(){for(var t=[],i=this.vertices,r=clippingPolygon2D.vertices.length,o=0;r>o;o++){for(var s=new e(clippingPolygon2D.vertices[o],clippingPolygon2D.vertices[(o+1)%r]),a=0;a<i.length;a++){var h=i[(a-1+i.length)%i.length],c=i[a],l=s.isPointOnTheLeftSide(h),u=s.isPointOnTheLeftSide(c);if(l&&u)t.push(c),prevStart=c;else if(l&&!u)p=s.intersect(new e(h,c)),t.push(p);else if(l||u){if(!l&&u){var p=s.intersect(new e(h,c));t.push(p),t.push(c)}}else prevStart=null}i=t,t=[]}return new n(i)},n.prototype.clipToLine=function(t){for(var i=[],r=this.vertices,o=t,s=0;s<r.length;s++){var a=r[(s-1+r.length)%r.length],h=r[s],c=o.isPointOnTheLeftSide(a),l=o.isPointOnTheLeftSide(h);if(c&&l)i.push(h),prevStart=h;else if(c&&!l)u=o.intersect(new e(a,h)),i.push(u);else if(c||l){if(!c&&l){var u=o.intersect(new e(a,h));i.push(u),i.push(h)}}else prevStart=null}return r=i,new n(r)},n}),define("pex/geom/Spline3D",["pex/geom/Vec3"],function(e){function t(e,t){this.points=e||[],this.dirtyLength=!0,this.loop=t||!1,this.samplesCount=100}return t.prototype.getPoint=function(t){t=this.loop?(t+1)%1:Math.max(0,Math.min(t,1));var i,n,r,o,s=this.points,a=this.loop?s.length:s.length-1,h=t*a,c=Math.floor(h),l=h-c;this.loop?(i=(c-1+s.length)%s.length,n=c%s.length,r=(c+1)%s.length,o=(c+2)%s.length):(i=0==c?c:c-1,n=c,r=c>s.length-2?c:c+1,o=c>s.length-3?c:c+2);var u=new e;return u.x=this.interpolate(s[i].x,s[n].x,s[r].x,s[o].x,l),u.y=this.interpolate(s[i].y,s[n].y,s[r].y,s[o].y,l),u.z=this.interpolate(s[i].z,s[n].z,s[r].z,s[o].z,l),u},t.prototype.addPoint=function(e){this.dirtyLength=!0,this.points.push(e)},t.prototype.getPointAt=function(e){e=this.loop?(e+1)%1:Math.max(0,Math.min(e,1)),this.dirtyLength&&this.precalculateLength();for(var t=0,i=0;i<this.accumulatedLengthRatios.length;i++)if(this.accumulatedLengthRatios[i]>=e){t=this.accumulatedRatios[i];break}return this.getPoint(t)},t.prototype.getPointAtIndex=function(e){return e<this.points.length?this.points[e]:null},t.prototype.getNumPoints=function(){return this.points.length},t.prototype.getLength=function(){return this.dirtyLength&&this.precalculateLength(),this.length},t.prototype.precalculateLength=function(){var e=1/this.samplesCount,t=0,i=0;this.accumulatedRatios=[],this.accumulatedLengthRatios=[],this.accumulatedLengths=[];for(var n,r,o=0;o<this.samplesCount;o++){if(r=n,n=this.getPoint(t),o>0){var s=n.dup().sub(r).length();i+=s}this.accumulatedRatios.push(t),this.accumulatedLengths.push(i),t+=e}for(var o=0;o<this.samplesCount;o++)this.accumulatedLengthRatios.push(this.accumulatedLengths[o]/i);this.length=i,this.dirtyLength=!1},t.prototype.close=function(){this.loop=!0},t.prototype.isClosed=function(){return this.loop},t.prototype.interpolate=function(e,t,i,n,r){var o=.5*(i-e),s=.5*(n-t),a=r*r,h=r*a;return(2*t-2*i+o+s)*h+(-3*t+3*i-2*o-s)*a+o*r+t},t}),define("pex/geom/Ray",["pex/geom/Vec3"],function(e){function t(t,i){this.origin=t||new e(0,0,0),this.direction=i||new e(0,0,1)}return t.prototype.hitTestSphere=function(e,t){var i=[],n=this.direction,r=this.origin,o=r.dup().sub(e),s=n.dot(n);if(0==s)return i;var a=2*o.dot(n),h=o.dot(o)-t*t,c=Math.sqrt(a*a-4*s*h);if(isNaN(c))return i;var l=(-a-c)/(2*s),u=(-a+c)/(2*s);return i.push(r.dup().add(n.dup().scale(l))),l!=u&&i.push(r.dup().add(n.dup().scale(u))),i},t.prototype.hitTestPlane=function(e,t){if(0==this.direction.dot(t))return[];var i=t.dup().scale(-1).dot(this.origin.dup().sub(e))/this.direction.dot(t);return[this.origin.dup().add(this.direction.dup().scale(i))]},t.prototype.hitTestBoundingBox=function(t){function i(e,t,i,o,s){var a=r.hitTestPlane(e,i);if(a.length>0){var h=a[0];h[o]>e[o]-t[o]/2&&h[o]<e[o]+t[o]/2&&h[s]>e[s]-t[s]/2&&h[s]<e[s]+t[s]/2&&n.push(h)}}var n=[],r=this,o=t.getCenter(),s=t.getSize();return i(o.dup().add(new e(0,0,s.z/2)),s,new e(0,0,1),"x","y"),i(o.dup().add(new e(0,0,-s.z/2)),s,new e(0,0,-1),"x","y"),i(o.dup().add(new e(s.x/2,0,0)),s,new e(1,0,0),"y","z"),i(o.dup().add(new e(-s.x/2,0,0)),s,new e(-1,0,0),"y","z"),i(o.dup().add(new e(0,s.y/2,0)),s,new e(0,1,0),"x","z"),i(o.dup().add(new e(0,-s.y/2,0)),s,new e(0,-1,0),"x","z"),n.forEach(function(e){e._distance=e.distance(r.origin)}),n.sort(function(e,t){return e._distance-t._distance}),n.forEach(function(e){delete e._distance}),n.length>0&&(n=[n[0]]),n},t}),define("pex/geom",["pex/geom/Vec2","pex/geom/Vec3","pex/geom/Vec4","pex/geom/Mat4","pex/geom/Quat","pex/geom/Geometry","pex/geom/GeometryOperations","pex/geom/gen","pex/geom/Edge","pex/geom/Face3","pex/geom/Face4","pex/geom/FacePolygon","pex/geom/Line2D","pex/geom/Rect","pex/geom/Triangle2D","pex/geom/Polygon2D","pex/geom/hem","pex/geom/BoundingBox","pex/geom/Octree","pex/geom/Spline3D","pex/geom/Ray"],function(e,t,i,n,r,o,s,a,h,c,l,u,p,f,d,g,m,x,v,y,w){return{Vec2:e,Vec3:t,Vec4:i,Mat4:n,Quat:r,Geometry:o,GeometryOperations:s,gen:a,Edge:h,Face3:c,Face4:l,FacePolygon:u,Line2D:p,Rect:f,Triangle2D:d,Polygon2D:g,hem:m,BoundingBox:x,Octree:v,Spline3D:y,Ray:w}}),function(){define("pex/scene/PerspectiveCamera",["require","pex/geom"],function(e){var t,i,n,r,o,s,a;return a=e("pex/geom"),r=a.Vec2,o=a.Vec3,s=a.Vec4,t=a.Mat4,n=a.Ray,i=function(){function e(e,i,n,r,s,a,h){this.fov=e||60,this.aspectRatio=i||4/3,this.near=n||.1,this.far=r||100,this.position=s||o.create(0,0,5),this.target=a||o.create(0,0,0),this.up=h||o.create(0,1,0),this.projectionMatrix=t.create(),this.viewMatrix=t.create(),this.updateMatrices()}var i;return e.prototype.getFov=function(){return this.fov},e.prototype.getAspectRatio=function(){return this.aspectRatio},e.prototype.getNear=function(){return this.near},e.prototype.getFar=function(){return this.far},e.prototype.getPosition=function(){return this.position},e.prototype.getTarget=function(){return this.target},e.prototype.getUp=function(){return this.up},e.prototype.getViewMatrix=function(){return this.viewMatrix},e.prototype.getProjectionMatrix=function(){return this.projectionMatrix},e.prototype.setFov=function(e){return this.fov=e,this.updateMatrices()},e.prototype.setAspectRatio=function(e){return this.aspectRatio=e,this.updateMatrices()},e.prototype.setFar=function(e){return this.far=e,this.updateMatrices()},e.prototype.setNear=function(e){return this.near=e,this.updateMatrices()},e.prototype.setPosition=function(e){return this.position=e,this.updateMatrices()},e.prototype.setTarget=function(e){return this.target=e,this.updateMatrices()},e.prototype.setUp=function(e){return this.up=e,this.updateMatrices()},e.prototype.lookAt=function(e,t,i){return e&&(this.target=e),t&&(this.position=t),i&&(this.up=i),this.updateMatrices()},e.prototype.updateMatrices=function(){return this.projectionMatrix.identity().perspective(this.fov,this.aspectRatio,this.near,this.far),this.viewMatrix.identity().lookAt(this.position,this.target,this.up)},i=s.create(),e.prototype.getScreenPos=function(e,t,n){var o;return i.set(e.x,e.y,e.z,1),i.transformMat4(this.viewMatrix),i.transformMat4(this.projectionMatrix),o=r.create().set(i.x,i.y),o.x/=i.w,o.y/=i.w,o.x=.5*o.x+.5,o.y=.5*o.y+.5,o.x*=t,o.y*=n,o},e.prototype.getWorldRay=function(e,t,i,r){var s,a,h,c,l,u,p,f;return e=(e-i/2)/(i/2),t=-(t-r/2)/(r/2),s=2*Math.tan(this.getFov()/180*Math.PI/2)*this.getNear(),u=s*this.getAspectRatio(),e*=u/2,t*=s/2,h=new o(0,0,0),c=new o(e,t,-this.getNear()),a=this.getViewMatrix().dup().invert(),p=h.dup().transformMat4(a),f=c.dup().transformMat4(a),l=f.dup().sub(p),new n(p,l)},e}()})}.call(this),function(){define("pex/scene/Arcball",["require","pex/geom"],function(e){var t,i,n,r,o,s,a;return a=e("pex/geom"),r=a.Vec2,o=a.Vec3,s=a.Vec4,n=a.Quat,i=a.Mat4,t=function(){function e(e,t,i){this.distance=i||2,this.minDistance=i/2||.3,this.maxDistance=2*i||5,this.camera=t,this.window=e,this.radius=2*Math.min(e.width/2,e.height/2),this.center=r.create(e.width/2,e.height/2),this.currRot=n.create(),this.currRot.setAxisAngle(o.create(0,1,0),180),this.clickRot=n.create(),this.dragRot=n.create(),this.clickPos=o.create(),this.dragPos=o.create(),this.rotAxis=o.create(),this.allowZooming=!0,this.enabled=!0,this.updateCamera(),this.addEventHanlders()}return e.prototype.addEventHanlders=function(){return this.window.on("leftMouseDown",function(e){return function(t){return!t.handled&&e.enabled?e.down(t.x,e.window.height-t.y):void 0}}(this)),this.window.on("mouseDragged",function(e){return function(t){return!t.handled&&e.enabled?e.drag(t.x,e.window.height-t.y):void 0}}(this)),this.window.on("scrollWheel",function(e){return function(t){return!t.handled&&e.enabled&&e.allowZooming?(e.distance=Math.min(e.maxDistance,Math.max(e.distance+t.dy/100*(e.maxDistance-e.minDistance),e.minDistance)),e.updateCamera()):void 0}}(this))},e.prototype.mouseToSphere=function(e,t){var i,n;return n=o.create((e-this.center.x)/this.radius,-(t-this.center.y)/this.radius,0),i=n.x*n.x+n.y*n.y,i>1?n.normalize():n.z=Math.sqrt(1-i),n},e.prototype.down=function(e,t){return this.clickPos=this.mouseToSphere(e,t),this.clickRot.copy(this.currRot),this.updateCamera()},e.prototype.drag=function(e,t){var i;return this.dragPos=this.mouseToSphere(e,t),this.rotAxis.asCross(this.clickPos,this.dragPos),i=this.clickPos.dot(this.dragPos),this.dragRot.set(this.rotAxis.x,this.rotAxis.y,this.rotAxis.z,i),this.currRot.asMul(this.dragRot,this.clickRot),this.updateCamera()},e.prototype.updateCamera=function(){var e,t,i,n,r;return i=this.currRot.clone(),i.w*=-1,n=this.target||o.create(0,0,0),t=o.create(0,0,this.distance).transformQuat(i),e=o.create().asSub(n,t),r=o.create(0,1,0).transformQuat(i),this.camera.lookAt(n,e,r)},e.prototype.disableZoom=function(){return this.allowZooming=!1},e.prototype.setDistance=function(e){return this.distance=e||2,this.minDistance=e/2||.3,this.maxDistance=2*e||5,this.updateCamera()},e}()})}.call(this),define("pex/gl/Context",[],function(){function e(e){this.gl=e}return e.currentContext=new e(null),e}),define("pex/color",["pex/color/Color"],function(e){return{Color:e}}),function(){define("pex/gl/Buffer",["require","pex/gl/Context","pex/geom","pex/color"],function(e){var t,i,n,r,o,s,a,h,c,l,u;return n=e("pex/gl/Context"),u=e("pex/geom"),h=u.Vec2,c=u.Vec3,l=u.Vec4,r=u.Edge,o=u.Face3,s=u.Face4,a=u.FacePolygon,i=e("pex/color").Color,t=function(){function e(e,t,i,r){this.gl=n.currentContext.gl,this.target=e,this.type=t,this.usage=r||gl.STATIC_DRAW,this.dataBuf=null,i&&this.update(i,this.usage)}return e.prototype.dispose=function(){return this.gl.deleteBuffer(this.handle),this.handle=null},e.prototype.update=function(e,t){var n,u,p,f,d,g,m,x,v,y,w,b,E,M,S,C,P,z,T,k,F,R;if(this.handle||(this.handle=this.gl.createBuffer()),this.usage=t||this.usage,e&&0!==e.length){if(isNaN(e[0]))if(e[0]instanceof h)for(this.dataBuf&&this.dataBuf.length===2*e.length||(this.dataBuf=new this.type(2*e.length),this.elementSize=2),p=x=0,b=e.length;b>x;p=++x)g=e[p],this.dataBuf[2*p+0]=g.x,this.dataBuf[2*p+1]=g.y;else if(e[0]instanceof c)for(this.dataBuf&&this.dataBuf.length===3*e.length||(this.dataBuf=new this.type(3*e.length),this.elementSize=3),p=v=0,E=e.length;E>v;p=++v)g=e[p],this.dataBuf[3*p+0]=g.x,this.dataBuf[3*p+1]=g.y,this.dataBuf[3*p+2]=g.z;else if(e[0]instanceof l)for(this.dataBuf&&this.dataBuf.length===4*e.length||(this.dataBuf=new this.type(4*e.length),this.elementSize=4),p=y=0,M=e.length;M>y;p=++y)g=e[p],this.dataBuf[4*p+0]=g.x,this.dataBuf[4*p+1]=g.y,this.dataBuf[4*p+2]=g.z,this.dataBuf[4*p+3]=g.w;else if(e[0]instanceof i)for(this.dataBuf&&this.dataBuf.length===4*e.length||(this.dataBuf=new this.type(4*e.length),this.elementSize=4),p=T=0,S=e.length;S>T;p=++T)g=e[p],this.dataBuf[4*p+0]=g.r,this.dataBuf[4*p+1]=g.g,this.dataBuf[4*p+2]=g.b,this.dataBuf[4*p+3]=g.a;else if(e[0]instanceof r)for(this.dataBuf&&this.dataBuf.length===2*e.length||(this.dataBuf=new this.type(2*e.length),this.elementSize=1),p=k=0,C=e.length;C>k;p=++k)n=e[p],this.dataBuf[2*p+0]=n.a,this.dataBuf[2*p+1]=n.b;else if(e[0]instanceof o||e[0]instanceof s||e[0]instanceof a){for(d=0,F=0,P=e.length;P>F;F++)if(u=e[F],u instanceof o&&(d+=3),u instanceof s&&(d+=6),u instanceof a)throw"FacePolygons are not supported in RenderableGeometry Buffers";for(this.dataBuf&&this.dataBuf.length===d||(this.dataBuf=new this.type(d),this.elementSize=1),f=0,R=0,z=e.length;z>R;R++)u=e[R],u instanceof o&&(this.dataBuf[f+0]=u.a,this.dataBuf[f+1]=u.b,this.dataBuf[f+2]=u.c,f+=3),u instanceof s&&(this.dataBuf[f+0]=u.a,this.dataBuf[f+1]=u.b,this.dataBuf[f+2]=u.d,this.dataBuf[f+3]=u.d,this.dataBuf[f+4]=u.b,this.dataBuf[f+5]=u.c,f+=6)}else console.log("Buffer.unknown type",e.name,e[0]);else for(this.dataBuf&&this.dataBuf.length===e.length||(this.dataBuf=new this.type(e.length)),p=m=0,w=e.length;w>m;p=++m)g=e[p],this.dataBuf[p]=g,this.elementSize=1;return this.gl.bindBuffer(this.target,this.handle),this.gl.bufferData(this.target,this.dataBuf,this.usage)}},e}()})}.call(this),function(){define("pex/gl/RenderableGeometry",["require","pex/geom/Geometry","pex/gl/Context","pex/gl/Buffer"],function(e){var t,i,n,r;return n=e("pex/geom/Geometry"),i=e("pex/gl/Context"),t=e("pex/gl/Buffer"),r=["faces","edges","indices"],n.prototype.compile=function(){var e,n,o,s,a,h,c,l;null==this.gl&&(this.gl=i.currentContext.gl),c=this.attribs;for(n in c)e=c[n],e.buffer||(s=e.dynamic?this.gl.DYNAMIC_DRAW:this.gl.STATIC_DRAW,e.buffer=new t(this.gl.ARRAY_BUFFER,Float32Array,null,s),e.dirty=!0),e.dirty&&(e.buffer.update(e),e.dirty=!1);for(l=[],a=0,h=r.length;h>a;a++)o=r[a],this[o]?(this[o].buffer||(s=this[o].dynamic?this.gl.DYNAMIC_DRAW:this.gl.STATIC_DRAW,this[o].buffer=new t(this.gl.ELEMENT_ARRAY_BUFFER,Uint16Array,null,s),this[o].dirty=!0),this[o].dirty?(this[o].buffer.update(this[o]),l.push(this[o].dirty=!1)):l.push(void 0)):l.push(void 0);return l},n.prototype.dispose=function(){var e,t,i,n,o,s,a;s=this.attribs;for(t in s)e=s[t],e&&e.buffer&&e.buffer.dispose();for(a=[],n=0,o=r.length;o>n;n++)i=r[n],a.push(this[i]&&this[i].buffer?this[i].buffer.dispose():void 0);return a}})}.call(this),function(){define("pex/gl/Mesh",["require","pex/gl/Context","pex/geom","pex/gl/RenderableGeometry"],function(e){var t,i,n,r,o,s,a,h;return i=e("pex/gl/Context"),h=e("pex/geom"),a=h.Vec3,o=h.Quat,n=h.Mat4,t=h.BoundingBox,s=e("pex/gl/RenderableGeometry"),r=function(){function e(e,t,r){this.gl=i.currentContext.gl,this.geometry=e,this.material=t,r=r||{},this.primitiveType=r.primitiveType,null==this.primitiveType&&(this.primitiveType=this.gl.TRIANGLES),r.useEdges&&(this.primitiveType=this.gl.LINES),this.useEdges=r.useEdges,this.position=a.create(0,0,0),this.rotation=o.create(),this.scale=a.create(1,1,1),this.projectionMatrix=n.create(),this.viewMatrix=n.create(),this.modelWorldMatrix=n.create(),this.modelViewMatrix=n.create(),this.rotationMatrix=n.create(),this.normalMatrix=n.create()}return e.prototype.draw=function(e){var t;return this.geometry.isDirty()&&this.geometry.compile(),e&&(this.updateMatrices(e),this.updateMatricesUniforms(this.material)),this.material.use(),this.bindAttribs(),this.geometry.faces&&this.geometry.faces.length>0&&!this.useEdges?(this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.geometry.faces.buffer.handle),this.gl.drawElements(this.primitiveType,this.geometry.faces.buffer.dataBuf.length,this.gl.UNSIGNED_SHORT,0)):this.geometry.edges&&this.useEdges?(this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.geometry.edges.buffer.handle),this.gl.drawElements(this.primitiveType,this.geometry.edges.buffer.dataBuf.length,this.gl.UNSIGNED_SHORT,0)):this.geometry.vertices&&(t=this.geometry.vertices.length,this.gl.drawArrays(this.primitiveType,0,t)),this.unbindAttribs()},e.prototype.drawInstances=function(e,t){var i,n,r,o,s,a,h,c;if(this.geometry.isDirty()&&this.geometry.compile(),this.material.use(),this.bindAttribs(),this.geometry.faces&&this.geometry.faces.length>0&&!this.useEdges)for(this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.geometry.faces.buffer.handle),r=0,a=t.length;a>r;r++)i=t[r],e&&(this.updateMatrices(e,i),this.updateMatricesUniforms(this.material),this.updateUniforms(this.material,i),this.material.use()),this.gl.drawElements(this.primitiveType,this.geometry.faces.buffer.dataBuf.length,this.gl.UNSIGNED_SHORT,0);else if(this.geometry.edges&&this.useEdges)for(this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.geometry.edges.buffer.handle),o=0,h=t.length;h>o;o++)i=t[o],e&&(this.updateMatrices(e,i),this.updateMatricesUniforms(this.material),this.updateUniforms(this.material,i),this.material.use()),this.gl.drawElements(this.primitiveType,this.geometry.edges.buffer.dataBuf.length,this.gl.UNSIGNED_SHORT,0);else if(this.geometry.vertices)for(n=this.geometry.vertices.length,s=0,c=t.length;c>s;s++)i=t[s],e&&(this.updateMatrices(e,i),this.updateMatricesUniforms(this.material),this.updateUniforms(this.material,i),this.material.use()),this.gl.drawArrays(this.primitiveType,0,n);return this.unbindAttribs()},e.prototype.bindAttribs=function(){var e,t,i,n,r;i=this.material.program,n=this.geometry.attribs,r=[];for(t in n)e=n[t],e.location=this.gl.getAttribLocation(i.handle,e.name),e.location>=0?(this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e.buffer.handle),this.gl.vertexAttribPointer(e.location,e.buffer.elementSize,this.gl.FLOAT,!1,0,0),r.push(this.gl.enableVertexAttribArray(e.location))):r.push(void 0);return r},e.prototype.unbindAttribs=function(){var e,t,i,n;i=this.geometry.attribs,n=[];for(t in i)e=i[t],n.push(e.location>=0?this.gl.disableVertexAttribArray(e.location):void 0);
return n},e.prototype.resetAttribLocations=function(){var e,t,i;i=[];for(t in this.attributes)e=this.attributes[t],i.push(e.location=-1);return i},e.prototype.updateMatrices=function(e,t){var i,n,r;return i=t&&t.position?t.position:this.position,n=t&&t.rotation?t.rotation:this.rotation,r=t&&t.scale?t.scale:this.scale,n.toMat4(this.rotationMatrix),this.modelWorldMatrix.identity().translate(i.x,i.y,i.z).mul(this.rotationMatrix).scale(r.x,r.y,r.z),e?(this.projectionMatrix.copy(e.getProjectionMatrix()),this.viewMatrix.copy(e.getViewMatrix()),this.modelViewMatrix.copy(e.getViewMatrix()).mul(this.modelWorldMatrix),this.normalMatrix.copy(this.modelViewMatrix).invert().transpose()):void 0},e.prototype.updateUniforms=function(e,t){var i,n,r,o;r=t.uniforms,o=[];for(i in r)n=r[i],o.push(e.uniforms[i]=n);return o},e.prototype.updateMatricesUniforms=function(){var e,t;return t=this.material.program.uniforms,e=this.material.uniforms,t.projectionMatrix&&(e.projectionMatrix=this.projectionMatrix),t.viewMatrix&&(e.viewMatrix=this.viewMatrix),t.modelWorldMatrix&&(e.modelWorldMatrix=this.modelWorldMatrix),t.modelViewMatrix&&(e.modelViewMatrix=this.modelViewMatrix),t.normalMatrix?e.normalMatrix=this.normalMatrix:void 0},e.prototype.getMaterial=function(){return this.material},e.prototype.setMaterial=function(e){return this.material=e,this.resetAttribLocations()},e.prototype.getProgram=function(){return this.material.program},e.prototype.setProgram=function(e){return this.material.program=e,this.resetAttribLocations()},e.prototype.dispose=function(){return this.geometry.dispose()},e.prototype.getBoundingBox=function(){return this.boundingBox||this.updateBoundingBox(),this.boundingBox},e.prototype.updateBoundingBox=function(){return this.updateMatrices(),this.boundingBox=t.fromPoints(this.geometry.vertices.map(function(e){return function(t){return t.dup().transformMat4(e.modelWorldMatrix)}}(this)))},e}()})}.call(this),define("pex/materials/Material",["pex/gl/Context"],function(e){function t(t,i){this.gl=e.currentContext.gl,this.program=t,this.uniforms=i||{},this.prevUniforms={}}return t.prototype.use=function(){this.program.use();var e=0;for(var t in this.uniforms)if(this.program.uniforms[t])if(this.program.uniforms[t].type==this.gl.SAMPLER_2D||this.program.uniforms[t].type==this.gl.SAMPLER_CUBE)this.gl.activeTexture(this.gl.TEXTURE0+e),this.uniforms[t].width>0&&this.uniforms[t].height>0&&(this.gl.bindTexture(this.uniforms[t].target,this.uniforms[t].handle),this.program.uniforms[t](e)),e++;else{var i=this.uniforms[t],n=this.prevUniforms[t],r=null;if(null!==n)if(i.hash){if(r=i.hash(),r==n)continue}else if(i==n)continue;this.program.uniforms[t](this.uniforms[t]),this.prevUniforms[t]=r?r:i}},t}),define("pex/utils/Log",[],function(){function e(){}return e.message=function(e){void 0!==console&&console.log(e)},e.error=function(e){void 0!==console&&console.log("ERROR: "+e)},e}),define("pex/sys/Platform",[],function(){var e="undefined"==typeof window&&"object"==typeof process,t="object"==typeof window&&"object"==typeof document,i="object"==typeof ejecta&&"function"==typeof ejecta.include;return{isPlask:e,isBrowser:t,isEjecta:i}}),define("pex/sys/Node",["pex/sys/Platform"],function(e){var t="function"==typeof pexNodeRequire?pexNodeRequire:require;return{plask:e.isPlask?t("plask"):{},fs:e.isPlask?t("fs"):{},path:e.isPlask?t("path"):{}}}),define("pex/sys/IO",["pex/utils/Log","pex/sys/Node","pex/sys/Platform"],function(e,t){var i=function(){function e(){}return e.loadTextFile=function(i,n){var r=t.path.resolve(e.getWorkingDirectory(),i);if(!t.fs.existsSync(r)&&n)return n(null);var o=t.fs.readFileSync(r,"utf8");n&&n(o)},e.getWorkingDirectory=function(){return t.path.dirname(module.parent.filename)},e.loadImageData=function(i,n,r,o,s){var a=t.path.resolve(e.getWorkingDirectory(),o);i.activeTexture(i.TEXTURE0),i.bindTexture(n.target,n.handle);var h=t.plask.SkCanvas.createFromImage(a);i.texImage2DSkCanvas(r,0,h),s&&s(h)},e.watchTextFile=function(e,i){t.fs.watch(e,{},function(n){if("change"==n){var r=t.fs.readFileSync(e,"utf8");i&&i(r)}})},e.saveTextFile=function(e,i){t.fs.writeFileSync(e,i)},e},n=function(){function t(){}return t.getWorkingDirectory=function(){return""},t.loadTextFile=function(t,i){var n=new XMLHttpRequest;n.open("GET",t,!0),n.onreadystatechange=function(){4==n.readyState&&(200==n.status?i&&i(n.responseText):e.error("WebIO.loadTextFile error : "+n.statusText))},n.send(null)},t.loadImageData=function(e,t,i,n,r){var o=new Image;o.onload=function(){e.activeTexture(e.TEXTURE0),e.bindTexture(t.target,t.handle),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!0),e.texImage2D(i,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,o),r&&r(o)},o.src=n},t.watchTextFile=function(){console.log("Warning: WebIO.watch is not implemented!")},t.saveTextFile=function(t,i,n){var r=new XMLHttpRequest;r.open("POST",t,!0),r.onreadystatechange=function(){4==r.readyState&&(200==r.status?n&&n(r.responseText,r):e.error("WebIO.saveTextFile error : "+r.statusText))},r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.send("data="+encodeURIComponent(i))},t};return"undefined"!=typeof window?n():i()}),function(){define("pex/gl/Program",["require","pex/gl/Context","pex/sys/IO","pex/utils/Log"],function(e){var t,i,n,r,o,s;return t=e("pex/gl/Context"),i=e("pex/sys/IO"),n=e("pex/utils/Log"),s="#ifdef GL_ES\nprecision highp float;\n#endif\n#define VERT\n",o="#ifdef GL_ES\n#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n#else\n  precision mediump float;\n#endif\n#endif\n#define FRAG\n",r=function(){function e(e,i){this.gl=t.currentContext.gl,this.handle=this.gl.createProgram(),this.uniforms={},this.attributes={},this.addSources(e,i),this.ready=!1,this.vertShader&&this.fragShader&&this.link()}return e.currentProgram=null,e.prototype.addSources=function(e,t){return null==t&&(t=e),e&&this.addVertexSource(e),t?this.addFragmentSource(t):void 0},e.prototype.addVertexSource=function(e){if(this.vertShader=this.gl.createShader(this.gl.VERTEX_SHADER),this.gl.shaderSource(this.vertShader,s+e+"\n"),this.gl.compileShader(this.vertShader),!this.gl.getShaderParameter(this.vertShader,this.gl.COMPILE_STATUS))throw this.gl.getShaderInfoLog(this.vertShader)},e.prototype.addFragmentSource=function(e){if(this.fragShader=this.gl.createShader(this.gl.FRAGMENT_SHADER),this.gl.shaderSource(this.fragShader,o+e+"\n"),this.gl.compileShader(this.fragShader),!this.gl.getShaderParameter(this.fragShader,this.gl.COMPILE_STATUS))throw this.gl.getShaderInfoLog(this.fragShader)},e.prototype.link=function(){var t,i,n,r,o,s,a,h,c,l,u,p,f;if(this.gl.attachShader(this.handle,this.vertShader),this.gl.attachShader(this.handle,this.fragShader),this.gl.linkProgram(this.handle),!this.gl.getProgramParameter(this.handle,this.gl.LINK_STATUS))throw this.gl.getProgramInfoLog(handle);for(a=this.gl.getProgramParameter(this.handle,this.gl.ACTIVE_UNIFORMS),i=h=0,u=a-1;u>=0?u>=h:h>=u;i=u>=0?++h:--h)if(n=this.gl.getActiveUniform(this.handle,i),n.size>1)for(r=c=0,p=n.size-1;p>=0?p>=c:c>=p;r=p>=0?++c:--c)t=n.name.replace(/\[\d+\]/,"["+r+"]"),o=this.gl.getUniformLocation(this.handle,t),this.uniforms[t]=e.makeUniformSetter(this.gl,n.type,o);else o=this.gl.getUniformLocation(this.handle,n.name),this.uniforms[n.name]=e.makeUniformSetter(this.gl,n.type,o);for(s=this.gl.getProgramParameter(this.handle,this.gl.ACTIVE_ATTRIBUTES),i=l=0,f=s-1;f>=0?f>=l:l>=f;i=f>=0?++l:--l)n=this.gl.getActiveAttrib(this.handle,i),o=this.gl.getAttribLocation(this.handle,n.name),this.attributes[n.name]=o;return this.ready=!0,this},e.prototype.use=function(){return e.currentProgram!==this.handle?(e.currentProgram=this.handle,this.gl.useProgram(this.handle)):void 0},e.prototype.dispose=function(){return this.gl.deleteShader(this.vertShader),this.gl.deleteShader(this.fragShader),this.gl.deleteProgram(this.handle)},e.load=function(t,r,o){var s;return s=new e,i.loadTextFile(t,function(e){return n.message("Program.Compiling "+t),s.addSources(e),s.link(),r&&r(),o&&o.autoreload?i.watchTextFile(t,function(e){var i;try{return s.gl.detachShader(s.handle,s.vertShader),s.gl.detachShader(s.handle,s.fragShader),s.addSources(e),s.link()}catch(r){return i=r,n.message("Program.load : failed to reload "+t),n.message(i)}}):void 0}),s},e.makeUniformSetter=function(e,t,i){var n,r;switch(r=null,t){case e.BOOL:case e.INT:r=function(t){return e.uniform1i(i,t)};break;case e.SAMPLER_2D:case e.SAMPLER_CUBE:r=function(t){return e.uniform1i(i,t)};break;case e.FLOAT:r=function(t){return e.uniform1f(i,t)};break;case e.FLOAT_VEC2:r=function(t){return e.uniform2f(i,t.x,t.y)};break;case e.FLOAT_VEC3:r=function(t){return e.uniform3f(i,t.x,t.y,t.z)};break;case e.FLOAT_VEC4:r=function(t){return null!=t.r&&e.uniform4f(i,t.r,t.g,t.b,t.a),null!=t.x?e.uniform4f(i,t.x,t.y,t.z,t.w):void 0};break;case e.FLOAT_MAT4:n=new Float32Array(16),r=function(t){return n[0]=t.a11,n[1]=t.a21,n[2]=t.a31,n[3]=t.a41,n[4]=t.a12,n[5]=t.a22,n[6]=t.a32,n[7]=t.a42,n[8]=t.a13,n[9]=t.a23,n[10]=t.a33,n[11]=t.a43,n[12]=t.a14,n[13]=t.a24,n[14]=t.a34,n[15]=t.a44,e.uniformMatrix4fv(i,!1,n)}}return r?(r.type=t,r):function(){throw"Unknown uniform type: "+t}},e}()})}.call(this),define("pex/utils/ObjectUtils",[],function(){function e(){}return e.mergeObjects=function(e,t){var i,n={};if(e)for(i in e)n[i]=e[i];if(t)for(i in t)n[i]=t[i];return n},e.property=function(e,t){return function(i){return void 0!==t?(i[e]=t,i):i[e]}},e}),function(){var e=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],t=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,i=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,n="undefined"!=typeof location&&location.href,r=n&&location.protocol&&location.protocol.replace(/\:/,""),o=n&&location.hostname,s=n&&(location.port||void 0),a=[];define("lib/text",[],function(){var h,c,l;return"undefined"!=typeof window&&window.navigator&&window.document?c=function(e,t){var i=h.createXhr();i.open("GET",e,!0),i.onreadystatechange=function(){4===i.readyState&&t(i.responseText)},i.send(null)}:"undefined"!=typeof process&&process.versions&&process.versions.node?(l=require.nodeRequire("fs"),c=function(e,t){t(l.readFileSync(e,"utf8"))}):"undefined"!=typeof Packages&&(c=function(e,t){var i,n,r="utf-8",o=new java.io.File(e),s=java.lang.System.getProperty("line.separator"),a=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(o),r)),h="";try{for(i=new java.lang.StringBuffer,n=a.readLine(),n&&n.length()&&65279===n.charAt(0)&&(n=n.substring(1)),i.append(n);null!==(n=a.readLine());)i.append(s),i.append(n);h=String(i.toString())}finally{a.close()}t(h)}),h={version:"1.0.2",strip:function(e){if(e){e=e.replace(t,"");var n=e.match(i);n&&(e=n[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")},createXhr:function(){var t,i,n;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;for(i=0;3>i;i++){n=e[i];try{t=new ActiveXObject(n)}catch(r){}if(t){e=[n];break}}if(!t)throw new Error("createXhr(): XMLHttpRequest not available");return t},get:c,parseName:function(e){var t=!1,i=e.indexOf("."),n=e.substring(0,i),r=e.substring(i+1,e.length);return i=r.indexOf("!"),-1!==i&&(t=r.substring(i+1,r.length),t="strip"===t,r=r.substring(0,i)),{moduleName:n,ext:r,strip:t}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,t,i,n){var r,o,s,a=h.xdRegExp.exec(e);return a?(r=a[2],o=a[3],o=o.split(":"),s=o[1],o=o[0],!(r&&r!==t||o&&o!==i||(s||o)&&s!==n)):!0},finishLoad:function(e,t,i,n,r){i=t?h.strip(i):i,r.isBuild&&(a[e]=i),n(i)},load:function(e,t,i,a){if(a.isBuild&&!a.inlineText)return void i();var c=h.parseName(e),l=c.moduleName+"."+c.ext,u=t.toUrl(l),p=a&&a.text&&a.text.useXhr||h.useXhr;!n||p(u,r,o,s)?h.get(u,function(t){h.finishLoad(e,c.strip,t,i,a)}):t([l],function(e){h.finishLoad(c.moduleName+"."+c.ext,c.strip,e,i,a)})},write:function(e,t,i){if(t in a){var n=h.jsEscape(a[t]);i.asModule(e+"!"+t,"define(function () { return '"+n+"';});\n")}},writeFile:function(e,t,i,n,r){var o=h.parseName(t),s=o.moduleName+"."+o.ext,a=i.toUrl(o.moduleName+"."+o.ext)+".js";h.load(s,i,function(){var t=function(e){return n(a,e)};t.asModule=function(e,t){return n.asModule(e,a,t)},h.write(e,s,t,r)},r)}}})}(),define("lib/text!pex/materials/SolidColor.glsl",[],function(){return"#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform float pointSize;\nattribute vec3 position;\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  gl_PointSize = pointSize;\n}\n\n#endif\n\n#ifdef FRAG\n\nuniform vec4 color;\nuniform bool premultiplied;\n\nvoid main() {\n  gl_FragColor = color;\n  if (premultiplied) {\n    gl_FragColor.rgb *= color.a;\n  }\n}\n\n#endif\n"}),define("pex/materials/SolidColor",["pex/materials/Material","pex/gl/Context","pex/gl/Program","pex/color/Color","pex/utils/ObjectUtils","lib/text!pex/materials/SolidColor.glsl"],function(e,t,i,n,r,o){function s(s){this.gl=t.currentContext.gl;var a=new i(o),h={color:n.create(1,1,1,1),pointSize:1,premultiplied:0};s=r.mergeObjects(h,s),e.call(this,a,s)}return s.prototype=Object.create(e.prototype),s}),define("lib/text!pex/materials/ShowNormals.glsl",[],function(){return"#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform float pointSize;\nattribute vec3 position;\nattribute vec3 normal;\nvarying vec4 vColor;\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  gl_PointSize = pointSize;\n  vColor = vec4(normal * 0.5 + 0.5, 1.0);\n}\n\n#endif\n\n#ifdef FRAG\n\nvarying vec4 vColor;\n\nvoid main() {\n  gl_FragColor = vColor;\n}\n\n#endif\n"}),define("pex/materials/ShowNormals",["pex/materials/Material","pex/gl/Context","pex/gl/Program","pex/utils/ObjectUtils","lib/text!pex/materials/ShowNormals.glsl"],function(e,t,i,n,r){function o(o){this.gl=t.currentContext.gl;var s=new i(r),a={pointSize:1};o=n.mergeObjects(a,o),e.call(this,s,o)}return o.prototype=Object.create(e.prototype),o}),define("lib/text!pex/materials/Textured.glsl",[],function(){return"#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nattribute vec3 position;\nattribute vec2 texCoord;\nvarying vec2 vTexCoord;\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  vTexCoord = texCoord;\n}\n\n#endif\n\n#ifdef FRAG\n\nuniform sampler2D texture;\nvarying vec2 vTexCoord;\n\nvoid main() {\n  gl_FragColor = texture2D(texture, vTexCoord);\n}\n\n#endif\n"}),define("pex/materials/Textured",["pex/materials/Material","pex/gl/Context","pex/gl/Program","pex/geom/Vec4","pex/utils/ObjectUtils","lib/text!pex/materials/Textured.glsl"],function(e,t,i,n,r,o){function s(n){this.gl=t.currentContext.gl;var s=new i(o),a={};n=r.mergeObjects(a,n),e.call(this,s,n)}return s.prototype=Object.create(e.prototype),s}),define("lib/text!pex/materials/ShowTexCoords.glsl",[],function(){return"#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform float pointSize;\nattribute vec3 position;\nattribute vec2 texCoord;\nvarying vec4 vColor;\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  gl_PointSize = pointSize;\n  vColor = vec4(texCoord, 1.0, 1.0);\n}\n\n#endif\n\n#ifdef FRAG\n\nvarying vec4 vColor;\n\nvoid main() {\n  gl_FragColor = vColor;\n}\n\n#endif"}),define("pex/materials/ShowTexCoords",["pex/materials/Material","pex/gl/Context","pex/gl/Program","pex/utils/ObjectUtils","lib/text!pex/materials/ShowTexCoords.glsl"],function(e,t,i,n,r){function o(o){this.gl=t.currentContext.gl;var s=new i(r),a={pointSize:1};o=n.mergeObjects(a,o),e.call(this,s,o)}return o.prototype=Object.create(e.prototype),o}),define("lib/text!pex/materials/ShowDepth.glsl",[],function(){return"#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform float near;\nuniform float far;\nuniform vec4 farColor;\nuniform vec4 nearColor;\nattribute vec3 position;\nattribute vec3 normal;\nvarying vec4 vColor;\nvoid main() {\n  vec4 pos = modelViewMatrix * vec4(position, 1.0);\n  gl_Position = projectionMatrix * pos;\n  float depth = clamp((-pos.z - near) / (far - near), 0.0, 1.0);\n  vColor = mix(nearColor, farColor, depth);\n}\n\n#endif\n\n#ifdef FRAG\n\nvarying vec4 vColor;\n\nvoid main() {\n  gl_FragColor = vColor;\n}\n\n#endif\n"}),define("pex/materials/ShowDepth",["pex/materials/Material","pex/gl/Context","pex/gl/Program","pex/utils/ObjectUtils","pex/color/Color","lib/text!pex/materials/ShowDepth.glsl"],function(e,t,i,n,r,o){function s(s){this.gl=t.currentContext.gl;var a=new i(o),h={near:0,far:10,nearColor:r.create(0,0,0,1),farColor:r.create(1,1,1,1)};s=n.mergeObjects(h,s),e.call(this,a,s)}return s.prototype=Object.create(e.prototype),s}),define("lib/text!pex/materials/ShowColors.glsl",[],function(){return"#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform float pointSize;\nattribute vec3 position;\nattribute vec4 color;\nvarying vec4 vColor;\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  gl_PointSize = pointSize;\n  vColor = color;\n}\n\n#endif\n\n#ifdef FRAG\n\nvarying vec4 vColor;\n\nvoid main() {\n  gl_FragColor = vColor;\n}\n\n#endif\n"}),define("pex/materials/ShowColors",["pex/materials/Material","pex/gl/Context","pex/gl/Program","pex/utils/ObjectUtils","lib/text!pex/materials/ShowColors.glsl"],function(e,t,i,n,r){function o(o){this.gl=t.currentContext.gl;var s=new i(r),a={pointSize:1};o=n.mergeObjects(a,o),e.call(this,s,o)}return o.prototype=Object.create(e.prototype),o}),define("lib/text!pex/materials/ShowPositions.glsl",[],function(){return"#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 modelWorldMatrix;\nuniform float pointSize;\nattribute vec3 position;\nattribute vec3 normal;\nvarying vec4 vColor;\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  gl_PointSize = pointSize;\n  vColor = modelWorldMatrix * vec4(position, 1.0);\n  vColor.a = (modelViewMatrix * vec4(position, 1.0)).z;\n}\n\n#endif\n\n#ifdef FRAG\n\nvarying vec4 vColor;\n\nvoid main() {\n  gl_FragColor = vColor;\n}\n\n#endif\n"}),define("pex/materials/ShowPositions",["pex/materials/Material","pex/gl/Context","pex/gl/Program","pex/utils/ObjectUtils","lib/text!pex/materials/ShowPositions.glsl"],function(e,t,i,n,r){function o(o){this.gl=t.currentContext.gl;var s=new i(r),a={pointSize:1};o=n.mergeObjects(a,o),e.call(this,s,o)}return o.prototype=Object.create(e.prototype),o}),define("lib/text!pex/materials/PackDepth.glsl",[],function(){return"#ifdef VERT\n\nattribute vec4 position;\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform float near;\nuniform float far;\n\nvarying float depth;\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * position;\n\n  //linear depth in camera space (0..far)\n  depth = (modelViewMatrix * position).z/far;\n}\n#endif\n\n#ifdef FRAG\n\nuniform float near;\nuniform float far;\n\nvarying float depth;\n\n//from http://spidergl.org/example.php?id=6\nvec4 packDepth(const in float depth) {\n  const vec4 bit_shift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);\n  const vec4 bit_mask  = vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);\n  vec4 res = fract(depth * bit_shift);\n  res -= res.xxyz * bit_mask;\n  return res;\n}\n\nvoid main() {\n  gl_FragColor = packDepth(-depth);\n  gl_FragColor.r = 1.0;\n}\n\n#endif"}),define("pex/materials/PackDepth",["pex/gl/Context","pex/gl/Program","pex/materials/Material","pex/utils/ObjectUtils","lib/text!pex/materials/PackDepth.glsl"],function(e,t,i,n,r){function o(o){this.gl=e.currentContext.gl;var s=new t(r),a={near:.1,far:100};o=n.mergeObjects(a,o),i.call(this,s,o)}return o.prototype=Object.create(i.prototype),o}),define("lib/text!pex/materials/Diffuse.glsl",[],function(){return"#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 normalMatrix;\nuniform float pointSize;\nattribute vec3 position;\nattribute vec3 normal;\nvarying vec3 vNormal;\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  gl_PointSize = pointSize;\n  vNormal = (normalMatrix * vec4(normal, 1.0)).xyz;\n}\n\n#endif\n\n#ifdef FRAG\n\nuniform vec4 ambientColor;\nuniform vec4 diffuseColor;\nuniform vec3 lightPos;\nuniform float wrap;\nvarying vec3 vNormal;\n\nvoid main() {\n  vec3 L = normalize(lightPos);\n  vec3 N = normalize(vNormal);\n  float NdotL = max(0.0, (dot(N, L) + wrap) / (1.0 + wrap));\n  gl_FragColor = ambientColor + NdotL * diffuseColor;\n}\n\n#endif\n"}),define("pex/materials/Diffuse",["pex/materials/Material","pex/gl/Context","pex/gl/Program","pex/utils/ObjectUtils","pex/geom/Vec3","pex/color/Color","lib/text!pex/materials/Diffuse.glsl"],function(e,t,i,n,r,o,s){function a(a){this.gl=t.currentContext.gl;var h=new i(s),c={wrap:1,pointSize:1,lightPos:r.create(10,20,30),ambientColor:o.create(0,0,0,1),diffuseColor:o.create(1,1,1,1)};a=n.mergeObjects(c,a),e.call(this,h,a)}return a.prototype=Object.create(e.prototype),a}),define("lib/text!pex/materials/Test.glsl",[],function(){return"#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\n\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 texCoord;\n\nvarying vec3 vNormal;\nvarying vec2 vTexCoord;\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  gl_PointSize = 2.0;\n  vNormal = normal;\n  vTexCoord = texCoord;\n}\n\n#endif\n\n#ifdef FRAG\n\nvec4 checker(vec2 uv) {\n  float checkSize = 8.0;\n  float fmodResult = mod(floor(checkSize * uv.x) + floor(checkSize * uv.y),2.0);\n  if (fmodResult < 1.0) {\n    return vec4(1, 1, 1, 1);\n  } else {\n    return vec4(0, 0, 0, 1);\n  }\n}\n\nvarying vec3 vNormal;\nvarying vec2 vTexCoord;\n\nvoid main() {\n  gl_FragColor.rgba = 0.25 * checker(vTexCoord);\n  gl_FragColor.rgb += 0.5 * normalize(vNormal)*0.5 + 0.5;\n  gl_FragColor.a = 1.0;\n}\n\n#endif"}),define("pex/materials/Test",["pex/materials/Material","pex/gl/Context","pex/gl/Program","pex/color/Color","pex/utils/ObjectUtils","lib/text!pex/materials/Test.glsl"],function(e,t,i,n,r,o){function s(){this.gl=t.currentContext.gl;var n=new i(o),r={};e.call(this,n,r)}return s.prototype=Object.create(e.prototype),s}),define("lib/text!pex/materials/BlinnPhong.glsl",[],function(){return"#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 modelWorldMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 normalMatrix;\nuniform float pointSize;\nuniform vec3 lightPos;\nuniform vec3 cameraPos;\nattribute vec3 position;\nattribute vec3 normal;\nvarying vec3 vNormal;\nvarying vec3 vLightPos;\nvarying vec3 vEyePos;\n\nvoid main() {\n  vec4 worldPos = modelWorldMatrix * vec4(position, 1.0);\n  vec4 eyePos = modelViewMatrix * vec4(position, 1.0);\n  gl_Position = projectionMatrix * eyePos;\n  vEyePos = eyePos.xyz;\n  gl_PointSize = pointSize;\n  vNormal = (normalMatrix * vec4(normal, 0.0)).xyz;\n  vLightPos = (viewMatrix * vec4(lightPos, 1.0)).xyz;\n}\n\n#endif\n\n#ifdef FRAG\n\nuniform vec4 ambientColor;\nuniform vec4 diffuseColor;\nuniform vec4 specularColor;\nuniform float shininess;\nuniform float wrap;\nuniform bool useBlinnPhong;\nvarying vec3 vNormal;\nvarying vec3 vLightPos;\nvarying vec3 vEyePos;\n\nfloat phong(vec3 L, vec3 E, vec3 N) {\n  vec3 R = reflect(-L, N);\n  return dot(R, E);\n}\n\nfloat blinnPhong(vec3 L, vec3 E, vec3 N) {\n  vec3 halfVec = normalize(L + E);\n  return dot(halfVec, N);\n}\n\nvoid main() {\n  vec3 L = normalize(vLightPos - vEyePos); //lightDir\n  vec3 E = normalize(-vEyePos); //viewDir\n  vec3 N = normalize(vNormal); //normal\n\n  float NdotL = max(0.0, (dot(N, L) + wrap) / (1.0 + wrap));\n  vec4 color = ambientColor + NdotL * diffuseColor;\n\n  float specular = 0;\n  if (useBlinnPhong)\n    specular = blinnPhong(L, E, N);\n  else\n    specular = phong(L, E, N);\n\n  color += max(pow(specular, shininess), 0.0) * specularColor;\n\n  gl_FragColor = color;\n}\n\n#endif\n"}),function(){var e={}.hasOwnProperty,t=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};define("pex/materials/BlinnPhong",["require","pex/materials/Material","pex/gl/Context","pex/gl/Program","pex/utils/ObjectUtils","pex/geom/Vec3","pex/color/Color","lib/text!./BlinnPhong.glsl"],function(e){var i,n,r,o,s,a,h,c;return s=e("pex/materials/Material"),o=e("pex/gl/Context"),h=e("pex/gl/Program"),a=e("pex/utils/ObjectUtils"),c=e("pex/geom/Vec3"),r=e("pex/color/Color"),n=e("lib/text!./BlinnPhong.glsl"),i=function(e){function i(e){var t,s;this.gl=o.currentContext.gl,s=new h(n),t={wrap:0,pointSize:1,lightPos:c.create(10,20,30),ambientColor:r.create(0,0,0,1),diffuseColor:r.create(1,1,1,1),specularColor:r.create(1,1,1,1),shininess:32,useBlinnPhong:!0},e=a.mergeObjects(t,e),i.__super__.constructor.call(this,s,e)}return t(i,e),i}(s)})}.call(this),define("lib/text!pex/materials/PointSpriteTextured.glsl",[],function(){return"#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform float pointSize;\nattribute vec3 position;\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  gl_PointSize = pointSize;\n}\n\n#endif\n\n#ifdef FRAG\n\nuniform sampler2D texture;\nuniform float alpha;\n\nvoid main() {\n  gl_FragColor = texture2D(texture, gl_PointCoord);\n  gl_FragColor *= alpha;\n}\n\n#endif\n"}),define("pex/materials/PointSpriteTextured",["pex/materials/Material","pex/gl/Context","pex/gl/Program","pex/geom/Vec4","pex/utils/ObjectUtils","lib/text!pex/materials/PointSpriteTextured.glsl"],function(e,t,i,n,r,o){function s(n){this.gl=t.currentContext.gl;var s=new i(o),a={pointSize:1,alpha:1};n=r.mergeObjects(a,n),e.call(this,s,n)}return s.prototype=Object.create(e.prototype),s}),define("pex/materials",["pex/materials/SolidColor","pex/materials/ShowNormals","pex/materials/Textured","pex/materials/ShowTexCoords","pex/materials/ShowDepth","pex/materials/ShowColors","pex/materials/ShowPositions","pex/materials/PackDepth","pex/materials/Diffuse","pex/materials/Test","pex/materials/BlinnPhong","pex/materials/PointSpriteTextured"],function(e,t,i,n,r,o,s,a,h,c,l,u){return{SolidColor:e,ShowNormals:t,Textured:i,ShowTexCoords:n,ShowDepth:r,ShowColors:o,ShowPositions:s,PackDepth:a,Diffuse:h,Test:c,BlinnPhong:l,PointSpriteTextured:u}}),define("pex/sys/EjectaPolyfills",["pex/sys/Platform"],function(e){return e.isEjecta?(HTMLElement.prototype.setAttribute=function(e,t){this.attributes||(this.attributes={}),this.attributes[e]=t},HTMLElement.prototype.getAttribute=function(e){return this.attributes?this.attributes[e]:null},HTMLElement.prototype.addEventListener=function(e,t,i){console.log("HTMLElement.prototype.addEventListener",e),"load"==e?this.onload=function(){t({type:"load",currentTarget:this,srcElement:this})}:("touchstart"==e||"touchstart"==e||"touchstart"==e)&&document.addEventListener(e,t,i)},HTMLElement.prototype.removeEventListener=function(e,t){"load"==e?this.onload=null:("touchstart"==e||"touchstart"==e||"touchstart"==e)&&document.removeEventListener(e,t)},{}):{}}),define("pex/sys/BrowserWindow",["pex/sys/Platform","pex/sys/EjectaPolyfills"],function(e){function t(e,t){for(var i=0;i<d.length;i++)d[i].eventType==e&&d[i].handler(t)}function i(e){n(e),r(e),o(e),s(e),a(e),h(e),c(e),l(e),u(e)}function n(e){e.addEventListener("mousedown",function(e){t("leftMouseDown",{x:(e.offsetX||e.layerX||e.clientX-e.target.offsetLeft)*window.devicePixelRatio,y:(e.offsetY||e.layerY||e.clientY-e.target.offsetTop)*window.devicePixelRatio,option:e.altKey,shift:e.shiftKey,control:e.ctrlKey})})}function r(e){e.addEventListener("mouseup",function(e){t("leftMouseUp",{x:(e.offsetX||e.layerX||e.clientX-e.target.offsetLeft)*window.devicePixelRatio,y:(e.offsetY||e.layerY||e.clientY-e.target.offsetTop)*window.devicePixelRatio,option:e.altKey,shift:e.shiftKey,control:e.ctrlKey})})}function o(e){var i=!1,n=0,r=0;e.addEventListener("mousedown",function(e){i=!0,n=(e.offsetX||e.layerX||e.clientX-e.target.offsetLeft)*window.devicePixelRatio,r=(e.offsetY||e.layerY||e.clientY-e.target.offsetTop)*window.devicePixelRatio}),e.addEventListener("mouseup",function(){i=!1}),e.addEventListener("mousemove",function(e){if(i){var o=(e.offsetX||e.layerX||e.clientX-e.target.offsetLeft)*window.devicePixelRatio,s=(e.offsetY||e.layerY||e.clientY-e.target.offsetTop)*window.devicePixelRatio;t("mouseDragged",{x:o,y:s,dx:o-n,dy:s-r,option:e.altKey,shift:e.shiftKey,control:e.ctrlKey}),n=o,r=s}})}function s(e){e.addEventListener("mousemove",function(e){t("mouseMoved",{x:(e.offsetX||e.layerX||e.clientX-e.target.offsetLeft)*window.devicePixelRatio,y:(e.offsetY||e.layerY||e.clientY-e.target.offsetTop)*window.devicePixelRatio,option:e.altKey,shift:e.shiftKey,control:e.ctrlKey})})}function a(){var e=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";document.addEventListener(e,function(e){t("scrollWheel",{x:(e.offsetX||e.layerX)*window.devicePixelRatio,y:(e.offsetY||e.layerY)*window.devicePixelRatio,dy:e.wheelDelta/10||-e.detail/10,option:e.altKey,shift:e.shiftKey,control:e.ctrlKey})})}function h(e){e.addEventListener("touchstart",function(e){g={clientX:e.touches[0].clientX*window.devicePixelRatio,clientY:e.touches[0].clientY*window.devicePixelRatio};var i=e.touches.map(function(e){return e.x=e.clientX*window.devicePixelRatio,e.y=e.clientY*window.devicePixelRatio,e});t("leftMouseDown",{x:e.touches[0].clientX*window.devicePixelRatio,y:e.touches[0].clientY*window.devicePixelRatio,option:!1,shift:!1,control:!1,touches:i})})}function c(e){e.addEventListener("touchend",function(e){var i=e.touches.map(function(e){return e.x=e.clientX*window.devicePixelRatio,e.y=e.clientY*window.devicePixelRatio,e});t("leftMouseUp",{x:g?g.clientX:0,y:g?g.clientY:0,option:!1,shift:!1,control:!1,touches:i}),g=null})}function l(e){e.addEventListener("touchmove",function(e){g={clientX:e.touches[0].clientX*window.devicePixelRatio,clientY:e.touches[0].clientY*window.devicePixelRatio};var i=e.touches.map(function(e){return e.x=e.clientX*window.devicePixelRatio,e.y=e.clientY*window.devicePixelRatio,e});t("mouseDragged",{x:e.touches[0].clientX*window.devicePixelRatio,y:e.touches[0].clientY*window.devicePixelRatio,option:!1,shift:!1,control:!1,touches:i})})}function u(){var e=0;window.addEventListener("keydown",function(i){e=setTimeout(function(){t("keyDown",{str:"",keyCode:i.keyCode,option:i.altKey,shift:i.shiftKey,control:i.ctrlKey},1)})}),window.addEventListener("keypress",function(i){e&&(clearTimeout(e),e=0),t("keyDown",{str:String.fromCharCode(i.charCode),keyCode:i.keyCode,option:i.altKey,shift:i.shiftKey,control:i.ctrlKey})})}function p(t){function n(){function e(){t.__disposed||(t.draw(),requestAnimFrame(e))}void 0===t.stencil&&(t.stencil=!1),t.settings.fullscreen&&(document.body.style.margin="0",document.body.style.padding="0",document.body.style.overflow="hidden");var n=null,o=null;if("3d"==t.settings.type){try{n=r.getContext("experimental-webgl",{antialias:!0})}catch(s){return void console.error(s.message)}if(null===n)throw"No WebGL context is available."}else"2d"==t.settings.type&&(o=r.getContext("2d"));t.framerate=function(e){f=e},t.on=function(e,t){d.push({eventType:e,handler:t})},i(r),t.dispose=function(){t.__disposed=!0},t.gl=n,t.ctx=o,t.init(),requestAnimFrame(e)}var r=t.settings.canvas;return t.settings.fullscreen&&(t.settings.width=window.innerWidth,t.settings.height=window.innerHeight),r?t.settings.width&&t.settings.height?(r.width=t.settings.width,r.height=t.settings.height):(t.settings.width=r.width,t.settings.height=r.height):r=document.getElementById("canvas"),r||(r=document.createElement("canvas"),r.width=t.settings.width,r.height=t.settings.height),e.isEjecta&&2==window.devicePixelRatio&&(r.width=2*t.settings.width,r.height=2*t.settings.height,r.style.width=t.settings.width,r.style.height=t.settings.height,r.msaaEnabled=!0,r.msaaSamples=2,t.settings.width*=2,t.settings.height*=2),t.width=t.settings.width,t.height=t.settings.height,t.canvas=r,r.style.backgroundColor="#000000",r.parentNode?n():document.body?(document.body.appendChild(r),n()):window.addEventListener("load",function(){document.body.appendChild(r),n()
},!1),t}var f=60;e.isBrowser&&(window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/f)}}());var d=[],g=null,m={simpleWindow:p};return m}),define("pex/utils/Time",["pex/utils/Log"],function(e){var t={now:0,prev:0,delta:0,seconds:0,frameNumber:0,fpsFrames:0,fpsTime:0,fps:0,fpsFrequency:3,paused:!1,verbose:!1};t.update=function(i){return t.paused?void 0:(0===t.prev&&(t.prev=Date.now()),t.now=Date.now(),t.delta=void 0!==i?i:(t.now-t.prev)/1e3,t.delta>1&&(t.delta=0),t.prev=t.now,t.seconds+=t.delta,t.fpsTime+=t.delta,t.frameNumber++,t.fpsFrames++,t.fpsTime>t.fpsFrequency&&(t.fps=t.fpsFrames/t.fpsTime,t.fpsTime=0,t.fpsFrames=0,this.verbose&&e.message("FPS: "+t.fps)),t.seconds)};var i=0;return t.startMeasuringTime=function(){i=Date.now()},t.stopMeasuringTime=function(t){var n=Date.now(),r=(n-i)/1e3;return t&&e.message(t+r),r},t.pause=function(){t.paused=!0},t.togglePause=function(){t.paused=!t.paused},t}),define("lib/csscolorparser",[],function(){function e(e){return e=Math.round(e),0>e?0:e>255?255:e}function t(e){return 0>e?0:e>1?1:e}function i(t){return e("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function n(e){return t("%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))}function r(e,t,i){return 0>i?i+=1:i>1&&(i-=1),1>6*i?e+(t-e)*i*6:1>2*i?t:2>3*i?e+(t-e)*(2/3-i)*6:e}function o(t){var o=t.replace(/ /g,"").toLowerCase();if(o in s)return s[o].slice();if("#"===o[0]){if(4===o.length){var a=parseInt(o.substr(1),16);return a>=0&&4095>=a?[(3840&a)>>4|(3840&a)>>8,240&a|(240&a)>>4,15&a|(15&a)<<4,1]:null}if(7===o.length){var a=parseInt(o.substr(1),16);return a>=0&&16777215>=a?[(16711680&a)>>16,(65280&a)>>8,255&a,1]:null}return null}var h=o.indexOf("("),c=o.indexOf(")");if(-1!==h&&c+1===o.length){var l=o.substr(0,h),u=o.substr(h+1,c-(h+1)).split(","),p=1;switch(l){case"rgba":if(4!==u.length)return null;p=n(u.pop());case"rgb":return 3!==u.length?null:[i(u[0]),i(u[1]),i(u[2]),p];case"hsla":if(4!==u.length)return null;p=n(u.pop());case"hsl":if(3!==u.length)return null;var f=(parseFloat(u[0])%360+360)%360/360,d=n(u[1]),g=n(u[2]),m=.5>=g?g*(d+1):g+d-g*d,x=2*g-m;return[e(255*r(x,m,f+1/3)),e(255*r(x,m,f)),e(255*r(x,m,f-1/3)),p];default:return null}}return null}var s={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};if("undefined"!=typeof exports)try{exports.parseCSSColor=o}catch(a){}return{parseCSSColor:o}}),define("lib/omgcanvas",["pex/sys/Node","lib/csscolorparser"],function(e,t){function i(e){return 1===e[3]?"#"+(1<<24|e[0]<<16|e[1]<<8|e[2]).toString(16).substr(1):"rgba("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function n(e){var t=new r.SkPaint,n=new r.SkPaint;n.setAntiAlias(!0),n.setStrokeWidth(1),n.setStrokeMiter(10);var s=[{paint:n,lineWidth:1,lineCap:"butt",lineJoin:"miter",miterLimit:10,lineDash:[],lineDashOffset:0,strokeColor:[0,0,0,1],strokeStyle:i([0,0,0,1]),fillColor:[0,0,0,1],fillStyle:i([0,0,0,1])}],h=s[0],c=new r.SkPath;return{canvas:e,save:function(){n=new r.SkPaint(n),h={paint:n,lineWidth:h.lineWidth,lineCap:h.lineCap,lineJoin:h.lineJoin,miterLimit:h.miterLimit,lineDash:h.lineDash,lineDashOffset:h.lineDashOffset,strokeColor:h.strokeColor,strokeStyle:h.strokeStyle,fillColor:h.fillColor,fillStyle:h.fillStyle},s.push(h),e.save()},restore:function(){s.length>1&&(s.pop(),h=s[s.length-1],n=h.paint,e.restore())},get strokeStyle(){return h.strokeStyle},set strokeStyle(e){var t=o(e);null!==t&&(h.strokeColor=t,h.strokeStyle=i(t))},get fillStyle(){return h.fillStyle},set fillStyle(e){var t=o(e);null!==t&&(h.fillColor=t,h.fillStyle=i(t))},get lineWidth(){return h.lineWidth},set lineWidth(e){"string"==typeof e&&(e=parseFloat(e)),e>0&&isFinite(e)&&(h.lineWidth=e,n.setStrokeWidth(e))},get lineCap(){return h.lineCap},set lineCap(e){var t=null;switch(e){case"butt":t=n.kButtCap;break;case"round":t=n.kRoundCap;break;case"square":t=n.kSquareCap;break;default:return}h.lineCap=e,n.setStrokeCap(t)},get lineJoin(){return h.lineJoin},set lineJoin(e){var t=null;switch(e){case"round":t=n.kRoundJoin;break;case"bevel":t=n.kBevelJoin;break;case"miter":t=n.kMiterJoin;break;default:return}h.lineJoin=e,n.setStrokeJoin(t)},get miterLimit(){return h.miterLimit},set miterLimit(e){e>0&&isFinite(e)&&(h.miterLimit=e,n.setStrokeMiter(e))},setLineDash:function(e){if(0===arguments.length)throw new TypeError("Not enough arguments");Array.isArray(e)||(e=[]);for(var t=0,i=e.length;i>t;++t)if(e[t]<0||!isFinite(e[t]))return;1&e.length&&(e=e.concat(e)),h.lineDash=e,0===e.length?n.clearPathEffect():n.setDashPathEffect(h.lineDash,h.lineDashOffset)},getLineDash:function(){return h.lineDash.slice()},get lineDashOffset(){return h.lineDashOffset},set lineDashOffset(e){"string"==typeof e&&(e=parseFloat(e)),isFinite(e)&&(h.lineDashOffset=e,0===h.lineDash.length?n.clearPathEffect():n.setDashPathEffect(h.lineDash,h.lineDashOffset))},setLineWidth:function(e){this.lineWidth=e},setLineCap:function(e){this.lineCap=e},setLineJoin:function(e){this.lineJoin=e},setMiterLimit:function(e){this.miterLimit=e},clearRect:function(i,n,r,o){t.setXfermodeMode(t.kClearMode),e.drawRect(t,i,n,i+r,n+o)},fillRect:function(t,i,r,o){this.save(),n.setFill();var s=h.fillColor;n.setColor(s[0],s[1],s[2],255*s[3]>>0),e.drawRect(n,t,i,t+r,i+o),this.restore()},strokeRect:function(t,i,r,o){this.save(),n.setStroke();var s=h.strokeColor;n.setColor(s[0],s[1],s[2],255*s[3]>>0),e.drawRect(n,t,i,t+r,i+o),this.restore()},beginPath:function(){c.rewind()},closePath:function(){c.close()},moveTo:function(e,t){c.moveTo(e,t)},lineTo:function(e,t){c.lineTo(e,t)},rect:function(e,t,i,n){c.addRect(e,t,e+i,t+n)},arcTo:function(e,t,i,n,r){c.arct(e,t,i,n,r)},arc:function(e,t,i,n,o,s){var a=o-n,h=180*n/r.kPI,l=180*a/r.kPI;l>=360||-360>=l?(c.arcTo(e-i,t-i,e+i,t+i,h,0),c.addOval(e-i,t-i,e+i,t+i,s),c.arcTo(e-i,t-i,e+i,t+i,h+l,0,!0)):(s&&l>0&&(l-=360),!s&&0>l&&(l+=360),c.arcTo(e-i,t-i,e+i,t+i,h,l))},quadraticCurveTo:function(e,t,i,n){c.quadTo(e,t,i,n)},bezierCurveTo:function(e,t,i,n,r,o){c.cubicTo(e,t,i,n,r,o)},fill:function(){this.save(),n.setFill();var t=h.fillColor;n.setColor(t[0],t[1],t[2],255*t[3]>>0),e.drawPath(n,c),this.restore()},stroke:function(){this.save(),n.setStroke();var t=h.strokeColor;n.setColor(t[0],t[1],t[2],255*t[3]>>0),e.drawPath(n,c),this.restore()},clip:function(){e.clipPath(c)},scale:function(t,i){e.scale(t,i)},rotate:function(t){e.rotate(180*t/r.kPI)},translate:function(t,i){e.translate(t,i)},transform:function(t,i,n,r,o,s){e.concatMatrix(t,n,o,i,r,s,0,0,1)},setTransform:function(t,i,n,r,o,s){e.setMatrix(t,n,o,i,r,s,0,0,1)},createImageData:function(e,t){1===arguments.length&&(t=e.height,e=e.width);var i=new Uint8Array(e*t*4);return{width:e,height:t,data:i}},getImageData:function(t,i,n,r){for(var o=e.width,s=(e.height,this.createImageData(n,r)),h=s.data,c=0;r>c;++c)for(var l=c*n<<2,u=(i+c)*o+t<<2,p=0;n>p;++p){var f=e[u++],d=e[u++],g=e[u++];a=e[u++];var m=0===a?0:255/a;h[l++]=g*m>>0,h[l++]=d*m>>0,h[l++]=f*m>>0,h[l++]=a}return s},putImageData:function(t,i,n){for(var r=e.width,o=(e.height,t.width),s=t.height,h=t.data,c=0;s>c;++c)for(var l=c*o<<2,u=(n+c)*r+i<<2,p=0;o>p;++p){var f=h[l++],d=h[l++];b=h[l++],a=h[l++];var g=a/255;e[u++]=b*g>>0,e[u++]=d*g>>0,e[u++]=f*g>>0,e[u++]=a}}}}var r=e.plask,o=t.parseCSSColor;return"undefined"!=typeof exports&&(exports.CanvasContext=n),{CanvasContext:n}}),function(){define("pex/sys/Window",["require","pex/sys/Platform","pex/sys/Node","pex/gl/Context","pex/sys/BrowserWindow","pex/utils/ObjectUtils","pex/utils/Time","lib/omgcanvas"],function(e){var t,i,n,r,o,s,a,h;return o=e("pex/sys/Platform"),n=e("pex/sys/Node"),i=e("pex/gl/Context"),t=e("pex/sys/BrowserWindow"),r=e("pex/utils/ObjectUtils"),s=e("pex/utils/Time"),h=e("lib/omgcanvas"),a={create:function(e){var a,c,l;return l=null,a=null,c={width:1280,height:720,type:"3d",vsync:!0,multisample:!0,fullscreen:!1,center:!0},e.settings=e.settings||{},e.settings=r.mergeObjects(c,e.settings),e.__init=e.init,e.init=function(){return l=this.gl,a=new i(l),i.currentContext=a,o.isPlask&&"2d"===e.settings.type&&(e.ctx=new h.CanvasContext(this.canvas)),e.framerate(60),e.__init?e.__init():void 0},e.__draw=e.draw,e.draw=function(){return s.update(),i.currentContext=a,e.__draw?e.__draw():void 0},e.dispose=function(){},o.isPlask?n.plask.simpleWindow(e):o.isBrowser?t.simpleWindow(e):void 0}}})}.call(this),"undefined"==typeof window)var require=require("requirejs");require.config({paths:{pex:"../../src/pex",lib:"../../src/lib"}}),require(["pex/scene/PerspectiveCamera","pex/scene/Arcball","pex/gl/Mesh","pex/geom/gen","pex/geom/Quat","pex/geom/Vec3","pex/materials","pex/sys/Window"],function(e,t,i,n,r,o,s,a){a.create({settings:{width:1280,height:720,type:"3d"},init:function(){this.camera=new e(60,this.width/this.height),this.arcball=new t(this,this.camera,2),this.mesh=new i(new n.Cube,new s.ShowNormals),this.mesh.rotation=(new r).setAxisAngle(new o(1,0,0),45),this.framerate(60)},draw:function(){var e=this.gl;e.clearColor(0,0,0,1),e.enable(e.DEPTH_TEST),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),this.mesh.draw(this.camera)}})}),define("app",function(){});