!function t(e,i,n){function r(s,a){if(!i[s]){if(!e[s]){var h="function"==typeof require&&require;if(!a&&h)return h(s,!0);if(o)return o(s,!0);throw new Error("Cannot find module '"+s+"'")}var l=i[s]={exports:{}};e[s][0].call(l.exports,function(t){var i=e[s][1][t];return r(i?i:t)},l,l.exports,t,e,i,n)}return i[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)r(n[s]);return r}({1:[function(t,e){!function(t){function i(t,e){if("object"!==r(t))return e;for(var n in e)t[n]="object"===r(t[n])&&"object"===r(e[n])?i(t[n],e[n]):e[n];return t}function n(t,e,n){var s=n[0],a=n.length;(t||"object"!==r(s))&&(s={});for(var h=0;a>h;++h){var l=n[h],u=r(l);if("object"===u)for(var c in l){var p=t?o.clone(l[c]):l[c];s[c]=e?i(s[c],p):p}}return s}function r(t){return{}.toString.call(t).slice(8,-1).toLowerCase()}var o=function(t){return n(t===!0,!1,arguments)},s="merge";o.recursive=function(t){return n(t===!0,!0,arguments)},o.clone=function(t){var e,i,n=t,s=r(t);if("array"===s)for(n=[],i=t.length,e=0;i>e;++e)n[e]=o.clone(t[e]);else if("object"===s){n={};for(e in t)n[e]=o.clone(t[e])}return n},t?e.exports=o:window[s]=o}("object"==typeof e&&e&&"object"==typeof e.exports&&e.exports)},{}],2:[function(t,e){e.exports.Color=t("./lib/Color")},{"./lib/Color":3}],3:[function(t,e){function i(t,e,i,n){this.r=null!=t?t:0,this.g=null!=e?e:0,this.b=null!=i?i:0,this.a=null!=n?n:1}var n=function(t,e,i){return t+(e-t)*i};i.create=function(t,e,n,r){return new i(t,e,n,r)},i.fromArray=function(t){return new i(t[0],t[1],t[2],t[3])},i.fromRGB=i.create,i.fromHSV=function(t,e,n,r){var o=new i;return o.setHSV(t,e,n,r),o},i.fromHSL=function(t,e,n,r){var o=new i;return o.setHSL(t,e,n,r),o},i.prototype.set=function(t,e,i,n){return this.r=t,this.g=e,this.b=i,this.a=null!=n?n:1,this},i.prototype.hash=function(){return 1*this.r+12*this.g+123*this.b+1234*this.a},i.prototype.setHSV=function(t,e,i,n){n=null!=n?n:1;var r=Math.floor(6*t),o=6*t-r,s=i*(1-e),a=i*(1-o*e),h=i*(1-(1-o)*e);switch(r%6){case 0:this.r=i,this.g=h,this.b=s;break;case 1:this.r=a,this.g=i,this.b=s;break;case 2:this.r=s,this.g=i,this.b=h;break;case 3:this.r=s,this.g=a,this.b=i;break;case 4:this.r=h,this.g=s,this.b=i;break;case 5:this.r=i,this.g=s,this.b=a}return this.a=n,this},i.prototype.getHSV=function(){var t,e=this.r,i=this.g,n=this.b,r=Math.max(e,i,n),o=Math.min(e,i,n),s=r,a=r-o,h=0==r?0:a/r;if(r==o)t=0;else{switch(r){case e:t=(i-n)/a+(n>i?6:0);break;case i:t=(n-e)/a+2;break;case n:t=(e-i)/a+4}t/=6}return{h:t,s:h,v:s,a:this.a}},i.prototype.setHSL=function(t,e,i,n){function r(t,e,i){return 0>i&&(i+=1),i>1&&(i-=1),1/6>i?t+6*(e-t)*i:.5>i?e:2/3>i?t+(e-t)*(2/3-i)*6:t}if(n=null!=n?n:1,0==e)this.r=this.g=this.b=i;else{var o=.5>i?i*(1+e):i+e-i*e,s=2*i-o;this.r=r(s,o,t+1/3),this.g=r(s,o,t),this.b=r(s,o,t-1/3),this.a=n}},i.prototype.getHSL=function(){var t,e,i=this.r,n=this.g,r=this.b,o=Math.max(i,n,r),s=Math.min(i,n,r),a=(o+s)/2;if(o==s)t=e=0;else{var h=o-s;switch(e=a>.5?h/(2-o-s):h/(o+s),o){case i:t=(n-r)/h+(r>n?6:0);break;case n:t=(r-i)/h+2;break;case r:t=(i-n)/h+4}t/=6}return{h:t,s:e,l:a,a:this.a}},i.prototype.copy=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},i.prototype.clone=function(){return new i(this.r,this.g,this.b,this.a)},i.lerp=function(t,e,r,o){if(o=o||"rgb","rgb"==o)return i.fromRGB(n(t.r,e.r,r),n(t.g,e.g,r),n(t.b,e.b,r),n(t.a,e.a,r));if("hsv"==o){var s=t.getHSV(),a=e.getHSV();return i.fromHSV(n(s.h,a.h,r),n(s.s,a.s,r),n(s.v,a.v,r),n(s.a,a.a,r))}if("hsl"==o){var h=t.getHSL(),l=e.getHSL();return i.fromHSL(n(h.h,l.h,r),n(h.s,l.s,r),n(h.l,l.l,r),n(h.a,l.a,r))}return t},i.Transparent=new i(0,0,0,0),i.None=new i(0,0,0,0),i.Black=new i(0,0,0,1),i.White=new i(1,1,1,1),i.DarkGrey=new i(.25,.25,.25,1),i.Grey=new i(.5,.5,.5,1),i.Red=new i(1,0,0,1),i.Green=new i(0,1,0,1),i.Blue=new i(0,0,1,1),i.Yellow=new i(1,1,0,1),i.Pink=new i(1,0,1,1),i.Cyan=new i(0,1,1,1),i.Orange=new i(1,.5,0,1),e.exports=i},{}],4:[function(){},{}],5:[function(t,e){function i(){}var n=e.exports={};n.nextTick=function(){var t="undefined"!=typeof window&&window.setImmediate,e="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(t)return function(t){return window.setImmediate(t)};if(e){var i=[];return window.addEventListener("message",function(t){var e=t.source;if((e===window||null===e)&&"process-tick"===t.data&&(t.stopPropagation(),i.length>0)){var n=i.shift();n()}},!0),function(t){i.push(t),window.postMessage("process-tick","*")}}return function(t){setTimeout(t,0)}}(),n.title="browser",n.browser=!0,n.env={},n.argv=[],n.on=i,n.once=i,n.off=i,n.emit=i,n.binding=function(){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(){throw new Error("process.chdir is not supported")}},{}],6:[function(t,e,i){(function(t){function e(t,e){for(var i=0,n=t.length-1;n>=0;n--){var r=t[n];"."===r?t.splice(n,1):".."===r?(t.splice(n,1),i++):i&&(t.splice(n,1),i--)}if(e)for(;i--;i)t.unshift("..");return t}function n(t,e){if(t.filter)return t.filter(e);for(var i=[],n=0;n<t.length;n++)e(t[n],n,t)&&i.push(t[n]);return i}var r=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,o=function(t){return r.exec(t).slice(1)};i.resolve=function(){for(var i="",r=!1,o=arguments.length-1;o>=-1&&!r;o--){var s=o>=0?arguments[o]:t.cwd();if("string"!=typeof s)throw new TypeError("Arguments to path.resolve must be strings");s&&(i=s+"/"+i,r="/"===s.charAt(0))}return i=e(n(i.split("/"),function(t){return!!t}),!r).join("/"),(r?"/":"")+i||"."},i.normalize=function(t){var r=i.isAbsolute(t),o="/"===s(t,-1);return t=e(n(t.split("/"),function(t){return!!t}),!r).join("/"),t||r||(t="."),t&&o&&(t+="/"),(r?"/":"")+t},i.isAbsolute=function(t){return"/"===t.charAt(0)},i.join=function(){var t=Array.prototype.slice.call(arguments,0);return i.normalize(n(t,function(t){if("string"!=typeof t)throw new TypeError("Arguments to path.join must be strings");return t}).join("/"))},i.relative=function(t,e){function n(t){for(var e=0;e<t.length&&""===t[e];e++);for(var i=t.length-1;i>=0&&""===t[i];i--);return e>i?[]:t.slice(e,i-e+1)}t=i.resolve(t).substr(1),e=i.resolve(e).substr(1);for(var r=n(t.split("/")),o=n(e.split("/")),s=Math.min(r.length,o.length),a=s,h=0;s>h;h++)if(r[h]!==o[h]){a=h;break}for(var l=[],h=a;h<r.length;h++)l.push("..");return l=l.concat(o.slice(a)),l.join("/")},i.sep="/",i.delimiter=":",i.dirname=function(t){var e=o(t),i=e[0],n=e[1];return i||n?(n&&(n=n.substr(0,n.length-1)),i+n):"."},i.basename=function(t,e){var i=o(t)[2];return e&&i.substr(-1*e.length)===e&&(i=i.substr(0,i.length-e.length)),i},i.extname=function(t){return o(t)[3]};var s="b"==="ab".substr(-1)?function(t,e,i){return t.substr(e,i)}:function(t,e,i){return 0>e&&(e=t.length+e),t.substr(e,i)}}).call(this,t("/Users/vorg/Workspace/vorg-pex/experiments/v3/node_modules/pex-examples/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))},{"/Users/vorg/Workspace/vorg-pex/experiments/v3/node_modules/pex-examples/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":5}],7:[function(t){{var e=t("pex-sys"),i=t("pex-glu"),n=t("pex-geom"),r=t("pex-gen"),o=t("pex-materials"),s=t("pex-color"),a=t("pex-fx"),h=r.Sphere,l=(r.Cube,i.Mesh),u=o.ShowNormals,c=o.ShowDepth,p=i.PerspectiveCamera,d=i.Arcball,f=(s.Color,i.Context);i.Texture2D}e.Window.create({settings:{width:1280,height:720,type:"3d",fullscreen:e.Platform.isBrowser},init:function(){this.camera=new p(60,this.width/this.height,.1,10),this.arcball=new d(this,this.camera,2),this.showNormals=new u,this.showDepth=new c({near:this.camera.getNear(),far:this.camera.getFar()}),this.mesh=new l(new h(.3),this.showNormals),this.instances=[];for(var t=0;10>t;t++)this.instances.push(n.randomVec3(.35));for(var t=0;10>t;t++)this.instances.push(n.randomVec3(1.05))},drawColor:function(){this.gl.clearColor(0,0,0,1),this.mesh.setMaterial(this.showNormals),this.drawScene()},drawDepth:function(){this.gl.clearColor(1,1,1,1),this.gl.clearDepth(1),this.mesh.setMaterial(this.showDepth),this.drawScene(),this.gl.clearDepth(1)},drawScene:function(){var t=this.gl;t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.enable(t.DEPTH_TEST),this.instances.forEach(function(t){this.mesh.position=t,this.mesh.draw(this.camera)}.bind(this))},draw:function(){var t=f.currentContext;t.clearColor(.2,.2,.2,1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.disable(t.DEPTH_TEST),i.viewport(0,0,this.width,this.height);var e=a(),n=e.render({drawFunc:this.drawColor.bind(this),depth:!0}),r=n.render({drawFunc:this.drawDepth.bind(this),bpp:32,depth:!0}),o=n.downsample4().downsample4(),s=o.blur5().blur5(),h=(n.mult(s),e.ssao({depthMap:r,camera:this.camera,strength:1,offset:0,width:this.width/2,height:this.height/2}).blur3().blur3()),l=n.mult(h);n.blit({x:0,y:0,width:this.width/2,height:this.height/2}),o.blit({x:this.width/2,y:0,width:this.width/2,height:this.height/2}),s.blit({x:0,y:this.height/2,width:this.width/2,height:this.height/2}),h.blit({x:this.width/2,y:this.height/2,width:this.width/2,height:this.height/2}),l.blit({x:.35*this.width,y:this.height/4,width:.35*this.width,height:.35*this.width*this.height/this.width})}})},{"pex-color":2,"pex-fx":8,"pex-gen":25,"pex-geom":40,"pex-glu":60,"pex-materials":76,"pex-sys":94}],8:[function(t,e){var i=t("./lib/FXStage");t("./lib/Render"),t("./lib/Blit"),t("./lib/Add"),t("./lib/Blur3"),t("./lib/Blur5"),t("./lib/Blur"),t("./lib/Downsample2"),t("./lib/Downsample4"),t("./lib/FXAA"),t("./lib/CorrectGamma"),t("./lib/TonemapReinhard"),t("./lib/Save"),t("./lib/Mult"),t("./lib/SSAO");var n;e.exports=function(){return n||(n=new i),n.reset(),n},e.exports.FXStage=i},{"./lib/Add":9,"./lib/Blit":10,"./lib/Blur":11,"./lib/Blur3":12,"./lib/Blur5":13,"./lib/CorrectGamma":14,"./lib/Downsample2":15,"./lib/Downsample4":16,"./lib/FXAA":17,"./lib/FXStage":19,"./lib/Mult":20,"./lib/Render":21,"./lib/SSAO":22,"./lib/Save":23,"./lib/TonemapReinhard":24}],9:[function(t,e){(function(){var i=t("./FXStage"),n="#ifdef VERT\n\nattribute vec2 position;\nattribute vec2 texCoord;\nvarying vec2 vTexCoord;\n\nvoid main() {\n  gl_Position = vec4(position, 0.0, 1.0);\n  vTexCoord = texCoord;\n}\n\n#endif\n\n#ifdef FRAG\n\nvarying vec2 vTexCoord;\nuniform sampler2D tex0;\nuniform sampler2D tex1;\nuniform float scale;\n\nvoid main() {\n  vec4 color = texture2D(tex0, vTexCoord).rgba;\n  vec4 color2 = texture2D(tex1, vTexCoord).rgba;\n\n  //color += scale * color2 * color2.a;\n\n  gl_FragColor = 1.0 - (1.0 - color) * (1.0 - color2 * scale);\n\n  //gl_FragColor.rgba = color + scale * color2;\n  //gl_FragColor.a = 1.0;\n}\n\n#endif";i.prototype.add=function(t,e){e=e||{},scale=void 0!==e.scale?e.scale:1;var i=this.getOutputSize(e.width,e.height),r=this.getRenderTarget(i.width,i.height,e.depth,e.bpp);r.bind(),this.getSourceTexture().bind(0),this.getSourceTexture(t).bind(1);var o=this.getShader(n);return o.use(),o.uniforms.tex0(0),o.uniforms.tex1(1),o.uniforms.scale(scale),this.drawFullScreenQuad(i.width,i.height,null,o),r.unbind(),this.asFXStage(r,"add")},e.exports=i}).call(this,"/../../../pex-fx/lib")},{"./FXStage":19}],10:[function(t,e){var i=t("./FXStage");i.prototype.blit=function(t){t=t||{};var e=this.getOutputSize(t.width,t.height),i=t.x||0,n=t.y||0;return this.drawFullScreenQuadAt(i,n,e.width,e.height,this.getSourceTexture()),this},e.exports=i},{"./FXStage":19}],11:[function(t,e){(function(){var i=t("pex-geom"),n=i.Vec2,r=t("./FXStage"),o="#ifdef VERT\n\nattribute vec2 position;\nattribute vec2 texCoord;\n\nvarying vec2 vTexCoord;\n\nvoid main() {\n  gl_Position = vec4(position, 0.0, 1.0);\n  vTexCoord = texCoord;\n}\n\n#endif\n\n#ifdef FRAG\n\nvarying vec2 vTexCoord;\n\nuniform sampler2D image;\nuniform vec2 imageSize;\nuniform float amount;\n\nvec4 gauss(sampler2D image, vec2 texel, float amount) {\n  vec4 color = vec4(0.0);\n  color += 1.0/16.0 * texture2D(image, vTexCoord + vec2(texel.x * -2.0 * amount, 0.0));\n  color += 4.0/16.0 * texture2D(image, vTexCoord + vec2(texel.x * -1.0 * amount, 0.0));\n  color += 6.0/16.0 * texture2D(image, vTexCoord + vec2(texel.x *  0.0 * amount, 0.0));\n  color += 4.0/16.0 * texture2D(image, vTexCoord + vec2(texel.x *  1.0 * amount, 0.0));\n  color += 1.0/16.0 * texture2D(image, vTexCoord + vec2(texel.x *  2.0 * amount, 0.0));\n  return color;\n}\n\nvoid main() {\n  vec2 texel = vec2(1.0 / imageSize.x, 1.0 / imageSize.y);\n\n  vec4 color = gauss(image, texel, amount);\n  gl_FragColor = color;\n}\n\n#endif\n",s="#ifdef VERT\n\nattribute vec2 position;\nattribute vec2 texCoord;\n\nvarying vec2 vTexCoord;\n\nvoid main() {\n  gl_Position = vec4(position, 0.0, 1.0);\n  vTexCoord = texCoord;\n}\n\n#endif\n\n#ifdef FRAG\n\nvarying vec2 vTexCoord;\n\nuniform sampler2D image;\nuniform vec2 imageSize;\nuniform float amount;\n\nvec4 gauss(sampler2D image, vec2 texel, float amount) {\n  vec4 color = vec4(0.0);\n  color += 1.0/16.0 * texture2D(image, vTexCoord + vec2(0.0, texel.y * -2.0 * amount));\n  color += 4.0/16.0 * texture2D(image, vTexCoord + vec2(0.0, texel.y * -1.0 * amount));\n  color += 6.0/16.0 * texture2D(image, vTexCoord + vec2(0.0, texel.y *  0.0 * amount));\n  color += 4.0/16.0 * texture2D(image, vTexCoord + vec2(0.0, texel.y *  1.0 * amount));\n  color += 1.0/16.0 * texture2D(image, vTexCoord + vec2(0.0, texel.y *  2.0 * amount));\n  return color;\n}\n\nvoid main() {\n  vec2 texel = vec2(1.0 / imageSize.x, 1.0 / imageSize.y);\n\n  vec4 color = gauss(image, texel, amount);\n  gl_FragColor = color;\n}\n\n#endif\n";r.prototype.blur=function(t){t=t||{};var e="undefined"!=typeof t.amount?t.amount:1,i=this.getOutputSize(t.width,t.height),r=this.getRenderTarget(i.width,i.height,t.depth,t.bpp),a=this.getRenderTarget(i.width,i.height,t.depth,t.bpp),h=this.getSourceTexture(),l=this.getShader(o);l.use(),l.uniforms.imageSize(n.create(h.width,h.height)),l.uniforms.amount(e),r.bindAndClear(),this.drawFullScreenQuad(i.width,i.height,h,l),r.unbind();var u=this.getShader(s);return u.use(),u.uniforms.imageSize(n.create(h.width,h.height)),u.uniforms.amount(e),a.bindAndClear(),this.drawFullScreenQuad(i.width,i.height,r.getColorAttachment(0),u),a.unbind(),this.asFXStage(a,"blur")},e.exports=r}).call(this,"/../../../pex-fx/lib")},{"./FXStage":19,"pex-geom":40}],12:[function(t,e){(function(){var i=t("pex-geom"),n=i.Vec2,r=t("./FXStage"),o="#ifdef VERT\n\nattribute vec2 position;\nattribute vec2 texCoord;\n\nvarying vec2 vTexCoord;\n\nvoid main() {\n  gl_Position = vec4(position, 0.0, 1.0);\n  vTexCoord = texCoord;\n}\n\n#endif\n\n#ifdef FRAG\n\nvarying vec2 vTexCoord;\n\nuniform sampler2D image;\nuniform vec2 imageSize;\n\nvoid main() {\n  vec2 texel = vec2(1.0 / imageSize.x, 1.0 / imageSize.y);\n\n  vec4 color = vec4(0.0);\n  color += 0.25 * texture2D(image, vTexCoord + vec2(texel.x * -1.0, 0.0));\n  color += 0.50 * texture2D(image, vTexCoord);\n  color += 0.25 * texture2D(image, vTexCoord + vec2(texel.x *  1.0, 0.0));\n  gl_FragColor = color;\n}\n\n#endif\n",s="#ifdef VERT\n\nattribute vec2 position;\nattribute vec2 texCoord;\n\nvarying vec2 vTexCoord;\n\nvoid main() {\n  gl_Position = vec4(position, 0.0, 1.0);\n  vTexCoord = texCoord;\n}\n\n#endif\n\n#ifdef FRAG\n\nvarying vec2 vTexCoord;\n\nuniform sampler2D image;\nuniform vec2 imageSize;\n\nvoid main() {\n  vec2 texel = vec2(1.0 / imageSize.x, 1.0 / imageSize.y);\n\n  vec4 color = vec4(0.0);\n  color += 0.25 * texture2D(image, vTexCoord + vec2(0.0, texel.y * -1.0));\n  color += 0.50 * texture2D(image, vTexCoord);\n  color += 0.25 * texture2D(image, vTexCoord + vec2(0.0, texel.y *  1.0));\n  gl_FragColor = color;\n}\n\n#endif\n";r.prototype.blur3=function(t){t=t||{};var e=this.getOutputSize(t.width,t.height),i=this.getRenderTarget(e.width,e.height,t.depth,t.bpp),r=this.getRenderTarget(e.width,e.height,t.depth,t.bpp),a=this.getSourceTexture(),h=this.getShader(o);h.use(),h.uniforms.imageSize(n.create(a.width,a.height)),i.bindAndClear(),this.drawFullScreenQuad(e.width,e.height,a,h),i.unbind();var l=this.getShader(s);return l.use(),l.uniforms.imageSize(n.create(a.width,a.height)),r.bindAndClear(),this.drawFullScreenQuad(e.width,e.height,i.getColorAttachment(0),l),r.unbind(),this.asFXStage(r,"blur3")},e.exports=r}).call(this,"/../../../pex-fx/lib")},{"./FXStage":19,"pex-geom":40}],13:[function(t,e){(function(){var i=t("pex-geom"),n=i.Vec2,r=t("./FXStage"),o="#ifdef VERT\n\nattribute vec2 position;\nattribute vec2 texCoord;\n\nvarying vec2 vTexCoord;\n\nvoid main() {\n  gl_Position = vec4(position, 0.0, 1.0);\n  vTexCoord = texCoord;\n}\n\n#endif\n\n#ifdef FRAG\n\nvarying vec2 vTexCoord;\n\nuniform sampler2D image;\nuniform vec2 imageSize;\n\nvoid main() {\n  vec2 texel = vec2(1.0 / imageSize.x, 1.0 / imageSize.y);\n\n  vec4 color = vec4(0.0);\n  color += 1.0/16.0 * texture2D(image, vTexCoord + vec2(texel.x * -2.0, 0.0));\n  color += 4.0/16.0 * texture2D(image, vTexCoord + vec2(texel.x * -1.0, 0.0));\n  color += 6.0/16.0 * texture2D(image, vTexCoord + vec2(texel.x *  0.0, 0.0));\n  color += 4.0/16.0 * texture2D(image, vTexCoord + vec2(texel.x *  1.0, 0.0));\n  color += 1.0/16.0 * texture2D(image, vTexCoord + vec2(texel.x *  2.0, 0.0));\n  gl_FragColor = color;\n}\n\n#endif\n",s="#ifdef VERT\n\nattribute vec2 position;\nattribute vec2 texCoord;\n\nvarying vec2 vTexCoord;\n\nvoid main() {\n  gl_Position = vec4(position, 0.0, 1.0);\n  vTexCoord = texCoord;\n}\n\n#endif\n\n#ifdef FRAG\n\nvarying vec2 vTexCoord;\n\nuniform sampler2D image;\nuniform vec2 imageSize;\n\nvoid main() {\n  vec2 texel = vec2(1.0 / imageSize.x, 1.0 / imageSize.y);\n\n  vec4 color = vec4(0.0);\n  color += 1.0/16.0 * texture2D(image, vTexCoord + vec2(0.0, texel.y * -2.0));\n  color += 4.0/16.0 * texture2D(image, vTexCoord + vec2(0.0, texel.y * -1.0));\n  color += 6.0/16.0 * texture2D(image, vTexCoord + vec2(0.0, texel.y *  0.0));\n  color += 4.0/16.0 * texture2D(image, vTexCoord + vec2(0.0, texel.y *  1.0));\n  color += 1.0/16.0 * texture2D(image, vTexCoord + vec2(0.0, texel.y *  2.0));\n  gl_FragColor = color;\n}\n\n#endif\n";r.prototype.blur5=function(t){t=t||{};var e=this.getOutputSize(t.width,t.height),i=this.getRenderTarget(e.width,e.height,t.depth,t.bpp),r=this.getRenderTarget(e.width,e.height,t.depth,t.bpp),a=this.getSourceTexture(),h=this.getShader(o);h.use(),h.uniforms.imageSize(n.create(a.width,a.height)),i.bindAndClear(),this.drawFullScreenQuad(e.width,e.height,a,h),i.unbind();var l=this.getShader(s);return l.use(),l.uniforms.imageSize(n.create(a.width,a.height)),r.bindAndClear(),this.drawFullScreenQuad(e.width,e.height,i.getColorAttachment(0),l),r.unbind(),this.asFXStage(r,"blur5")},e.exports=r}).call(this,"/../../../pex-fx/lib")},{"./FXStage":19,"pex-geom":40}],14:[function(t,e){(function(){var i=t("./FXStage"),n="#ifdef VERT\n\nattribute vec2 position;\nattribute vec2 texCoord;\nvarying vec2 vTexCoord;\n\nvoid main() {\n  gl_Position = vec4(position, 0.0, 1.0);\n  vTexCoord = texCoord;\n}\n\n#endif\n\n#ifdef FRAG\n\nvarying vec2 vTexCoord;\nuniform sampler2D tex0;\n\nvoid main() {\n  vec4 color = texture2D(tex0, vTexCoord).rgba;\n  vec3 retColor = pow(color.rgb, vec3(1.0/2.2)); //map gamma\n  gl_FragColor.rgb = retColor;\n  gl_FragColor.a = 1.0;\n}\n\n#endif";i.prototype.correctGamma=function(t){t=t||{};var e=this.getOutputSize(t.width,t.height),i=this.getRenderTarget(e.width,e.height,t.depth,t.bpp);i.bind(),this.getSourceTexture().bind(0);var r=this.getShader(n);return r.use(),r.uniforms.tex0(0),this.drawFullScreenQuad(e.width,e.height,null,r),i.unbind(),this.asFXStage(i,"correctGamma")},e.exports=i}).call(this,"/../../../pex-fx/lib")},{"./FXStage":19}],15:[function(t,e){(function(){var i=t("pex-geom"),n=i.Vec2,r=t("./FXStage"),o="#ifdef VERT\n\nattribute vec2 position;\nattribute vec2 texCoord;\n\nvarying vec2 vTexCoord;\n\nvoid main() {\n  gl_Position = vec4(position, 0.0, 1.0);\n  vTexCoord = texCoord;\n}\n\n#endif\n\n#ifdef FRAG\n\nvarying vec2 vTexCoord;\n\nuniform sampler2D image;\nuniform vec2 imageSize;\n\nvoid main() {\n  vec2 texel = vec2(1.0 / imageSize.x, 1.0 / imageSize.y);\n  vec4 color = vec4(0.0);\n  color += texture2D(image, vTexCoord + vec2(texel.x * -1.0, texel.y * -1.0));\n  color += texture2D(image, vTexCoord + vec2(texel.x *  0.0, texel.y * -1.0));\n  color += texture2D(image, vTexCoord + vec2(texel.x * -1.0, texel.y *  0.0));\n  color += texture2D(image, vTexCoord + vec2(texel.x *  0.0, texel.y *  0.0));\n  gl_FragColor = color / 4.0;\n}\n\n#endif";r.prototype.downsample2=function(t){t=t||{};var e=this.getOutputSize(t.width,t.height);e.width/=2,e.height/=2;var i=this.getRenderTarget(e.width,e.height,t.depth,t.bpp),r=this.getSourceTexture(),s=this.getShader(o);return s.use(),s.uniforms.imageSize(n.create(r.width,r.height)),i.bindAndClear(),this.drawFullScreenQuad(e.width,e.height,r,s),i.unbind(),this.asFXStage(i,"downsample2")},e.exports=r}).call(this,"/../../../pex-fx/lib")},{"./FXStage":19,"pex-geom":40}],16:[function(t,e){(function(){var i=t("pex-geom"),n=i.Vec2,r=t("./FXStage"),o="#ifdef VERT\n\nattribute vec2 position;\nattribute vec2 texCoord;\n\nvarying vec2 vTexCoord;\n\nvoid main() {\n  gl_Position = vec4(position, 0.0, 1.0);\n  vTexCoord = texCoord;\n}\n\n#endif\n\n#ifdef FRAG\n\nvarying vec2 vTexCoord;\n\nuniform sampler2D image;\nuniform vec2 imageSize;\n\nvoid main() {\n  vec2 texel = vec2(1.0 / imageSize.x, 1.0 / imageSize.y);\n  vec4 color = vec4(0.0);\n  color += texture2D(image, vTexCoord + vec2(texel.x * -2.0, texel.y * -2.0));\n  color += texture2D(image, vTexCoord + vec2(texel.x * -1.0, texel.y * -2.0));\n  color += texture2D(image, vTexCoord + vec2(texel.x *  0.0, texel.y * -2.0));\n  color += texture2D(image, vTexCoord + vec2(texel.x *  1.0, texel.y * -2.0));\n  color += texture2D(image, vTexCoord + vec2(texel.x * -2.0, texel.y * -1.0));\n  color += texture2D(image, vTexCoord + vec2(texel.x * -1.0, texel.y * -1.0));\n  color += texture2D(image, vTexCoord + vec2(texel.x *  0.0, texel.y * -1.0));\n  color += texture2D(image, vTexCoord + vec2(texel.x *  1.0, texel.y * -1.0));\n  color += texture2D(image, vTexCoord + vec2(texel.x * -2.0, texel.y *  0.0));\n  color += texture2D(image, vTexCoord + vec2(texel.x * -1.0, texel.y *  0.0));\n  color += texture2D(image, vTexCoord + vec2(texel.x *  0.0, texel.y *  0.0));\n  color += texture2D(image, vTexCoord + vec2(texel.x *  1.0, texel.y *  0.0));\n  color += texture2D(image, vTexCoord + vec2(texel.x * -2.0, texel.y *  1.0));\n  color += texture2D(image, vTexCoord + vec2(texel.x * -1.0, texel.y *  1.0));\n  color += texture2D(image, vTexCoord + vec2(texel.x *  0.0, texel.y *  1.0));\n  color += texture2D(image, vTexCoord + vec2(texel.x *  1.0, texel.y *  1.0));\n  gl_FragColor = color / 16.0;\n}\n\n#endif";r.prototype.downsample4=function(t){t=t||{};var e=this.getOutputSize(t.width,t.height,!0);e.width/=4,e.height/=4;var i=this.getRenderTarget(e.width,e.height,t.depth,t.bpp),r=this.getSourceTexture(),s=this.getShader(o);return s.use(),s.uniforms.imageSize(n.create(r.width,r.height)),i.bindAndClear(),this.drawFullScreenQuad(e.width,e.height,r,s),i.unbind(),this.asFXStage(i,"downsample4")},e.exports=r}).call(this,"/../../../pex-fx/lib")},{"./FXStage":19,"pex-geom":40}],17:[function(t,e){(function(){var i=(t("pex-geom"),t("./FXStage")),n="#ifdef VERT\n\nfloat FXAA_SUBPIX_SHIFT = 1.0/4.0;\n\nuniform float rtWidth;\nuniform float rtHeight;\nattribute vec2 position;\nattribute vec2 texCoord;\nvarying vec4 posPos;\n\nvoid main() {\n  gl_Position = vec4(position, 0.0, 1.0);\n\n  vec2 rcpFrame = vec2(1.0/rtWidth, 1.0/rtHeight);\n  posPos.xy = texCoord.xy;\n  posPos.zw = texCoord.xy - (rcpFrame * (0.5 + FXAA_SUBPIX_SHIFT));\n}\n\n#endif\n\n#ifdef FRAG\n\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#define FXAA_SPAN_MAX     8.0\n\nuniform sampler2D tex0;\nvarying vec4 posPos;\nuniform float rtWidth;\nuniform float rtHeight;\n\n\nvec4 applyFXAA(vec2 fragCoord, sampler2D tex)\n{\n    vec4 color;\n    vec2 inverseVP = vec2(1.0 / rtWidth, 1.0 / rtHeight);\n    vec3 rgbNW = texture2D(tex, (fragCoord + vec2(-1.0, -1.0)) * inverseVP).xyz;\n    vec3 rgbNE = texture2D(tex, (fragCoord + vec2(1.0, -1.0)) * inverseVP).xyz;\n    vec3 rgbSW = texture2D(tex, (fragCoord + vec2(-1.0, 1.0)) * inverseVP).xyz;\n    vec3 rgbSE = texture2D(tex, (fragCoord + vec2(1.0, 1.0)) * inverseVP).xyz;\n    vec3 rgbM  = texture2D(tex, fragCoord  * inverseVP).xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    //return texture2D(tex, fragCoord);\n    //return vec4(fragCoord, 0.0, 1.0);\n    //return vec4(rgbM, 1.0);\n\n    vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n              dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n        texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n        texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n        texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n        texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, 1.0);\n    else\n        color = vec4(rgbB, 1.0);\n    return color;\n}\n\nvoid main() {\n  gl_FragColor = applyFXAA(posPos.xy * vec2(rtWidth, rtHeight), tex0);\n}\n\n//#version 120\n/*\nuniform sampler2D tex0;\nvarying vec4 posPos;\nuniform float rtWidth;\nuniform float rtHeight;\nfloat FXAA_SPAN_MAX = 8.0;\nfloat FXAA_REDUCE_MUL = 1.0/8.0;\n\n#define FxaaInt2 ivec2\n#define FxaaFloat2 vec2\n#define FxaaTexLod0(t, p) texture2DLod(t, p, 0.0)\n#define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)\n\nvec3 FxaaPixelShader(\n  vec4 posPos, // Output of FxaaVertexShader interpolated across screen.\n  sampler2D tex, // Input texture.\n  vec2 rcpFrame) // Constant {1.0/frameWidth, 1.0/frameHeight}.\n{\n//---------------------------------------------------------\n    #define FXAA_REDUCE_MIN   (1.0/128.0)\n    //#define FXAA_REDUCE_MUL   (1.0/8.0)\n    //#define FXAA_SPAN_MAX     8.0\n//---------------------------------------------------------\n    vec3 rgbNW = FxaaTexLod0(tex, posPos.zw).xyz;\n    vec3 rgbNE = FxaaTexOff(tex, posPos.zw, FxaaInt2(1,0), rcpFrame.xy).xyz;\n    vec3 rgbSW = FxaaTexOff(tex, posPos.zw, FxaaInt2(0,1), rcpFrame.xy).xyz;\n    vec3 rgbSE = FxaaTexOff(tex, posPos.zw, FxaaInt2(1,1), rcpFrame.xy).xyz;\n    vec3 rgbM  = FxaaTexLod0(tex, posPos.xy).xyz;\n//---------------------------------------------------------\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n/*---------------------------------------------------------\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n/*---------------------------------------------------------\n    vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n/*---------------------------------------------------------\n    float dirReduce = max(\n        (lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL),\n        FXAA_REDUCE_MIN);\n    float rcpDirMin = 1.0/(min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(FxaaFloat2( FXAA_SPAN_MAX,  FXAA_SPAN_MAX),\n          max(FxaaFloat2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n          dir * rcpDirMin)) * rcpFrame.xy;\n/*--------------------------------------------------------\n    vec3 rgbA = (1.0/2.0) * (\n        FxaaTexLod0(tex, posPos.xy + dir * (1.0/3.0 - 0.5)).xyz +\n        FxaaTexLod0(tex, posPos.xy + dir * (2.0/3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * (1.0/2.0) + (1.0/4.0) * (\n        FxaaTexLod0(tex, posPos.xy + dir * (0.0/3.0 - 0.5)).xyz +\n        FxaaTexLod0(tex, posPos.xy + dir * (3.0/3.0 - 0.5)).xyz);\n    float lumaB = dot(rgbB, luma);\n    if((lumaB < lumaMin) || (lumaB > lumaMax)) return rgbA;\n    return rgbB; }\n\nvec4 PostFX(sampler2D tex, vec2 uv, float time)\n{\n  vec4 c = vec4(0.0);\n  vec2 rcpFrame = vec2(1.0/rt_w, 1.0/rt_h);\n  c.rgb = FxaaPixelShader(posPos, tex, rcpFrame);\n  //c.rgb = 1.0 - texture2D(tex, posPos.xy).rgb;\n  c.a = 1.0;\n  return c;\n}\n\nvoid main()\n{\n  vec2 uv = posPos.xy;\n  gl_FragColor = PostFX(tex0, uv, 0.0);\n}\n\n*/\n\n#endif";i.prototype.fxaa=function(t){t=t||{};var e=this.getOutputSize(t.width,t.height),i=this.getRenderTarget(e.width,e.height,t.depth,t.bpp);i.bind();var r=this.getSourceTexture();r.bind();var o=this.getShader(n);return o.use(),o.uniforms.rtWidth(r.width),o.uniforms.rtHeight(r.height),this.drawFullScreenQuad(e.width,e.height,null,o),i.unbind(),this.asFXStage(i,"fxaa")},e.exports=i}).call(this,"/../../../pex-fx/lib")},{"./FXStage":19,"pex-geom":40}],18:[function(t,e){function i(){this.cache=[]}i.prototype.getResource=function(t,e){e=e||{};for(var i=0;i<this.cache.length;i++){var n=this.cache[i];if(n.type==t&&!n.used){var r=!0;for(var o in e)e[o]!=n.properties[o]&&(r=!1);if(r)return n}}return null},i.prototype.addResource=function(t,e,i){var n={type:t,obj:e,properties:i};return this.cache.push(n),n},i.prototype.markAllAsNotUsed=function(){for(var t=0;t<this.cache.length;t++)this.cache[t].used=!1},e.exports=i},{}],19:[function(t,e){function i(t,e,i){this.id=u++,this.gl=r.currentContext,this.source=t||null,this.resourceMgr=e||new l,this.fullscreenQuad=i||new o,this.defaultBPP=8}var n=t("pex-glu"),r=n.Context,o=n.ScreenImage,s=n.RenderTarget,a=n.Program,h=n.Texture2D,l=t("./FXResourceMgr"),u=0;i.prototype.reset=function(){this.resourceMgr.markAllAsNotUsed()},i.prototype.getOutputSize=function(t,e){if(t&&e)return{width:t,height:e};if(this.source)return{width:this.source.width,height:this.source.height};var i=this.gl.getParameter(this.gl.VIEWPORT);return{width:i[2],height:i[3]}},i.prototype.getRenderTarget=function(t,e,i,n){i=i||!1,n=n||this.defaultBPP;var r={w:t,h:e,depth:i,bpp:n},o=this.resourceMgr.getResource("RenderTarget",r);if(!o){var a=new s(t,e,r);o=this.resourceMgr.addResource("RenderTarget",a,r)}return o.used=!0,o.obj},i.prototype.getFXStage=function(){var t={},e=this.resourceMgr.getResource("FXStage",t);if(!e){var n=new i(null,this.resourceMgr,this.fullscreenQuad);e=this.resourceMgr.addResource("FXStage",n,t)}return e.used=!0,e.obj},i.prototype.asFXStage=function(t,e){var i=this.getFXStage(e);return i.source=t,i.name=e+"_"+i.id,i},i.prototype.getShader=function(t){if(t.indexOf(".glsl")==t.length-5)throw"FXStage.getShader - loading files not supported yet.";var e={code:t},i=this.resourceMgr.getResource("Program",e);if(!i){var n=new a(t);i=this.resourceMgr.addResource("Program",n,e)}return i.used=!0,i.obj},i.prototype.getSourceTexture=function(t){if(t)return t.source?t.source.getColorAttachment?t.source.getColorAttachment(0):t.source:t.getColorAttachment?t.getColorAttachment(0):t;if(this.source)return this.source.getColorAttachment?this.source.getColorAttachment(0):this.source;throw"FXStage.getSourceTexture() No source texture!"},i.prototype.drawFullScreenQuad=function(t,e,i,n){this.drawFullScreenQuadAt(0,0,t,e,i,n)},i.prototype.drawFullScreenQuadAt=function(t,e,i,r,o,s){var a=this.gl;a.disable(a.DEPTH_TEST);var h=a.getParameter(a.VIEWPORT);
n.viewport(t,e,i,r,!1),this.fullscreenQuad.draw(o,s),n.viewport(h[0],h[1],h[2],h[3],!1)},i.prototype.getImage=function(t){var e={path:t},i=this.resourceMgr.getResource("Image",e);if(!i){var n=h.load(t);i=this.resourceMgr.addResource("Image",n,e)}return i.used=!1,i.obj},i.prototype.getFullScreenQuad=function(){return this.fullscreenQuad},e.exports=i},{"./FXResourceMgr":18,"pex-glu":60}],20:[function(t,e){(function(){var i=t("./FXStage"),n="#ifdef VERT\n\nattribute vec2 position;\nattribute vec2 texCoord;\nvarying vec2 vTexCoord;\n\nvoid main() {\n  gl_Position = vec4(position, 0.0, 1.0);\n  vTexCoord = texCoord;\n}\n\n#endif\n\n#ifdef FRAG\n\nvarying vec2 vTexCoord;\nuniform sampler2D tex0;\nuniform sampler2D tex1;\n\nvoid main() {\n  vec4 color = texture2D(tex0, vTexCoord);\n  vec4 color2 = texture2D(tex1, vTexCoord);\n\n  gl_FragColor = color * color2;\n}\n\n#endif";i.prototype.mult=function(t,e){e=e||{};var i=this.getOutputSize(e.width,e.height),r=this.getRenderTarget(i.width,i.height,e.depth,e.bpp);r.bind(),this.getSourceTexture().bind(0),this.getSourceTexture(t).bind(1);var o=this.getShader(n);return o.use(),o.uniforms.tex0(0),o.uniforms.tex1(1),this.drawFullScreenQuad(i.width,i.height,null,o),r.unbind(),this.asFXStage(r,"mult")},e.exports=i}).call(this,"/../../../pex-fx/lib")},{"./FXStage":19}],21:[function(t){var e=t("./FXStage");e.prototype.render=function(t){var e=this.gl,i=this.getOutputSize(t.width,t.height),n=this.getRenderTarget(i.width,i.height,t.depth,t.bpp),r=e.getParameter(e.VIEWPORT);return e.viewport(0,0,i.width,i.height),n.bindAndClear(),t.drawFunc&&t.drawFunc(),n.unbind(),e.viewport(r[0],r[1],r[2],r[3]),this.asFXStage(n,"render")}},{"./FXStage":19}],22:[function(t,e){(function(){var i=t("./FXStage"),n=t("pex-geom"),r=(t("pex-glu"),n.Vec2),o="//based on http://blenderartists.org/forum/showthread.php?184102-nicer-and-faster-SSAO and http://www.pasteall.org/12299\n#ifdef VERT\n\nattribute vec2 position;\nattribute vec2 texCoord;\n\nvarying vec2 vTexCoord;\n\nvoid main() {\n  gl_Position = vec4(position, 0.0, 1.0);\n  vTexCoord = texCoord;\n}\n\n#endif\n\n#ifdef FRAG\n\n#define PI    3.14159265\n\nvarying vec2 vTexCoord;\n\nuniform sampler2D depthMap;\nuniform vec2 textureSize;\nuniform float near;\nuniform float far;\n\nconst int samples = 3;\nconst int rings = 5;\n\nuniform float strength;\nuniform float offset;\n\nvec2 rand(vec2 coord) {\n  float noiseX = (fract(sin(dot(coord, vec2(12.9898,78.233))) * 43758.5453));\n  float noiseY = (fract(sin(dot(coord, vec2(12.9898,78.233) * 2.0)) * 43758.5453));\n  return vec2(noiseX,noiseY) * 0.004;\n}\n\nfloat compareDepths( in float depth1, in float depth2 )\n{\n  float depthTolerance = far / 5.0;\n  float occlusionTolerance = far / 100.0;\n  float diff = (depth1 - depth2);\n\n  if (diff <= 0.0) return 0.0;\n  if (diff > depthTolerance) return 0.0;\n  if (diff < occlusionTolerance) return 0.0;\n\n  return 1.0;\n}\n\n//fron depth buf normalized z to linear (eye space) z\n//http://stackoverflow.com/questions/6652253/getting-the-true-z-value-from-the-depth-buffer\nfloat readDepth(vec2 coord) {\n  float z_b = texture2D(depthMap, coord).r;\n  float z_n = 2.0 * z_b - 1.0;\n  float z_e = 2.0 * near * far / (far + near - z_n * (far - near));\n  return z_e;\n}\n\nvoid main() {\n  vec2 texCoord = vec2(gl_FragCoord.x / textureSize.x, gl_FragCoord.y / textureSize.y);\n  float depth = readDepth(texCoord);\n  float z_b = texture2D(depthMap, texCoord).r;\n\n  float d;\n\n  float aspect = textureSize.x / textureSize.y;\n  vec2 noise = rand(vTexCoord);\n\n  float w = (1.0 / textureSize.x)/clamp(z_b,0.1,1.0)+(noise.x*(1.0-noise.x));\n  float h = (1.0 / textureSize.y)/clamp(z_b,0.1,1.0)+(noise.y*(1.0-noise.y));\n\n  float pw;\n  float ph;\n\n  float ao = 0.0;\n  float s = 0.0;\n  float fade = 4.0;\n\n  for (int i = 0 ; i < rings; i += 1)\n  {\n    fade *= 0.5;\n    for (int j = 0 ; j < samples*rings; j += 1)\n    {\n      if (j >= samples*i) break;\n      float step = PI * 2.0 / (float(samples) * float(i));\n      float r = 4.0 * float(i);\n      pw = r * (cos(float(j)*step));\n      ph = r * (sin(float(j)*step)) * aspect;\n      d = readDepth( vec2(texCoord.s + pw * w,texCoord.t + ph * h));\n      ao += compareDepths(depth, d) * fade;\n      s += 1.0 * fade;\n    }\n  }\n\n  ao /= s;\n  ao = clamp(ao, 0.0, 1.0);\n  ao = 1.0 - ao;\n  ao = offset + (1.0 - offset) * ao;\n  ao = pow(ao, strength);\n\n  gl_FragColor = vec4(ao, ao, ao, 1.0);\n}\n\n#endif";i.prototype.ssao=function(t){t=t||{};var e=this.getOutputSize(t.width,t.height),i=this.getRenderTarget(e.width,e.height,t.depth,t.bpp);i.bind();var n=this.getSourceTexture(t.depthMap);n.bind(0);var s=this.getShader(o);return s.use(),s.uniforms.textureSize(r.create(e.width,e.height)),s.uniforms.depthMap(0),s.uniforms.near(t.camera.getNear()),s.uniforms.far(t.camera.getFar()),s.uniforms.strength&&s.uniforms.strength("undefined"!=typeof t.strength?t.strength:1),s.uniforms.offset&&s.uniforms.offset("undefined"!=typeof t.offset?t.offset:0),this.drawFullScreenQuad(e.width,e.height,null,s),i.unbind(),this.asFXStage(i,"ssao")},e.exports=i}).call(this,"/../../../pex-fx/lib")},{"./FXStage":19,"pex-geom":40,"pex-glu":60}],23:[function(t,e){(function(){var i=(t("pex-geom"),t("pex-glu")),n=t("./FXStage"),r="#ifdef VERT\n\nattribute vec2 position;\nattribute vec2 texCoord;\nvarying vec2 vTexCoord;\n\nvoid main() {\n  gl_Position = vec4(position, 0.0, 1.0);\n  vTexCoord = texCoord;\n}\n\n#endif\n\n#ifdef FRAG\n\nvarying vec2 vTexCoord;\nuniform sampler2D tex0;\n\nvoid main() {\n  gl_FragColor = texture2D(tex0, vTexCoord);\n}\n\n#endif",o=function(t,e,i){for(var n=""+t;n.length<i;)n=e+n;return n};n.prototype.save=function(t,e){t=t||".",e=e||{};var n=this.getOutputSize(e.width,e.height),s=this.getRenderTarget(n.width,n.height,e.depth,e.bpp);s.bind(),this.getSourceTexture().bind(0);var a=this.getShader(r);a.use(),a.uniforms.tex0(0);var h=this.gl.getParameter(this.gl.VIEWPORT);i.viewport(0,0,n.width,n.height,!1),this.drawFullScreenQuad(n.width,n.height,null,a);var l=new Date,u=t+"/screenshot_";return u+=l.getFullYear()+"-"+o(l.getMonth()+1,"0",2)+"-"+o(l.getDate(),"0",2),u+="_"+o(l.getHours(),"0",2)+":"+o(l.getMinutes(),"0",2)+":"+o(l.getSeconds(),"0",2)+".png",this.gl.writeImage("png",u),console.log("Saved",u),i.viewport(h[0],h[1],h[2],h[3],!1),s.unbind(),this.asFXStage(s,"save")},e.exports=n}).call(this,"/../../../pex-fx/lib")},{"./FXStage":19,"pex-geom":40,"pex-glu":60}],24:[function(t,e){(function(){var i=t("./FXStage"),n="#ifdef VERT\n\nattribute vec2 position;\nattribute vec2 texCoord;\nvarying vec2 vTexCoord;\n\nvoid main() {\n  gl_Position = vec4(position, 0.0, 1.0);\n  vTexCoord = texCoord;\n}\n\n#endif\n\n#ifdef FRAG\n\nvarying vec2 vTexCoord;\nuniform float exposure;\nuniform sampler2D tex0;\n\nvoid main() {\n  vec4 color = texture2D(tex0, vTexCoord).rgba;\n  color.rgb *= exposure;\n  color = color/(1.0 + color);\n  vec3 retColor = color.rgb;\n  gl_FragColor.rgb = retColor;\n  gl_FragColor.a = color.a;\n}\n\n#endif";i.prototype.tonemapReinhard=function(t){t=t||{exposure:1};var e=this.getOutputSize(t.width,t.height),i=this.getRenderTarget(e.width,e.height,t.depth,t.bpp);i.bind(),this.getSourceTexture().bind(0);var r=this.getShader(n);return r.use(),r.uniforms.tex0(0),r.uniforms.exposure(t.exposure),this.drawFullScreenQuad(e.width,e.height,null,r),i.unbind(),this.asFXStage(i,"tonemapReinhard")},e.exports=i}).call(this,"/../../../pex-fx/lib")},{"./FXStage":19}],25:[function(t,e){e.exports.Plane=t("./lib/Plane"),e.exports.Cube=t("./lib/Cube"),e.exports.Box=t("./lib/Box"),e.exports.Sphere=t("./lib/Sphere"),e.exports.Tetrahedron=t("./lib/Tetrahedron"),e.exports.Octahedron=t("./lib/Octahedron"),e.exports.Icosahedron=t("./lib/Icosahedron"),e.exports.Dodecahedron=t("./lib/Dodecahedron"),e.exports.HexSphere=t("./lib/HexSphere"),e.exports.LineBuilder=t("./lib/LineBuilder"),e.exports.Loft=t("./lib/Loft"),e.exports.IsoSurface=t("./lib/IsoSurface"),e.exports.Cylinder=t("./lib/Cylinder")},{"./lib/Box":26,"./lib/Cube":27,"./lib/Cylinder":28,"./lib/Dodecahedron":29,"./lib/HexSphere":30,"./lib/Icosahedron":31,"./lib/IsoSurface":32,"./lib/LineBuilder":33,"./lib/Loft":34,"./lib/Octahedron":35,"./lib/Plane":36,"./lib/Sphere":37,"./lib/Tetrahedron":38}],26:[function(t,e){function i(t,e,i){t=null!=t?t:1,e=null!=e?e:null!=t?t:1,i=null!=i?i:null!=t?t:1,o.call(this,{vertices:!0,faces:!0});var n=this.vertices,s=this.faces,a=t/2,h=e/2,l=i/2;n.push(new r(-a,-h,-l)),n.push(new r(-a,-h,l)),n.push(new r(a,-h,l)),n.push(new r(a,-h,-l)),n.push(new r(-a,h,-l)),n.push(new r(-a,h,l)),n.push(new r(a,h,l)),n.push(new r(a,h,-l)),s.push([0,3,2,1]),s.push([4,5,6,7]),s.push([0,1,5,4]),s.push([2,3,7,6]),s.push([1,2,6,5]),s.push([3,0,4,7]),this.computeNormals()}var n=t("pex-geom"),r=(n.Vec2,n.Vec3),o=n.Geometry;i.prototype=Object.create(o.prototype),e.exports=i},{"pex-geom":40}],27:[function(t,e){function i(t,e,i,n,a,h){function l(t,e,i,n,s,a,h,l,g,m){for(var x=f,v=0;h>=v;v++)for(var y=0;a>=y;y++)vert=u[f]=o.create(),vert[t]=(-n/2+y*n/a)*g,vert[e]=(-s/2+v*s/h)*m,vert[i]=l,normal=p[f]=o.create(),normal[t]=0,normal[e]=0,normal[i]=l/Math.abs(l),texCoord=c[f]=r.create(),texCoord.x=y/a,texCoord.y=1-v/h,++f;for(var v=0;h-1>=v;v++)for(var y=0;a-1>=y;y++){var w=x+v*(a+1)+y;d.push([w,w+a+1,w+a+2,w+1])}}t=null!=t?t:1,e=null!=e?e:null!=t?t:1,i=null!=i?i:null!=t?t:1,n=n||1,a=a||1,h=h||1,s.call(this,{vertices:!0,normals:!0,texCoords:!0,faces:!0});var u=this.vertices,c=this.texCoords,p=this.normals,d=this.faces,f=0;l("x","y","z",t,e,n,a,i/2,1,-1),l("x","y","z",t,e,n,a,-i/2,-1,-1),l("z","y","x",i,e,h,a,-t/2,1,-1),l("z","y","x",i,e,h,a,t/2,-1,-1),l("x","z","y",t,i,n,h,e/2,1,1),l("x","z","y",t,i,n,h,-e/2,1,-1),this.computeEdges()}var n=t("pex-geom"),r=n.Vec2,o=n.Vec3,s=n.Geometry;i.prototype=Object.create(s.prototype),e.exports=i},{"pex-geom":40}],28:[function(t,e){function i(t,e,i,n,a,h,l,u){e=null!=e?e:.5,t=null!=t?t:.5,i=null!=i?i:1,n=null!=n?n:8,a=null!=a?a:4,h=null!=h?h:!0,l=null!=l?l:!0,u=null!=u?u:!0,s.call(this,{vertices:!0,normals:!0,texCoords:!0,faces:!0});var c=this.vertices,p=this.texCoords,d=this.normals,f=this.faces,g=0,m=-i/2;u||(m=0);for(var x=0;a>=x;x++)for(var v=0;n>=v;v++){var y=t+(e-t)*x/a,w=m+i*x/a,b=y*Math.cos(v/n*Math.PI*2),C=y*Math.sin(v/n*Math.PI*2);c.push(new o(b,w,C)),d.push(new o(b,0,C)),p.push(new r(v/n,x/a)),n>v&&a>x&&f.push([g+1,g,g+n+1,g+n+1+1]),g++}if(h){c.push(new o(0,m,0)),d.push(new o(0,-1,0)),p.push(new r(0,0));var T=g;g++;for(var v=0;n>=v;v++){var w=m,b=t*Math.cos(v/n*Math.PI*2),C=t*Math.sin(v/n*Math.PI*2);c.push(new o(b,w,C)),n>v&&f.push([g,g+1,T]),d.push(new o(0,-1,0)),p.push(new r(0,0)),g++}}if(l){c.push(new o(0,m+i,0)),d.push(new o(0,1,0)),p.push(new r(0,0));var T=g;g++;for(var v=0;n>=v;v++){var w=m+i,b=e*Math.cos(v/n*Math.PI*2),C=e*Math.sin(v/n*Math.PI*2);c.push(new o(b,w,C)),n>v&&f.push([g+1,g,T]),d.push(new o(0,1,0)),p.push(new r(1,1)),g++}}this.computeEdges()}var n=t("pex-geom"),r=n.Vec2,o=n.Vec3,s=n.Geometry;i.prototype=Object.create(s.prototype),e.exports=i},{"pex-geom":40}],29:[function(t,e){function i(t){t=t||.5;var e=(1+Math.sqrt(5))/2,i=.5,n=.5/e,s=.5*(2-e),a=[new r(s,0,i),new r(-s,0,i),new r(-n,n,n),new r(0,i,s),new r(n,n,n),new r(n,-n,n),new r(0,-i,s),new r(-n,-n,n),new r(s,0,-i),new r(-s,0,-i),new r(-n,-n,-n),new r(0,-i,-s),new r(n,-n,-n),new r(n,n,-n),new r(0,i,-s),new r(-n,n,-n),new r(i,s,0),new r(-i,s,0),new r(-i,-s,0),new r(i,-s,0)];a=a.map(function(e){return e.normalize().scale(t)});var h=[[4,3,2,1,0],[7,6,5,0,1],[12,11,10,9,8],[15,14,13,8,9],[14,3,4,16,13],[3,14,15,17,2],[11,6,7,18,10],[6,11,12,19,5],[4,0,5,19,16],[12,8,13,16,19],[15,9,10,18,17],[7,1,2,17,18]],l=[[0,1],[0,4],[0,5],[1,2],[1,7],[2,3],[2,17],[3,4],[3,14],[4,16],[5,6],[5,19],[6,7],[6,11],[7,18],[8,9],[8,12],[8,13],[9,10],[9,15],[10,11],[10,18],[11,12],[12,19],[13,14],[13,16],[14,15],[15,17],[16,19],[17,18]];o.call(this,{vertices:a,faces:h,edges:l})}var n=t("pex-geom"),r=n.Vec3,o=n.Geometry;i.prototype=Object.create(o.prototype),e.exports=i},{"pex-geom":40}],30:[function(t,e){function i(t){return t.face.halfEdges[(t.slot-1+t.face.length)%t.face.length]}function n(t,e){var n=t;do e(n),n=i(n).opposite;while(n!=t)}function r(t){var e=(t.length,t.reduce(function(t,e){return t.add(e)},new h(0,0,0)));return e.scale(1/t.length),e}function o(t,e){return e.map(function(e){return t[e]})}function s(t,e){t=t||.5,e=e||1;for(var i=new u(t),s=0;e>s;s++)i=i.subdivideEdges();var a=[],h=[],c=[],p=i.computeHalfEdges();p.forEach(function(t){c[t.face[t.slot]]=t});for(var s=0;s<i.vertices.length;s++){var d=a.length,f=[];n(c[s],function(t){var e=r(o(i.vertices,t.face));f.push(e)}),f.forEach(function(t){a.push(t)}),5==f.length&&h.push([d,d+1,d+2,d+3,d+4]),6==f.length&&h.push([d,d+1,d+2,d+3,d+4,d+5])}a.forEach(function(e){e.normalize().scale(t)}),l.call(this,{vertices:a,faces:h}),this.computeEdges()}var a=t("pex-geom"),h=a.Vec3,l=a.Geometry,u=t("./Icosahedron");s.prototype=Object.create(l.prototype),e.exports=s},{"./Icosahedron":31,"pex-geom":40}],31:[function(t,e){function i(t){t=t||.5;var e=(1+Math.sqrt(5))/2,i=.5,n=1/(2*e),s=[new r(0,n,-i),new r(n,i,0),new r(-n,i,0),new r(0,n,i),new r(0,-n,i),new r(-i,0,n),new r(i,0,n),new r(0,-n,-i),new r(i,0,-n),new r(-i,0,-n),new r(n,-i,0),new r(-n,-i,0)];s=s.map(function(e){return e.normalize().scale(t)});var a=[[1,0,2],[2,3,1],[4,3,5],[6,3,4],[7,0,8],[9,0,7],[10,4,11],[11,7,10],[5,2,9],[9,11,5],[8,1,6],[6,10,8],[5,3,2],[1,3,6],[2,0,9],[8,0,1],[9,7,11],[10,7,8],[11,4,5],[6,4,10]],h=[[0,1],[0,2],[0,7],[0,8],[0,9],[1,2],[1,3],[1,6],[1,8],[2,3],[2,5],[2,9],[3,4],[3,5],[3,6],[4,5],[4,6],[4,10],[4,11],[5,9],[5,11],[6,8],[6,10],[7,8],[7,9],[7,10],[7,11],[8,10],[9,11],[10,11]];o.call(this,{vertices:s,faces:a,edges:h})}var n=t("pex-geom"),r=n.Vec3,o=n.Geometry;i.prototype=Object.create(o.prototype),e.exports=i},{"pex-geom":40}],32:[function(t,e){function i(t,e){e=e||1,this.numOfGridPts=t,this.tresholdValue=1,this.makeGrid(e)}var n=t("pex-geom"),r=n.Vec2,o=n.Vec3,s=n.Geometry;i.prototype.makeGrid=function(t){2/(this.numOfGridPts-1);this.grid=[];for(var e=0;e<this.numOfGridPts;e++){this.grid[e]=[];for(var i=0;i<this.numOfGridPts;i++){this.grid[e][i]=[];for(var n=0;n<this.numOfGridPts;n++)this.grid[e][i][n]={value:0,position:new o((e/(this.numOfGridPts-1)-.5)*t,(i/(this.numOfGridPts-1)-.5)*t,(n/(this.numOfGridPts-1)-.5)*t),normal:new o(0,0,0)}}}this.cubes=[];for(var e=0;e<this.numOfGridPts-1;e++){this.cubes[e]=[];for(var i=0;i<this.numOfGridPts-1;i++){this.cubes[e][i]=[];for(var n=0;n<this.numOfGridPts-1;n++)this.cubes[e][i][n]={vert:[]},this.cubes[e][i][n].vert[0]=this.grid[e][i][n],this.cubes[e][i][n].vert[1]=this.grid[e+1][i][n],this.cubes[e][i][n].vert[2]=this.grid[e+1][i][n+1],this.cubes[e][i][n].vert[3]=this.grid[e][i][n+1],this.cubes[e][i][n].vert[4]=this.grid[e][i+1][n],this.cubes[e][i][n].vert[5]=this.grid[e+1][i+1][n],this.cubes[e][i][n].vert[6]=this.grid[e+1][i+1][n+1],this.cubes[e][i][n].vert[7]=this.grid[e][i+1][n+1]}}},i.prototype.update=function(t){for(var e=this.grid,i=0;i<this.numOfGridPts;i++)for(var n=0;n<this.numOfGridPts;n++)for(var r=0;r<this.numOfGridPts;r++)e[i][n][r].value=this.findValue(e[i][n][r].position,t);for(i=1;i<this.numOfGridPts-1;i++)for(n=1;n<this.numOfGridPts-1;n++)for(r=1;r<this.numOfGridPts-1;r++)e[i][n][r].normal.x=e[i-1][n][r].value-e[i+1][n][r].value,e[i][n][r].normal.y=e[i][n-1][r].value-e[i][n+1][r].value,e[i][n][r].normal.z=e[i][n][r-1].value-e[i][n][r+1].value;this.geom?(this.geom.vertices.length=0,this.geom.normals.length=0,this.geom.texCoords.length=0,this.geom.faces.length=0,this.geom.vertices.dirty=!0,this.geom.normals.dirty=!0,this.geom.texCoords.dirty=!0,this.geom.faces.dirty=!0):this.geom=new s({vertices:!0,normals:!0,texCoords:!0,faces:!0});for(var i=0;i<this.numOfGridPts-1;i++)for(var n=0;n<this.numOfGridPts-1;n++)for(var r=0;r<this.numOfGridPts-1;r++)this.marchCube(i,n,r);return this.geom},i.prototype.marchCube=function(t,e,i){var n,o,s,l,u=0,c=[{},{},{},{},{},{},{},{},{},{},{},{}],p=this.cubes[t][e][i];if(p.vert[0].value>this.tresholdValue&&(u|=1),p.vert[1].value>this.tresholdValue&&(u|=2),p.vert[2].value>this.tresholdValue&&(u|=4),p.vert[3].value>this.tresholdValue&&(u|=8),p.vert[4].value>this.tresholdValue&&(u|=16),p.vert[5].value>this.tresholdValue&&(u|=32),p.vert[6].value>this.tresholdValue&&(u|=64),p.vert[7].value>this.tresholdValue&&(u|=128),n=a[u],0!=n){1&n&&this.interpolate(p.vert[0],p.vert[1],c[0]),2&n&&this.interpolate(p.vert[1],p.vert[2],c[1]),4&n&&this.interpolate(p.vert[2],p.vert[3],c[2]),8&n&&this.interpolate(p.vert[3],p.vert[0],c[3]),16&n&&this.interpolate(p.vert[4],p.vert[5],c[4]),32&n&&this.interpolate(p.vert[5],p.vert[6],c[5]),64&n&&this.interpolate(p.vert[6],p.vert[7],c[6]),128&n&&this.interpolate(p.vert[7],p.vert[4],c[7]),256&n&&this.interpolate(p.vert[0],p.vert[4],c[8]),512&n&&this.interpolate(p.vert[1],p.vert[5],c[9]),1024&n&&this.interpolate(p.vert[2],p.vert[6],c[10]),2048&n&&this.interpolate(p.vert[3],p.vert[7],c[11]);var d=this.geom.vertices.length;for(o=0;5>o&&!(h[u][3*o]<0);o++){for(var f=c[h[u][3*o+1]].position.dup().sub(c[h[u][3*o+0]].position),g=c[h[u][3*o+2]].position.dup().sub(c[h[u][3*o+0]].position),s=(f.dup().cross(g),0);3>s;s++)l=c[h[u][3*o+s]],this.geom.vertices.push(l.position),this.geom.normals.push(l.normal),this.geom.texCoords.push(new r(.5*l.normal.x+.5,.5*l.normal.y+.5));this.geom.faces.push([d++,d++,d++])}}},i.prototype.interpolate=function(t,e,i){var n=e.value-t.value;0==n&&(n=0);var r=(this.tresholdValue-t.value)/n;i.position=t.position.dup().add(e.position.dup().sub(t.position).dup().scale(r)),i.normal=t.normal.dup().add(e.normal.dup().sub(t.normal).dup().scale(r));var o=i.normal.length();o=0==o?1:1/o,i.normal=i.normal.dup().scale(o)},i.prototype.findValue=function(t,e){for(var i=0,n=0;n<e.length;n++){var r=t.squareDistance(e[n].position);0==r&&(len=1);var o=e[n].radius,s=e[n].force;i+=s*o*o*e[n].radius/r}return i};var a=[0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0],h=[[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1],[3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1],[3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1],[3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1],[9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1],[1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1],[9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1],[2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1],[8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1],[9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1],[4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1],[3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1],[1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1],[4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1],[4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1],[9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1],[1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1],[5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1],[2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1],[9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1],[0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1],[2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1],[10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1],[4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1],[5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1],[5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1],[9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1],[0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1],[1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1],[10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1],[8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1],[2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1],[7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1],[9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1],[2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1],[11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1],[9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1],[5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1],[11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1],[11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1],[1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1],[9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1],[5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1],[2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1],[0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1],[5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1],[6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1],[0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1],[3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1],[6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1],[5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1],[1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1],[10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1],[6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1],[1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1],[8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1],[7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1],[3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1],[5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1],[0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1],[9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1],[8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1],[5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1],[0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1],[6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1],[10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1],[10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1],[8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1],[1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1],[3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1],[0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1],[10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1],[0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1],[3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1],[6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1],[9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1],[8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1],[3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1],[6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1],[0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1],[10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1],[10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1],[1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1],[2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1],[7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1],[7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1],[2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1],[1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1],[11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1],[8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1],[0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1],[7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1],[10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1],[2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1],[6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1],[7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1],[2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1],[1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1],[10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1],[10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1],[0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1],[7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1],[6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1],[8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1],[9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1],[6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1],[1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1],[4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1],[10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1],[8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1],[0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1],[1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1],[8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1],[10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1],[4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1],[10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1],[5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1],[11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1],[9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1],[6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1],[7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1],[3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1],[7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1],[9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1],[3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1],[6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1],[9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1],[1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1],[4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1],[7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1],[6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1],[3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1],[0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1],[6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1],[1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1],[0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1],[11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1],[6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1],[5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1],[9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1],[1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1],[1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1],[10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1],[0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1],[5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1],[10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1],[11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1],[0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1],[9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1],[7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1],[2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1],[8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1],[9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1],[9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1],[1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1],[9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1],[9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1],[5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1],[0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1],[10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1],[2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1],[0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1],[0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1],[9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1],[5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1],[3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1],[5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1],[8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1],[0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1],[9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1],[0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1],[1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1],[3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1],[4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1],[9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1],[11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1],[11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1],[2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1],[9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1],[3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1],[1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1],[4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1],[4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1],[0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1],[3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1],[3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1],[0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1],[9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1],[1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]];e.exports=i},{"pex-geom":40}],33:[function(t,e){function i(){o.call(this,{vertices:!0,colors:!0})}var n=t("pex-geom"),r=n.Vec3,o=n.Geometry;i.prototype=Object.create(o.prototype),i.prototype.addLine=function(t,e,i,n){return i=i||{r:1,g:1,b:1,a:1},n=n||i,this.vertices.push(r.create().copy(t)),this.vertices.push(r.create().copy(e)),this.colors.push(i),this.colors.push(n),this.vertices.dirty=!0,this.colors.dirty=!0,this},i.prototype.addPath=function(t,e,i,n){i=i||t.points.length,e=e||{r:1,g:1,b:1,a:1};var r=t.getPointAt(0);n&&this.addCross(r,.1,e);for(var o=1;i>o;o++){var s;s=t.points.length==i?t.getPoint(o/(i-1)):t.getPointAt(o/(i-1)),this.addLine(r,s,e),r=s,n&&this.addCross(r,.1,e)}return this.vertices.dirty=!0,this.colors.dirty=!0,this},i.prototype.addCross=function(t,e,i){e=e||.1;var n=e/2;return i=i||{r:1,g:1,b:1,a:1},this.vertices.push(r.create().set(t.x-n,t.y,t.z)),this.vertices.push(r.create().set(t.x+n,t.y,t.z)),this.vertices.push(r.create().set(t.x,t.y-n,t.z)),this.vertices.push(r.create().set(t.x,t.y+n,t.z)),this.vertices.push(r.create().set(t.x,t.y,t.z-n)),this.vertices.push(r.create().set(t.x,t.y,t.z+n)),this.colors.push(i),this.colors.push(i),this.colors.push(i),this.colors.push(i),this.colors.push(i),this.colors.push(i),this},i.prototype.reset=function(){return this.vertices.length=0,this.colors.length=0,this.vertices.dirty=!0,this.colors.dirty=!0,this},e.exports=i},{"pex-geom":40}],34:[function(t,e){function i(t,e,i){return Math.max(e,Math.min(t,i))}function n(t,e){e=e||{},s.call(this,{vertices:!0,normals:!0,texCoords:!0,edges:!1,faces:!0});var i={numSteps:200,numSegments:8,r:.3,shapePath:null,xShapeScale:1,caps:!1,initialNormal:null,adjustAngle:0};t.samplesCount=5e3,e.shapePath&&!e.numSegments&&(e.numSegments=e.shapePath.points.length),this.options=e=r(i,e),this.path=t,t.isClosed()&&(e.caps=!1),this.shapePath=e.shapePath||this.makeShapePath(e.numSegments),this.adjustAngle=e.adjustAngle,this.rfunc=this.makeRadiusFunction(e.r),this.rufunc=e.ru?this.makeRadiusFunction(e.ru):this.rfunc,this.rvfunc=e.rv?this.makeRadiusFunction(e.rv):e.ru?this.rufunc:this.rfunc,this.points=this.samplePoints(t,e.numSteps,t.isClosed()),this.tangents=this.sampleTangents(t,e.numSteps,t.isClosed()),this.frames=this.makeFrames(this.points,this.tangents,t.isClosed()),this.buildGeometry(e.caps)
}var r=t("merge"),o=t("pex-geom"),s=o.Geometry,a=o.Vec2,h=o.Vec3,l=o.Mat4,u=o.Quat,c=o.Path,d=o.Spline1D,f=(o.Spline3D,Math.acos),g=Math.PI,m=(Math.min,t("./LineBuilder")),x=1e-5;n.prototype=Object.create(s.prototype),n.prototype.buildGeometry=function(t){t="undefined"!=typeof t?t:!1;for(var e=0,i=this.options.numSteps,n=this.options.numSegments,r=0;r<this.frames.length;r++)for(var o=this.frames[r],s=this.rufunc(r,i),h=this.rvfunc(r,i),l=0;n>l;l++)p=n==this.shapePath.points.length?this.shapePath.getPoint(l/(n-1)):this.shapePath.getPointAt(l/(n-1)),p.x*=s,p.y*=h,p=p.transformMat4(o.m).add(o.position),this.vertices.push(p),this.texCoords.push(new a(l/n,r/i)),this.normals.push(p.dup().sub(o.position).normalize());t&&(this.vertices.push(this.frames[0].position),this.texCoords.push(new a(0,0)),this.normals.push(this.frames[0].tangent.dup().scale(-1)),this.vertices.push(this.frames[this.frames.length-1].position),this.texCoords.push(new a(0,0)),this.normals.push(this.frames[this.frames.length-1].tangent.dup().scale(-1))),e=0;for(var r=0;r<this.frames.length;r++){for(var l=0;n>l;l++)i-1>r&&this.faces.push([e+(l+1)%n+n,e+(l+1)%n,e+l,e+l+n]);e+=n}if(this.path.isClosed()){e-=n;for(var l=0;n>l;l++)this.faces.push([(l+1)%n,e+(l+1)%n,e+l,l])}if(t)for(var l=0;n>l;l++)this.faces.push([l,(l+1)%n,this.vertices.length-2]),this.faces.push([this.vertices.length-1,e-n+(l+1)%n,e-n+l])},n.prototype.makeShapePath=function(t){for(var e=new c,i=0;t>i;i++){var n=i/t,r=2*n*Math.PI,o=new h(Math.cos(r),Math.sin(r),0);e.addPoint(o)}return e.close(),e},n.prototype.makeFrames=function(t,e,n,r){null==r&&(r=0);var o=e[0],s=Math.abs(o.x),a=Math.abs(o.y),c=Math.abs(o.z),p=null;p=o.dup().cross(c>s&&c>=a?new h(0,1,0):a>s&&a>=c?new h(1,0,0):new h(0,0,1));var d=this.options.initialNormal||h.create().asCross(o,p).normalize(),m=h.create().asCross(o,d).normalize(),v=[],y=new u;p=new h;for(var w=0;w<this.points.length;w++){var b=t[w];o=e[w],w>0&&(d=d.dup(),m=m.dup(),prevTangent=e[w-1],p.asCross(prevTangent,o),p.length()>x&&(p.normalize(),theta=f(prevTangent.dot(o)),y.setAxisAngle(p,180*theta/g),d.transformQuat(y)),m.asCross(o,d));var C=(new l).set4x4r(m.x,d.x,o.x,0,m.y,d.y,o.y,0,m.z,d.z,o.z,0,0,0,0,1);v.push({tangent:o,normal:d,binormal:m,position:b,m:C})}return n&&(firstNormal=v[0].normal,lastNormal=v[v.length-1].normal,theta=Math.acos(i(firstNormal.dot(lastNormal),0,1)),theta/=v.length-1,e[0].dot(p.asCross(firstNormal,lastNormal))>0&&(theta=-theta),v.forEach(function(t,e){y.setAxisAngle(t.tangent,theta*e*180/g),t.normal.transformQuat(y),t.binormal.asCross(t.tangent,t.normal),t.m.set4x4r(t.binormal.x,t.normal.x,t.tangent.x,0,t.binormal.y,t.normal.y,t.tangent.y,0,t.binormal.z,t.normal.z,t.tangent.z,0,0,0,0,1)})),v},n.prototype.samplePoints=function(t,e,i){for(var n=[],r=i?e:e-1,o=0;e>o;o++)n.push(t.getPointAt(o/r));return n},n.prototype.sampleTangents=function(t,e,i){for(var n=[],r=i?e:e-1,o=0;e>o;o++)n.push(t.getTangentAt(o/r));return n},n.prototype.makeRadiusFunction=function(t){var e;return e=t instanceof d?function(e,i){return t.getPointAt(e/(i-1))}:function(){return t}},n.prototype.toDebugLines=function(t){t=t||.5;var e=new m,i={r:1,g:0,b:0,a:1},n={r:0,g:1,b:0,a:1},r={r:0,g:.5,b:1,a:1};return this.frames.forEach(function(o){e.addLine(o.position,o.position.dup().add(o.tangent.dup().scale(t)),i,i),e.addLine(o.position,o.position.dup().add(o.normal.dup().scale(t)),n,n),e.addLine(o.position,o.position.dup().add(o.binormal.dup().scale(t)),r,r)}),e},e.exports=n},{"./LineBuilder":33,merge:39,"pex-geom":40}],35:[function(t,e){function i(t){t=t||.5;var e=1/(2*Math.sqrt(2)),i=.5,n=(Math.sqrt(3),Math.sqrt(6),[new r(-e,0,e),new r(e,0,e),new r(e,0,-e),new r(-e,0,-e),new r(0,i,0),new r(0,-i,0)]);n=n.map(function(e){return e.normalize().scale(t)});var s=[[3,0,4],[2,3,4],[1,2,4],[0,1,4],[3,2,5],[0,3,5],[2,1,5],[1,0,5]],a=[[0,1],[1,2],[2,3],[3,0],[0,4],[1,4],[2,4],[3,4],[0,5],[1,5],[2,5],[3,5]];o.call(this,{vertices:n,faces:s,edges:a})}var n=t("pex-geom"),r=n.Vec3,o=n.Geometry;i.prototype=Object.create(o.prototype),e.exports=i},{"pex-geom":40}],36:[function(t,e){function i(t,e,i,n,a,h){t=t||1,e=e||t||1,i=i||1,n=n||i||1,a=a||"x",h=h||"y",s.call(this,{vertices:!0,normals:!0,texCoords:!0,faces:!0,edges:!0});var l=["x","y","z"];l.splice(l.indexOf(a),1),l.splice(l.indexOf(h),1),l=l[0];for(var u=this.vertices,c=this.texCoords,p=this.normals,d=this.faces,f=this.edges,g=u.length,m=0;n>=m;++m)for(var x=0;i>=x;++x){var v=new o;v[a]=-t/2+x*t/i,v[h]=e/2-m*e/n,v[l]=0,u.push(v);var y=new r(x/i,1-m/n);c.push(y);var w=new o;w[a]=0,w[h]=0,w[l]=1,p.push(w)}for(var m=0;n>m;++m)for(var x=0;i>x;++x){var b=g+m*(i+1)+x,C=[b,b+i+1,b+i+2,b+1];f.push([b,b+1]),f.push([b,b+i+1]),m==n-1&&f.push([b+i+1,b+i+2]),x==i-1&&f.push([b+1,b+i+2]),d.push(C)}}var n=t("pex-geom"),r=n.Vec2,o=n.Vec3,s=n.Geometry;i.prototype=Object.create(s.prototype),e.exports=i},{"pex-geom":40}],37:[function(t,e){function i(t,e,i){function n(e,i){var n=new o;return n.x=t*Math.sin(e*c)*Math.sin(i*c),n.y=t*Math.cos(e*c),n.z=t*Math.sin(e*c)*Math.cos(i*c),n}t=t||.5,e=e||36,i=i||18,s.call(this,{vertices:!0,normals:!0,texCoords:!0,faces:!0});for(var a=this.vertices,h=this.texCoords,l=this.normals,u=this.faces,c=1/180*Math.PI,p=360/e,d=180/i,f=0;i>=f;++f)for(var g=f*d,m=0;e>=m;++m){var x=m*p,v=n(g,x),y=v.dup().normalize(),w=new r(x/360,g/180);a.push(v),l.push(y),h.push(w),f!=i&&m!=e&&u.push(0==f?[f*(e+1)+m,(f+1)*(e+1)+m,(f+1)*(e+1)+m+1]:f==i-1?[f*(e+1)+m,(f+1)*(e+1)+m+1,f*(e+1)+m+1]:[f*(e+1)+m,(f+1)*(e+1)+m,(f+1)*(e+1)+m+1,f*(e+1)+m+1])}this.computeEdges()}var n=t("pex-geom"),r=n.Vec2,o=n.Vec3,s=n.Geometry;i.prototype=Object.create(s.prototype),e.exports=i},{"pex-geom":40}],38:[function(t,e){function i(t){t=t||.5;var e=Math.sqrt(3),i=Math.sqrt(6),n=[new r(e/3,-i/3*.333+.025*i,0),new r(-e/6,-i/3*.333+.025*i,.5),new r(-e/6,-i/3*.333+.025*i,-0.5),new r(0,i/3*.666+.025*i,0)];n=n.map(function(e){return e.normalize().scale(t)});var s=[[0,1,2],[3,1,0],[3,0,2],[3,2,1]],a=[[0,1],[0,2],[0,3],[1,2],[1,3],[2,3]];o.call(this,{vertices:n,faces:s,edges:a})}var n=t("pex-geom"),r=n.Vec3,o=n.Geometry;i.prototype=Object.create(o.prototype),e.exports=i},{"pex-geom":40}],39:[function(t,e){!function(t){function i(){var t,e,i,o=Array.prototype.slice.call(arguments),s=o.shift(),a=s===!0,h=o.length;for((a||"object"!==r(s))&&(s={}),e=0;h>e;++e)if("object"===r(t=o[e]))for(i in t)s[i]=a?n(t[i]):t[i];return s}function n(t){var e,i,o=t,s=r(t);if("array"===s)for(o=[],i=t.length,e=0;i>e;++e)o[e]=n(t[e]);else if("object"===s){o={};for(e in t)o[e]=n(t[e])}return o}function r(t){return{}.toString.call(t).match(/\s([\w]+)/)[1].toLowerCase()}t?e.exports=i:window.merge=i}("object"==typeof e&&e&&"object"==typeof e.exports&&e.exports)},{}],40:[function(t,e){e.exports.Vec2=t("./lib/Vec2"),e.exports.Vec3=t("./lib/Vec3"),e.exports.Vec4=t("./lib/Vec4"),e.exports.Mat4=t("./lib/Mat4"),e.exports.Quat=t("./lib/Quat"),e.exports.Path=t("./lib/Path"),e.exports.Rect=t("./lib/Rect"),e.exports.Spline3D=t("./lib/Spline3D"),e.exports.Spline2D=t("./lib/Spline2D"),e.exports.Spline1D=t("./lib/Spline1D"),e.exports.Ray=t("./lib/Ray"),e.exports.Plane=t("./lib/Plane"),e.exports.Geometry=t("./lib/Geometry"),e.exports.Random=t("./lib/Random"),e.exports.BoundingBox=t("./lib/BoundingBox"),e.exports.Triangle2D=t("./lib/Triangle2D"),e.exports.Triangle3D=t("./lib/Triangle3D"),e.exports.Octree=t("./lib/Octree");for(var i in e.exports.Random)e.exports[i]=e.exports.Random[i]},{"./lib/BoundingBox":41,"./lib/Geometry":42,"./lib/Mat4":43,"./lib/Octree":44,"./lib/Path":45,"./lib/Plane":46,"./lib/Quat":47,"./lib/Random":48,"./lib/Ray":49,"./lib/Rect":50,"./lib/Spline1D":51,"./lib/Spline2D":52,"./lib/Spline3D":53,"./lib/Triangle2D":54,"./lib/Triangle3D":55,"./lib/Vec2":56,"./lib/Vec3":57,"./lib/Vec4":58}],41:[function(t,e){function i(t,e){this.min=t,this.max=e}var n=t("./Vec3");i.fromPositionSize=function(t,e){return new i(n.create(t.x-e.x/2,t.y-e.y/2,t.z-e.z/2),n.create(t.x+e.x/2,t.y+e.y/2,t.z+e.z/2))},i.fromPoints=function(t){var e=new i(t[0].clone(),t[0].clone());return t.forEach(e.addPoint.bind(e)),e},i.prototype.isEmpty=function(){return this.min&&this.max?!1:!0},i.prototype.addPoint=function(t){this.isEmpty()&&(this.min=t.clone(),this.max=t.clone()),t.x<this.min.x&&(this.min.x=t.x),t.y<this.min.y&&(this.min.y=t.y),t.z<this.min.z&&(this.min.z=t.z),t.x>this.max.x&&(this.max.x=t.x),t.y>this.max.y&&(this.max.y=t.y),t.z>this.max.z&&(this.max.z=t.z)},i.prototype.getSize=function(){return n.create(this.max.x-this.min.x,this.max.y-this.min.y,this.max.z-this.min.z)},i.prototype.getCenter=function(){return n.create(this.min.x+(this.max.x-this.min.x)/2,this.min.y+(this.max.y-this.min.y)/2,this.min.z+(this.max.z-this.min.z)/2)},e.exports=i},{"./Vec3":57}],42:[function(t,e){function i(t){var e=(t.length,t.reduce(function(t,e){return t.add(e)},new u(0,0,0)));return e.scale(1/t.length),e}function n(t,e){var i=t,n=0;do e(i,n++),i=o(i);while(i!=t)}function r(t,e){var i=t;do e(i),i=s(i).opposite;while(i!=t)}function o(t){return t.face.halfEdges[(t.slot+1)%t.face.length]}function s(t){return t.face.halfEdges[(t.slot-1+t.face.length)%t.face.length]}function a(t,e){return e.map(function(e){return t[e]})}function h(t,e,i){return e.dup().sub(t).normalize().scale(i).add(t)}function l(t){t=t||{},this.attribs={},t.vertices&&this.addAttrib("vertices","position",t.vertices,!1),t.normals&&this.addAttrib("normals","normal",t.normals,!1),t.texCoords&&this.addAttrib("texCoords","texCoord",t.texCoords,!1),t.tangents&&this.addAttrib("tangents","tangent",t.tangents,!1),t.colors&&this.addAttrib("colors","color",t.colors,!1),t.indices&&this.addIndices(t.indices),t.edges&&this.addEdges(t.edges),t.faces&&this.addFaces(t.faces)}var u=t("./Vec3"),c=t("./Ray"),p=t("./BoundingBox");l.prototype.generateVolumePoints=function(t){t=t||5e3;for(var e=p.fromPoints(this.vertices),i=-e.min.x+e.max.x,n=-e.min.y+e.max.y,r=-e.min.z+e.max.z,o=0,s=[],a=[],h=0;!(o>=t);h++){var l=Math.floor(6*Math.random())+1,d=bottomX=(Math.random()-.5)*i,f=(Math.random()+.5)*n,g=bottomZ=(Math.random()-.5)*r,m=-f,x=-(Math.random()+.5)*i,v=rightY=(Math.random()-.5)*n,y=rightZ=(Math.random()-.5)*r,w=-x,b=frontX=(Math.random()-.5)*i,C=frontY=(Math.random()-.5)*n,T=-(Math.random()+.5)*r,E=-T;switch(l){case 1:var M=new u(x,v,y),P=new u(w,rightY,rightZ);break;case 2:var M=new u(w,rightY,rightZ),P=new u(x,v,y);break;case 3:var M=new u(d,f,g),P=new u(bottomX,m,m);break;case 4:var M=new u(bottomX,m,bottomZ),P=new u(d,f,g);break;case 5:var M=new u(b,C,T),P=new u(frontX,frontY,E);break;case 6:var M=new u(frontX,frontY,E),P=new u(b,C,T)}var S=M.dup(),R=P.dup().sub(M).normalize(),A=this.clone().triangulate(),z=0,_=[];if(A.faces.forEach(function(t){var e={};e.a=A.vertices[t[0]],e.b=A.vertices[t[1]],e.c=A.vertices[t[2]];var i=new c(S,R),n=i.hitTestTriangle(e);isNaN(n)&&(o++,z++,_.push(n))}),_.forEach(function(t){z%2===0&&s.push(t)}),!(s.length<2)){var F=s[s.length-2],D=s[s.length-1],N=D.dup().sub(F),L=F.dup().addScaled(N,Math.random());a.push(L)}}return a},l.prototype.generateSurfacePoints=function(t){t=t||5e3;for(var e=[],i=[],n=0,r=this.faces.length;r>n;n++){var o={},s=this.faces[n][0],a=this.faces[n][1],h=this.faces[n][2],l=this.vertices[s],u=this.vertices[a],c=this.vertices[h],p=u.dup().sub(l),d=c.dup().sub(l),f=p.cross(d),g=.5*Math.sqrt(f.x*f.x+f.y*f.y+f.z*f.z);o.A=l,o.B=u,o.C=c,i.push(o),e.push(g)}var m=Math.min.apply(Math,e),x=e.map(function(t){return Math.ceil(t/m)}),v=[];x.forEach(function(t,e){for(var i=0;t>i;i++)v.push(e)});for(var y=[],w=0;t>w;w++){var b=Math.ceil(Math.random()*v.length)-1,o=i[v[b]],l=o.A.clone(),u=o.B.clone(),c=o.C.clone(),C=Math.random(),T=Math.random();C+T>1&&(C=1-C,T=1-T);var E=1-(C+T),M=l.dup().scale(C),P=u.dup().scale(T),S=c.dup().scale(E),R=M.add(P).add(S);y.push(R)}return y},l.prototype.addAttrib=function(t,e,i,n){return null==i&&(i=null),null==n&&(n=!1),this[t]=i&&i.length?i:[],this[t].name=e,this[t].dirty=!0,this[t].dynamic=n,this.attribs[t]=this[t],this},l.prototype.addFaces=function(t,e){return null==t&&(t=null),null==e&&(e=!1),this.faces=t&&t.length?t:[],this.faces.dirty=!0,this.faces.dynamic=!1,this},l.prototype.addEdges=function(t,e){return null==t&&(t=null),null==e&&(e=!1),this.edges=t&&t.length?t:[],this.edges.dirty=!0,this.edges.dynamic=!1,this},l.prototype.addIndices=function(t,e){return null==t&&(t=null),null==e&&(e=!1),this.indices=t&&t.length?t:[],this.indices.dirty=!0,this.indices.dynamic=!1,this},l.prototype.isDirty=function(){var t=!1;t||(t=this.faces&&this.faces.dirty),t||(t=this.edges&&this.edges.dirty);for(attribAlias in this.attribs){var e=this.attribs[attribAlias];t||(t=e.dirty)}return t},l.prototype.addEdge=function(t,e){this.edges||this.addEdges(),this.edgeHash||(this.edgeHash={});var i=t+"_"+e,n=e+"_"+t;return this.edgeHash[i]||this.edgeHash[n]?void 0:(this.edges.push([t,e]),this.edgeHash[i]=this.edgeHash[n]=!0)},l.prototype.computeEdges=function(){if(this.edges?(this.edgeHash=null,this.edges.length=0):this.addEdges(),this.faces&&this.faces.length)this.faces.forEach(function(t){for(var e=0;e<t.length;e++)this.addEdge(t[e],t[(e+1)%t.length])}.bind(this));else for(var t=0;t<this.vertices.length-1;t++)this.addEdge(t,t+1)},l.prototype.computeNormals=function(){if(!this.faces)throw"Geometry[2]omputeSmoothNormals no faces found";if(this.normals||this.addAttrib("normals","normal",null,!1),this.normals.length>this.vertices.length)this.normals.length=this.vertices.length;else for(;this.normals.length<this.vertices.length;)this.normals.push(new u(0,0,0));var t=[];this.vertices.forEach(function(e,i){t[i]=0}.bind(this));var e=new u,i=new u,n=new u;this.faces.forEach(function(r){var o=this.vertices[r[0]],s=this.vertices[r[1]],a=this.vertices[r[2]];e.asSub(s,o).normalize(),i.asSub(a,o).normalize(),n.asCross(e,i);for(var h=0;h<r.length;h++)this.normals[r[h]].add(n),t[r[h]]++}.bind(this)),this.normals.forEach(function(t){t.normalize()})},l.prototype.toFlatGeometry=function(){var t=new l({vertices:!0,faces:!0}),e=this.vertices;return this.faces.forEach(function(i){var n=[];i.forEach(function(i){n.push(t.vertices.length),t.vertices.push(e[i])}),t.faces.push(n)}),t},l.prototype.clone=function(){var t=null,e=this.vertices.map(function(t){return t.dup()}),i=this.texCoords?this.texCoords.map(function(t){return t.dup()}):null,n=this.faces.map(function(t){return t.slice(0)}),t=this.edges?this.edges.map(function(t){return t.slice(0)}):null;return new l({vertices:e,texCoords:i,faces:n,edges:t})},l.prototype.triangulate=function(){var t=this.clone();return t.faces=[],this.faces.forEach(function(e){t.faces.push([e[0],e[1],e[2]]);for(var i=2;i<e.length-1;i++)t.faces.push([e[0],e[i],e[i+1]])}),t},l.prototype.computeHalfEdges=function(){var t=this.halfEdges=[],e=this.faces;e.forEach(function(e,i){e.halfEdges=[],e.forEach(function(n,r){var o=n,s=e[(r+1)%e.length],a={edgeIndex:t.length,face:e,faceIndex:i,slot:r,opposite:null,v0:Math.min(o,s),v1:Math.max(o,s)};e.halfEdges.push(a),t.push(a)})}),t.sort(function(t,e){return t.v0>e.v0?1:t.v0<e.v0?-1:t.v1>e.v1?1:t.v1<e.v1?-1:0});for(var i=1;i<t.length;i++){var n=t[i-1],r=t[i];n.v0==r.v0&&n.v1==r.v1&&(n.opposite=r,r.opposite=n)}return t},l.prototype.subdivideEdges=function(){var t=this.vertices,e=this.faces,s=this.computeHalfEdges(),a=t.map(function(t){return t}),h=[],u=[];s.forEach(function(e){if(!u[e.edgeIndex]){var n=i([t[e.face[e.slot]],t[o(e).face[o(e).slot]]]);u[e.edgeIndex]=n,u[e.opposite.edgeIndex]=n,a.push(n)}}),e.forEach(function(t){var e=[];n(t.halfEdges[0],function(t){e.push(a.indexOf(u[t.edgeIndex]))}),h.push(e)});var c=[];s.forEach(function(t){if(-1===c.indexOf(t.face[t.slot])){c.push(t.face[t.slot]);var e=[];r(t,function(t){e.push(a.indexOf(u[t.edgeIndex]))}),e.forEach(function(i,n){var r=e[(n+1)%e.length];h.push([t.face[t.slot],i,r])})}});var p=new l({vertices:a,faces:h});return p.computeEdges(),p},l.prototype.getFaceVertices=function(t){return t.map(function(t){return this.vertices[t]}.bind(this))},l.prototype.catmullClark=function(){var t=this.vertices,e=this.faces,s=this.computeHalfEdges(),a=e.map(this.getFaceVertices.bind(this)).map(i),h=[];s.forEach(function(e){if(!h[e.edgeIndex]){var n=i([t[e.v0],t[e.v1],a[e.faceIndex],a[e.opposite.faceIndex]]);h[e.edgeIndex]=n,h[e.opposite.edgeIndex]=n}});var c=[];s.map(function(n){var o=e[n.faceIndex][n.slot],s=t[o];if(!c[o]){var h=[],l=[];r(n,function(e){h.push(a[e.faceIndex]),l.push(i([t[e.v0],t[e.v1]]))});var p=i(h),d=i(l),f=h.length,g=new u(0,0,0);g.add(p),g.add(d.dup().scale(2)),g.add(s.dup().scale(f-3)),g.scale(1/f),c[o]=g}});var p=c.concat(a);s.forEach(function(t){t.added>-1||(t.added=p.length,t.opposite.added=p.length,p.push(h[t.edgeIndex]))});var d=[],f=[];return e.forEach(function(t,e){var i=e+c.length;n(t.halfEdges[0],function(e){var n=e.added,r=o(e),s=t[r.slot],a=r.added;f.push([i,n]),f.push([n,s]),d.push([i,n,s,a])})}),new l({vertices:p,faces:d,edges:f})},l.prototype.dooSabin=function(t){var e=this.vertices,u=this.faces,c=this.computeHalfEdges(),p=[],d=[],f=[];t=t||.1;var g=[];return u.forEach(function(r,o){var l=g[o]=[];return n(r.halfEdges[0],function(n){var r=e[n.face[n.slot]],o=i([r,i(a(e,n.face)),i(a(e,[n.v0,n.v1])),i(a(e,[s(n).v0,s(n).v1]))]);l.push(p.length),p.push(h(r,o,t))}),l}),u.forEach(function(t,e){d.push(g[e])}),c.forEach(function(t){if(!t.edgeVisited){t.edgeVisited=!0,t.opposite.edgeVisited=!0;var e=t,i=o(e.opposite),n=e.opposite,r=o(e),s=[g[e.faceIndex][e.slot],g[i.faceIndex][i.slot],g[n.faceIndex][n.slot],g[r.faceIndex][r.slot]];d.push(s),f.push([s[0],s[3]]),f.push([s[1],s[2]])}}),c.forEach(function(t){if(!t.vertexVisited){var e=[];r(t,function(t){t.vertexVisited=!0,e.push(g[t.faceIndex][t.slot])}),d.push(e),e.forEach(function(t,i){f.push([t,e[(i+1)%e.length]])})}}),new l({vertices:p,faces:d,edges:f})},l.prototype.wire=function(t,e){e=null!=e?e:t||.1,t=t||.1;var i=this.dooSabin(t);i.computeNormals();var r=(i.computeHalfEdges(),this.dooSabin(t));r.computeNormals(),r.vertices.forEach(function(t,i){t.sub(r.normals[i].dup().scale(e))});var o=i.faces.splice(0,this.faces.length);r.faces.splice(0,this.faces.length);var a=i.vertices.length;return r.vertices.forEach(function(t){i.vertices.push(t)}),r.faces.forEach(function(t){i.faces.push(t.map(function(t){return t+a}).reverse())}),r.edges.forEach(function(t){i.edges.push(t.map(function(t){return t+a}))}),o.forEach(function(t){n(t.halfEdges[0],function(t){var e=s(t);i.faces.push([e.face[e.slot],t.face[t.slot],t.face[t.slot]+a,e.face[e.slot]+a]),i.edges.push([e.face[e.slot],e.face[e.slot]+a]),i.edges.push([t.face[t.slot],t.face[t.slot]+a])})}),i},l.prototype.extrude=function(t,e,r){t=t||.1,r=r||0,e||(e=this.faces.map(function(t,e){return e}));var s=this.clone(),h=(s.computeHalfEdges(),new u),l=new u,c=new u,p=new u;return e.forEach(function(e){var u=s.faces[e],d=a(s.vertices,u),f=s.texCoords?a(s.texCoords,u):null,g=d[0],m=d[1],x=d[2];h.asSub(m,g).normalize(),l.asSub(x,g).normalize(),c.asCross(h,l).normalize(),c.scale(t);var v=d.map(function(t){return t.dup().add(c)}),y=[];if(v.forEach(function(t){y.push(s.vertices.length),s.vertices.push(t)}),f){var w=f.map(function(t){return t.dup()});w.forEach(function(t){s.texCoords.push(t)})}if(r){var x=i(v);v.forEach(function(t){p.asSub(x,t),p.scale(r),t.add(p)})}n(u.halfEdges[0],function(t){s.faces.push([u[t.slot],u[o(t).slot],y[o(t).slot],y[t.slot]])}),s.edges&&(y.forEach(function(t,e){s.edges.push([t,u[e]])}),y.forEach(function(t,e){s.edges.push([t,y[(e+1)%y.length]])})),y.forEach(function(t,e){u[e]=t})}),s},e.exports=l},{"./BoundingBox":41,"./Ray":49,"./Vec3":57}],43:[function(t,e){function i(){this.reset()}var n=t("./Vec3");i.create=function(){return new i},i.prototype.equals=function(t,e){return null==e&&(e=1e-7),Math.abs(t.a11-this.a11)<=e&&Math.abs(t.a12-this.a12)<=e&&Math.abs(t.a13-this.a13)<=e&&Math.abs(t.a14-this.a14)<=e&&Math.abs(t.a21-this.a21)<=e&&Math.abs(t.a22-this.a22)<=e&&Math.abs(t.a23-this.a23)<=e&&Math.abs(t.a24-this.a24)<=e&&Math.abs(t.a31-this.a31)<=e&&Math.abs(t.a32-this.a32)<=e&&Math.abs(t.a33-this.a33)<=e&&Math.abs(t.a34-this.a34)<=e&&Math.abs(t.a41-this.a41)<=e&&Math.abs(t.a42-this.a42)<=e&&Math.abs(t.a43-this.a43)<=e&&Math.abs(t.a44-this.a44)<=e},i.prototype.hash=function(){return.01*this.a11+.02*this.a12+.03*this.a13+.04*this.a14+.05*this.a21+.06*this.a22+.07*this.a23+.08*this.a24+.09*this.a31+.1*this.a32+.11*this.a33+.12*this.a34+.13*this.a41+.14*this.a42+.15*this.a43+.16*this.a44},i.prototype.set4x4r=function(t,e,i,n,r,o,s,a,h,l,u,c,p,d,f,g){return this.a11=t,this.a12=e,this.a13=i,this.a14=n,this.a21=r,this.a22=o,this.a23=s,this.a24=a,this.a31=h,this.a32=l,this.a33=u,this.a34=c,this.a41=p,this.a42=d,this.a43=f,this.a44=g,this},i.prototype.copy=function(t){return this.a11=t.a11,this.a12=t.a12,this.a13=t.a13,this.a14=t.a14,this.a21=t.a21,this.a22=t.a22,this.a23=t.a23,this.a24=t.a24,this.a31=t.a31,this.a32=t.a32,this.a33=t.a33,this.a34=t.a34,this.a41=t.a41,this.a42=t.a42,this.a43=t.a43,this.a44=t.a44,this},i.prototype.dup=function(){return i.create().copy(this)},i.prototype.reset=function(){return this.set4x4r(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},i.prototype.identity=function(){return this.reset(),this},i.prototype.mul4x4r=function(t,e,i,n,r,o,s,a,h,l,u,c,p,d,f,g){var m=this.a11,x=this.a12,v=this.a13,y=this.a14,w=this.a21,b=this.a22,C=this.a23,T=this.a24,E=this.a31,M=this.a32,P=this.a33,S=this.a34,R=this.a41,A=this.a42,z=this.a43,_=this.a44;return this.a11=m*t+x*r+v*h+y*p,this.a12=m*e+x*o+v*l+y*d,this.a13=m*i+x*s+v*u+y*f,this.a14=m*n+x*a+v*c+y*g,this.a21=w*t+b*r+C*h+T*p,this.a22=w*e+b*o+C*l+T*d,this.a23=w*i+b*s+C*u+T*f,this.a24=w*n+b*a+C*c+T*g,this.a31=E*t+M*r+P*h+S*p,this.a32=E*e+M*o+P*l+S*d,this.a33=E*i+M*s+P*u+S*f,this.a34=E*n+M*a+P*c+S*g,this.a41=R*t+A*r+z*h+_*p,this.a42=R*e+A*o+z*l+_*d,this.a43=R*i+A*s+z*u+_*f,this.a44=R*n+A*a+z*c+_*g,this},i.prototype.perspective=function(t,e,i,n){var r=1/Math.tan(t/180*Math.PI/2),o=1/(n-i);return this.mul4x4r(r/e,0,0,0,0,r,0,0,0,0,-(n+i)*o,-2*n*i*o,0,0,-1,0),this},i.prototype.ortho=function(t,e,i,n,r,o){return this.mul4x4r(2/(e-t),0,0,(e+t)/(t-e),0,2/(n-i),0,(n+i)/(i-n),0,0,2/(r-o),(o+r)/(r-o),0,0,0,1),this},i.prototype.lookAt=function(t,e,i){var r=n.create(t.x-e.x,t.y-e.y,t.z-e.z).normalize(),o=n.create(i.x,i.y,i.z).cross(r).normalize(),s=n.create().copy(r).cross(o).normalize();return this.mul4x4r(o.x,o.y,o.z,0,s.x,s.y,s.z,0,r.x,r.y,r.z,0,0,0,0,1),this.translate(-t.x,-t.y,-t.z),this},i.prototype.translate=function(t,e,i){return this.mul4x4r(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this},i.prototype.rotate=function(t,e,i,n){var r=Math.sin(t),o=Math.cos(t);return this.mul4x4r(e*e*(1-o)+o,e*i*(1-o)-n*r,e*n*(1-o)+i*r,0,i*e*(1-o)+n*r,i*i*(1-o)+o,i*n*(1-o)-e*r,0,e*n*(1-o)-i*r,i*n*(1-o)+e*r,n*n*(1-o)+o,0,0,0,0,1),this},i.prototype.asMul=function(t,e){var i=t.a11,n=t.a12,r=t.a13,o=t.a14,s=t.a21,a=t.a22,h=t.a23,l=t.a24,u=t.a31,c=t.a32,p=t.a33,d=t.a34,f=t.a41,g=t.a42,m=t.a43,x=t.a44,v=e.a11,y=e.a12,w=e.a13,b=e.a14,C=e.a21,T=e.a22,E=e.a23,M=e.a24,P=e.a31,S=e.a32,R=e.a33,A=e.a34,z=e.a41,_=e.a42,F=e.a43,D=e.a44;return this.a11=i*v+n*C+r*P+o*z,this.a12=i*y+n*T+r*S+o*_,this.a13=i*w+n*E+r*R+o*F,this.a14=i*b+n*M+r*A+o*D,this.a21=s*v+a*C+h*P+l*z,this.a22=s*y+a*T+h*S+l*_,this.a23=s*w+a*E+h*R+l*F,this.a24=s*b+a*M+h*A+l*D,this.a31=u*v+c*C+p*P+d*z,this.a32=u*y+c*T+p*S+d*_,this.a33=u*w+c*E+p*R+d*F,this.a34=u*b+c*M+p*A+d*D,this.a41=f*v+g*C+m*P+x*z,this.a42=f*y+g*T+m*S+x*_,this.a43=f*w+g*E+m*R+x*F,this.a44=f*b+g*M+m*A+x*D,this},i.prototype.mul=function(t){return this.asMul(this,t)},i.prototype.scale=function(t,e,i){return this.mul4x4r(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this},i.prototype.invert=function(){var t=this.a11,e=this.a12,i=this.a13,n=this.a14,r=this.a21,o=this.a22,s=this.a23,a=this.a24,h=this.a31,l=this.a32,u=this.a33,c=this.a34,p=this.a41,d=this.a42,f=this.a43,g=this.a44,m=t*o-e*r,x=t*s-i*r,v=t*a-n*r,y=e*s-i*o,w=e*a-n*o,b=i*a-n*s,C=h*d-l*p,T=h*f-u*p,E=h*g-c*p,M=l*f-u*d,P=l*g-c*d,S=u*g-c*f,R=1/(m*S-x*P+v*M+y*E-w*T+b*C);return this.a11=(+o*S-s*P+a*M)*R,this.a12=(-e*S+i*P-n*M)*R,this.a13=(+d*b-f*w+g*y)*R,this.a14=(-l*b+u*w-c*y)*R,this.a21=(-r*S+s*E-a*T)*R,this.a22=(+t*S-i*E+n*T)*R,this.a23=(-p*b+f*v-g*x)*R,this.a24=(+h*b-u*v+c*x)*R,this.a31=(+r*P-o*E+a*C)*R,this.a32=(-t*P+e*E-n*C)*R,this.a33=(+p*w-d*v+g*m)*R,this.a34=(-h*w+l*v-c*m)*R,this.a41=(-r*M+o*T-s*C)*R,this.a42=(+t*M-e*T+i*C)*R,this.a43=(-p*y+d*x-f*m)*R,this.a44=(+h*y-l*x+u*m)*R,this},i.prototype.transpose=function(){var t=this.a11,e=this.a12,i=this.a13,n=this.a14,r=this.a21,o=this.a22,s=this.a23,a=this.a24,h=this.a31,l=this.a32,u=this.a33,c=this.a34,p=this.a41,d=this.a42,f=this.a43,g=this.a44;return this.a11=t,this.a12=r,this.a13=h,this.a14=p,this.a21=e,this.a22=o,this.a23=l,this.a24=d,this.a31=i,this.a32=s,this.a33=u,this.a34=f,this.a41=n,this.a42=a,this.a43=c,this.a44=g,this},i.prototype.toArray=function(){return[this.a11,this.a21,this.a31,this.a41,this.a12,this.a22,this.a32,this.a42,this.a13,this.a23,this.a33,this.a43,this.a14,this.a24,this.a34,this.a44]},i.prototype.fromArray=function(t){return this.a11=t[0](this.a21=t[1](this.a31=t[2](this.a41=t[3]))),this.a12=t[4](this.a22=t[5](this.a32=t[6](this.a42=t[7]))),this.a13=t[8](this.a23=t[9](this.a33=t[10](this.a43=t[11]))),this.a14=t[12](this.a24=t[13](this.a34=t[14](this.a44=t[15]))),this},e.exports=i},{"./Vec3":57}],44:[function(t,e){function i(t,e){this.maxDistance=Math.max(e.x,Math.max(e.y,e.z)),this.accuracy=0,this.root=new i.Cell(this,t,e,0)}var n=t("pex-geom"),r=n.Vec3;i.fromBoundingBox=function(t){return new i(t.min.clone(),t.getSize().clone())},i.MaxLevel=8,i.prototype.add=function(t,e){this.root.add(t,e)},i.prototype.has=function(t){return this.root.has(t)},i.prototype.findNearestPoint=function(t,e){e.includeData=e.includeData?e.includeData:!1,e.bestDist=e.maxDist?e.maxDist:1/0,e.notSelf=e.notSelf?e.notSelf:!1;var i=this.root.findNearestPoint(t,e);return i?e.includeData?i:i.point:null},i.prototype.findNearbyPoints=function(t,e,i){i=i||{};var n={points:[],data:[]};return this.root.findNearbyPoints(t,e,n,i),n},i.prototype.getAllCellsAtLevel=function(t,e,i){return"undefined"==typeof e&&(e=t,t=this.root),i=i||[],t.level==e?(t.points.length>0&&i.push(t),i):(t.children.forEach(function(t){this.getAllCellsAtLevel(t,e,i)}.bind(this)),i)},i.Cell=function(t,e,i,n){this.tree=t,this.position=e,this.size=i,this.level=n,this.points=[],this.data=[],this.temp=new r,this.children=[]},i.Cell.prototype.has=function(t){if(!this.contains(t))return null;if(this.children.length>0){for(var e=0;e<this.children.length;e++){var i=this.children[e].has(t);if(i)return i}return null}for(var n=this.tree.accuracy*this.tree.accuracy,e=0;e<this.points.length;e++){var r=this.points[e],o=t.squareDistance(r);if(n>=o)return r}return null},i.Cell.prototype.add=function(t,e){this.points.push(t),this.data.push(e),this.children.length>0?this.addToChildren(t,e):this.points.length>1&&this.level<i.MaxLevel&&this.split()},i.Cell.prototype.addToChildren=function(t,e){for(var i=0;i<this.children.length;i++)if(this.children[i].contains(t)){this.children[i].add(t,e);break}},i.Cell.prototype.contains=function(t){return t.x>=this.position.x-this.tree.accuracy&&t.y>=this.position.y-this.tree.accuracy&&t.z>=this.position.z-this.tree.accuracy&&t.x<this.position.x+this.size.x+this.tree.accuracy&&t.y<this.position.y+this.size.y+this.tree.accuracy&&t.z<this.position.z+this.size.z+this.tree.accuracy},i.Cell.prototype.split=function(){var t=this.position.x,e=this.position.y,n=this.position.z,o=this.size.x/2,s=this.size.y/2,a=this.size.z/2;this.children.push(new i.Cell(this.tree,r.create(t,e,n),r.create(o,s,a),this.level+1)),this.children.push(new i.Cell(this.tree,r.create(t+o,e,n),r.create(o,s,a),this.level+1)),this.children.push(new i.Cell(this.tree,r.create(t,e,n+a),r.create(o,s,a),this.level+1)),this.children.push(new i.Cell(this.tree,r.create(t+o,e,n+a),r.create(o,s,a),this.level+1)),this.children.push(new i.Cell(this.tree,r.create(t,e+s,n),r.create(o,s,a),this.level+1)),this.children.push(new i.Cell(this.tree,r.create(t+o,e+s,n),r.create(o,s,a),this.level+1)),this.children.push(new i.Cell(this.tree,r.create(t,e+s,n+a),r.create(o,s,a),this.level+1)),this.children.push(new i.Cell(this.tree,r.create(t+o,e+s,n+a),r.create(o,s,a),this.level+1));for(var h=0;h<this.points.length;h++)this.addToChildren(this.points[h],this.data[h])},i.Cell.prototype.squareDistanceToCenter=function(t){var e=t.x-(this.position.x+this.size.x/2),i=t.y-(this.position.y+this.size.y/2),n=t.z-(this.position.z+this.size.z/2);return e*e+i*i+n*n},i.Cell.prototype.findNearestPoint=function(t,e){var i=null,n=null,r=e.bestDist;if(this.points.length>0&&0==this.children.length)for(var o=0;o<this.points.length;o++){var s=this.points[o].distance(t);if(r>=s){if(0==s&&e.notSelf)continue;r=s,i=this.points[o],n=this.data[o]}}var a=this.children,a=this.children.map(function(e){return{child:e,dist:e.squareDistanceToCenter(t)}}).sort(function(t,e){return t.dist-e.dist}).map(function(t){return t.child});if(a.length>0)for(var o=0;o<a.length;o++){var h=a[o];if(h.points.length>0){if(t.x<h.position.x-r||t.x>h.position.x+h.size.x+r||t.y<h.position.y-r||t.y>h.position.y+h.size.y+r||t.z<h.position.z-r||t.z>h.position.z+h.size.z+r)continue;var l=h.findNearestPoint(t,e);if(!l||!l.point)continue;var u=l.point.distance(t);r>u&&(i=l.point,r=u,n=l.data)}}return{point:i,data:n}},i.Cell.prototype.findNearbyPoints=function(t,e,i,n){if(this.points.length>0&&0==this.children.length)for(var r=0;r<this.points.length;r++){var o=this.points[r].distance(t);if(e>=o){if(0==o&&n.notSelf)continue;i.points.push(this.points[r]),n.includeData&&i.data.push(this.data[r])}}var s=this.children;if(s.length>0)for(var r=0;r<s.length;r++){var a=s[r];if(a.points.length>0){if(t.x<a.position.x-e||t.x>a.position.x+a.size.x+e||t.y<a.position.y-e||t.y>a.position.y+a.size.y+e||t.z<a.position.z-e||t.z>a.position.z+a.size.z+e)continue;a.findNearbyPoints(t,e,i,n)}}},e.exports=i},{"pex-geom":40}],45:[function(t,e){function i(t,e){this.points=t||[],this.dirtyLength=!0,this.closed=e||!1,this.samplesCount=1e3}var n=t("./Vec3");i.prototype.addPoint=function(t){return this.points.push(t)},i.prototype.getPoint=function(t){var e=t*(this.points.length-1),i=Math.floor(e),r=e-i,o=i,s=i+1;i===this.points.length-1&&(o=i,s=i);var a=new n;return a.x=this.points[o].x+(this.points[s].x-this.points[o].x)*r,a.y=this.points[o].y+(this.points[s].y-this.points[o].y)*r,a.z=this.points[o].z+(this.points[s].z-this.points[o].z)*r,a},i.prototype.getPointAt=function(t){this.closed||(t=Math.max(0,Math.min(t,1))),this.dirtyLength&&this.precalculateLength();for(var e=0,i=0;i<this.accumulatedLengthRatios.length;i++)if(this.accumulatedLengthRatios[i]>t-1/this.samplesCount){e=this.accumulatedRatios[i];break}return this.getPoint(e,!0)},i.prototype.getClosestPoint=function(t){this.dirtyLength&&this.precalculateLength();var e=this.precalculatedPoints.reduce(function(e,i){var n=t.squareDistance(i);return n<e.dist?{dist:n,point:i}:e},{dist:1/0,point:null});return e.point},i.prototype.getClosestPointRatio=function(t){this.dirtyLength&&this.precalculateLength();var e=this.precalculatedPoints.reduce(function(e,i,n){var r=t.squareDistance(i);return r<e.dist?{dist:r,point:i,index:n}:e},{dist:1/0,point:null,index:-1});return this.accumulatedLengthRatios[e.index]},i.prototype.close=function(){return this.closed=!0},i.prototype.isClosed=function(){return this.closed},i.prototype.reverse=function(){return this.points=this.points.reverse(),this.dirtyLength=!0},i.prototype.precalculateLength=function(){this.accumulatedRatios=[],this.accumulatedLengthRatios=[],this.accumulatedLengths=[],this.precalculatedPoints=[];for(var t=1/this.samplesCount,e=0,i=0,n=null,r=null,o=0;o<this.samplesCount;o++)r=n,n=this.getPoint(e),o>0&&(i+=n.dup().sub(r).length()),this.accumulatedRatios.push(e),this.accumulatedLengths.push(i),this.precalculatedPoints.push(n),e+=t;for(var o=0;o<this.accumulatedLengths.length-1;o++)this.accumulatedLengthRatios.push(this.accumulatedLengths[o]/i);return this.length=i,this.dirtyLength=!1},e.exports=i},{"./Vec3":57}],46:[function(t,e){function i(t,e){this.point=t,this.normal=e,this.u=new r,this.v=new r,this.updateUV()
}var n=t("./Vec2"),r=t("./Vec3");i.prototype.set=function(t,e){this.point=t,this.normal=e},i.prototype.setPoint=function(t){this.point=t},i.prototype.setNormal=function(t){this.normal=t},i.prototype.project=function(t){var e=r.create().asSub(t,this.point),i=e.dot(this.normal),n=this.normal.clone().scale(i),o=t.clone().sub(n);return o},i.prototype.intersectRay=function(t){return t.hitTestPlane(this.point,this.normal)[0]},i.prototype.updateUV=function(){if(Math.abs(this.normal.x)>Math.abs(this.normal.y)){var t=1/Math.sqrt(this.normal.x*this.normal.x+this.normal.z*this.normal.z);this.u.set(this.normal.x*t,0,-this.normal.z*t)}else{var t=1/Math.sqrt(this.normal.y*this.normal.y+this.normal.z*this.normal.z);this.u.set(0,this.normal.z*t,-this.normal.y*t)}this.v.setVec3(this.normal).cross(this.u)},i.prototype.project=function(t){var e=r.create().asSub(t,this.point),i=e.dot(this.normal),n=this.normal.clone().scale(i),o=t.clone().sub(n);return o},i.prototype.rebase=function(t){var e=t.dup().sub(this.point),i=this.u.dot(e),r=this.v.dot(e);return new n(i,r)},e.exports=i},{"./Vec2":56,"./Vec3":57}],47:[function(t,e){function i(t,e,i,n){this.x=null!=t?t:0,this.y=null!=e?e:0,this.z=null!=i?i:0,this.w=null!=n?n:1}var n=t("./Mat4"),r=t("./Vec3"),o=Math.pow(2,-24);i.create=function(t,e,n,r){return new i(t,e,n,r)},i.fromArray=function(t){return new i(t[0],t[1],t[2],t[3])},i.prototype.identity=function(){return this.set(0,0,0,1),this},i.prototype.equals=function(t,e){return null==e&&(e=1e-7),Math.abs(t.x-this.x)<=e&&Math.abs(t.y-this.y)<=e&&Math.abs(t.z-this.z)<=e&&Math.abs(t.w-this.w)<=e},i.prototype.hash=function(){return 1*this.x+12*this.y+123*this.z+1234*this.w},i.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},i.prototype.clone=function(){return new i(this.x,this.y,this.z,this.w)},i.prototype.dup=function(){return this.clone()},i.prototype.setAxisAngle=function(t,e){e=.5*e;var i=Math.sin(e/180*Math.PI);return this.x=i*t.x,this.y=i*t.y,this.z=i*t.z,this.w=Math.cos(e/180*Math.PI),this},i.prototype.setQuat=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},i.prototype.set=function(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this},i.prototype.asMul=function(t,e){var i=t.x,n=t.y,r=t.z,o=t.w,s=e.x,a=e.y,h=e.z,l=e.w;return this.x=i*l+o*s+n*h-r*a,this.y=n*l+o*a+r*s-i*h,this.z=r*l+o*h+i*a-n*s,this.w=o*l-i*s-n*a-r*h,this},i.prototype.mul=function(t){return this.asMul(this,t),this},i.prototype.mul4=function(t,e,i,n){var r=this.x,o=this.y,s=this.z,a=this.w;return this.x=n*r+t*a+e*s-i*o,this.y=n*o+e*a+i*r-t*s,this.z=n*s+i*a+t*o-e*r,this.w=n*a-t*r-e*o-i*s,this},i.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},i.prototype.normalize=function(){var t=this.length();return t>o&&(this.x/=t,this.y/=t,this.z/=t,this.w/=t),this},i.prototype.toMat4=function(t){var e=this.x+this.x,i=this.y+this.y,r=this.z+this.z,o=this.w*e,s=this.w*i,a=this.w*r,h=this.x*e,l=this.x*i,u=this.x*r,c=this.y*i,p=this.y*r,d=this.z*r,f=t||new n;return f.set4x4r(1-(c+d),l-a,u+s,0,l+a,1-(h+d),p-o,0,u-s,p+o,1-(h+c),0,0,0,0,1)},i.prototype.setDirection=function(t,e){var o=r.create().copy(t).normalize(),s=r.create(0,1,0),a=r.create().asCross(s,o);0==a.length()&&(s.set(1,0,0),a.asCross(s,o)),s.asCross(o,a),a.normalize(),s.normalize(),e&&console.log("dir",o),e&&console.log("up",s),e&&console.log("right",a);var h=new n;h.set4x4r(a.x,a.y,a.z,0,s.x,s.y,s.z,0,o.x,o.y,o.z,0,0,0,0,1);var l=new i;if(1+h.a11+h.a22+h.a33<.001){e&&console.log("singularity"),o=t.dup(),o.z*=-1,o.normalize(),s.set(0,1,0),a.asCross(s,o),s.asCross(o,a),a.normalize(),s.normalize(),h=new n,h.set4x4r(a.x,a.y,a.z,0,s.x,s.y,s.z,0,o.x,o.y,o.z,0,0,0,0,1),l.w=Math.sqrt(1+h.a11+h.a22+h.a33)/2;var u=4*l.w;return l.x=(h.a23-h.a32)/u,l.y=(h.a31-h.a13)/u,l.z=(h.a12-h.a21)/u,e&&console.log("dir",o),e&&console.log("up",s),e&&console.log("right",a),q2=new i,q2.setAxisAngle(new r(0,1,0),180),q2.mul(l),q2}return l.w=Math.sqrt(1+h.a11+h.a22+h.a33)/2,u=4*l.w,l.x=(h.a23-h.a32)/u,l.y=(h.a31-h.a13)/u,l.z=(h.a12-h.a21)/u,this.copy(l),this},i.prototype.slerp=function(t,e){var i=this,n=i.w*t.w+i.x*t.x+i.y*t.y+i.z*t.z;if(Math.abs(n)>=1)return this;var r=Math.acos(n),o=Math.sqrt(1-n*n);if(Math.abs(o)<.001)return this.w=.5*i.w+.5*t.w,this.x=.5*i.x+.5*t.x,this.y=.5*i.y+.5*t.y,this.z=.5*i.z+.5*t.z,this;var s=Math.sin((1-e)*r)/o,a=Math.sin(e*r)/o;return this.w=i.w*s+t.w*a,this.x=i.x*s+t.x*a,this.y=i.y*s+t.y*a,this.z=i.z*s+t.z*a,this},i.fromAxisAngle=function(t,e){return(new i).setAxisAngle(t,e)},i.fromDirection=function(t){return(new i).setDirection(t)},e.exports=i},{"./Mat4":43,"./Vec3":57}],48:[function(t,e){function i(){}var n=(t("seedrandom"),t("./Vec2")),r=t("./Vec3");i.randomSeed=function(t){Math.seedrandom(t)},i.randomFloat=function(t,e){return"undefined"==typeof e&&(t=1),"undefined"==typeof e&&(e=t,t=0),t+(e-t)*Math.random()},i.randomInt=function(t,e){return Math.floor(i.randomFloat(t,e))},i.randomVec3=function(t){t=t||.5;var e=2*Math.random()-1,i=2*Math.random()-1,n=2*Math.random()-1;return r.create(e*t,i*t,n*t)},i.randomVec3InBoundingBox=function(t){var e=t.min.x+Math.random()*(t.max.x-t.min.x),i=t.min.y+Math.random()*(t.max.y-t.min.y),n=t.min.z+Math.random()*(t.max.z-t.min.z);return r.create(e,i,n)},i.randomVec2InRect=function(t){return n.create(t.x+Math.random()*t.width,t.y+Math.random()*t.height)},i.randomChance=function(t){return Math.random()<=t},i.randomElement=function(t){return t[Math.floor(Math.random()*t.length)]},e.exports=i},{"./Vec2":56,"./Vec3":57,seedrandom:59}],49:[function(t,e){function i(t,e){this.origin=t||new n(0,0,0),this.direction=e||new n(0,0,1)}var n=t("./Vec3"),r=1e-4;i.prototype.hitTestSphere=function(t,e){var i=[],n=this.direction,r=this.origin,o=r.dup().sub(t),s=n.dot(n);if(0==s)return i;var a=2*o.dot(n),h=o.dot(o)-e*e,l=Math.sqrt(a*a-4*s*h);if(isNaN(l))return i;var u=(-a-l)/(2*s),c=(-a+l)/(2*s);return i.push(r.dup().add(n.dup().scale(u))),u!=c&&i.push(r.dup().add(n.dup().scale(c))),i},i.prototype.hitTestPlane=function(t,e){if(0==this.direction.dot(e))return[];var i=e.dup().scale(-1).dot(this.origin.dup().sub(t))/this.direction.dot(e);return[this.origin.dup().add(this.direction.dup().scale(i))]},i.prototype.hitTestBoundingBox=function(t){function e(t,e,n,o,s){var a=r.hitTestPlane(t,n);if(a.length>0){var h=a[0];h[o]>t[o]-e[o]/2&&h[o]<t[o]+e[o]/2&&h[s]>t[s]-e[s]/2&&h[s]<t[s]+e[s]/2&&i.push(h)}}var i=[],r=this,o=t.getCenter(),s=t.getSize();return e(o.dup().add(new n(0,0,s.z/2)),s,new n(0,0,1),"x","y"),e(o.dup().add(new n(0,0,-s.z/2)),s,new n(0,0,-1),"x","y"),e(o.dup().add(new n(s.x/2,0,0)),s,new n(1,0,0),"y","z"),e(o.dup().add(new n(-s.x/2,0,0)),s,new n(-1,0,0),"y","z"),e(o.dup().add(new n(0,s.y/2,0)),s,new n(0,1,0),"x","z"),e(o.dup().add(new n(0,-s.y/2,0)),s,new n(0,-1,0),"x","z"),i.forEach(function(t){t._distance=t.distance(r.origin)}),i.sort(function(t,e){return t._distance-e._distance}),i.forEach(function(t){delete t._distance}),i.length>0&&(i=[i[0]]),i},i.prototype.hitTestTriangle=function(t){var e=this,i=t.b.dup().sub(t.a),o=t.c.dup().sub(t.a),s=n.create().asCross(i,o);if(s.length()<r)return-1;var a=e.origin.dup().sub(t.a),h=-s.dot(a),l=s.dot(e.direction);if(Math.abs(l)<r)return 0==h?-2:-3;var u=h/l;if(-r>u)return-4;var c=e.origin.dup().add(e.direction.dup().scale(u)),p=i.dot(i),d=i.dot(o),f=o.dot(o),g=c.dup().sub(t.a),m=g.dot(i),x=g.dot(o),v=d*d-p*f,y=(d*x-f*m)/v;if(-r>y||y>1+r)return-5;var w=(d*m-p*x)/v;return-r>w||y+w>1+r?-6:i.scale(y).add(o.scale(w)).add(t.a)},e.exports=i},{"./Vec3":57}],50:[function(t,e){function i(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n}i.prototype.set=function(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n},i.prototype.contains=function(t){return t.x>=this.x&&t.x<=this.x+this.width&&t.y>=this.y&&t.y<=this.y+this.height},e.exports=i},{}],51:[function(t,e){function i(t,e){this.points=t||[],this.dirtyLength=!0,this.closed=e||!1,this.samplesCount=2e3}i.prototype.getPoint=function(t){t=this.closed?(t+1)%1:Math.max(0,Math.min(t,1));var e,i,n,r,o=this.points,s=this.closed?o.length:o.length-1,a=t*s,h=Math.floor(a),l=a-h;return this.closed?(e=(h-1+o.length)%o.length,i=h%o.length,n=(h+1)%o.length,r=(h+2)%o.length):(e=0==h?h:h-1,i=h,n=h>o.length-2?h:h+1,r=h>o.length-3?h:h+2),this.interpolate(o[e],o[i],o[n],o[r],l)},i.prototype.addPoint=function(t){this.dirtyLength=!0,this.points.push(t)},i.prototype.getPointAt=function(t){t=this.closed?(t+1)%1:Math.max(0,Math.min(t,1)),this.dirtyLength&&this.precalculateLength();for(var e=0,i=0;i<this.accumulatedLengthRatios.length;i++)if(this.accumulatedLengthRatios[i]>t-1/this.samplesCount){e=this.accumulatedRatios[i];break}return this.getPoint(e)},i.prototype.getPointAtIndex=function(t){return t<this.points.length?this.points[t]:null},i.prototype.getNumPoints=function(){return this.points.length},i.prototype.getLength=function(){return this.dirtyLength&&this.precalculateLength(),this.length},i.prototype.precalculateLength=function(){var t=1/this.samplesCount,e=0,i=0;this.accumulatedRatios=[],this.accumulatedLengthRatios=[],this.accumulatedLengths=[];for(var n,r,e=0,o=0;o<this.samplesCount;o++){if(r=n,n=this.getPoint(e),o>0){var s=Math.sqrt(1+(n-r)*(n-r));i+=s}this.accumulatedRatios.push(e),this.accumulatedLengths.push(i),e+=t}for(var o=0;o<this.samplesCount;o++)this.accumulatedLengthRatios.push(this.accumulatedLengths[o]/i);this.length=i,this.dirtyLength=!1},i.prototype.close=function(){this.closed=!0},i.prototype.isClosed=function(){return this.closed},i.prototype.interpolate=function(t,e,i,n,r){var o=.5*(i-t),s=.5*(n-e),a=r*r,h=r*a;return(2*e-2*i+o+s)*h+(-3*e+3*i-2*o-s)*a+o*r+e},e.exports=i},{}],52:[function(t,e){function i(t,e){this.points=t||[],this.dirtyLength=!0,this.closed=e||!1,this.samplesCount=100}var n=t("./Vec2");i.prototype.getPoint=function(t){t=this.closed?(t+1)%1:Math.max(0,Math.min(t,1));var e,i,r,o,s=this.points,a=this.closed?s.length:s.length-1,h=t*a,l=Math.floor(h),u=h-l;this.closed?(e=(l-1+s.length)%s.length,i=l%s.length,r=(l+1)%s.length,o=(l+2)%s.length):(e=0==l?l:l-1,i=l,r=l>s.length-2?l:l+1,o=l>s.length-3?l:l+2);var c=new n;return c.x=this.interpolate(s[e].x,s[i].x,s[r].x,s[o].x,u),c.y=this.interpolate(s[e].y,s[i].y,s[r].y,s[o].y,u),c},i.prototype.addPoint=function(t){this.dirtyLength=!0,this.points.push(t)},i.prototype.getPointAt=function(t){t=this.closed?(t+1)%1:Math.max(0,Math.min(t,1)),this.dirtyLength&&this.precalculateLength();for(var e=0,i=0;i<this.accumulatedLengthRatios.length;i++)if(this.accumulatedLengthRatios[i]>t-1/this.samplesCount){e=this.accumulatedRatios[i];break}return this.getPoint(e)},i.prototype.getClosestPoint=function(t){this.dirtyLength&&this.precalculateLength();var e=this.precalculatedPoints.reduce(function(e,i){var n=t.squareDistance(i);return n<e.dist?{dist:n,point:i}:e},{dist:1/0,point:null});return e.point},i.prototype.getClosestPointRatio=function(t){this.dirtyLength&&this.precalculateLength();var e=this.precalculatedPoints.reduce(function(e,i,n){var r=t.squareDistance(i);return r<e.dist?{dist:r,point:i,index:n}:e},{dist:1/0,point:null,index:-1});return this.accumulatedLengthRatios[e.index]},i.prototype.getPointAtIndex=function(t){return t<this.points.length?this.points[t]:null},i.prototype.getNumPoints=function(){return this.points.length},i.prototype.getLength=function(){return this.dirtyLength&&this.precalculateLength(),this.length},i.prototype.precalculateLength=function(){var t=1/this.samplesCount,e=0,i=0;this.accumulatedRatios=[],this.accumulatedLengthRatios=[],this.accumulatedLengths=[],this.precalculatedPoints=[];for(var n,r,o=0;o<this.samplesCount;o++){if(r=n,n=this.getPoint(e),o>0){var s=n.dup().sub(r).length();i+=s}this.accumulatedRatios.push(e),this.accumulatedLengths.push(i),this.precalculatedPoints.push(n),e+=t}for(var o=0;o<this.samplesCount;o++)this.accumulatedLengthRatios.push(this.accumulatedLengths[o]/i);this.length=i,this.dirtyLength=!1},i.prototype.close=function(){this.closed=!0},i.prototype.isClosed=function(){return this.closed},i.prototype.interpolate=function(t,e,i,n,r){var o=.5*(i-t),s=.5*(n-e),a=r*r,h=r*a;return(2*e-2*i+o+s)*h+(-3*e+3*i-2*o-s)*a+o*r+e},e.exports=i},{"./Vec2":56}],53:[function(t,e){function i(t,e){this.points=t||[],this.dirtyLength=!0,this.closed=e||!1,this.samplesCount=1e3}var n=t("./Vec3");i.prototype.getPoint=function(t){t=this.closed?(t+1)%1:Math.max(0,Math.min(t,1));var e,i,r,o,s=this.points,a=this.closed?s.length:s.length-1,h=t*a,l=Math.floor(h),u=h-l;this.closed?(e=(l-1+s.length)%s.length,i=l%s.length,r=(l+1)%s.length,o=(l+2)%s.length):(e=0==l?l:l-1,i=l,r=l>s.length-2?l:l+1,o=l>s.length-3?l:l+2);var c=new n;return c.x=this.interpolate(s[e].x,s[i].x,s[r].x,s[o].x,u),c.y=this.interpolate(s[e].y,s[i].y,s[r].y,s[o].y,u),c.z=this.interpolate(s[e].z,s[i].z,s[r].z,s[o].z,u),c},i.prototype.addPoint=function(t){this.dirtyLength=!0,this.points.push(t)},i.prototype.getPointAt=function(t){t=this.closed?(t+1)%1:Math.max(0,Math.min(t,1)),this.dirtyLength&&this.precalculateLength();for(var e=0,i=0;i<this.accumulatedLengthRatios.length;i++)if(this.accumulatedLengthRatios[i]>t-1/this.samplesCount){e=this.accumulatedRatios[i];break}return this.getPoint(e)},i.prototype.getClosestPoint=function(t){this.dirtyLength&&this.precalculateLength();var e=this.precalculatedPoints.reduce(function(e,i){var n=t.squareDistance(i);return n<e.dist?{dist:n,point:i}:e},{dist:1/0,point:null});return e.point},i.prototype.getClosestPointRatio=function(t){this.dirtyLength&&this.precalculateLength();var e=this.precalculatedPoints.reduce(function(e,i,n){var r=t.squareDistance(i);return r<e.dist?{dist:r,point:i,index:n}:e},{dist:1/0,point:null,index:-1});return this.accumulatedLengthRatios[e.index]},i.prototype.getTangentAt=function(t){var e=.99>t?t:t-.01,i=.99>t?t+.01:t,r=this.getPointAt(e),o=this.getPointAt(i);return n.create().asSub(o,r).normalize()},i.prototype.getPointAtIndex=function(t){return t<this.points.length?this.points[t]:null},i.prototype.getNumPoints=function(){return this.points.length},i.prototype.getLength=function(){return this.dirtyLength&&this.precalculateLength(),this.length},i.prototype.precalculateLength=function(){var t=1/this.samplesCount,e=0,i=0;this.accumulatedRatios=[],this.accumulatedLengthRatios=[],this.accumulatedLengths=[],this.precalculatedPoints=[];for(var n,r,o=0;o<this.samplesCount;o++){if(r=n,n=this.getPoint(e),o>0){var s=n.dup().sub(r).length();i+=s}this.accumulatedRatios.push(e),this.accumulatedLengths.push(i),this.precalculatedPoints.push(n),e+=t}for(var o=0;o<this.samplesCount;o++)this.accumulatedLengthRatios.push(this.accumulatedLengths[o]/i);this.length=i,this.dirtyLength=!1},i.prototype.close=function(){this.closed=!0},i.prototype.isClosed=function(){return this.closed},i.prototype.interpolate=function(t,e,i,n,r){var o=.5*(i-t),s=.5*(n-e),a=r*r,h=r*a;return(2*e-2*i+o+s)*h+(-3*e+3*i-2*o-s)*a+o*r+e},e.exports=i},{"./Vec3":57}],54:[function(t,e){function i(t,e,i){return(t.x-i.x)*(e.y-i.y)-(e.x-i.x)*(t.y-i.y)}function n(t,e,i){this.a=t,this.b=e,this.c=i}n.prototype.contains=function(t){var e=i(this.a,this.b,t)<0,n=i(this.b,this.c,t)<0,r=i(this.c,this.a,t)<0;return e==n&&n==r},n.prototype.getArea=function(){var t=this.a.distance(this.b),e=this.a.distance(this.c),i=this.b.distance(this.c),n=(t+e+i)/2;return Math.sqrt(n*(n-t)*(n-e)*(n-i))},e.exports=n},{}],55:[function(t,e){function i(t,e,i){this.a=t,this.b=e,this.c=i}i.prototype.getArea=function(){var t=this.a.distance(this.b),e=this.a.distance(this.c),i=this.b.distance(this.c),n=(t+e+i)/2;return Math.sqrt(n*(n-t)*(n-e)*(n-i))},e.exports=i},{}],56:[function(t,e){function i(t,e){this.x=null!=t?t:0,this.y=null!=e?e:0}i.create=function(t,e){return new i(t,e)},i.fromArray=function(t){return new i(t[0],t[1])},i.prototype.set=function(t,e){return this.x=t,this.y=e,this},i.prototype.equals=function(t,e){return null==e&&(e=1e-7),Math.abs(t.x-this.x)<=e&&Math.abs(t.y-this.y)<=e},i.prototype.hash=function(){return 1*this.x+12*this.y},i.prototype.setVec2=function(t){return this.x=t.x,this.y=t.y,this},i.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},i.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},i.prototype.scale=function(t){return this.x*=t,this.y*=t,this},i.prototype.distance=function(t){var e=t.x-this.x,i=t.y-this.y;return Math.sqrt(e*e+i*i)},i.prototype.squareDistance=function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},i.prototype.dot=function(t){return this.x*t.x+this.y*t.y},i.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},i.prototype.clone=function(){return new i(this.x,this.y)},i.prototype.dup=function(){return this.clone()},i.prototype.asAdd=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},i.prototype.asSub=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},i.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},i.prototype.normalize=function(){var t=this.length();return t>0&&this.scale(1/t),this},i.prototype.lerp=function(t,e){this.x=this.x+(t.x-this.x)*e,this.y=this.y+(t.y-this.y)*e},i.prototype.toString=function(){return"{"+Math.floor(1e3*this.x)/1e3+", "+Math.floor(1e3*this.y)/1e3+"}"},e.exports=i},{}],57:[function(t,e){function i(t,e,i){this.x=null!=t?t:0,this.y=null!=e?e:0,this.z=null!=i?i:0}i.create=function(t,e,n){return new i(t,e,n)},i.fromArray=function(t){return new i(t[0],t[1],t[2])},i.prototype.hash=function(){return 1*this.x+12*this.y+123*this.z},i.prototype.set=function(t,e,i){return this.x=t,this.y=e,this.z=i,this},i.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},i.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},i.prototype.scale=function(t){return this.x*=t,this.y*=t,this.z*=t,this},i.prototype.distance=function(t){var e=t.x-this.x,i=t.y-this.y,n=t.z-this.z;return Math.sqrt(e*e+i*i+n*n)},i.prototype.squareDistance=function(t){var e=t.x-this.x,i=t.y-this.y,n=t.z-this.z;return e*e+i*i+n*n},i.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},i.prototype.setVec3=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},i.prototype.clone=function(){return new i(this.x,this.y,this.z)},i.prototype.dup=function(){return this.clone()},i.prototype.cross=function(t){var e=this.x,i=this.y,n=this.z,r=t.x,o=t.y,s=t.z;return this.x=i*s-n*o,this.y=n*r-e*s,this.z=e*o-i*r,this},i.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},i.prototype.asAdd=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},i.prototype.asSub=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},i.prototype.asCross=function(t,e){return this.copy(t).cross(e)},i.prototype.addScaled=function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},i.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},i.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},i.prototype.normalize=function(){var t=this.length();return t>0&&this.scale(1/t),this},i.prototype.transformQuat=function(t){var e=this.x,i=this.y,n=this.z,r=t.x,o=t.y,s=t.z,a=t.w,h=a*e+o*n-s*i,l=a*i+s*e-r*n,u=a*n+r*i-o*e,c=-r*e-o*i-s*n;return this.x=h*a+c*-r+l*-s-u*-o,this.y=l*a+c*-o+u*-r-h*-s,this.z=u*a+c*-s+h*-o-l*-r,this},i.prototype.transformMat4=function(t){var e=t.a14+t.a11*this.x+t.a12*this.y+t.a13*this.z,i=t.a24+t.a21*this.x+t.a22*this.y+t.a23*this.z,n=t.a34+t.a31*this.x+t.a32*this.y+t.a33*this.z;return this.x=e,this.y=i,this.z=n,this},i.prototype.equals=function(t,e){return e=null!=e?e:1e-7,Math.abs(t.x-this.x)<=e&&Math.abs(t.y-this.y)<=e&&Math.abs(t.z-this.z)<=e},i.prototype.toString=function(){return"{"+Math.floor(1e3*this.x)/1e3+", "+Math.floor(1e3*this.y)/1e3+", "+Math.floor(1e3*this.z)/1e3+"}"},i.prototype.lerp=function(t,e){this.x=this.x+(t.x-this.x)*e,this.y=this.y+(t.y-this.y)*e,this.z=this.z+(t.z-this.z)*e},i.Zero=new i(0,0,0),e.exports=i},{}],58:[function(t,e){function i(t,e,i,n){this.x=null!=t?t:0,this.y=null!=e?e:0,this.z=null!=i?i:0,this.w=null!=n?n:0}i.prototype.equals=function(t,e){return null==e&&(e=1e-7),Math.abs(t.x-this.x)<=e&&Math.abs(t.y-this.y)<=e&&Math.abs(t.z-this.z)<=e&&Math.abs(t.w-this.w)<=e},i.prototype.hash=function(){return 1*this.x+12*this.y+123*this.z+1234*this.w},i.create=function(t,e,n,r){return new i(t,e,n,r)},i.fromArray=function(t){return new i(t[0],t[1],t[2],t[3])},i.prototype.set=function(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this},i.prototype.setVec4=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},i.prototype.transformMat4=function(t){var e=t.a14*this.w+t.a11*this.x+t.a12*this.y+t.a13*this.z,i=t.a24*this.w+t.a21*this.x+t.a22*this.y+t.a23*this.z,n=t.a34*this.w+t.a31*this.x+t.a32*this.y+t.a33*this.z,r=t.a44*this.w+t.a41*this.x+t.a42*this.y+t.a43*this.z;return this.x=e,this.y=i,this.z=n,this.w=r,this},i.prototype.toString=function(){return"{"+Math.floor(1e3*this.x)/1e3+", "+Math.floor(1e3*this.y)/1e3+", "+Math.floor(1e3*this.z)/1e3+", "+Math.floor(1e3*this.w)/1e3+"}"},e.exports=i},{}],59:[function(t,e){!function(t,e,i,n,r,o,s,a,h){function l(t){var e,i=t.length,r=this,o=0,s=r.i=r.j=0,a=r.S=[];for(i||(t=[i++]);n>o;)a[o]=o++;for(o=0;n>o;o++)a[o]=a[s=x&s+t[o%i]+(e=a[o])],a[s]=e;(r.g=function(t){for(var e,i=0,o=r.i,s=r.j,a=r.S;t--;)e=a[o=x&o+1],i=i*n+a[x&(a[o]=a[s=x&s+e])+(a[s]=e)];return r.i=o,r.j=s,i})(n)}function u(t,e){var i,n=[],r=typeof t;if(e&&"object"==r)for(i in t)try{n.push(u(t[i],e-1))}catch(o){}return n.length?n:"string"==r?t:t+"\x00"}function c(t,e){for(var i,n=t+"",r=0;r<n.length;)e[x&r]=x&(i^=19*e[x&r])+n.charCodeAt(r++);return d(e)}function p(i){try{return t.crypto.getRandomValues(i=new Uint8Array(n)),d(i)}catch(r){return[+new Date,t,(i=t.navigator)&&i.plugins,t.screen,d(e)]}}function d(t){return String.fromCharCode.apply(0,t)}var f=i.pow(n,r),g=i.pow(2,o),m=2*g,x=n-1,v=i["seed"+h]=function(t,o,s){var a=[],x=c(u(o?[t,d(e)]:null==t?p():t,3),a),v=new l(a);return c(d(v.S),e),(s||function(t,e,n){return n?(i[h]=t,e):t})(function(){for(var t=v.g(r),e=f,i=0;g>t;)t=(t+i)*n,e*=n,i=v.g(1);for(;t>=m;)t/=2,e/=2,i>>>=1;return(t+i)/e},x,this==i)};c(i[h](),e),s&&s.exports?s.exports=v:a&&a.amd&&a(function(){return v})}(this,[],Math,256,6,52,"object"==typeof e&&e,"function"==typeof define&&define,"random")},{}],60:[function(t,e){e.exports.Context=t("./lib/Context"),e.exports.Texture=t("./lib/Texture"),e.exports.Texture2D=t("./lib/Texture2D"),e.exports.TextureCube=t("./lib/TextureCube"),e.exports.Program=t("./lib/Program"),e.exports.Material=t("./lib/Material"),e.exports.Mesh=t("./lib/Mesh"),e.exports.OrthographicCamera=t("./lib/OrthographicCamera"),e.exports.PerspectiveCamera=t("./lib/PerspectiveCamera"),e.exports.Arcball=t("./lib/Arcball"),e.exports.ScreenImage=t("./lib/ScreenImage"),e.exports.RenderTarget=t("./lib/RenderTarget");var i=t("./lib/Utils");for(var n in i)e.exports[n]=i[n]},{"./lib/Arcball":61,"./lib/Context":63,"./lib/Material":64,"./lib/Mesh":65,"./lib/OrthographicCamera":66,"./lib/PerspectiveCamera":67,"./lib/Program":68,"./lib/RenderTarget":69,"./lib/ScreenImage":71,"./lib/Texture":72,"./lib/Texture2D":73,"./lib/TextureCube":74,"./lib/Utils":75}],61:[function(t,e){var i,n,r,o,s,a,h,l;l=t("pex-geom"),s=l.Vec2,a=l.Vec3,h=l.Vec4,o=l.Quat,n=l.Mat4,r=l.Plane,i=function(){function t(t,e,i){this.camera=e,this.window=t,this.radius=2*Math.min(t.width/2,t.height/2),this.center=s.create(t.width/2,t.height/2),this.currRot=o.create(),this.currRot.setAxisAngle(a.create(0,1,0),0),this.clickRot=o.create(),this.dragRot=o.create(),this.clickPos=a.create(),this.clickPosWindow=s.create(),this.dragPos=a.create(),this.dragPosWindow=s.create(),this.rotAxis=a.create(),this.allowZooming=!0,this.enabled=!0,this.clickTarget=a.create(0,0,0),this.setDistance(i||2),this.updateCamera(),this.addEventHanlders()}return t.prototype.setTarget=function(t){return this.camera.setTarget(t),this.updateCamera()},t.prototype.setOrientation=function(t){return this.currRot.setDirection(t),this.currRot.w*=-1,this.updateCamera(),this},t.prototype.setPosition=function(t){var e;return e=a.create().asSub(t,this.camera.getTarget()),this.setOrientation(e.dup().normalize()),this.setDistance(e.length()),this.updateCamera()},t.prototype.addEventHanlders=function(){return this.window.on("leftMouseDown",function(t){return function(e){return!e.handled&&t.enabled?t.down(e.x,e.y,e.shift):void 0}}(this)),this.window.on("leftMouseUp",function(t){return function(e){return t.up(e.x,e.y,e.shift)}}(this)),this.window.on("mouseDragged",function(t){return function(e){return!e.handled&&t.enabled?t.drag(e.x,e.y,e.shift):void 0}}(this)),this.window.on("scrollWheel",function(t){return function(e){return!e.handled&&t.enabled&&t.allowZooming?(t.distance=Math.min(t.maxDistance,Math.max(t.distance+e.dy/100*(t.maxDistance-t.minDistance),t.minDistance)),t.updateCamera()):void 0}}(this))},t.prototype.mouseToSphere=function(t,e){var i,n;return e=this.window.height-e,n=a.create((t-this.center.x)/this.radius,(e-this.center.y)/this.radius,0),i=n.x*n.x+n.y*n.y,i>1?n.normalize():n.z=Math.sqrt(1-i),n},t.prototype.down=function(t,e,i){var n,o;return this.dragging=!0,this.clickPos=this.mouseToSphere(t,e),this.clickRot.copy(this.currRot),this.updateCamera(),i?(this.clickPosWindow.set(t,e),n=this.camera.getTarget(),this.clickTarget=n.dup(),o=n.dup().transformMat4(this.camera.getViewMatrix()),this.panPlane=new r(o,new a(0,0,1)),this.clickPosPlane=this.panPlane.intersectRay(this.camera.getViewRay(this.clickPosWindow.x,this.clickPosWindow.y,this.window.width,this.window.height)),this.dragPosPlane=this.panPlane.intersectRay(this.camera.getViewRay(this.dragPosWindow.x,this.dragPosWindow.y,this.window.width,this.window.height))):this.panPlane=null},t.prototype.up=function(){return this.dragging=!1,this.panPlane=null},t.prototype.drag=function(t,e,i){var n,r;if(this.dragging)return i&&this.panPlane?(this.dragPosWindow.set(t,e),this.clickPosPlane=this.panPlane.intersectRay(this.camera.getViewRay(this.clickPosWindow.x,this.clickPosWindow.y,this.window.width,this.window.height)),this.dragPosPlane=this.panPlane.intersectRay(this.camera.getViewRay(this.dragPosWindow.x,this.dragPosWindow.y,this.window.width,this.window.height)),n=this.camera.getViewMatrix().dup().invert(),this.clickPosWorld=this.clickPosPlane.dup().transformMat4(n),this.dragPosWorld=this.dragPosPlane.dup().transformMat4(n),this.diffWorld=this.dragPosWorld.dup().sub(this.clickPosWorld),this.camera.setTarget(this.clickTarget.dup().sub(this.diffWorld)),this.updateCamera()):(this.dragPos=this.mouseToSphere(t,e),this.rotAxis.asCross(this.clickPos,this.dragPos),r=this.clickPos.dot(this.dragPos),this.dragRot.set(this.rotAxis.x,this.rotAxis.y,this.rotAxis.z,r),this.currRot.asMul(this.dragRot,this.clickRot)),this.updateCamera()},t.prototype.updateCamera=function(){var t,e,i,n,r;return i=this.currRot.clone(),i.w*=-1,n=this.camera.getTarget(),e=a.create(0,0,this.distance).transformQuat(i),t=a.create().asAdd(n,e),r=a.create(0,1,0).transformQuat(i),this.camera.lookAt(n,t,r)},t.prototype.disableZoom=function(){return this.allowZooming=!1},t.prototype.setDistance=function(t){return this.distance=t||2,this.minDistance=t/2||.3,this.maxDistance=2*t||5,this.updateCamera()},t}(),e.exports=i},{"pex-geom":40}],62:[function(t,e){var i,n,r,o,s,a,h,l,u,c,p,d;d=t("pex-geom"),l=d.Vec2,u=d.Vec3,c=d.Vec4,o=d.Edge,s=d.Face3,a=d.Face4,h=d.FacePolygon,n=t("pex-color").Color,r=t("./Context"),p=function(t,e){var i,n,r;for(n=0,r=e.length;r>n;n++)if(i=e[n],"undefined"==typeof t[i])return!1;return!0},i=function(){function t(t,e,i,n){this.gl=r.currentContext,this.target=t,this.type=e,this.usage=n||gl.STATIC_DRAW,this.dataBuf=null,i&&this.update(i,this.usage)}return t.prototype.dispose=function(){return this.gl.deleteBuffer(this.handle),this.handle=null},t.prototype.update=function(t,e){var i,n,r,o,s,a,h,l,u,c,d,f,g,m,x,v,y,w,b,C,T,E;if(this.handle||(this.handle=this.gl.createBuffer()),this.usage=e||this.usage,t&&0!==t.length){if(isNaN(t[0]))if(p(t[0],["x","y","z","w"]))for(this.dataBuf&&this.dataBuf.length===4*t.length||(this.dataBuf=new this.type(4*t.length),this.elementSize=4),r=l=0,f=t.length;f>l;r=++l)a=t[r],this.dataBuf[4*r+0]=a.x,this.dataBuf[4*r+1]=a.y,this.dataBuf[4*r+2]=a.z,this.dataBuf[4*r+3]=a.w;else if(p(t[0],["x","y","z"]))for(this.dataBuf&&this.dataBuf.length===3*t.length||(this.dataBuf=new this.type(3*t.length),this.elementSize=3),r=u=0,g=t.length;g>u;r=++u)a=t[r],this.dataBuf[3*r+0]=a.x,this.dataBuf[3*r+1]=a.y,this.dataBuf[3*r+2]=a.z;else if(p(t[0],["x","y"]))for(this.dataBuf&&this.dataBuf.length===2*t.length||(this.dataBuf=new this.type(2*t.length),this.elementSize=2),r=c=0,m=t.length;m>c;r=++c)a=t[r],this.dataBuf[2*r+0]=a.x,this.dataBuf[2*r+1]=a.y;else if(p(t[0],["r","g","b","a"]))for(this.dataBuf&&this.dataBuf.length===4*t.length||(this.dataBuf=new this.type(4*t.length),this.elementSize=4),r=b=0,x=t.length;x>b;r=++b)a=t[r],this.dataBuf[4*r+0]=a.r,this.dataBuf[4*r+1]=a.g,this.dataBuf[4*r+2]=a.b,this.dataBuf[4*r+3]=a.a;else if(2===t[0].length)for(this.dataBuf&&this.dataBuf.length===2*t.length||(this.dataBuf=new this.type(2*t.length),this.elementSize=1),r=C=0,v=t.length;v>C;r=++C)i=t[r],this.dataBuf[2*r+0]=i[0],this.dataBuf[2*r+1]=i[1];else if(t[0].length>=3){for(s=0,T=0,y=t.length;y>T;T++)if(n=t[T],3===n.length&&(s+=3),4===n.length&&(s+=6),n.length>4)throw"FacePolygons "+n.length+" + are not supported in RenderableGeometry Buffers";for(this.dataBuf&&this.dataBuf.length===s||(this.dataBuf=new this.type(s),this.elementSize=1),o=0,E=0,w=t.length;w>E;E++)n=t[E],3===n.length&&(this.dataBuf[o+0]=n[0],this.dataBuf[o+1]=n[1],this.dataBuf[o+2]=n[2],o+=3),4===n.length&&(this.dataBuf[o+0]=n[0],this.dataBuf[o+1]=n[1],this.dataBuf[o+2]=n[3],this.dataBuf[o+3]=n[3],this.dataBuf[o+4]=n[1],this.dataBuf[o+5]=n[2],o+=6)}else console.log("Buffer.unknown type",t.name,t[0]);else for(this.dataBuf&&this.dataBuf.length===t.length||(this.dataBuf=new this.type(t.length)),r=h=0,d=t.length;d>h;r=++h)a=t[r],this.dataBuf[r]=a,this.elementSize=1;return this.gl.bindBuffer(this.target,this.handle),this.gl.bufferData(this.target,this.dataBuf,this.usage)}},t}(),e.exports=i},{"./Context":63,"pex-color":2,"pex-geom":40}],63:[function(t,e){var i=t("pex-sys"),n=null,r={};Object.defineProperty(r,"currentContext",{get:function(){return n?n:i.Window.currentWindow?i.Window.currentWindow.gl:null},set:function(t){n=t},enumerable:!0,configurable:!0}),e.exports=r},{"pex-sys":94}],64:[function(t,e){function i(t,e){this.gl=n.currentContext,this.program=t,this.uniforms=e||{},this.prevUniforms={}}var n=t("./Context");i.prototype.use=function(){this.program.use();var t=0;for(var e in this.program.uniforms)if(null==this.uniforms[e]&&(-1==e.indexOf("[")&&console.log("WARN","Uniform",e,"is null"),this.uniforms[e]=0),this.program.uniforms[e].type==this.gl.SAMPLER_2D||this.program.uniforms[e].type==this.gl.SAMPLER_CUBE)this.gl.activeTexture(this.gl.TEXTURE0+t),this.uniforms[e],this.uniforms[e].width>0&&this.uniforms[e].height>0&&(this.gl.bindTexture(this.uniforms[e].target,this.uniforms[e].handle),this.program.uniforms[e](t)),t++;else{var i=this.uniforms[e],n=this.prevUniforms[e],r=null;if(null!==n)if(i.hash){if(r=i.hash(),r==n)continue}else if(i==n)continue;this.program.uniforms[e](this.uniforms[e]),this.prevUniforms[e]=r?r:i}},e.exports=i},{"./Context":63}],65:[function(t,e){var i,n,r,o,s,a,h,l,u;l=t("merge"),u=t("pex-geom"),h=u.Vec3,s=u.Quat,r=u.Mat4,i=u.BoundingBox,n=t("./Context"),a=t("./RenderableGeometry"),o=function(){function t(t,e,i){this.gl=n.currentContext,this.geometry=l(t,a),this.material=e,i=i||{},this.primitiveType=i.primitiveType,null==this.primitiveType&&(this.primitiveType=this.gl.TRIANGLES),i.lines&&(this.primitiveType=this.gl.LINES),i.triangles&&(this.primitiveType=this.gl.TRIANGLES),i.points&&(this.primitiveType=this.gl.POINTS),this.position=h.create(0,0,0),this.rotation=s.create(),this.scale=h.create(1,1,1),this.projectionMatrix=r.create(),this.viewMatrix=r.create(),this.invViewMatrix=r.create(),this.modelWorldMatrix=r.create(),this.modelViewMatrix=r.create(),this.rotationMatrix=r.create(),this.normalMatrix=r.create()
}return t.prototype.draw=function(t){var e;return this.geometry.isDirty()&&this.geometry.compile(),t&&(this.updateMatrices(t),this.updateMatricesUniforms(this.material)),this.material.use(),this.bindAttribs(),this.geometry.faces&&this.geometry.faces.length>0&&this.primitiveType!==this.gl.LINES&&this.primitiveType!==this.gl.POINTS?(this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.geometry.faces.buffer.handle),this.gl.drawElements(this.primitiveType,this.geometry.faces.buffer.dataBuf.length,this.gl.UNSIGNED_SHORT,0)):this.geometry.edges&&this.geometry.edges.length>0&&this.primitiveType===this.gl.LINES?(this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.geometry.edges.buffer.handle),this.gl.drawElements(this.primitiveType,this.geometry.edges.buffer.dataBuf.length,this.gl.UNSIGNED_SHORT,0)):this.geometry.vertices&&(e=this.geometry.vertices.length,this.gl.drawArrays(this.primitiveType,0,e)),this.unbindAttribs()},t.prototype.drawInstances=function(t,e){var i,n,r,o,s,a,h,l;if(this.geometry.isDirty()&&this.geometry.compile(),this.material.use(),this.bindAttribs(),this.geometry.faces&&this.geometry.faces.length>0&&!this.useEdges)for(this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.geometry.faces.buffer.handle),r=0,a=e.length;a>r;r++)i=e[r],t&&(this.updateMatrices(t,i),this.updateMatricesUniforms(this.material),this.updateUniforms(this.material,i),this.material.use()),this.gl.drawElements(this.primitiveType,this.geometry.faces.buffer.dataBuf.length,this.gl.UNSIGNED_SHORT,0);else if(this.geometry.edges&&this.useEdges)for(this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.geometry.edges.buffer.handle),o=0,h=e.length;h>o;o++)i=e[o],t&&(this.updateMatrices(t,i),this.updateMatricesUniforms(this.material),this.updateUniforms(this.material,i),this.material.use()),this.gl.drawElements(this.primitiveType,this.geometry.edges.buffer.dataBuf.length,this.gl.UNSIGNED_SHORT,0);else if(this.geometry.vertices)for(n=this.geometry.vertices.length,s=0,l=e.length;l>s;s++)i=e[s],t&&(this.updateMatrices(t,i),this.updateMatricesUniforms(this.material),this.updateUniforms(this.material,i),this.material.use()),this.gl.drawArrays(this.primitiveType,0,n);return this.unbindAttribs()},t.prototype.bindAttribs=function(){var t,e,i,n,r;i=this.material.program,n=this.geometry.attribs,r=[];for(e in n)t=n[e],t.location=this.gl.getAttribLocation(i.handle,t.name),t.location>=0?(this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t.buffer.handle),this.gl.vertexAttribPointer(t.location,t.buffer.elementSize,this.gl.FLOAT,!1,0,0),r.push(this.gl.enableVertexAttribArray(t.location))):r.push(void 0);return r},t.prototype.unbindAttribs=function(){var t,e,i,n;i=this.geometry.attribs,n=[];for(e in i)t=i[e],n.push(t.location>=0?this.gl.disableVertexAttribArray(t.location):void 0);return n},t.prototype.resetAttribLocations=function(){var t,e,i;i=[];for(e in this.attributes)t=this.attributes[e],i.push(t.location=-1);return i},t.prototype.updateMatrices=function(t,e){var i,n,r;return i=e&&e.position?e.position:this.position,n=e&&e.rotation?e.rotation:this.rotation,r=e&&e.scale?e.scale:this.scale,n.toMat4(this.rotationMatrix),this.modelWorldMatrix.identity().translate(i.x,i.y,i.z).mul(this.rotationMatrix).scale(r.x,r.y,r.z),t?(this.projectionMatrix.copy(t.getProjectionMatrix()),this.viewMatrix.copy(t.getViewMatrix()),this.invViewMatrix.copy(t.getViewMatrix().dup().invert()),this.modelViewMatrix.copy(t.getViewMatrix()).mul(this.modelWorldMatrix),this.normalMatrix.copy(this.modelViewMatrix).invert().transpose()):void 0},t.prototype.updateUniforms=function(t,e){var i,n,r,o;r=e.uniforms,o=[];for(i in r)n=r[i],o.push(t.uniforms[i]=n);return o},t.prototype.updateMatricesUniforms=function(){var t,e;return e=this.material.program.uniforms,t=this.material.uniforms,e.projectionMatrix&&(t.projectionMatrix=this.projectionMatrix),e.viewMatrix&&(t.viewMatrix=this.viewMatrix),e.invViewMatrix&&(t.invViewMatrix=this.invViewMatrix),e.modelWorldMatrix&&(t.modelWorldMatrix=this.modelWorldMatrix),e.modelViewMatrix&&(t.modelViewMatrix=this.modelViewMatrix),e.normalMatrix?t.normalMatrix=this.normalMatrix:void 0},t.prototype.getMaterial=function(){return this.material},t.prototype.setMaterial=function(t){return this.material=t,this.resetAttribLocations()},t.prototype.getProgram=function(){return this.material.program},t.prototype.setProgram=function(t){return this.material.program=t,this.resetAttribLocations()},t.prototype.dispose=function(){return this.geometry.dispose()},t.prototype.getBoundingBox=function(){return this.boundingBox||this.updateBoundingBox(),this.boundingBox},t.prototype.updateBoundingBox=function(){return this.updateMatrices(),this.boundingBox=i.fromPoints(this.geometry.vertices.map(function(t){return function(e){return e.dup().transformMat4(t.modelWorldMatrix)}}(this)))},t}(),e.exports=o},{"./Context":63,"./RenderableGeometry":70,merge:1,"pex-geom":40}],66:[function(t,e){var i,n,r,o,s,a,h;h=t("pex-geom"),o=h.Vec2,s=h.Vec3,a=h.Vec4,i=h.Mat4,r=h.Ray,n=function(){function t(t,e,n,r,o,a,h,l,u){var c,p,d,f;p=t,d=t+n,f=e,c=e+r,this.left=p,this.right=d,this.bottom=c,this.top=f,this.near=o||.1,this.far=a||100,this.position=h||s.create(0,0,5),this.target=l||s.create(0,0,0),this.up=u||s.create(0,1,0),this.projectionMatrix=i.create(),this.viewMatrix=i.create(),this.updateMatrices()}var e;return t.prototype.getFov=function(){return this.fov},t.prototype.getAspectRatio=function(){return this.aspectRatio},t.prototype.getNear=function(){return this.near},t.prototype.getFar=function(){return this.far},t.prototype.getPosition=function(){return this.position},t.prototype.getTarget=function(){return this.target},t.prototype.getUp=function(){return this.up},t.prototype.getViewMatrix=function(){return this.viewMatrix},t.prototype.getProjectionMatrix=function(){return this.projectionMatrix},t.prototype.setFov=function(t){return this.fov=t,this.updateMatrices()},t.prototype.setAspectRatio=function(t){return this.aspectRatio=t,this.updateMatrices()},t.prototype.setFar=function(t){return this.far=t,this.updateMatrices()},t.prototype.setNear=function(t){return this.near=t,this.updateMatrices()},t.prototype.setPosition=function(t){return this.position=t,this.updateMatrices()},t.prototype.setTarget=function(t){return this.target=t,this.updateMatrices()},t.prototype.setUp=function(t){return this.up=t,this.updateMatrices()},t.prototype.lookAt=function(t,e,i){return t&&(this.target=t),e&&(this.position=e),i&&(this.up=i),this.updateMatrices()},t.prototype.updateMatrices=function(){return this.projectionMatrix.identity().ortho(this.left,this.right,this.bottom,this.top,this.near,this.far),this.viewMatrix.identity().lookAt(this.position,this.target,this.up)},e=a.create(),t.prototype.getScreenPos=function(t,i,n){var r;return e.set(t.x,t.y,t.z,1),e.transformMat4(this.viewMatrix),e.transformMat4(this.projectionMatrix),r=o.create().set(e.x,e.y),r.x/=e.w,r.y/=e.w,r.x=.5*r.x+.5,r.y=.5*r.y+.5,r.x*=i,r.y*=n,r},t.prototype.getWorldRay=function(t,e,i,n){var o,a,h,l,u,c,p,d;return t=(t-i/2)/(i/2),e=-(e-n/2)/(n/2),o=2*Math.tan(this.getFov()/180*Math.PI/2)*this.getNear(),c=o*this.getAspectRatio(),t*=c/2,e*=o/2,h=new s(0,0,0),l=new s(t,e,-this.getNear()),a=this.getViewMatrix().dup().invert(),p=h.dup().transformMat4(a),d=l.dup().transformMat4(a),u=d.dup().sub(p),new r(p,u)},t}(),e.exports=n},{"pex-geom":40}],67:[function(t,e){var i,n,r,o,s,a,h;h=t("pex-geom"),o=h.Vec2,s=h.Vec3,a=h.Vec4,i=h.Mat4,r=h.Ray,n=function(){function t(t,e,n,r,o,a,h){this.fov=t||60,this.aspectRatio=e||4/3,this.near=n||.1,this.far=r||100,this.position=o||s.create(0,0,5),this.target=a||s.create(0,0,0),this.up=h||s.create(0,1,0),this.projectionMatrix=i.create(),this.viewMatrix=i.create(),this.updateMatrices()}var e;return t.prototype.getFov=function(){return this.fov},t.prototype.getAspectRatio=function(){return this.aspectRatio},t.prototype.getNear=function(){return this.near},t.prototype.getFar=function(){return this.far},t.prototype.getPosition=function(){return this.position},t.prototype.getTarget=function(){return this.target},t.prototype.getUp=function(){return this.up},t.prototype.getViewMatrix=function(){return this.viewMatrix},t.prototype.getProjectionMatrix=function(){return this.projectionMatrix},t.prototype.setFov=function(t){return this.fov=t,this.updateMatrices()},t.prototype.setAspectRatio=function(t){return this.aspectRatio=t,this.updateMatrices()},t.prototype.setFar=function(t){return this.far=t,this.updateMatrices()},t.prototype.setNear=function(t){return this.near=t,this.updateMatrices()},t.prototype.setPosition=function(t){return this.position=t,this.updateMatrices()},t.prototype.setTarget=function(t){return this.target=t,this.updateMatrices()},t.prototype.setUp=function(t){return this.up=t,this.updateMatrices()},t.prototype.lookAt=function(t,e,i){return t&&(this.target=t),e&&(this.position=e),i&&(this.up=i),this.updateMatrices()},t.prototype.updateMatrices=function(){return this.projectionMatrix.identity().perspective(this.fov,this.aspectRatio,this.near,this.far),this.viewMatrix.identity().lookAt(this.position,this.target,this.up)},e=a.create(),t.prototype.getScreenPos=function(t,i,n){var r;return e.set(t.x,t.y,t.z,1),e.transformMat4(this.viewMatrix),e.transformMat4(this.projectionMatrix),r=o.create().set(e.x,e.y),r.x/=e.w,r.y/=e.w,r.x=.5*r.x+.5,r.y=.5*r.y+.5,r.x*=i,r.y*=n,r},t.prototype.getViewRay=function(t,e,i,n){var o,a,h,l,u,c,p;return a=(t-i/2)/(i/2),h=-(e-n/2)/(n/2),o=2*Math.tan(this.getFov()/180*Math.PI/2)*this.getNear(),p=o*this.getAspectRatio(),a*=p/2,h*=o/2,u=new s(0,0,0),c=new s(a,h,-this.getNear()),l=c.dup().sub(u).normalize(),new r(u,l)},t.prototype.getWorldRay=function(t,e,i,n){var o,a,h,l,u,c,p,d;return t=(t-i/2)/(i/2),e=-(e-n/2)/(n/2),o=2*Math.tan(this.getFov()/180*Math.PI/2)*this.getNear(),c=o*this.getAspectRatio(),t*=c/2,e*=o/2,h=new s(0,0,0),l=new s(t,e,-this.getNear()),a=this.getViewMatrix().dup().invert(),p=h.dup().transformMat4(a),d=l.dup().transformMat4(a),u=d.dup().sub(p),new r(p,u)},t}(),e.exports=n},{"pex-geom":40}],68:[function(t,e){function i(t,e){this.gl=n.currentContext,this.handle=this.gl.createProgram(),this.uniforms={},this.attributes={},this.addSources(t,e),this.ready=!1,this.vertShader&&this.fragShader&&this.link()}var n=t("./Context"),r=t("pex-sys"),o=r.IO,s="#ifdef GL_ES\nprecision highp float;\n#endif\n#define VERT\n",a="#ifdef GL_ES\n#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n#else\n  precision mediump float;\n#endif\n#endif\n#define FRAG\n";i.prototype.addSources=function(t,e){return null==e&&(e=t),t&&this.addVertexSource(t),e?this.addFragmentSource(e):void 0},i.prototype.addVertexSource=function(t){if(this.vertShader=this.gl.createShader(this.gl.VERTEX_SHADER),this.gl.shaderSource(this.vertShader,s+t+"\n"),this.gl.compileShader(this.vertShader),!this.gl.getShaderParameter(this.vertShader,this.gl.COMPILE_STATUS))throw new Error(this.gl.getShaderInfoLog(this.vertShader))},i.prototype.addFragmentSource=function(t){if(this.fragShader=this.gl.createShader(this.gl.FRAGMENT_SHADER),this.gl.shaderSource(this.fragShader,a+t+"\n"),this.gl.compileShader(this.fragShader),!this.gl.getShaderParameter(this.fragShader,this.gl.COMPILE_STATUS))throw new Error(this.gl.getShaderInfoLog(this.fragShader))},i.prototype.link=function(){if(this.gl.attachShader(this.handle,this.vertShader),this.gl.attachShader(this.handle,this.fragShader),this.gl.linkProgram(this.handle),!this.gl.getProgramParameter(this.handle,this.gl.LINK_STATUS))throw new Error(this.gl.getProgramInfoLog(this.handle));for(var t=this.gl.getProgramParameter(this.handle,this.gl.ACTIVE_UNIFORMS),e=0;t>e;e++){var n=this.gl.getActiveUniform(this.handle,e);if(n.size>1)for(var r=0;r<n.size;r++){var o=n.name.replace(/\[\d+\]/,"["+r+"]"),s=this.gl.getUniformLocation(this.handle,o);this.uniforms[o]=i.makeUniformSetter(this.gl,n.type,s)}else{var s=this.gl.getUniformLocation(this.handle,n.name);this.uniforms[n.name]=i.makeUniformSetter(this.gl,n.type,s)}}for(var a=this.gl.getProgramParameter(this.handle,this.gl.ACTIVE_ATTRIBUTES),e=0;a>e;e++){n=this.gl.getActiveAttrib(this.handle,e);var s=this.gl.getAttribLocation(this.handle,n.name);this.attributes[n.name]=s}return this.ready=!0,this},i.prototype.use=function(){return i.currentProgram!==this.handle?(i.currentProgram=this.handle,this.gl.useProgram(this.handle)):void 0},i.prototype.dispose=function(){return this.gl.deleteShader(this.vertShader),this.gl.deleteShader(this.fragShader),this.gl.deleteProgram(this.handle)},i.load=function(t,e,n){var r;return r=new i,o.loadTextFile(t,function(i){return console.log("Program.Compiling "+t),r.addSources(i),r.link(),e&&e(),n&&n.autoreload?o.watchTextFile(t,function(e){var i;try{return r.gl.detachShader(r.handle,r.vertShader),r.gl.detachShader(r.handle,r.fragShader),r.addSources(e),r.link()}catch(n){return i=n,console.log("Program.load : failed to reload "+t),console.log(i)}}):void 0}),r},i.makeUniformSetter=function(t,e,i){var n=null;switch(e){case t.BOOL:case t.INT:n=function(e){return t.uniform1i(i,e)};break;case t.SAMPLER_2D:case t.SAMPLER_CUBE:n=function(e){return t.uniform1i(i,e)};break;case t.FLOAT:n=function(e){return t.uniform1f(i,e)};break;case t.FLOAT_VEC2:n=function(e){return t.uniform2f(i,e.x,e.y)};break;case t.FLOAT_VEC3:n=function(e){return t.uniform3f(i,e.x,e.y,e.z)};break;case t.FLOAT_VEC4:n=function(e){return null!=e.r&&t.uniform4f(i,e.r,e.g,e.b,e.a),null!=e.x?t.uniform4f(i,e.x,e.y,e.z,e.w):void 0};break;case t.FLOAT_MAT4:var r=new Float32Array(16);n=function(e){return r[0]=e.a11,r[1]=e.a21,r[2]=e.a31,r[3]=e.a41,r[4]=e.a12,r[5]=e.a22,r[6]=e.a32,r[7]=e.a42,r[8]=e.a13,r[9]=e.a23,r[10]=e.a33,r[11]=e.a43,r[12]=e.a14,r[13]=e.a24,r[14]=e.a34,r[15]=e.a44,t.uniformMatrix4fv(i,!1,r)}}return n?(n.type=e,n):function(){throw new Error("Unknown uniform type: "+e)}},e.exports=i},{"./Context":63,"pex-sys":94}],69:[function(t,e){function i(t,e,i){var s=this.gl=n.currentContext,a={color:!0,depth:!1};if(i=o(a,i),this.width=t,this.height=e,this.oldBinding=s.getParameter(s.FRAMEBUFFER_BINDING),this.handle=s.createFramebuffer(),s.bindFramebuffer(s.FRAMEBUFFER,this.handle),this.colorAttachments=[],this.colorAttachmentsPositions=[],this.depthAttachments=[],i.color===!0){var h=r.create(t,e,i);s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,h.target,h.handle,0),this.colorAttachments.push(h),this.colorAttachmentsPositions.push(s.COLOR_ATTACHMENT0)}else void 0!==i.color.length&&i.color.length>0?i.color.forEach(function(t,e){s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0+e,t.target,t.handle,0),this.colorAttachments.push(t),this.colorAttachmentsPositions.push(s.COLOR_ATTACHMENT0+e)}.bind(this)):i.color!==!1&&(s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,i.color.target,i.color.handle,0),this.colorAttachments.push(i.color),this.colorAttachmentsPositions.push(s.COLOR_ATTACHMENT0));if(i.depth)if(i.depth===!0){var l=s.getParameter(s.RENDERBUFFER_BINDING);this.depthAttachments[0]={handle:s.createRenderbuffer()},s.bindRenderbuffer(s.RENDERBUFFER,this.depthAttachments[0].handle),s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_COMPONENT16,this.width,this.height),s.bindRenderbuffer(s.RENDERBUFFER,l),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,this.depthAttachments[0].handle)}else this.depthAttachments[0]=i.depth,s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.TEXTURE_2D,this.depthAttachments[0].handle,0);this.checkFramebuffer(),this.checkExtensions(),s.bindFramebuffer(s.FRAMEBUFFER,this.oldBinding),this.oldBinding=null}var n=t("./Context"),r=t("./Texture2D"),o=t("merge"),s=t("pex-sys"),a=s.Platform;i.prototype.checkExtensions=function(){var t=this.gl;if(a.isBrowser&&this.colorAttachments.length>1&&(this.webglDrawBuffersExt=t.getExtension("WEBGL_draw_buffers"),!this.webglDrawBuffersExt))throw"RenderTarget creating multiple render targets:"+this.colorAttachments.length+" but WEBGL_draw_buffers is not available"},i.prototype.bind=function(){var t=this.gl;this.oldBinding=t.getParameter(t.FRAMEBUFFER_BINDING),t.bindFramebuffer(t.FRAMEBUFFER,this.handle),this.colorAttachmentsPositions.length>1&&(a.isBrowser?this.webglDrawBuffersExt.drawBuffersWEBGL(this.colorAttachmentsPositions):t.drawBuffers(this.colorAttachmentsPositions))},i.prototype.bindAndClear=function(){var t=this.gl;this.bind(),t.clearColor(0,0,0,1),t.clear(this.depthAttachments.length>0?t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT:t.COLOR_BUFFER_BIT)},i.prototype.unbind=function(){var t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,this.oldBinding),this.oldBinding=null,this.colorAttachmentsPositions.length>1&&(a.isBrowser?this.webglDrawBuffersExt.drawBuffersWEBGL([t.COLOR_ATTACHMENT0]):t.drawBuffers([t.COLOR_ATTACHMENT0]))},i.prototype.checkFramebuffer=function(){var t=this.gl,e=t.checkFramebufferStatus(t.FRAMEBUFFER);switch(e){case t.FRAMEBUFFER_UNSUPPORTED:throw"Framebuffer is unsupported";case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw"Framebuffer incomplete attachment";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw"Framebuffer incomplete dimensions";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw"Framebuffer incomplete missing attachment"}},i.prototype.getColorAttachment=function(t){return t=t||0,this.colorAttachments[t]},i.prototype.getDepthAttachement=function(){return this.depthAttachments[0]},e.exports=i},{"./Context":63,"./Texture2D":73,merge:1,"pex-sys":94}],70:[function(t,e){var i,n,r,o,s;r=t("pex-geom").Geometry,n=t("./Context"),i=t("./Buffer"),s=["faces","edges","indices"],o={compile:function(){var t,e,r,o,a,h,l,u;null==this.gl&&(this.gl=n.currentContext),l=this.attribs;for(e in l)t=l[e],t.buffer||(o=t.dynamic?this.gl.DYNAMIC_DRAW:this.gl.STATIC_DRAW,t.buffer=new i(this.gl.ARRAY_BUFFER,Float32Array,null,o),t.dirty=!0),t.dirty&&(t.buffer.update(t),t.dirty=!1);for(u=[],a=0,h=s.length;h>a;a++)r=s[a],this[r]?(this[r].buffer||(o=this[r].dynamic?this.gl.DYNAMIC_DRAW:this.gl.STATIC_DRAW,this[r].buffer=new i(this.gl.ELEMENT_ARRAY_BUFFER,Uint16Array,null,o),this[r].dirty=!0),this[r].dirty?(this[r].buffer.update(this[r]),u.push(this[r].dirty=!1)):u.push(void 0)):u.push(void 0);return u},dispose:function(){var t,e,i,n,r,o,a;o=this.attribs;for(e in o)t=o[e],t&&t.buffer&&t.buffer.dispose();for(a=[],n=0,r=s.length;r>n;n++)i=s[n],a.push(this[i]&&this[i].buffer?this[i].buffer.dispose():void 0);return a}},e.exports=o},{"./Buffer":62,"./Context":63,"pex-geom":40}],71:[function(t,e){(function(){function i(t,e,i,n,u,c,p){e=void 0!==e?e:0,i=void 0!==i?i:0,n=void 0!==n?n:1,u=void 0!==u?u:1,c=void 0!==c?c:1,p=void 0!==p?p:1,this.image=t;var d=new s(l),f={screenSize:r.create(c,p),pixelPosition:r.create(e,i),pixelSize:r.create(n,u),alpha:1};t&&(f.image=t);var g=new a(d,f),m=[new r(-1,1),new r(-1,-1),new r(1,-1),new r(1,1)],x=[new r(0,1),new r(0,0),new r(1,0),new r(1,1)],v=new o({vertices:m,texCoords:x,faces:!0});v.faces.push([0,1,2]),v.faces.push([0,2,3]),this.mesh=new h(v,g)}var n=t("pex-geom"),r=n.Vec2,o=n.Geometry,s=t("./Program"),a=t("./Material"),h=t("./Mesh"),l="#ifdef VERT\n\nattribute vec2 position;\nattribute vec2 texCoord;\nuniform vec2 screenSize;\nuniform vec2 pixelPosition;\nuniform vec2 pixelSize;\nvarying vec2 vTexCoord;\n\nvoid main() {\n  float tx = position.x * 0.5 + 0.5; //-1 -> 0, 1 -> 1\n  float ty = -position.y * 0.5 + 0.5; //-1 -> 1, 1 -> 0\n  //(x + 0)/sw * 2 - 1, (x + w)/sw * 2 - 1\n  float x = (pixelPosition.x + pixelSize.x * tx)/screenSize.x * 2.0 - 1.0;  //0 -> -1, 1 -> 1\n  //1.0 - (y + h)/sh * 2, 1.0 - (y + h)/sh * 2\n  float y = 1.0 - (pixelPosition.y + pixelSize.y * ty)/screenSize.y * 2.0;  //0 -> 1, 1 -> -1\n  gl_Position = vec4(x, y, 0.0, 1.0);\n  vTexCoord = texCoord;\n}\n\n#endif\n\n#ifdef FRAG\n\nvarying vec2 vTexCoord;\nuniform sampler2D image;\nuniform float alpha;\n\nvoid main() {\n  gl_FragColor = texture2D(image, vTexCoord);\n  gl_FragColor.a *= alpha;\n}\n\n#endif";i.prototype.setAlpha=function(t){this.mesh.material.uniforms.alpha=t},i.prototype.setPosition=function(t){this.mesh.material.uniforms.pixelPosition=t},i.prototype.setSize=function(t){this.mesh.material.uniforms.pixelSize=t},i.prototype.setWindowSize=function(t){this.mesh.material.uniforms.windowSize=t},i.prototype.setBounds=function(t){this.mesh.material.uniforms.pixelPosition.x=t.x,this.mesh.material.uniforms.pixelPosition.y=t.y,this.mesh.material.uniforms.pixelSize.x=t.width,this.mesh.material.uniforms.pixelSize.y=t.height},i.prototype.setImage=function(t){this.image=t,this.mesh.material.uniforms.image=t},i.prototype.draw=function(t,e){var i=null;t&&(i=this.mesh.material.uniforms.image,this.mesh.material.uniforms.image=t);var n=null;e&&(n=this.mesh.getProgram(),this.mesh.setProgram(e)),this.mesh.draw(),n&&this.mesh.setProgram(n),i&&(this.mesh.material.uniforms.image=i)},e.exports=i}).call(this,"/../../../pex-glu/lib")},{"./Material":64,"./Mesh":65,"./Program":68,"pex-geom":40}],72:[function(t,e){function i(t){t&&this.init(t)}var n=t("./Context");i.RGBA32F=34836,i.prototype.init=function(t){this.gl=n.currentContext,this.target=t,this.handle=this.gl.createTexture()},i.prototype.bind=function(t){t=t?t:0,this.gl.activeTexture(this.gl.TEXTURE0+t),this.gl.bindTexture(this.target,this.handle)},e.exports=i},{"./Context":63}],73:[function(t,e){function i(){this.gl=s.currentContext,a.call(this,this.gl.TEXTURE_2D)}var n=t("pex-sys"),r=t("merge"),o=n.IO,s=t("./Context"),a=t("./Texture"),h=n.Platform;i.prototype=Object.create(a.prototype),i.create=function(t,e,n){var o=s.currentContext,a={repeat:!1,mipmap:!1,nearest:!1,internalFormat:o.RGBA,format:o.RGBA,type:o.UNSIGNED_BYTE};n=r(a,n);var h=new i;h.bind();var l=o.getExtension?!0:!1;32==n.bpp?(n.internalFormat=l?o.RGBA:34836,n.type=o.FLOAT):n.internalFormat=n.format,h.checkExtensions(n),o.texImage2D(o.TEXTURE_2D,0,n.format,t,e,0,n.format,n.type,null);var u=n.repeat?o.REPEAT:o.CLAMP_TO_EDGE,c=n.repeat?o.REPEAT:o.CLAMP_TO_EDGE,p=o.LINEAR,d=o.LINEAR;return n.nearest&&(p=o.NEAREST,d=o.NEAREST),n.mipmap&&(d=o.LINEAR_MIPMAP_LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,p),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,d),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,u),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,c),o.bindTexture(o.TEXTURE_2D,null),h.width=t,h.height=e,h.target=o.TEXTURE_2D,h},i.prototype.checkExtensions=function(t){var e=this.gl;if(h.isBrowser){if(t.format==e.DEPTH_COMPONENT){var i=e.getExtension("WEBGL_depth_texture");if(!i)throw"Texture2D creating texture with format:gl.DEPTH_COMPONENT but WEBGL_depth_texture is not available"}if(t.type==e.FLOAT){{var n=e.getExtension("OES_texture_float");e.getExtension("OES_texture_float_linear")}if(!n)throw"Texture2D creating texture with type:gl.FLOAT but OES_texture_float is not available"}}},i.prototype.bind=function(t){t=t?t:0,this.gl.activeTexture(this.gl.TEXTURE0+t),this.gl.bindTexture(this.gl.TEXTURE_2D,this.handle)},i.genNoise=function(t,e){t=t||256,e=e||256;var n=s.currentContext,r=new i;r.bind();for(var o=new ArrayBuffer(t*e*2),a=new Uint8Array(o),h=0;e>h;h++)for(var l=0;t>l;l++)a[h*t+l]=Math.floor(255*Math.random());return n.texImage2D(n.TEXTURE_2D,0,n.LUMINANCE,t,e,0,n.LUMINANCE,n.UNSIGNED_BYTE,a),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.bindTexture(n.TEXTURE_2D,null),r.width=t,r.height=e,r},i.genNoiseRGBA=function(t,e){t=t||256,e=e||256;var n=s.currentContext,r=n.createTexture();n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,r);for(var o=new ArrayBuffer(t*e*4),a=new Uint8Array(o),h=0;e>h;h++)for(var l=0;t>l;l++)a[4*(h*t+l)+0]=h,a[4*(h*t+l)+1]=Math.floor(255*Math.random()),a[4*(h*t+l)+2]=Math.floor(255*Math.random()),a[4*(h*t+l)+3]=Math.floor(255*Math.random());n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t,e,0,n.RGBA,n.UNSIGNED_BYTE,a),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!0),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.bindTexture(n.TEXTURE_2D,null);var u=new i;return u.handle=r,u.width=t,u.height=e,u.target=n.TEXTURE_2D,u.gl=n,u},i.load=function(t,e,n){n||"function"!=typeof e||(n=e,optiosn=null);var a={repeat:!1,mipmap:!1,nearest:!1};e=r(a,e);var h=s.currentContext,l=i.create(0,0,e);return l.ready=!1,o.loadImageData(h,l.handle,l.target,l.target,t,{flip:!0,crossOrigin:e.crossOrigin},function(t){if(!t){l.dispose();var r=i.getNoise();l.handle=r.handle,l.width=r.width,l.height=r.height}e.mipmap&&l.generateMipmap(),h.bindTexture(l.target,null),l.width=t.width,l.height=t.height,l.ready=!0,n&&n(l)}),l},i.prototype.dispose=function(){this.handle&&(this.gl.deleteTexture(this.handle),this.handle=null)},i.prototype.generateMipmap=function(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.handle),this.gl.generateMipmap(this.gl.TEXTURE_2D)},e.exports=i},{"./Context":63,"./Texture":72,merge:1,"pex-sys":94}],74:[function(t,e){function i(){this.gl=o.currentContext,s.call(this,this.gl.TEXTURE_CUBE_MAP)}var n=t("pex-sys"),r=n.IO,o=(n.Platform,t("./Context")),s=t("./Texture"),a=t("merge");i.prototype=Object.create(s.prototype),i.load=function(t,e,n){var s={mipmap:!1,nearest:!1};e=a(s,e);var h=o.currentContext,l=new i,u=[h.TEXTURE_CUBE_MAP_POSITIVE_X,h.TEXTURE_CUBE_MAP_NEGATIVE_X,h.TEXTURE_CUBE_MAP_POSITIVE_Y,h.TEXTURE_CUBE_MAP_NEGATIVE_Y,h.TEXTURE_CUBE_MAP_POSITIVE_Z,h.TEXTURE_CUBE_MAP_NEGATIVE_Z],c=h.LINEAR,p=h.LINEAR;e.nearest&&(p=h.NEAREST,c=h.NEAREST),(e.mipmap||t.length>6)&&(c=h.LINEAR_MIPMAP_LINEAR),h.bindTexture(l.target,l.handle),h.texParameteri(l.target,h.TEXTURE_MAG_FILTER,p),h.texParameteri(l.target,h.TEXTURE_MIN_FILTER,c),h.texParameteri(l.target,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(l.target,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),l.ready=!1;for(var d=0,f=0;f<t.length;f++)r.loadImageData(h,l.handle,l.target,u[f%6],t[f],{flip:!1,lod:Math.floor(f/6)},function(i){l.width=i.width,l.height=i.height,++d==t.length&&(e.mipmap&&(h.bindTexture(l.target,l.handle),h.generateMipmap(l.target)),l.ready=!0,n&&n(l))});return l},i.prototype.dispose=function(){this.handle&&(this.gl.deleteTexture(this.handle),this.handle=null)},e.exports=i},{"./Context":63,"./Texture":72,merge:1,"pex-sys":94}],75:[function(t,e){var i=t("./Context");e.exports.getCurrentContext=function(){return i.currentContext},e.exports.clearColor=function(t){var e=i.currentContext;return t&&e.clearColor(t.r,t.g,t.b,t.a),e.clear(e.COLOR_BUFFER_BIT),this},e.exports.clearDepth=function(){var t=i.currentContext;return t.clear(t.DEPTH_BUFFER_BIT),this},e.exports.clearColorAndDepth=function(t){var e=i.currentContext;return t=t||{r:0,g:0,b:0,a:1},e.clearColor(t.r,t.g,t.b,t.a),e.depthMask(1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),this},e.exports.enableDepthReadAndWrite=function(t,e){2==arguments.length||(1==arguments.length?e=t:(t=!0,e=!0));var n=i.currentContext;return n.depthMask(e?1:0),t?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this},e.exports.enableAdditiveBlending=function(){return this.enableBlending("ONE","ONE")},e.exports.enableAlphaBlending=function(){return this.enableBlending("SRC_ALPHA","ONE_MINUS_SRC_ALPHA")},e.exports.enableBlending=function(t,e){var n=i.currentContext;return t===!1?(n.disable(n.BLEND),this):(n.enable(n.BLEND),n.blendFunc(n[t],n[e]),this)},e.exports.viewport=function(t,e,n,r){var o=i.currentContext;return o.viewport(t,e,n,r),this},e.exports.scissor=function(t,e,n,r){var o=i.currentContext;if(t===!1)o.disable(o.SCISSOR_TEST);else if(null!=t.width){var s=t;o.enable(o.SCISSOR_TEST),o.scissor(s.x,s.y,s.width,s.height)}else o.enable(o.SCISSOR_TEST),o.scissor(t,e,n,r);return this},e.exports.cullFace=function(t){t=void 0!==t?t:!0;var e=i.currentContext;return t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),e.cullFace(e.BACK),this},e.exports.lineWidth=function(t){var e=i.currentContext;return e.lineWidth(t),this}},{"./Context":63}],76:[function(t,e){e.exports.SolidColor=t("./lib/SolidColor"),e.exports.ShowNormals=t("./lib/ShowNormals"),e.exports.ShowColors=t("./lib/ShowColors"),e.exports.ShowPosition=t("./lib/ShowPosition"),e.exports.ShowTexCoords=t("./lib/ShowTexCoords"),e.exports.Textured=t("./lib/Textured"),e.exports.TexturedTriPlanar=t("./lib/TexturedTriPlanar"),e.exports.TexturedCubeMap=t("./lib/TexturedCubeMap"),e.exports.TexturedEnvMap=t("./lib/TexturedEnvMap"),e.exports.SkyBox=t("./lib/SkyBox"),e.exports.SkyBoxEnvMap=t("./lib/SkyBoxEnvMap"),e.exports.FlatToonShading=t("./lib/FlatToonShading"),e.exports.MatCap=t("./lib/MatCap"),e.exports.Diffuse=t("./lib/Diffuse"),e.exports.BlinnPhong=t("./lib/BlinnPhong"),e.exports.ShowDepth=t("./lib/ShowDepth")},{"./lib/BlinnPhong":77,"./lib/Diffuse":78,"./lib/FlatToonShading":79,"./lib/MatCap":80,"./lib/ShowColors":81,"./lib/ShowDepth":82,"./lib/ShowNormals":83,"./lib/ShowPosition":84,"./lib/ShowTexCoords":85,"./lib/SkyBox":86,"./lib/SkyBoxEnvMap":87,"./lib/SolidColor":88,"./lib/Textured":89,"./lib/TexturedCubeMap":90,"./lib/TexturedEnvMap":91,"./lib/TexturedTriPlanar":92}],77:[function(t,e){(function(){function i(t){this.gl=s.currentContext;var e=new h(p),i={wrap:0,pointSize:1,lightPos:u.create(10,20,30),ambientColor:l.create(0,0,0,1),diffuseColor:l.create(.9,.9,.9,1),specularColor:l.create(1,1,1,1),shininess:256,useBlinnPhong:!0};t=c(i,t),a.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=t("pex-geom"),s=n.Context,a=n.Material,h=n.Program,l=r.Color,u=o.Vec3,c=t("merge"),p="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 modelWorldMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 normalMatrix;\nuniform float pointSize;\nuniform vec3 lightPos;\nuniform vec3 cameraPos;\nattribute vec3 position;\nattribute vec3 normal;\nvarying vec3 vNormal;\nvarying vec3 vLightPos;\nvarying vec3 vEyePos;\n\nvoid main() {\n  vec4 worldPos = modelWorldMatrix * vec4(position, 1.0);\n  vec4 eyePos = modelViewMatrix * vec4(position, 1.0);\n  gl_Position = projectionMatrix * eyePos;\n  vEyePos = eyePos.xyz;\n  gl_PointSize = pointSize;\n  vNormal = (normalMatrix * vec4(normal, 0.0)).xyz;\n  vLightPos = (viewMatrix * vec4(lightPos, 1.0)).xyz;\n}\n\n#endif\n\n#ifdef FRAG\n\nuniform vec4 ambientColor;\nuniform vec4 diffuseColor;\nuniform vec4 specularColor;\nuniform float shininess;\nuniform float wrap;\nuniform bool useBlinnPhong;\nvarying vec3 vNormal;\nvarying vec3 vLightPos;\nvarying vec3 vEyePos;\n\nfloat phong(vec3 L, vec3 E, vec3 N) {\n  vec3 R = reflect(-L, N);\n  return max(0.0, dot(R, E));\n}\n\nfloat blinnPhong(vec3 L, vec3 E, vec3 N) {\n  vec3 halfVec = normalize(L + E);\n  return max(0.0, dot(halfVec, N));\n}\n\nvoid main() {\n  vec3 L = normalize(vLightPos - vEyePos); //lightDir\n  vec3 E = normalize(-vEyePos); //viewDir\n  vec3 N = normalize(vNormal); //normal\n\n  float NdotL = max(0.0, (dot(N, L) + wrap) / (1.0 + wrap));\n  vec4 color = ambientColor + NdotL * diffuseColor;\n\n  float specular = 0.0;\n  if (useBlinnPhong)\n    specular = blinnPhong(L, E, N);\n  else\n    specular = phong(L, E, N);\n\n  color += max(pow(specular, shininess), 0.0) * specularColor;\n\n  gl_FragColor = color;\n}\n\n#endif\n";i.prototype=Object.create(a.prototype),e.exports=i}).call(this,"/../../../pex-materials/lib")},{merge:93,"pex-color":2,"pex-geom":40,"pex-glu":60}],78:[function(t,e){(function(){function i(t){this.gl=s.currentContext;var e=new h(p),i={wrap:0,pointSize:1,lightPos:u.create(10,20,30),ambientColor:l.create(0,0,0,1),diffuseColor:l.create(1,1,1,1)};t=c(i,t),a.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=t("pex-geom"),s=n.Context,a=n.Material,h=n.Program,l=r.Color,u=o.Vec3,c=t("merge"),p="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 normalMatrix;\nuniform mat4 viewMatrix;\nuniform float pointSize;\nuniform vec3 lightPos;\nattribute vec3 position;\nattribute vec3 normal;\nvarying vec3 vNormal;\nvarying vec3 vLightPos;\nvarying vec3 vPosition;\n\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  gl_PointSize = pointSize;\n  vNormal = (normalMatrix * vec4(normal, 1.0)).xyz;\n  vLightPos = (viewMatrix * vec4(lightPos, 1.0)).xyz;\n  vPosition = (modelViewMatrix * vec4(position, 1.0)).xyz;\n}\n\n#endif\n\n#ifdef FRAG\n\nuniform vec4 ambientColor;\nuniform vec4 diffuseColor;\nuniform float wrap;\nvarying vec3 vNormal;\nvarying vec3 vLightPos;\nvarying vec3 vPosition;\n\nvoid main() {\n  vec3 L = normalize(vLightPos - vPosition);\n  vec3 N = normalize(vNormal);\n  float NdotL = max(0.0, (dot(N, L) + wrap) / (1.0 + wrap));\n  gl_FragColor = ambientColor + NdotL * diffuseColor;\n}\n\n#endif\n";
i.prototype=Object.create(a.prototype),e.exports=i}).call(this,"/../../../pex-materials/lib")},{merge:93,"pex-color":2,"pex-geom":40,"pex-glu":60}],79:[function(t,e){(function(){function i(t){this.gl=s.currentContext.gl;var e=new h(c),i={wrap:1,pointSize:1,lightPos:l.create(10,20,30)},t=u(i,t);a.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=t("pex-geom"),s=n.Context,a=n.Material,h=n.Program,l=(r.Color,o.Vec3),u=t("merge"),c="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform float pointSize;\nattribute vec3 position;\nattribute vec3 normal;\nvarying vec3 vNormal;\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  gl_PointSize = pointSize;\n  vNormal = normal;\n}\n\n#endif\n\n#ifdef FRAG\n\nuniform vec3 lightPos;\nuniform sampler2D colorBands;\nuniform float wrap;\nvarying vec3 vNormal;\n\nvoid main() {\n  vec3 L = normalize(lightPos);\n  vec3 N = normalize(vNormal);\n  float NdotL = max(0.0, (dot(N, L) + wrap) / (1.0 + wrap));\n  gl_FragColor.rgb = N*0.5 + vec3(0.5);\n  gl_FragColor.rgb = vec3(NdotL);\n  gl_FragColor.a = 1.0;\n\n  gl_FragColor = texture2D(colorBands, vec2(NdotL, 0.5));\n}\n\n#endif\n";i.prototype=Object.create(a.prototype),e.exports=i}).call(this,"/../../../pex-materials/lib")},{merge:93,"pex-color":2,"pex-geom":40,"pex-glu":60}],80:[function(t,e){(function(){function i(t){this.gl=o.currentContext;var e=new a(l),i={};t=h(i,t),s.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=n.Context,s=n.Material,a=n.Program,h=(r.Color,t("merge")),l="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 normalMatrix;\nuniform float pointSize;\nattribute vec3 position;\nattribute vec3 normal;\n\nvarying vec3 e;\nvarying vec3 n;\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\n  e = normalize(vec3(modelViewMatrix * vec4(position, 1.0)));\n  n = normalize(vec3(normalMatrix * vec4(normal, 1.0)));\n}\n\n#endif\n\n#ifdef FRAG\n\nuniform sampler2D texture;\n\nvarying vec3 e;\nvarying vec3 n;\n\nvoid main() {\n  vec3 r = reflect(e, n);\n  float m = 2.0 * sqrt(\n    pow(r.x, 2.0) +\n    pow(r.y, 2.0) +\n    pow(r.z + 1.0, 2.0)\n  );\n  vec2 N = r.xy / m + 0.5;\n  vec3 base = texture2D( texture, N ).rgb;\n  gl_FragColor = vec4( base, 1.0 );\n}\n\n#endif\n";i.prototype=Object.create(s.prototype),e.exports=i}).call(this,"/../../../pex-materials/lib")},{merge:93,"pex-color":2,"pex-glu":60}],81:[function(t,e){(function(){function i(t){this.gl=o.currentContext;var e=new a(l),i={pointSize:1};t=h(i,t),s.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=n.Context,s=n.Material,a=n.Program,h=(r.Color,t("merge")),l="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform float pointSize;\nattribute vec3 position;\nattribute vec4 color;\nvarying vec4 vColor;\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  gl_PointSize = pointSize;\n  vColor = color;\n}\n\n#endif\n\n#ifdef FRAG\n\nvarying vec4 vColor;\n\nvoid main() {\n  gl_FragColor = vColor;\n}\n\n#endif\n";i.prototype=Object.create(s.prototype),e.exports=i}).call(this,"/../../../pex-materials/lib")},{merge:93,"pex-color":2,"pex-glu":60}],82:[function(t,e){(function(){function i(t){this.gl=s.currentContext;var e=new h(u),i={near:0,far:10};t=l(i,t),a.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=t("pex-geom"),s=n.Context,a=n.Material,h=n.Program,l=(r.Color,o.Vec3,t("merge")),u="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\n\nattribute vec3 position;\n\n//position in eye space coordinates (camera space, view space)\nvarying vec3 ecPosition;\n\nvoid main() {\n  vec4 ecPos = modelViewMatrix * vec4(position, 1.0);\n  gl_Position = projectionMatrix * ecPos;\n\n  ecPosition = ecPos.xyz;\n}\n\n#endif\n\n#ifdef FRAG\n\nvarying vec3 ecPosition;\nuniform float near;\nuniform float far;\n\n//Z in Normalized Device Coordinates\n//http://www.songho.ca/opengl/gl_projectionmatrix.html\nfloat eyeSpaceDepthToNDC(float zEye) {\n  float A = -(far + near) / (far - near); //projectionMatrix[2].z\n  float B = -2.0 * far * near / (far - near); //projectionMatrix[3].z; //\n\n  float zNDC = (A * zEye + B) / -zEye;\n  return zNDC;\n}\n\n//depth buffer encoding\n//http://stackoverflow.com/questions/6652253/getting-the-true-z-value-from-the-depth-buffer\nfloat ndcDepthToDepthBuf(float zNDC) {\n  return 0.5 * zNDC + 0.5;\n}\n\nvoid main() {\n  float zEye = ecPosition.z;\n  float zNDC = eyeSpaceDepthToNDC(zEye);\n  float zBuf = ndcDepthToDepthBuf(zNDC);\n\n  gl_FragColor = vec4(zBuf);\n}\n\n#endif\n";i.prototype=Object.create(a.prototype),e.exports=i}).call(this,"/../../../pex-materials/lib")},{merge:93,"pex-color":2,"pex-geom":40,"pex-glu":60}],83:[function(t,e){(function(){function i(t){this.gl=o.currentContext;var e=new a(l),i={pointSize:1};t=h(i,t),s.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=n.Context,s=n.Material,a=n.Program,h=(r.Color,t("merge")),l="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 normalMatrix;\nuniform float pointSize;\nattribute vec3 position;\nattribute vec3 normal;\nvarying vec4 vColor;\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  gl_PointSize = pointSize;\n  vec3 N = normalize((normalMatrix * vec4(normal, 1.0)).xyz);\n  vColor = vec4(N * 0.5 + 0.5, 1.0);\n}\n\n#endif\n\n#ifdef FRAG\n\nvarying vec4 vColor;\n\nvoid main() {\n  gl_FragColor = vColor;\n}\n\n#endif\n";i.prototype=Object.create(s.prototype),e.exports=i}).call(this,"/../../../pex-materials/lib")},{merge:93,"pex-color":2,"pex-glu":60}],84:[function(t,e){(function(){function i(t){this.gl=s.currentContext;var e=new h(u),i={};t=l(i,t),a.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=t("pex-geom"),s=n.Context,a=n.Material,h=n.Program,l=(r.Color,o.Vec3,t("merge")),u="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nattribute vec3 position;\nvarying vec4 vColor;\nvoid main() {\n  vec4 pos = modelViewMatrix * vec4(position, 1.0);\n  gl_Position = projectionMatrix * pos;\n  vColor = pos;\n}\n\n#endif\n\n#ifdef FRAG\n\nvarying vec4 vColor;\n\nvoid main() {\n  gl_FragColor = vColor;\n}\n\n#endif\n";i.prototype=Object.create(a.prototype),e.exports=i}).call(this,"/../../../pex-materials/lib")},{merge:93,"pex-color":2,"pex-geom":40,"pex-glu":60}],85:[function(t,e){(function(){function i(t){this.gl=s.currentContext;var e=new h(u),i={};t=l(i,t),a.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=t("pex-geom"),s=n.Context,a=n.Material,h=n.Program,l=(r.Color,o.Vec3,t("merge")),u="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform float pointSize;\nattribute vec3 position;\nattribute vec2 texCoord;\nvarying vec4 vColor;\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  gl_PointSize = pointSize;\n  vColor = vec4(texCoord, 0.0, 1.0);\n}\n\n#endif\n\n#ifdef FRAG\n\nvarying vec4 vColor;\n\nvoid main() {\n  gl_FragColor = vColor;\n}\n\n#endif";i.prototype=Object.create(a.prototype),e.exports=i}).call(this,"/../../../pex-materials/lib")},{merge:93,"pex-color":2,"pex-geom":40,"pex-glu":60}],86:[function(t,e){(function(){function i(t){this.gl=o.currentContext;var e=new a(l),i={};t=h(i,t),s.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=n.Context,s=n.Material,a=n.Program,h=(r.Color,t("merge")),l="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nattribute vec3 position;\nattribute vec3 normal;\nvarying vec3 vNormal;\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  vNormal = position * vec3(1.0, 1.0, 1.0);\n}\n\n#endif\n\n#ifdef FRAG\n\nuniform samplerCube texture;\nvarying vec3 vNormal;\n\nvoid main() {\n  vec3 N = normalize(vNormal);\n  gl_FragColor = textureCube(texture, N);\n}\n\n#endif\n";i.prototype=Object.create(s.prototype),e.exports=i}).call(this,"/../../../pex-materials/lib")},{merge:93,"pex-color":2,"pex-glu":60}],87:[function(t,e){(function(){function i(t){this.gl=o.currentContext;var e=new a(l),i={};t=h(i,t),s.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=n.Context,s=n.Material,a=n.Program,h=(r.Color,t("merge")),l="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nattribute vec3 position;\nattribute vec3 normal;\nvarying vec3 vNormal;\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  vNormal = position;\n}\n\n#endif\n\n#ifdef FRAG\n\nuniform sampler2D texture;\nvarying vec3 vNormal;\n\nvoid main() {\n  vec3 N = normalize(vNormal);\n  vec2 texCoord = vec2((1.0 + atan(-N.z, N.x)/3.14159265359)/2.0, acos(-N.y)/3.14159265359);\n\n  gl_FragColor = texture2D(texture, texCoord);\n}\n\n#endif\n";i.prototype=Object.create(s.prototype),e.exports=i}).call(this,"/../../../pex-materials/lib")},{merge:93,"pex-color":2,"pex-glu":60}],88:[function(t,e){(function(){function i(t){this.gl=o.currentContext;var e=new a(u),i={color:h.create(1,1,1,1),pointSize:1,premultiplied:0};t=l(i,t),s.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=n.Context,s=n.Material,a=n.Program,h=r.Color,l=t("merge"),u="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform float pointSize;\nattribute vec3 position;\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  gl_PointSize = pointSize;\n}\n\n#endif\n\n#ifdef FRAG\n\nuniform vec4 color;\nuniform bool premultiplied;\n\nvoid main() {\n  gl_FragColor = color;\n  if (premultiplied) {\n    gl_FragColor.rgb *= color.a;\n  }\n}\n\n#endif\n";i.prototype=Object.create(s.prototype),e.exports=i}).call(this,"/../../../pex-materials/lib")},{merge:93,"pex-color":2,"pex-glu":60}],89:[function(t,e){(function(){function i(t){this.gl=s.currentContext;var e=new h(p),i={scale:new u(1,1),color:new l(1,1,1,1)};t=c(i,t),a.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=t("pex-geom"),s=n.Context,a=n.Material,h=n.Program,l=r.Color,u=o.Vec2,c=t("merge"),p="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nattribute vec3 position;\nattribute vec2 texCoord;\nvarying vec2 vTexCoord;\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  vTexCoord = texCoord;\n}\n\n#endif\n\n#ifdef FRAG\n\nuniform sampler2D texture;\nuniform vec2 scale;\nuniform vec4 color;\nvarying vec2 vTexCoord;\n\nvoid main() {\n  gl_FragColor = texture2D(texture, vTexCoord * scale) * color;\n}\n\n#endif\n";i.prototype=Object.create(a.prototype),e.exports=i}).call(this,"/../../../pex-materials/lib")},{merge:93,"pex-color":2,"pex-geom":40,"pex-glu":60}],90:[function(t,e){(function(){function i(t){this.gl=s.currentContext,u.isBrowser&&(this.lodExt=this.gl.getExtension("EXT_shader_texture_lod"),this.lodExt&&(c="#define LOD_ENABLED 1\n"+c,c="#define WEBGL 1\n"+c,c="#define textureCubeLod textureCubeLodEXT\n"+c));var e=new h(c),i={lod:-1};t=l(i,t),a.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=t("pex-sys"),s=n.Context,a=n.Material,h=n.Program,l=(r.Color,t("merge")),u=o.Platform,c="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 normalMatrix;\n\nattribute vec3 position;\nattribute vec3 normal;\n\nvarying vec3 ecNormal;\nvarying vec3 ecPos;\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  ecPos = (modelViewMatrix * vec4(position, 1.0)).xyz;\n  ecNormal = (normalMatrix * vec4(normal, 1.0)).xyz;\n}\n\n#endif\n\n#ifdef FRAG\n\n#ifdef LOD_ENABLED\n#ifdef WEBGL\n  #extension GL_EXT_shader_texture_lod : require\n#else\n  #extension GL_ARB_shader_texture_lod : require\n#endif\n#endif\n\nuniform mat4 invViewMatrix;\n\nuniform samplerCube texture;\nuniform float lod;\nvarying vec3 ecNormal;\nvarying vec3 ecPos;\n\nvoid main() {\n  vec3 eyeDir = normalize(ecPos); //Direction to eye = camPos (0,0,0) - ecPos\n  vec3 ecN = normalize(ecNormal);\n  vec3 ecReflected = reflect(eyeDir, ecN); //eye coordinates reflection vector\n  vec3 wcReflected = vec3(invViewMatrix * vec4(ecReflected, 0.0)); //world coordinates reflection vector\n\n  #ifdef LOD_ENABLED\n  gl_FragColor = textureCubeLod(texture, wcReflected, lod);\n  #else\n  gl_FragColor = textureCube(texture, wcReflected);\n  #endif\n}\n\n#endif\n";i.prototype=Object.create(a.prototype),e.exports=i}).call(this,"/../../../pex-materials/lib")},{merge:93,"pex-color":2,"pex-glu":60,"pex-sys":94}],91:[function(t,e){(function(){function i(t){this.gl=o.currentContext;var e=new a(l),i={};t=h(i,t),s.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=n.Context,s=n.Material,a=n.Program,h=(r.Color,t("merge")),l="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 normalMatrix;\nattribute vec3 position;\nattribute vec3 normal;\nvarying vec3 vNormal;\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  vNormal = (normalMatrix * vec4(normal, 1.0)).xyz;\n}\n\n#endif\n\n#ifdef FRAG\n\nuniform sampler2D texture;\nvarying vec3 vNormal;\n\nvoid main() {\n  vec3 N = normalize(vNormal);\n  vec2 texCoord = vec2((1.0 + atan(-N.z, N.x)/3.14159265359)/2.0, acos(-N.y)/3.14159265359);\n  gl_FragColor = texture2D(texture, texCoord);\n}\n\n#endif\n";i.prototype=Object.create(s.prototype),e.exports=i}).call(this,"/../../../pex-materials/lib")},{merge:93,"pex-color":2,"pex-glu":60}],92:[function(t,e){(function(){function i(t){this.gl=s.currentContext;var e=new h(u),i={scale:1};t=l(i,t),a.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=t("pex-geom"),s=n.Context,a=n.Material,h=n.Program,l=(r.Color,o.Vec3,t("merge")),u="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 modelWorldMatrix;\nattribute vec3 position;\nattribute vec3 normal;\nvarying vec3 wcNormal;\nvarying vec3 wcCoords;\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  wcNormal = normal; //this is not correct, shoud go from model -> world\n  wcCoords = (modelWorldMatrix * vec4(position, 1.0)).xyz;\n}\n\n#endif\n\n#ifdef FRAG\n\nuniform sampler2D texture;\nuniform float scale;\nvarying vec3 wcNormal;\nvarying vec3 wcCoords;\n\nvoid main() {\n  vec3 blending = abs( normalize(wcNormal) );\n  blending = normalize(max(blending, 0.00001)); // Force weights to sum to 1.0\n  float b = (blending.x + blending.y + blending.z);\n  blending /= vec3(b, b, b);\n\n  vec4 xaxis = texture2D( texture, wcCoords.zy * scale);\n  vec4 yaxis = texture2D( texture, wcCoords.xz * scale);\n  vec4 zaxis = texture2D( texture, wcCoords.xy * scale);\n  // blend the results of the 3 planar projections.\n  vec4 tex = xaxis * blending.x + yaxis * blending.y + zaxis * blending.z;\n\n  gl_FragColor = tex;\n}\n\n#endif\n";i.prototype=Object.create(a.prototype),e.exports=i}).call(this,"/../../../pex-materials/lib")},{merge:93,"pex-color":2,"pex-geom":40,"pex-glu":60}],93:[function(t,e){e.exports=t(39)},{}],94:[function(t,e){e.exports.Platform=t("./lib/Platform"),e.exports.Window=t("./lib/Window"),e.exports.Time=t("./lib/Time"),e.exports.IO=t("./lib/IO"),e.exports.Log=t("./lib/Log")},{"./lib/IO":96,"./lib/Log":97,"./lib/Platform":98,"./lib/Time":99,"./lib/Window":100}],95:[function(t,e){function i(t,e){for(var i=0;i<x.length;i++)x[i].eventType==t&&x[i].handler(e)}function n(t){r(t),o(t),s(t),a(t),h(t),l(t),u(t),c(t),p(t)}function r(t){t.addEventListener("mousedown",function(t){i("leftMouseDown",{x:(t.offsetX||t.layerX||t.clientX-t.target.offsetLeft)*window.devicePixelRatio,y:(t.offsetY||t.layerY||t.clientY-t.target.offsetTop)*window.devicePixelRatio,option:t.altKey,shift:t.shiftKey,control:t.ctrlKey})})}function o(t){t.addEventListener("mouseup",function(t){i("leftMouseUp",{x:(t.offsetX||t.layerX||t.clientX-t.target.offsetLeft)*window.devicePixelRatio,y:(t.offsetY||t.layerY||t.clientY-t.target.offsetTop)*window.devicePixelRatio,option:t.altKey,shift:t.shiftKey,control:t.ctrlKey})})}function s(t){var e=!1,n=0,r=0;t.addEventListener("mousedown",function(t){e=!0,n=(t.offsetX||t.layerX||t.clientX-t.target.offsetLeft)*window.devicePixelRatio,r=(t.offsetY||t.layerY||t.clientY-t.target.offsetTop)*window.devicePixelRatio}),t.addEventListener("mouseup",function(){e=!1}),t.addEventListener("mousemove",function(t){if(e){var o=(t.offsetX||t.layerX||t.clientX-t.target.offsetLeft)*window.devicePixelRatio,s=(t.offsetY||t.layerY||t.clientY-t.target.offsetTop)*window.devicePixelRatio;i("mouseDragged",{x:o,y:s,dx:o-n,dy:s-r,option:t.altKey,shift:t.shiftKey,control:t.ctrlKey}),n=o,r=s}})}function a(t){t.addEventListener("mousemove",function(t){i("mouseMoved",{x:(t.offsetX||t.layerX||t.clientX-t.target.offsetLeft)*window.devicePixelRatio,y:(t.offsetY||t.layerY||t.clientY-t.target.offsetTop)*window.devicePixelRatio,option:t.altKey,shift:t.shiftKey,control:t.ctrlKey})})}function h(){var t=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";document.addEventListener(t,function(t){i("scrollWheel",{x:(t.offsetX||t.layerX)*window.devicePixelRatio,y:(t.offsetY||t.layerY)*window.devicePixelRatio,dy:t.wheelDelta/10||-t.detail/10,option:t.altKey,shift:t.shiftKey,control:t.ctrlKey})})}function l(t){t.addEventListener("touchstart",function(t){v={clientX:t.touches[0].clientX*window.devicePixelRatio,clientY:t.touches[0].clientY*window.devicePixelRatio};var e=t.touches.map(function(t){return t.x=t.clientX*window.devicePixelRatio,t.y=t.clientY*window.devicePixelRatio,t});i("leftMouseDown",{x:t.touches[0].clientX*window.devicePixelRatio,y:t.touches[0].clientY*window.devicePixelRatio,option:!1,shift:!1,control:!1,touches:e})})}function u(t){t.addEventListener("touchend",function(t){var e=t.touches.map(function(t){return t.x=t.clientX*window.devicePixelRatio,t.y=t.clientY*window.devicePixelRatio,t});i("leftMouseUp",{x:v?v.clientX:0,y:v?v.clientY:0,option:!1,shift:!1,control:!1,touches:e}),v=null})}function c(t){t.addEventListener("touchmove",function(t){v={clientX:t.touches[0].clientX*window.devicePixelRatio,clientY:t.touches[0].clientY*window.devicePixelRatio};var e=t.touches.map(function(t){return t.x=t.clientX*window.devicePixelRatio,t.y=t.clientY*window.devicePixelRatio,t});i("mouseDragged",{x:t.touches[0].clientX*window.devicePixelRatio,y:t.touches[0].clientY*window.devicePixelRatio,option:!1,shift:!1,control:!1,touches:e})})}function p(){var t=0;window.addEventListener("keydown",function(e){t=setTimeout(function(){i("keyDown",{str:"",keyCode:e.keyCode,option:e.altKey,shift:e.shiftKey,control:e.ctrlKey},1)})}),window.addEventListener("keypress",function(e){t&&(clearTimeout(t),t=0),i("keyDown",{str:String.fromCharCode(e.charCode),keyCode:e.keyCode,option:e.altKey,shift:e.shiftKey,control:e.ctrlKey})})}function d(t){function e(){function e(){t.__disposed||(t.draw(),requestAnimFrame(e))}void 0===t.stencil&&(t.stencil=!1),t.settings.fullscreen&&(document.body.style.margin="0",document.body.style.padding="0",document.body.style.overflow="hidden");var r=null,o=null;if("3d"==t.settings.type){try{r=i.getContext("experimental-webgl",{antialias:!0,stencil:t.settings.stencil,premultipliedAlpha:t.settings.premultipliedAlpha,preserveDrawingBuffer:t.settings.preserveDrawingBuffer})}catch(s){return void g.error(s.message)}if(null===r)throw"No WebGL context is available."}else"2d"==t.settings.type&&(o=i.getContext("2d"));t.framerate=function(t){m=t},t.on=function(t,e){x.push({eventType:t,handler:e})},n(i),t.dispose=function(){t.__disposed=!0},t.gl=r,t.ctx=o,t.init(),requestAnimFrame(e)}var i=t.settings.canvas;return t.settings.fullscreen&&(t.settings.width=window.innerWidth,t.settings.height=window.innerHeight),i?t.settings.width&&t.settings.height?(i.width=t.settings.width,i.height=t.settings.height):(t.settings.width=i.width,t.settings.height=i.height):i=document.getElementById("canvas"),i||(i=document.createElement("canvas"),i.width=t.settings.width,i.height=t.settings.height),2==window.devicePixelRatio&&(i.width=2*t.settings.width,i.height=2*t.settings.height,i.style.width=t.settings.width+"px",i.style.height=t.settings.height+"px",i.msaaEnabled=!0,i.msaaSamples=2,t.settings.width*=2,t.settings.height*=2,t.settings.highdpi=2),t.width=t.settings.width,t.height=t.settings.height,t.canvas=i,i.style.backgroundColor="#000000",i.parentNode?e():document.body?(document.body.appendChild(i),e()):window.addEventListener("load",function(){document.body.appendChild(i),e()},!1),t}var f=t("./Platform"),g=t("./Log"),m=(t("merge"),60);f.isBrowser&&(window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/m)}}());var x=[],v=null,y={simpleWindow:d};e.exports=y},{"./Log":97,"./Platform":98,merge:1}],96:[function(t,e){(function(i){var n=t("./Platform"),r=t("./Log"),o=t("plask"),s=t("path"),a=t("merge"),h=function(){function t(){}return t.loadTextFile=function(e,i){var n=s.resolve(t.getWorkingDirectory(),e);if(!fs.existsSync(n)&&i)return i(null);var r=fs.readFileSync(n,"utf8");i&&i(r)},t.getWorkingDirectory=function(){return s.dirname(i.mainModule.filename)},t.loadImageData=function(e,i,n,r,h,l,u){var c={flip:!1,lod:0};l=a(c,l);var p=s.resolve(t.getWorkingDirectory(),h);e.activeTexture(e.TEXTURE0),e.bindTexture(n,i);var d=o.SkCanvas.createFromImage(p);l.flip?e.texImage2DSkCanvas(r,l.lod,d):e.texImage2DSkCanvasNoFlip(r,l.lod,d),u&&u(d)},t.watchTextFile=function(t,e){fs.watch(t,{},function(i){if("change"==i){var n=fs.readFileSync(t,"utf8");e&&e(n)}})},t.saveTextFile=function(t,e){fs.writeFileSync(t,e)},t},l=function(){function t(){}return t.getWorkingDirectory=function(){return"."},t.loadTextFile=function(t,e){var i=new XMLHttpRequest;i.open("GET",t,!0),i.onreadystatechange=function(){4==i.readyState&&(200==i.status?e&&e(i.responseText):r.error("WebIO.loadTextFile error : "+i.statusText))},i.send(null)},t.loadImageData=function(t,e,i,n,r,o,s){var h={flip:!1,lod:0};o=a(h,o);var l=new Image;o.crossOrigin&&(l.crossOrigin=o.crossOrigin),l.onload=function(){t.activeTexture(t.TEXTURE0),t.bindTexture(i,e),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,o.flip),t.texImage2D(n,o.lod,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,l),s&&s(l)},l.src=r},t.watchTextFile=function(){console.log("Warning: WebIO.watch is not implemented!")},t.saveTextFile=function(t,e,i){var n=new XMLHttpRequest;n.open("POST",t,!0),n.onreadystatechange=function(){4==n.readyState&&(200==n.status?i&&i(n.responseText,n):r.error("WebIO.saveTextFile error : "+n.statusText))},n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send("data="+encodeURIComponent(e))},t};n.isPlask?e.exports=h():n.isBrowser&&(e.exports=l())}).call(this,t("/Users/vorg/Workspace/vorg-pex/experiments/v3/node_modules/pex-examples/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))},{"./Log":97,"./Platform":98,"/Users/vorg/Workspace/vorg-pex/experiments/v3/node_modules/pex-examples/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":5,merge:1,path:6,plask:4}],97:[function(t,e){function i(){}i.message=function(){if(void 0!==console){var t=Array.prototype.slice.call(arguments);console.log(t.join(" "))}},i.error=function(){var t=Array.prototype.slice.call(arguments);void 0!==console&&console.log("ERROR: "+t.join(" "))},e.exports=i},{}],98:[function(t,e){(function(t){e.exports.isPlask="undefined"==typeof window&&"object"==typeof t,e.exports.isBrowser="object"==typeof window&&"object"==typeof document,e.exports.isEjecta="object"==typeof ejecta&&"function"==typeof ejecta.include}).call(this,t("/Users/vorg/Workspace/vorg-pex/experiments/v3/node_modules/pex-examples/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))},{"/Users/vorg/Workspace/vorg-pex/experiments/v3/node_modules/pex-examples/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":5}],99:[function(t,e){var i=t("./Log"),n={now:0,prev:0,delta:0,seconds:0,frameNumber:0,fpsFrames:0,fpsTime:0,fps:0,fpsFrequency:3,paused:!1,verbose:!1};n.update=function(t){return n.paused?void 0:(0===n.prev&&(n.prev=Date.now()),n.now=Date.now(),n.delta=void 0!==t?t:(n.now-n.prev)/1e3,n.delta>1&&(n.delta=0),n.prev=n.now,n.seconds+=n.delta,n.fpsTime+=n.delta,n.frameNumber++,n.fpsFrames++,n.fpsTime>n.fpsFrequency&&(n.fps=n.fpsFrames/n.fpsTime,n.fpsTime=0,n.fpsFrames=0,this.verbose&&i.message("FPS: "+n.fps)),n.seconds)};var r=0;n.startMeasuringTime=function(){r=Date.now()},n.stopMeasuringTime=function(t){var e=Date.now(),i=(e-r)/1e3;return t&&console.log(t+i),i},n.pause=function(){n.paused=!0},n.togglePause=function(){n.paused=!n.paused},e.exports=n},{"./Log":97}],100:[function(t,e){var i=t("./Platform"),n=t("./BrowserWindow"),r=t("./Time"),o=(t("./Log"),t("merge")),s=t("plask"),a={width:1280,height:720,type:"3d",vsync:!0,multisample:!0,fullscreen:!1,center:!0,hdpi:1,stencil:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1},h={currentWindow:null,create:function(t){t.settings=t.settings||{},t.settings=o(a,t.settings),t.__init=t.init,t.init=function(){h.currentWindow=this,t.framerate(60),t.__init&&t.__init()},t.__draw=t.draw,t.draw=function(){h.currentWindow=this,r.update(),t.__draw&&t.__draw()},i.isPlask?s.simpleWindow(t):(i.isBrowser||i.isEjecta)&&n.simpleWindow(t)}};e.exports=h},{"./BrowserWindow":95,"./Log":97,"./Platform":98,"./Time":99,merge:1,plask:4}]},{},[7]);