!function t(e,i,n){function s(r,a){if(!i[r]){if(!e[r]){var h="function"==typeof require&&require;if(!a&&h)return h(r,!0);if(o)return o(r,!0);throw new Error("Cannot find module '"+r+"'")}var u=i[r]={exports:{}};e[r][0].call(u.exports,function(t){var i=e[r][1][t];return s(i?i:t)},u,u.exports,t,e,i,n)}return i[r].exports}for(var o="function"==typeof require&&require,r=0;r<n.length;r++)s(n[r]);return s}({1:[function(t,e){!function(t){function i(t,e){if("object"!==s(t))return e;for(var n in e)t[n]="object"===s(t[n])&&"object"===s(e[n])?i(t[n],e[n]):e[n];return t}function n(t,e,n){var r=n[0],a=n.length;(t||"object"!==s(r))&&(r={});for(var h=0;a>h;++h){var u=n[h],c=s(u);if("object"===c)for(var l in u){var p=t?o.clone(u[l]):u[l];r[l]=e?i(r[l],p):p}}return r}function s(t){return{}.toString.call(t).slice(8,-1).toLowerCase()}var o=function(t){return n(t===!0,!1,arguments)},r="merge";o.recursive=function(t){return n(t===!0,!0,arguments)},o.clone=function(t){var e,i,n=t,r=s(t);if("array"===r)for(n=[],i=t.length,e=0;i>e;++e)n[e]=o.clone(t[e]);else if("object"===r){n={};for(e in t)n[e]=o.clone(t[e])}return n},t?e.exports=o:window[r]=o}("object"==typeof e&&e&&"object"==typeof e.exports&&e.exports)},{}],2:[function(t,e){e.exports.Color=t("./lib/Color")},{"./lib/Color":3}],3:[function(t,e){function i(t,e,i,n){this.r=null!=t?t:0,this.g=null!=e?e:0,this.b=null!=i?i:0,this.a=null!=n?n:1}var n=function(t,e,i){return t+(e-t)*i};i.create=function(t,e,n,s){return new i(t,e,n,s)},i.fromArray=function(t){return new i(t[0],t[1],t[2],t[3])},i.fromRGB=i.create,i.fromHSV=function(t,e,n,s){var o=new i;return o.setHSV(t,e,n,s),o},i.fromHSL=function(t,e,n,s){var o=new i;return o.setHSL(t,e,n,s),o},i.prototype.set=function(t,e,i,n){return this.r=t,this.g=e,this.b=i,this.a=null!=n?n:1,this},i.prototype.hash=function(){return 1*this.r+12*this.g+123*this.b+1234*this.a},i.prototype.setHSV=function(t,e,i,n){n=null!=n?n:1;var s=Math.floor(6*t),o=6*t-s,r=i*(1-e),a=i*(1-o*e),h=i*(1-(1-o)*e);switch(s%6){case 0:this.r=i,this.g=h,this.b=r;break;case 1:this.r=a,this.g=i,this.b=r;break;case 2:this.r=r,this.g=i,this.b=h;break;case 3:this.r=r,this.g=a,this.b=i;break;case 4:this.r=h,this.g=r,this.b=i;break;case 5:this.r=i,this.g=r,this.b=a}return this.a=n,this},i.prototype.getHSV=function(){var t,e=this.r,i=this.g,n=this.b,s=Math.max(e,i,n),o=Math.min(e,i,n),r=s,a=s-o,h=0==s?0:a/s;if(s==o)t=0;else{switch(s){case e:t=(i-n)/a+(n>i?6:0);break;case i:t=(n-e)/a+2;break;case n:t=(e-i)/a+4}t/=6}return{h:t,s:h,v:r,a:this.a}},i.prototype.setHSL=function(t,e,i,n){function s(t,e,i){return 0>i&&(i+=1),i>1&&(i-=1),1/6>i?t+6*(e-t)*i:.5>i?e:2/3>i?t+(e-t)*(2/3-i)*6:t}if(n=null!=n?n:1,0==e)this.r=this.g=this.b=i;else{var o=.5>i?i*(1+e):i+e-i*e,r=2*i-o;this.r=s(r,o,t+1/3),this.g=s(r,o,t),this.b=s(r,o,t-1/3),this.a=n}},i.prototype.getHSL=function(){var t,e,i=this.r,n=this.g,s=this.b,o=Math.max(i,n,s),r=Math.min(i,n,s),a=(o+r)/2;if(o==r)t=e=0;else{var h=o-r;switch(e=a>.5?h/(2-o-r):h/(o+r),o){case i:t=(n-s)/h+(s>n?6:0);break;case n:t=(s-i)/h+2;break;case s:t=(i-n)/h+4}t/=6}return{h:t,s:e,l:a,a:this.a}},i.prototype.copy=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},i.prototype.clone=function(){return new i(this.r,this.g,this.b,this.a)},i.lerp=function(t,e,s,o){if(o=o||"rgb","rgb"==o)return i.fromRGB(n(t.r,e.r,s),n(t.g,e.g,s),n(t.b,e.b,s),n(t.a,e.a,s));if("hsv"==o){var r=t.getHSV(),a=e.getHSV();return i.fromHSV(n(r.h,a.h,s),n(r.s,a.s,s),n(r.v,a.v,s),n(r.a,a.a,s))}if("hsl"==o){var h=t.getHSL(),u=e.getHSL();return i.fromHSL(n(h.h,u.h,s),n(h.s,u.s,s),n(h.l,u.l,s),n(h.a,u.a,s))}return t},i.Transparent=new i(0,0,0,0),i.None=new i(0,0,0,0),i.Black=new i(0,0,0,1),i.White=new i(1,1,1,1),i.DarkGrey=new i(.25,.25,.25,1),i.Grey=new i(.5,.5,.5,1),i.Red=new i(1,0,0,1),i.Green=new i(0,1,0,1),i.Blue=new i(0,0,1,1),i.Yellow=new i(1,1,0,1),i.Pink=new i(1,0,1,1),i.Cyan=new i(0,1,1,1),i.Orange=new i(1,.5,0,1),e.exports=i},{}],4:[function(){},{}],5:[function(t,e){function i(){}var n=e.exports={};n.nextTick=function(){var t="undefined"!=typeof window&&window.setImmediate,e="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(t)return function(t){return window.setImmediate(t)};if(e){var i=[];return window.addEventListener("message",function(t){var e=t.source;if((e===window||null===e)&&"process-tick"===t.data&&(t.stopPropagation(),i.length>0)){var n=i.shift();n()}},!0),function(t){i.push(t),window.postMessage("process-tick","*")}}return function(t){setTimeout(t,0)}}(),n.title="browser",n.browser=!0,n.env={},n.argv=[],n.on=i,n.once=i,n.off=i,n.emit=i,n.binding=function(){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(){throw new Error("process.chdir is not supported")}},{}],6:[function(t,e,i){(function(t){function e(t,e){for(var i=0,n=t.length-1;n>=0;n--){var s=t[n];"."===s?t.splice(n,1):".."===s?(t.splice(n,1),i++):i&&(t.splice(n,1),i--)}if(e)for(;i--;i)t.unshift("..");return t}function n(t,e){if(t.filter)return t.filter(e);for(var i=[],n=0;n<t.length;n++)e(t[n],n,t)&&i.push(t[n]);return i}var s=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,o=function(t){return s.exec(t).slice(1)};i.resolve=function(){for(var i="",s=!1,o=arguments.length-1;o>=-1&&!s;o--){var r=o>=0?arguments[o]:t.cwd();if("string"!=typeof r)throw new TypeError("Arguments to path.resolve must be strings");r&&(i=r+"/"+i,s="/"===r.charAt(0))}return i=e(n(i.split("/"),function(t){return!!t}),!s).join("/"),(s?"/":"")+i||"."},i.normalize=function(t){var s=i.isAbsolute(t),o="/"===r(t,-1);return t=e(n(t.split("/"),function(t){return!!t}),!s).join("/"),t||s||(t="."),t&&o&&(t+="/"),(s?"/":"")+t},i.isAbsolute=function(t){return"/"===t.charAt(0)},i.join=function(){var t=Array.prototype.slice.call(arguments,0);return i.normalize(n(t,function(t){if("string"!=typeof t)throw new TypeError("Arguments to path.join must be strings");return t}).join("/"))},i.relative=function(t,e){function n(t){for(var e=0;e<t.length&&""===t[e];e++);for(var i=t.length-1;i>=0&&""===t[i];i--);return e>i?[]:t.slice(e,i-e+1)}t=i.resolve(t).substr(1),e=i.resolve(e).substr(1);for(var s=n(t.split("/")),o=n(e.split("/")),r=Math.min(s.length,o.length),a=r,h=0;r>h;h++)if(s[h]!==o[h]){a=h;break}for(var u=[],h=a;h<s.length;h++)u.push("..");return u=u.concat(o.slice(a)),u.join("/")},i.sep="/",i.delimiter=":",i.dirname=function(t){var e=o(t),i=e[0],n=e[1];return i||n?(n&&(n=n.substr(0,n.length-1)),i+n):"."},i.basename=function(t,e){var i=o(t)[2];return e&&i.substr(-1*e.length)===e&&(i=i.substr(0,i.length-e.length)),i},i.extname=function(t){return o(t)[3]};var r="b"==="ab".substr(-1)?function(t,e,i){return t.substr(e,i)}:function(t,e,i){return 0>e&&(e=t.length+e),t.substr(e,i)}}).call(this,t("/Users/vorg/Workspace/vorg-pex/experiments/v3/node_modules/pex-examples/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))},{"/Users/vorg/Workspace/vorg-pex/experiments/v3/node_modules/pex-examples/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":5}],7:[function(t){var e=t("pex-sys"),i=t("pex-geom"),n=t("pex-color"),s=i.Path,o=i.Spline3D,r=i.Vec3,a=n.Color;e.Window.create({settings:{type:"2d3d",fullscreen:e.Platform.isBrowser},mousePos:new r(0,0,0),init:function(){i.randomSeed(1);var t=10;this.points=[];for(var e=0;t>e;e++)this.points.push(new r(i.randomFloat(.1*this.width,.9*this.width),i.randomFloat(.2*this.height,.8*this.height),0));this.points.sort(function(t,e){return t.x-e.x}),this.path=new s(this.points),this.spline=new o(this.points),this.splinePoints=[];for(var e=0;100>e;e++)this.splinePoints.push(this.spline.getPointAt(e/100));this.on("mouseMoved",this.mouseMoved.bind(this))},mouseMoved:function(t){this.mousePos.x=t.x,this.mousePos.y=t.y},drawPoints:function(t,e){var i=this.canvas,n=this.paint;n.setStroke(),n.setColor(255*e.r,255*e.g,255*e.b,255),n.setAntiAlias(!0);var s=null;t.forEach(function(t){s&&i.drawLine(n,s.x,s.y,t.x,t.y),i.drawRect(n,t.x-3,t.y-3,t.x+3,t.y+3),s=t})},draw:function(){var t=this.canvas,e=this.paint;t.drawColor(255,255,255,255),this.drawPoints(this.points,a.Red),this.drawPoints(this.splinePoints,a.Green),e.setColor(255,0,255,255),t.drawRect(e,this.mousePos.x-10,this.mousePos.y-10,this.mousePos.x+10,this.mousePos.y+10);var i=this.path.getClosestPoint(this.mousePos);e.setColor(150,0,0,255),t.drawRect(e,i.x-10,i.y-10,i.x+10,i.y+10),t.drawLine(e,i.x,i.y,this.mousePos.x,this.mousePos.y);var n=this.spline.getClosestPoint(this.mousePos);e.setColor(0,150,0,255),t.drawRect(e,n.x-8,n.y-8,n.x+8,n.y+8),t.drawLine(e,n.x,n.y,this.mousePos.x,this.mousePos.y)}})},{"pex-color":2,"pex-geom":8,"pex-sys":28}],8:[function(t,e){e.exports.Vec2=t("./lib/Vec2"),e.exports.Vec3=t("./lib/Vec3"),e.exports.Vec4=t("./lib/Vec4"),e.exports.Mat4=t("./lib/Mat4"),e.exports.Quat=t("./lib/Quat"),e.exports.Path=t("./lib/Path"),e.exports.Rect=t("./lib/Rect"),e.exports.Spline3D=t("./lib/Spline3D"),e.exports.Spline2D=t("./lib/Spline2D"),e.exports.Spline1D=t("./lib/Spline1D"),e.exports.Ray=t("./lib/Ray"),e.exports.Plane=t("./lib/Plane"),e.exports.Geometry=t("./lib/Geometry"),e.exports.Random=t("./lib/Random"),e.exports.BoundingBox=t("./lib/BoundingBox"),e.exports.Triangle2D=t("./lib/Triangle2D"),e.exports.Triangle3D=t("./lib/Triangle3D"),e.exports.Octree=t("./lib/Octree");for(var i in e.exports.Random)e.exports[i]=e.exports.Random[i]},{"./lib/BoundingBox":9,"./lib/Geometry":10,"./lib/Mat4":11,"./lib/Octree":12,"./lib/Path":13,"./lib/Plane":14,"./lib/Quat":15,"./lib/Random":16,"./lib/Ray":17,"./lib/Rect":18,"./lib/Spline1D":19,"./lib/Spline2D":20,"./lib/Spline3D":21,"./lib/Triangle2D":22,"./lib/Triangle3D":23,"./lib/Vec2":24,"./lib/Vec3":25,"./lib/Vec4":26}],9:[function(t,e){function i(t,e){this.min=t,this.max=e}var n=t("./Vec3");i.fromPositionSize=function(t,e){return new i(n.create(t.x-e.x/2,t.y-e.y/2,t.z-e.z/2),n.create(t.x+e.x/2,t.y+e.y/2,t.z+e.z/2))},i.fromPoints=function(t){var e=new i(t[0].clone(),t[0].clone());return t.forEach(e.addPoint.bind(e)),e},i.prototype.isEmpty=function(){return this.min&&this.max?!1:!0},i.prototype.addPoint=function(t){this.isEmpty()&&(this.min=t.clone(),this.max=t.clone()),t.x<this.min.x&&(this.min.x=t.x),t.y<this.min.y&&(this.min.y=t.y),t.z<this.min.z&&(this.min.z=t.z),t.x>this.max.x&&(this.max.x=t.x),t.y>this.max.y&&(this.max.y=t.y),t.z>this.max.z&&(this.max.z=t.z)},i.prototype.getSize=function(){return n.create(this.max.x-this.min.x,this.max.y-this.min.y,this.max.z-this.min.z)},i.prototype.getCenter=function(){return n.create(this.min.x+(this.max.x-this.min.x)/2,this.min.y+(this.max.y-this.min.y)/2,this.min.z+(this.max.z-this.min.z)/2)},e.exports=i},{"./Vec3":25}],10:[function(t,e){function i(t){var e=(t.length,t.reduce(function(t,e){return t.add(e)},new c(0,0,0)));return e.scale(1/t.length),e}function n(t,e){var i=t,n=0;do e(i,n++),i=o(i);while(i!=t)}function s(t,e){var i=t;do e(i),i=r(i).opposite;while(i!=t)}function o(t){return t.face.halfEdges[(t.slot+1)%t.face.length]}function r(t){return t.face.halfEdges[(t.slot-1+t.face.length)%t.face.length]}function a(t,e){return e.map(function(e){return t[e]})}function h(t,e,i){return e.dup().sub(t).normalize().scale(i).add(t)}function u(t){t=t||{},this.attribs={},t.vertices&&this.addAttrib("vertices","position",t.vertices,!1),t.normals&&this.addAttrib("normals","normal",t.normals,!1),t.texCoords&&this.addAttrib("texCoords","texCoord",t.texCoords,!1),t.tangents&&this.addAttrib("tangents","tangent",t.tangents,!1),t.colors&&this.addAttrib("colors","color",t.colors,!1),t.indices&&this.addIndices(t.indices),t.edges&&this.addEdges(t.edges),t.faces&&this.addFaces(t.faces)}var c=t("./Vec3"),l=t("./Ray"),p=t("./BoundingBox");u.prototype.generateVolumePoints=function(t){t=t||5e3;for(var e=p.fromPoints(this.vertices),i=-e.min.x+e.max.x,n=-e.min.y+e.max.y,s=-e.min.z+e.max.z,o=0,r=[],a=[],h=0;!(o>=t);h++){var u=Math.floor(6*Math.random())+1,d=bottomX=(Math.random()-.5)*i,f=(Math.random()+.5)*n,y=bottomZ=(Math.random()-.5)*s,g=-f,m=-(Math.random()+.5)*i,x=rightY=(Math.random()-.5)*n,v=rightZ=(Math.random()-.5)*s,w=-m,b=frontX=(Math.random()-.5)*i,z=frontY=(Math.random()-.5)*n,M=-(Math.random()+.5)*s,P=-M;switch(u){case 1:var L=new c(m,x,v),C=new c(w,rightY,rightZ);break;case 2:var L=new c(w,rightY,rightZ),C=new c(m,x,v);break;case 3:var L=new c(d,f,y),C=new c(bottomX,g,g);break;case 4:var L=new c(bottomX,g,bottomZ),C=new c(d,f,y);break;case 5:var L=new c(b,z,M),C=new c(frontX,frontY,P);break;case 6:var L=new c(frontX,frontY,P),C=new c(b,z,M)}var E=L.dup(),R=C.dup().sub(L).normalize(),S=this.clone().triangulate(),A=0,T=[];if(S.faces.forEach(function(t){var e={};e.a=S.vertices[t[0]],e.b=S.vertices[t[1]],e.c=S.vertices[t[2]];var i=new l(E,R),n=i.hitTestTriangle(e);isNaN(n)&&(o++,A++,T.push(n))}),T.forEach(function(t){A%2===0&&r.push(t)}),!(r.length<2)){var D=r[r.length-2],V=r[r.length-1],k=V.dup().sub(D),q=D.dup().addScaled(k,Math.random());a.push(q)}}return a},u.prototype.generateSurfacePoints=function(t){t=t||5e3;for(var e=[],i=[],n=0,s=this.faces.length;s>n;n++){var o={},r=this.faces[n][0],a=this.faces[n][1],h=this.faces[n][2],u=this.vertices[r],c=this.vertices[a],l=this.vertices[h],p=c.dup().sub(u),d=l.dup().sub(u),f=p.cross(d),y=.5*Math.sqrt(f.x*f.x+f.y*f.y+f.z*f.z);o.A=u,o.B=c,o.C=l,i.push(o),e.push(y)}var g=Math.min.apply(Math,e),m=e.map(function(t){return Math.ceil(t/g)}),x=[];m.forEach(function(t,e){for(var i=0;t>i;i++)x.push(e)});for(var v=[],w=0;t>w;w++){var b=Math.ceil(Math.random()*x.length)-1,o=i[x[b]],u=o.A.clone(),c=o.B.clone(),l=o.C.clone(),z=Math.random(),M=Math.random();z+M>1&&(z=1-z,M=1-M);var P=1-(z+M),L=u.dup().scale(z),C=c.dup().scale(M),E=l.dup().scale(P),R=L.add(C).add(E);v.push(R)}return v},u.prototype.addAttrib=function(t,e,i,n){return null==i&&(i=null),null==n&&(n=!1),this[t]=i&&i.length?i:[],this[t].name=e,this[t].dirty=!0,this[t].dynamic=n,this.attribs[t]=this[t],this},u.prototype.addFaces=function(t,e){return null==t&&(t=null),null==e&&(e=!1),this.faces=t&&t.length?t:[],this.faces.dirty=!0,this.faces.dynamic=!1,this},u.prototype.addEdges=function(t,e){return null==t&&(t=null),null==e&&(e=!1),this.edges=t&&t.length?t:[],this.edges.dirty=!0,this.edges.dynamic=!1,this},u.prototype.addIndices=function(t,e){return null==t&&(t=null),null==e&&(e=!1),this.indices=t&&t.length?t:[],this.indices.dirty=!0,this.indices.dynamic=!1,this},u.prototype.isDirty=function(){var t=!1;t||(t=this.faces&&this.faces.dirty),t||(t=this.edges&&this.edges.dirty);for(attribAlias in this.attribs){var e=this.attribs[attribAlias];t||(t=e.dirty)}return t},u.prototype.addEdge=function(t,e){this.edges||this.addEdges(),this.edgeHash||(this.edgeHash={});var i=t+"_"+e,n=e+"_"+t;return this.edgeHash[i]||this.edgeHash[n]?void 0:(this.edges.push([t,e]),this.edgeHash[i]=this.edgeHash[n]=!0)},u.prototype.computeEdges=function(){if(this.edges?(this.edgeHash=null,this.edges.length=0):this.addEdges(),this.faces&&this.faces.length)this.faces.forEach(function(t){for(var e=0;e<t.length;e++)this.addEdge(t[e],t[(e+1)%t.length])}.bind(this));else for(var t=0;t<this.vertices.length-1;t++)this.addEdge(t,t+1)},u.prototype.computeNormals=function(){if(!this.faces)throw"Geometry[2]omputeSmoothNormals no faces found";if(this.normals||this.addAttrib("normals","normal",null,!1),this.normals.length>this.vertices.length)this.normals.length=this.vertices.length;else for(;this.normals.length<this.vertices.length;)this.normals.push(new c(0,0,0));var t=[];this.vertices.forEach(function(e,i){t[i]=0}.bind(this));var e=new c,i=new c,n=new c;this.faces.forEach(function(s){var o=this.vertices[s[0]],r=this.vertices[s[1]],a=this.vertices[s[2]];e.asSub(r,o).normalize(),i.asSub(a,o).normalize(),n.asCross(e,i);for(var h=0;h<s.length;h++)this.normals[s[h]].add(n),t[s[h]]++}.bind(this)),this.normals.forEach(function(t){t.normalize()})},u.prototype.toFlatGeometry=function(){var t=new u({vertices:!0,faces:!0}),e=this.vertices;return this.faces.forEach(function(i){var n=[];i.forEach(function(i){n.push(t.vertices.length),t.vertices.push(e[i])}),t.faces.push(n)}),t},u.prototype.clone=function(){var t=null,e=this.vertices.map(function(t){return t.dup()}),i=this.texCoords?this.texCoords.map(function(t){return t.dup()}):null,n=this.faces.map(function(t){return t.slice(0)}),t=this.edges?this.edges.map(function(t){return t.slice(0)}):null;return new u({vertices:e,texCoords:i,faces:n,edges:t})},u.prototype.triangulate=function(){var t=this.clone();return t.faces=[],this.faces.forEach(function(e){t.faces.push([e[0],e[1],e[2]]);for(var i=2;i<e.length-1;i++)t.faces.push([e[0],e[i],e[i+1]])}),t},u.prototype.computeHalfEdges=function(){var t=this.halfEdges=[],e=this.faces;e.forEach(function(e,i){e.halfEdges=[],e.forEach(function(n,s){var o=n,r=e[(s+1)%e.length],a={edgeIndex:t.length,face:e,faceIndex:i,slot:s,opposite:null,v0:Math.min(o,r),v1:Math.max(o,r)};e.halfEdges.push(a),t.push(a)})}),t.sort(function(t,e){return t.v0>e.v0?1:t.v0<e.v0?-1:t.v1>e.v1?1:t.v1<e.v1?-1:0});for(var i=1;i<t.length;i++){var n=t[i-1],s=t[i];n.v0==s.v0&&n.v1==s.v1&&(n.opposite=s,s.opposite=n)}return t},u.prototype.subdivideEdges=function(){var t=this.vertices,e=this.faces,r=this.computeHalfEdges(),a=t.map(function(t){return t}),h=[],c=[];r.forEach(function(e){if(!c[e.edgeIndex]){var n=i([t[e.face[e.slot]],t[o(e).face[o(e).slot]]]);c[e.edgeIndex]=n,c[e.opposite.edgeIndex]=n,a.push(n)}}),e.forEach(function(t){var e=[];n(t.halfEdges[0],function(t){e.push(a.indexOf(c[t.edgeIndex]))}),h.push(e)});var l=[];r.forEach(function(t){if(-1===l.indexOf(t.face[t.slot])){l.push(t.face[t.slot]);var e=[];s(t,function(t){e.push(a.indexOf(c[t.edgeIndex]))}),e.forEach(function(i,n){var s=e[(n+1)%e.length];h.push([t.face[t.slot],i,s])})}});var p=new u({vertices:a,faces:h});return p.computeEdges(),p},u.prototype.getFaceVertices=function(t){return t.map(function(t){return this.vertices[t]}.bind(this))},u.prototype.catmullClark=function(){var t=this.vertices,e=this.faces,r=this.computeHalfEdges(),a=e.map(this.getFaceVertices.bind(this)).map(i),h=[];r.forEach(function(e){if(!h[e.edgeIndex]){var n=i([t[e.v0],t[e.v1],a[e.faceIndex],a[e.opposite.faceIndex]]);h[e.edgeIndex]=n,h[e.opposite.edgeIndex]=n}});var l=[];r.map(function(n){var o=e[n.faceIndex][n.slot],r=t[o];if(!l[o]){var h=[],u=[];s(n,function(e){h.push(a[e.faceIndex]),u.push(i([t[e.v0],t[e.v1]]))});var p=i(h),d=i(u),f=h.length,y=new c(0,0,0);y.add(p),y.add(d.dup().scale(2)),y.add(r.dup().scale(f-3)),y.scale(1/f),l[o]=y}});var p=l.concat(a);r.forEach(function(t){t.added>-1||(t.added=p.length,t.opposite.added=p.length,p.push(h[t.edgeIndex]))});var d=[],f=[];return e.forEach(function(t,e){var i=e+l.length;n(t.halfEdges[0],function(e){var n=e.added,s=o(e),r=t[s.slot],a=s.added;f.push([i,n]),f.push([n,r]),d.push([i,n,r,a])})}),new u({vertices:p,faces:d,edges:f})},u.prototype.dooSabin=function(t){var e=this.vertices,c=this.faces,l=this.computeHalfEdges(),p=[],d=[],f=[];t=t||.1;var y=[];return c.forEach(function(s,o){var u=y[o]=[];return n(s.halfEdges[0],function(n){var s=e[n.face[n.slot]],o=i([s,i(a(e,n.face)),i(a(e,[n.v0,n.v1])),i(a(e,[r(n).v0,r(n).v1]))]);u.push(p.length),p.push(h(s,o,t))}),u}),c.forEach(function(t,e){d.push(y[e])}),l.forEach(function(t){if(!t.edgeVisited){t.edgeVisited=!0,t.opposite.edgeVisited=!0;var e=t,i=o(e.opposite),n=e.opposite,s=o(e),r=[y[e.faceIndex][e.slot],y[i.faceIndex][i.slot],y[n.faceIndex][n.slot],y[s.faceIndex][s.slot]];d.push(r),f.push([r[0],r[3]]),f.push([r[1],r[2]])}}),l.forEach(function(t){if(!t.vertexVisited){var e=[];s(t,function(t){t.vertexVisited=!0,e.push(y[t.faceIndex][t.slot])}),d.push(e),e.forEach(function(t,i){f.push([t,e[(i+1)%e.length]])})}}),new u({vertices:p,faces:d,edges:f})},u.prototype.wire=function(t,e){e=null!=e?e:t||.1,t=t||.1;var i=this.dooSabin(t);i.computeNormals();var s=(i.computeHalfEdges(),this.dooSabin(t));s.computeNormals(),s.vertices.forEach(function(t,i){t.sub(s.normals[i].dup().scale(e))});var o=i.faces.splice(0,this.faces.length);s.faces.splice(0,this.faces.length);var a=i.vertices.length;return s.vertices.forEach(function(t){i.vertices.push(t)}),s.faces.forEach(function(t){i.faces.push(t.map(function(t){return t+a}).reverse())}),s.edges.forEach(function(t){i.edges.push(t.map(function(t){return t+a}))}),o.forEach(function(t){n(t.halfEdges[0],function(t){var e=r(t);i.faces.push([e.face[e.slot],t.face[t.slot],t.face[t.slot]+a,e.face[e.slot]+a]),i.edges.push([e.face[e.slot],e.face[e.slot]+a]),i.edges.push([t.face[t.slot],t.face[t.slot]+a])})}),i},u.prototype.extrude=function(t,e,s){t=t||.1,s=s||0,e||(e=this.faces.map(function(t,e){return e}));var r=this.clone(),h=(r.computeHalfEdges(),new c),u=new c,l=new c,p=new c;return e.forEach(function(e){var c=r.faces[e],d=a(r.vertices,c),f=r.texCoords?a(r.texCoords,c):null,y=d[0],g=d[1],m=d[2];h.asSub(g,y).normalize(),u.asSub(m,y).normalize(),l.asCross(h,u).normalize(),l.scale(t);var x=d.map(function(t){return t.dup().add(l)}),v=[];if(x.forEach(function(t){v.push(r.vertices.length),r.vertices.push(t)}),f){var w=f.map(function(t){return t.dup()});w.forEach(function(t){r.texCoords.push(t)})}if(s){var m=i(x);x.forEach(function(t){p.asSub(m,t),p.scale(s),t.add(p)})}n(c.halfEdges[0],function(t){r.faces.push([c[t.slot],c[o(t).slot],v[o(t).slot],v[t.slot]])}),r.edges&&(v.forEach(function(t,e){r.edges.push([t,c[e]])}),v.forEach(function(t,e){r.edges.push([t,v[(e+1)%v.length]])})),v.forEach(function(t,e){c[e]=t})}),r},e.exports=u},{"./BoundingBox":9,"./Ray":17,"./Vec3":25}],11:[function(t,e){function i(){this.reset()}var n=t("./Vec3");i.create=function(){return new i},i.prototype.equals=function(t,e){return null==e&&(e=1e-7),Math.abs(t.a11-this.a11)<=e&&Math.abs(t.a12-this.a12)<=e&&Math.abs(t.a13-this.a13)<=e&&Math.abs(t.a14-this.a14)<=e&&Math.abs(t.a21-this.a21)<=e&&Math.abs(t.a22-this.a22)<=e&&Math.abs(t.a23-this.a23)<=e&&Math.abs(t.a24-this.a24)<=e&&Math.abs(t.a31-this.a31)<=e&&Math.abs(t.a32-this.a32)<=e&&Math.abs(t.a33-this.a33)<=e&&Math.abs(t.a34-this.a34)<=e&&Math.abs(t.a41-this.a41)<=e&&Math.abs(t.a42-this.a42)<=e&&Math.abs(t.a43-this.a43)<=e&&Math.abs(t.a44-this.a44)<=e},i.prototype.hash=function(){return.01*this.a11+.02*this.a12+.03*this.a13+.04*this.a14+.05*this.a21+.06*this.a22+.07*this.a23+.08*this.a24+.09*this.a31+.1*this.a32+.11*this.a33+.12*this.a34+.13*this.a41+.14*this.a42+.15*this.a43+.16*this.a44},i.prototype.set4x4r=function(t,e,i,n,s,o,r,a,h,u,c,l,p,d,f,y){return this.a11=t,this.a12=e,this.a13=i,this.a14=n,this.a21=s,this.a22=o,this.a23=r,this.a24=a,this.a31=h,this.a32=u,this.a33=c,this.a34=l,this.a41=p,this.a42=d,this.a43=f,this.a44=y,this},i.prototype.copy=function(t){return this.a11=t.a11,this.a12=t.a12,this.a13=t.a13,this.a14=t.a14,this.a21=t.a21,this.a22=t.a22,this.a23=t.a23,this.a24=t.a24,this.a31=t.a31,this.a32=t.a32,this.a33=t.a33,this.a34=t.a34,this.a41=t.a41,this.a42=t.a42,this.a43=t.a43,this.a44=t.a44,this},i.prototype.dup=function(){return i.create().copy(this)},i.prototype.reset=function(){return this.set4x4r(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},i.prototype.identity=function(){return this.reset(),this},i.prototype.mul4x4r=function(t,e,i,n,s,o,r,a,h,u,c,l,p,d,f,y){var g=this.a11,m=this.a12,x=this.a13,v=this.a14,w=this.a21,b=this.a22,z=this.a23,M=this.a24,P=this.a31,L=this.a32,C=this.a33,E=this.a34,R=this.a41,S=this.a42,A=this.a43,T=this.a44;return this.a11=g*t+m*s+x*h+v*p,this.a12=g*e+m*o+x*u+v*d,this.a13=g*i+m*r+x*c+v*f,this.a14=g*n+m*a+x*l+v*y,this.a21=w*t+b*s+z*h+M*p,this.a22=w*e+b*o+z*u+M*d,this.a23=w*i+b*r+z*c+M*f,this.a24=w*n+b*a+z*l+M*y,this.a31=P*t+L*s+C*h+E*p,this.a32=P*e+L*o+C*u+E*d,this.a33=P*i+L*r+C*c+E*f,this.a34=P*n+L*a+C*l+E*y,this.a41=R*t+S*s+A*h+T*p,this.a42=R*e+S*o+A*u+T*d,this.a43=R*i+S*r+A*c+T*f,this.a44=R*n+S*a+A*l+T*y,this},i.prototype.perspective=function(t,e,i,n){var s=1/Math.tan(t/180*Math.PI/2),o=1/(n-i);return this.mul4x4r(s/e,0,0,0,0,s,0,0,0,0,-(n+i)*o,-2*n*i*o,0,0,-1,0),this},i.prototype.ortho=function(t,e,i,n,s,o){return this.mul4x4r(2/(e-t),0,0,(e+t)/(t-e),0,2/(n-i),0,(n+i)/(i-n),0,0,2/(s-o),(o+s)/(s-o),0,0,0,1),this},i.prototype.lookAt=function(t,e,i){var s=n.create(t.x-e.x,t.y-e.y,t.z-e.z).normalize(),o=n.create(i.x,i.y,i.z).cross(s).normalize(),r=n.create().copy(s).cross(o).normalize();return this.mul4x4r(o.x,o.y,o.z,0,r.x,r.y,r.z,0,s.x,s.y,s.z,0,0,0,0,1),this.translate(-t.x,-t.y,-t.z),this},i.prototype.translate=function(t,e,i){return this.mul4x4r(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this},i.prototype.rotate=function(t,e,i,n){var s=Math.sin(t),o=Math.cos(t);return this.mul4x4r(e*e*(1-o)+o,e*i*(1-o)-n*s,e*n*(1-o)+i*s,0,i*e*(1-o)+n*s,i*i*(1-o)+o,i*n*(1-o)-e*s,0,e*n*(1-o)-i*s,i*n*(1-o)+e*s,n*n*(1-o)+o,0,0,0,0,1),this},i.prototype.asMul=function(t,e){var i=t.a11,n=t.a12,s=t.a13,o=t.a14,r=t.a21,a=t.a22,h=t.a23,u=t.a24,c=t.a31,l=t.a32,p=t.a33,d=t.a34,f=t.a41,y=t.a42,g=t.a43,m=t.a44,x=e.a11,v=e.a12,w=e.a13,b=e.a14,z=e.a21,M=e.a22,P=e.a23,L=e.a24,C=e.a31,E=e.a32,R=e.a33,S=e.a34,A=e.a41,T=e.a42,D=e.a43,V=e.a44;return this.a11=i*x+n*z+s*C+o*A,this.a12=i*v+n*M+s*E+o*T,this.a13=i*w+n*P+s*R+o*D,this.a14=i*b+n*L+s*S+o*V,this.a21=r*x+a*z+h*C+u*A,this.a22=r*v+a*M+h*E+u*T,this.a23=r*w+a*P+h*R+u*D,this.a24=r*b+a*L+h*S+u*V,this.a31=c*x+l*z+p*C+d*A,this.a32=c*v+l*M+p*E+d*T,this.a33=c*w+l*P+p*R+d*D,this.a34=c*b+l*L+p*S+d*V,this.a41=f*x+y*z+g*C+m*A,this.a42=f*v+y*M+g*E+m*T,this.a43=f*w+y*P+g*R+m*D,this.a44=f*b+y*L+g*S+m*V,this},i.prototype.mul=function(t){return this.asMul(this,t)},i.prototype.scale=function(t,e,i){return this.mul4x4r(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this},i.prototype.invert=function(){var t=this.a11,e=this.a12,i=this.a13,n=this.a14,s=this.a21,o=this.a22,r=this.a23,a=this.a24,h=this.a31,u=this.a32,c=this.a33,l=this.a34,p=this.a41,d=this.a42,f=this.a43,y=this.a44,g=t*o-e*s,m=t*r-i*s,x=t*a-n*s,v=e*r-i*o,w=e*a-n*o,b=i*a-n*r,z=h*d-u*p,M=h*f-c*p,P=h*y-l*p,L=u*f-c*d,C=u*y-l*d,E=c*y-l*f,R=1/(g*E-m*C+x*L+v*P-w*M+b*z);return this.a11=(+o*E-r*C+a*L)*R,this.a12=(-e*E+i*C-n*L)*R,this.a13=(+d*b-f*w+y*v)*R,this.a14=(-u*b+c*w-l*v)*R,this.a21=(-s*E+r*P-a*M)*R,this.a22=(+t*E-i*P+n*M)*R,this.a23=(-p*b+f*x-y*m)*R,this.a24=(+h*b-c*x+l*m)*R,this.a31=(+s*C-o*P+a*z)*R,this.a32=(-t*C+e*P-n*z)*R,this.a33=(+p*w-d*x+y*g)*R,this.a34=(-h*w+u*x-l*g)*R,this.a41=(-s*L+o*M-r*z)*R,this.a42=(+t*L-e*M+i*z)*R,this.a43=(-p*v+d*m-f*g)*R,this.a44=(+h*v-u*m+c*g)*R,this},i.prototype.transpose=function(){var t=this.a11,e=this.a12,i=this.a13,n=this.a14,s=this.a21,o=this.a22,r=this.a23,a=this.a24,h=this.a31,u=this.a32,c=this.a33,l=this.a34,p=this.a41,d=this.a42,f=this.a43,y=this.a44;return this.a11=t,this.a12=s,this.a13=h,this.a14=p,this.a21=e,this.a22=o,this.a23=u,this.a24=d,this.a31=i,this.a32=r,this.a33=c,this.a34=f,this.a41=n,this.a42=a,this.a43=l,this.a44=y,this},i.prototype.toArray=function(){return[this.a11,this.a21,this.a31,this.a41,this.a12,this.a22,this.a32,this.a42,this.a13,this.a23,this.a33,this.a43,this.a14,this.a24,this.a34,this.a44]},i.prototype.fromArray=function(t){return this.a11=t[0](this.a21=t[1](this.a31=t[2](this.a41=t[3]))),this.a12=t[4](this.a22=t[5](this.a32=t[6](this.a42=t[7]))),this.a13=t[8](this.a23=t[9](this.a33=t[10](this.a43=t[11]))),this.a14=t[12](this.a24=t[13](this.a34=t[14](this.a44=t[15]))),this},e.exports=i},{"./Vec3":25}],12:[function(t,e){function i(t,e){this.maxDistance=Math.max(e.x,Math.max(e.y,e.z)),this.accuracy=0,this.root=new i.Cell(this,t,e,0)}var n=t("pex-geom"),s=n.Vec3;i.fromBoundingBox=function(t){return new i(t.min.clone(),t.getSize().clone())},i.MaxLevel=8,i.prototype.add=function(t,e){this.root.add(t,e)},i.prototype.has=function(t){return this.root.has(t)},i.prototype.findNearestPoint=function(t,e){e.includeData=e.includeData?e.includeData:!1,e.bestDist=e.maxDist?e.maxDist:1/0,e.notSelf=e.notSelf?e.notSelf:!1;var i=this.root.findNearestPoint(t,e);return i?e.includeData?i:i.point:null},i.prototype.findNearbyPoints=function(t,e,i){i=i||{};var n={points:[],data:[]};return this.root.findNearbyPoints(t,e,n,i),n},i.prototype.getAllCellsAtLevel=function(t,e,i){return"undefined"==typeof e&&(e=t,t=this.root),i=i||[],t.level==e?(t.points.length>0&&i.push(t),i):(t.children.forEach(function(t){this.getAllCellsAtLevel(t,e,i)}.bind(this)),i)},i.Cell=function(t,e,i,n){this.tree=t,this.position=e,this.size=i,this.level=n,this.points=[],this.data=[],this.temp=new s,this.children=[]},i.Cell.prototype.has=function(t){if(!this.contains(t))return null;if(this.children.length>0){for(var e=0;e<this.children.length;e++){var i=this.children[e].has(t);if(i)return i}return null}for(var n=this.tree.accuracy*this.tree.accuracy,e=0;e<this.points.length;e++){var s=this.points[e],o=t.squareDistance(s);if(n>=o)return s}return null},i.Cell.prototype.add=function(t,e){this.points.push(t),this.data.push(e),this.children.length>0?this.addToChildren(t,e):this.points.length>1&&this.level<i.MaxLevel&&this.split()},i.Cell.prototype.addToChildren=function(t,e){for(var i=0;i<this.children.length;i++)if(this.children[i].contains(t)){this.children[i].add(t,e);break}},i.Cell.prototype.contains=function(t){return t.x>=this.position.x-this.tree.accuracy&&t.y>=this.position.y-this.tree.accuracy&&t.z>=this.position.z-this.tree.accuracy&&t.x<this.position.x+this.size.x+this.tree.accuracy&&t.y<this.position.y+this.size.y+this.tree.accuracy&&t.z<this.position.z+this.size.z+this.tree.accuracy},i.Cell.prototype.split=function(){var t=this.position.x,e=this.position.y,n=this.position.z,o=this.size.x/2,r=this.size.y/2,a=this.size.z/2;this.children.push(new i.Cell(this.tree,s.create(t,e,n),s.create(o,r,a),this.level+1)),this.children.push(new i.Cell(this.tree,s.create(t+o,e,n),s.create(o,r,a),this.level+1)),this.children.push(new i.Cell(this.tree,s.create(t,e,n+a),s.create(o,r,a),this.level+1)),this.children.push(new i.Cell(this.tree,s.create(t+o,e,n+a),s.create(o,r,a),this.level+1)),this.children.push(new i.Cell(this.tree,s.create(t,e+r,n),s.create(o,r,a),this.level+1)),this.children.push(new i.Cell(this.tree,s.create(t+o,e+r,n),s.create(o,r,a),this.level+1)),this.children.push(new i.Cell(this.tree,s.create(t,e+r,n+a),s.create(o,r,a),this.level+1)),this.children.push(new i.Cell(this.tree,s.create(t+o,e+r,n+a),s.create(o,r,a),this.level+1));for(var h=0;h<this.points.length;h++)this.addToChildren(this.points[h],this.data[h])},i.Cell.prototype.squareDistanceToCenter=function(t){var e=t.x-(this.position.x+this.size.x/2),i=t.y-(this.position.y+this.size.y/2),n=t.z-(this.position.z+this.size.z/2);return e*e+i*i+n*n},i.Cell.prototype.findNearestPoint=function(t,e){var i=null,n=null,s=e.bestDist;if(this.points.length>0&&0==this.children.length)for(var o=0;o<this.points.length;o++){var r=this.points[o].distance(t);if(s>=r){if(0==r&&e.notSelf)continue;s=r,i=this.points[o],n=this.data[o]}}var a=this.children,a=this.children.map(function(e){return{child:e,dist:e.squareDistanceToCenter(t)}}).sort(function(t,e){return t.dist-e.dist}).map(function(t){return t.child});if(a.length>0)for(var o=0;o<a.length;o++){var h=a[o];if(h.points.length>0){if(t.x<h.position.x-s||t.x>h.position.x+h.size.x+s||t.y<h.position.y-s||t.y>h.position.y+h.size.y+s||t.z<h.position.z-s||t.z>h.position.z+h.size.z+s)continue;var u=h.findNearestPoint(t,e);if(!u||!u.point)continue;var c=u.point.distance(t);s>c&&(i=u.point,s=c,n=u.data)}}return{point:i,data:n}},i.Cell.prototype.findNearbyPoints=function(t,e,i,n){if(this.points.length>0&&0==this.children.length)for(var s=0;s<this.points.length;s++){var o=this.points[s].distance(t);if(e>=o){if(0==o&&n.notSelf)continue;i.points.push(this.points[s]),n.includeData&&i.data.push(this.data[s])}}var r=this.children;if(r.length>0)for(var s=0;s<r.length;s++){var a=r[s];if(a.points.length>0){if(t.x<a.position.x-e||t.x>a.position.x+a.size.x+e||t.y<a.position.y-e||t.y>a.position.y+a.size.y+e||t.z<a.position.z-e||t.z>a.position.z+a.size.z+e)continue;a.findNearbyPoints(t,e,i,n)}}},e.exports=i},{"pex-geom":8}],13:[function(t,e){function i(t,e){this.points=t||[],this.dirtyLength=!0,this.closed=e||!1,this.samplesCount=1e3}var n=t("./Vec3");i.prototype.addPoint=function(t){return this.points.push(t)
},i.prototype.getPoint=function(t){var e=t*(this.points.length-1),i=Math.floor(e),s=e-i,o=i,r=i+1;i===this.points.length-1&&(o=i,r=i);var a=new n;return a.x=this.points[o].x+(this.points[r].x-this.points[o].x)*s,a.y=this.points[o].y+(this.points[r].y-this.points[o].y)*s,a.z=this.points[o].z+(this.points[r].z-this.points[o].z)*s,a},i.prototype.getPointAt=function(t){this.closed||(t=Math.max(0,Math.min(t,1))),this.dirtyLength&&this.precalculateLength();for(var e=0,i=0;i<this.accumulatedLengthRatios.length;i++)if(this.accumulatedLengthRatios[i]>t-1/this.samplesCount){e=this.accumulatedRatios[i];break}return this.getPoint(e,!0)},i.prototype.getClosestPoint=function(t){this.dirtyLength&&this.precalculateLength();var e=this.precalculatedPoints.reduce(function(e,i){var n=t.squareDistance(i);return n<e.dist?{dist:n,point:i}:e},{dist:1/0,point:null});return e.point},i.prototype.getClosestPointRatio=function(t){this.dirtyLength&&this.precalculateLength();var e=this.precalculatedPoints.reduce(function(e,i,n){var s=t.squareDistance(i);return s<e.dist?{dist:s,point:i,index:n}:e},{dist:1/0,point:null,index:-1});return this.accumulatedLengthRatios[e.index]},i.prototype.close=function(){return this.closed=!0},i.prototype.isClosed=function(){return this.closed},i.prototype.reverse=function(){return this.points=this.points.reverse(),this.dirtyLength=!0},i.prototype.precalculateLength=function(){this.accumulatedRatios=[],this.accumulatedLengthRatios=[],this.accumulatedLengths=[],this.precalculatedPoints=[];for(var t=1/this.samplesCount,e=0,i=0,n=null,s=null,o=0;o<this.samplesCount;o++)s=n,n=this.getPoint(e),o>0&&(i+=n.dup().sub(s).length()),this.accumulatedRatios.push(e),this.accumulatedLengths.push(i),this.precalculatedPoints.push(n),e+=t;for(var o=0;o<this.accumulatedLengths.length-1;o++)this.accumulatedLengthRatios.push(this.accumulatedLengths[o]/i);return this.length=i,this.dirtyLength=!1},e.exports=i},{"./Vec3":25}],14:[function(t,e){function i(t,e){this.point=t,this.normal=e,this.u=new s,this.v=new s,this.updateUV()}var n=t("./Vec2"),s=t("./Vec3");i.prototype.set=function(t,e){this.point=t,this.normal=e},i.prototype.setPoint=function(t){this.point=t},i.prototype.setNormal=function(t){this.normal=t},i.prototype.project=function(t){var e=s.create().asSub(t,this.point),i=e.dot(this.normal),n=this.normal.clone().scale(i),o=t.clone().sub(n);return o},i.prototype.intersectRay=function(t){return t.hitTestPlane(this.point,this.normal)[0]},i.prototype.updateUV=function(){if(Math.abs(this.normal.x)>Math.abs(this.normal.y)){var t=1/Math.sqrt(this.normal.x*this.normal.x+this.normal.z*this.normal.z);this.u.set(this.normal.x*t,0,-this.normal.z*t)}else{var t=1/Math.sqrt(this.normal.y*this.normal.y+this.normal.z*this.normal.z);this.u.set(0,this.normal.z*t,-this.normal.y*t)}this.v.setVec3(this.normal).cross(this.u)},i.prototype.project=function(t){var e=s.create().asSub(t,this.point),i=e.dot(this.normal),n=this.normal.clone().scale(i),o=t.clone().sub(n);return o},i.prototype.rebase=function(t){var e=t.dup().sub(this.point),i=this.u.dot(e),s=this.v.dot(e);return new n(i,s)},e.exports=i},{"./Vec2":24,"./Vec3":25}],15:[function(t,e){function i(t,e,i,n){this.x=null!=t?t:0,this.y=null!=e?e:0,this.z=null!=i?i:0,this.w=null!=n?n:1}var n=t("./Mat4"),s=t("./Vec3"),o=Math.pow(2,-24);i.create=function(t,e,n,s){return new i(t,e,n,s)},i.fromArray=function(t){return new i(t[0],t[1],t[2],t[3])},i.prototype.identity=function(){return this.set(0,0,0,1),this},i.prototype.equals=function(t,e){return null==e&&(e=1e-7),Math.abs(t.x-this.x)<=e&&Math.abs(t.y-this.y)<=e&&Math.abs(t.z-this.z)<=e&&Math.abs(t.w-this.w)<=e},i.prototype.hash=function(){return 1*this.x+12*this.y+123*this.z+1234*this.w},i.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},i.prototype.clone=function(){return new i(this.x,this.y,this.z,this.w)},i.prototype.dup=function(){return this.clone()},i.prototype.setAxisAngle=function(t,e){e=.5*e;var i=Math.sin(e/180*Math.PI);return this.x=i*t.x,this.y=i*t.y,this.z=i*t.z,this.w=Math.cos(e/180*Math.PI),this},i.prototype.setQuat=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},i.prototype.set=function(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this},i.prototype.asMul=function(t,e){var i=t.x,n=t.y,s=t.z,o=t.w,r=e.x,a=e.y,h=e.z,u=e.w;return this.x=i*u+o*r+n*h-s*a,this.y=n*u+o*a+s*r-i*h,this.z=s*u+o*h+i*a-n*r,this.w=o*u-i*r-n*a-s*h,this},i.prototype.mul=function(t){return this.asMul(this,t),this},i.prototype.mul4=function(t,e,i,n){var s=this.x,o=this.y,r=this.z,a=this.w;return this.x=n*s+t*a+e*r-i*o,this.y=n*o+e*a+i*s-t*r,this.z=n*r+i*a+t*o-e*s,this.w=n*a-t*s-e*o-i*r,this},i.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},i.prototype.normalize=function(){var t=this.length();return t>o&&(this.x/=t,this.y/=t,this.z/=t,this.w/=t),this},i.prototype.toMat4=function(t){var e=this.x+this.x,i=this.y+this.y,s=this.z+this.z,o=this.w*e,r=this.w*i,a=this.w*s,h=this.x*e,u=this.x*i,c=this.x*s,l=this.y*i,p=this.y*s,d=this.z*s,f=t||new n;return f.set4x4r(1-(l+d),u-a,c+r,0,u+a,1-(h+d),p-o,0,c-r,p+o,1-(h+l),0,0,0,0,1)},i.prototype.setDirection=function(t,e){var o=s.create().copy(t).normalize(),r=s.create(0,1,0),a=s.create().asCross(r,o);0==a.length()&&(r.set(1,0,0),a.asCross(r,o)),r.asCross(o,a),a.normalize(),r.normalize(),e&&console.log("dir",o),e&&console.log("up",r),e&&console.log("right",a);var h=new n;h.set4x4r(a.x,a.y,a.z,0,r.x,r.y,r.z,0,o.x,o.y,o.z,0,0,0,0,1);var u=new i;if(1+h.a11+h.a22+h.a33<.001){e&&console.log("singularity"),o=t.dup(),o.z*=-1,o.normalize(),r.set(0,1,0),a.asCross(r,o),r.asCross(o,a),a.normalize(),r.normalize(),h=new n,h.set4x4r(a.x,a.y,a.z,0,r.x,r.y,r.z,0,o.x,o.y,o.z,0,0,0,0,1),u.w=Math.sqrt(1+h.a11+h.a22+h.a33)/2;var c=4*u.w;return u.x=(h.a23-h.a32)/c,u.y=(h.a31-h.a13)/c,u.z=(h.a12-h.a21)/c,e&&console.log("dir",o),e&&console.log("up",r),e&&console.log("right",a),q2=new i,q2.setAxisAngle(new s(0,1,0),180),q2.mul(u),q2}return u.w=Math.sqrt(1+h.a11+h.a22+h.a33)/2,c=4*u.w,u.x=(h.a23-h.a32)/c,u.y=(h.a31-h.a13)/c,u.z=(h.a12-h.a21)/c,this.copy(u),this},i.prototype.slerp=function(t,e){var i=this,n=i.w*t.w+i.x*t.x+i.y*t.y+i.z*t.z;if(Math.abs(n)>=1)return this;var s=Math.acos(n),o=Math.sqrt(1-n*n);if(Math.abs(o)<.001)return this.w=.5*i.w+.5*t.w,this.x=.5*i.x+.5*t.x,this.y=.5*i.y+.5*t.y,this.z=.5*i.z+.5*t.z,this;var r=Math.sin((1-e)*s)/o,a=Math.sin(e*s)/o;return this.w=i.w*r+t.w*a,this.x=i.x*r+t.x*a,this.y=i.y*r+t.y*a,this.z=i.z*r+t.z*a,this},i.fromAxisAngle=function(t,e){return(new i).setAxisAngle(t,e)},i.fromDirection=function(t){return(new i).setDirection(t)},e.exports=i},{"./Mat4":11,"./Vec3":25}],16:[function(t,e){function i(){}var n=(t("seedrandom"),t("./Vec2")),s=t("./Vec3");i.randomSeed=function(t){Math.seedrandom(t)},i.randomFloat=function(t,e){return"undefined"==typeof e&&(t=1),"undefined"==typeof e&&(e=t,t=0),t+(e-t)*Math.random()},i.randomInt=function(t,e){return Math.floor(i.randomFloat(t,e))},i.randomVec3=function(t){t=t||.5;var e=2*Math.random()-1,i=2*Math.random()-1,n=2*Math.random()-1;return s.create(e*t,i*t,n*t)},i.randomVec3InBoundingBox=function(t){var e=t.min.x+Math.random()*(t.max.x-t.min.x),i=t.min.y+Math.random()*(t.max.y-t.min.y),n=t.min.z+Math.random()*(t.max.z-t.min.z);return s.create(e,i,n)},i.randomVec2InRect=function(t){return n.create(t.x+Math.random()*t.width,t.y+Math.random()*t.height)},i.randomChance=function(t){return Math.random()<=t},i.randomElement=function(t){return t[Math.floor(Math.random()*t.length)]},e.exports=i},{"./Vec2":24,"./Vec3":25,seedrandom:27}],17:[function(t,e){function i(t,e){this.origin=t||new n(0,0,0),this.direction=e||new n(0,0,1)}var n=t("./Vec3"),s=1e-4;i.prototype.hitTestSphere=function(t,e){var i=[],n=this.direction,s=this.origin,o=s.dup().sub(t),r=n.dot(n);if(0==r)return i;var a=2*o.dot(n),h=o.dot(o)-e*e,u=Math.sqrt(a*a-4*r*h);if(isNaN(u))return i;var c=(-a-u)/(2*r),l=(-a+u)/(2*r);return i.push(s.dup().add(n.dup().scale(c))),c!=l&&i.push(s.dup().add(n.dup().scale(l))),i},i.prototype.hitTestPlane=function(t,e){if(0==this.direction.dot(e))return[];var i=e.dup().scale(-1).dot(this.origin.dup().sub(t))/this.direction.dot(e);return[this.origin.dup().add(this.direction.dup().scale(i))]},i.prototype.hitTestBoundingBox=function(t){function e(t,e,n,o,r){var a=s.hitTestPlane(t,n);if(a.length>0){var h=a[0];h[o]>t[o]-e[o]/2&&h[o]<t[o]+e[o]/2&&h[r]>t[r]-e[r]/2&&h[r]<t[r]+e[r]/2&&i.push(h)}}var i=[],s=this,o=t.getCenter(),r=t.getSize();return e(o.dup().add(new n(0,0,r.z/2)),r,new n(0,0,1),"x","y"),e(o.dup().add(new n(0,0,-r.z/2)),r,new n(0,0,-1),"x","y"),e(o.dup().add(new n(r.x/2,0,0)),r,new n(1,0,0),"y","z"),e(o.dup().add(new n(-r.x/2,0,0)),r,new n(-1,0,0),"y","z"),e(o.dup().add(new n(0,r.y/2,0)),r,new n(0,1,0),"x","z"),e(o.dup().add(new n(0,-r.y/2,0)),r,new n(0,-1,0),"x","z"),i.forEach(function(t){t._distance=t.distance(s.origin)}),i.sort(function(t,e){return t._distance-e._distance}),i.forEach(function(t){delete t._distance}),i.length>0&&(i=[i[0]]),i},i.prototype.hitTestTriangle=function(t){var e=this,i=t.b.dup().sub(t.a),o=t.c.dup().sub(t.a),r=n.create().asCross(i,o);if(r.length()<s)return-1;var a=e.origin.dup().sub(t.a),h=-r.dot(a),u=r.dot(e.direction);if(Math.abs(u)<s)return 0==h?-2:-3;var c=h/u;if(-s>c)return-4;var l=e.origin.dup().add(e.direction.dup().scale(c)),p=i.dot(i),d=i.dot(o),f=o.dot(o),y=l.dup().sub(t.a),g=y.dot(i),m=y.dot(o),x=d*d-p*f,v=(d*m-f*g)/x;if(-s>v||v>1+s)return-5;var w=(d*g-p*m)/x;return-s>w||v+w>1+s?-6:i.scale(v).add(o.scale(w)).add(t.a)},e.exports=i},{"./Vec3":25}],18:[function(t,e){function i(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n}i.prototype.set=function(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n},i.prototype.contains=function(t){return t.x>=this.x&&t.x<=this.x+this.width&&t.y>=this.y&&t.y<=this.y+this.height},e.exports=i},{}],19:[function(t,e){function i(t,e){this.points=t||[],this.dirtyLength=!0,this.closed=e||!1,this.samplesCount=2e3}i.prototype.getPoint=function(t){t=this.closed?(t+1)%1:Math.max(0,Math.min(t,1));var e,i,n,s,o=this.points,r=this.closed?o.length:o.length-1,a=t*r,h=Math.floor(a),u=a-h;return this.closed?(e=(h-1+o.length)%o.length,i=h%o.length,n=(h+1)%o.length,s=(h+2)%o.length):(e=0==h?h:h-1,i=h,n=h>o.length-2?h:h+1,s=h>o.length-3?h:h+2),this.interpolate(o[e],o[i],o[n],o[s],u)},i.prototype.addPoint=function(t){this.dirtyLength=!0,this.points.push(t)},i.prototype.getPointAt=function(t){t=this.closed?(t+1)%1:Math.max(0,Math.min(t,1)),this.dirtyLength&&this.precalculateLength();for(var e=0,i=0;i<this.accumulatedLengthRatios.length;i++)if(this.accumulatedLengthRatios[i]>t-1/this.samplesCount){e=this.accumulatedRatios[i];break}return this.getPoint(e)},i.prototype.getPointAtIndex=function(t){return t<this.points.length?this.points[t]:null},i.prototype.getNumPoints=function(){return this.points.length},i.prototype.getLength=function(){return this.dirtyLength&&this.precalculateLength(),this.length},i.prototype.precalculateLength=function(){var t=1/this.samplesCount,e=0,i=0;this.accumulatedRatios=[],this.accumulatedLengthRatios=[],this.accumulatedLengths=[];for(var n,s,e=0,o=0;o<this.samplesCount;o++){if(s=n,n=this.getPoint(e),o>0){var r=Math.sqrt(1+(n-s)*(n-s));i+=r}this.accumulatedRatios.push(e),this.accumulatedLengths.push(i),e+=t}for(var o=0;o<this.samplesCount;o++)this.accumulatedLengthRatios.push(this.accumulatedLengths[o]/i);this.length=i,this.dirtyLength=!1},i.prototype.close=function(){this.closed=!0},i.prototype.isClosed=function(){return this.closed},i.prototype.interpolate=function(t,e,i,n,s){var o=.5*(i-t),r=.5*(n-e),a=s*s,h=s*a;return(2*e-2*i+o+r)*h+(-3*e+3*i-2*o-r)*a+o*s+e},e.exports=i},{}],20:[function(t,e){function i(t,e){this.points=t||[],this.dirtyLength=!0,this.closed=e||!1,this.samplesCount=100}var n=t("./Vec2");i.prototype.getPoint=function(t){t=this.closed?(t+1)%1:Math.max(0,Math.min(t,1));var e,i,s,o,r=this.points,a=this.closed?r.length:r.length-1,h=t*a,u=Math.floor(h),c=h-u;this.closed?(e=(u-1+r.length)%r.length,i=u%r.length,s=(u+1)%r.length,o=(u+2)%r.length):(e=0==u?u:u-1,i=u,s=u>r.length-2?u:u+1,o=u>r.length-3?u:u+2);var l=new n;return l.x=this.interpolate(r[e].x,r[i].x,r[s].x,r[o].x,c),l.y=this.interpolate(r[e].y,r[i].y,r[s].y,r[o].y,c),l},i.prototype.addPoint=function(t){this.dirtyLength=!0,this.points.push(t)},i.prototype.getPointAt=function(t){t=this.closed?(t+1)%1:Math.max(0,Math.min(t,1)),this.dirtyLength&&this.precalculateLength();for(var e=0,i=0;i<this.accumulatedLengthRatios.length;i++)if(this.accumulatedLengthRatios[i]>t-1/this.samplesCount){e=this.accumulatedRatios[i];break}return this.getPoint(e)},i.prototype.getClosestPoint=function(t){this.dirtyLength&&this.precalculateLength();var e=this.precalculatedPoints.reduce(function(e,i){var n=t.squareDistance(i);return n<e.dist?{dist:n,point:i}:e},{dist:1/0,point:null});return e.point},i.prototype.getClosestPointRatio=function(t){this.dirtyLength&&this.precalculateLength();var e=this.precalculatedPoints.reduce(function(e,i,n){var s=t.squareDistance(i);return s<e.dist?{dist:s,point:i,index:n}:e},{dist:1/0,point:null,index:-1});return this.accumulatedLengthRatios[e.index]},i.prototype.getPointAtIndex=function(t){return t<this.points.length?this.points[t]:null},i.prototype.getNumPoints=function(){return this.points.length},i.prototype.getLength=function(){return this.dirtyLength&&this.precalculateLength(),this.length},i.prototype.precalculateLength=function(){var t=1/this.samplesCount,e=0,i=0;this.accumulatedRatios=[],this.accumulatedLengthRatios=[],this.accumulatedLengths=[],this.precalculatedPoints=[];for(var n,s,o=0;o<this.samplesCount;o++){if(s=n,n=this.getPoint(e),o>0){var r=n.dup().sub(s).length();i+=r}this.accumulatedRatios.push(e),this.accumulatedLengths.push(i),this.precalculatedPoints.push(n),e+=t}for(var o=0;o<this.samplesCount;o++)this.accumulatedLengthRatios.push(this.accumulatedLengths[o]/i);this.length=i,this.dirtyLength=!1},i.prototype.close=function(){this.closed=!0},i.prototype.isClosed=function(){return this.closed},i.prototype.interpolate=function(t,e,i,n,s){var o=.5*(i-t),r=.5*(n-e),a=s*s,h=s*a;return(2*e-2*i+o+r)*h+(-3*e+3*i-2*o-r)*a+o*s+e},e.exports=i},{"./Vec2":24}],21:[function(t,e){function i(t,e){this.points=t||[],this.dirtyLength=!0,this.closed=e||!1,this.samplesCount=1e3}var n=t("./Vec3");i.prototype.getPoint=function(t){t=this.closed?(t+1)%1:Math.max(0,Math.min(t,1));var e,i,s,o,r=this.points,a=this.closed?r.length:r.length-1,h=t*a,u=Math.floor(h),c=h-u;this.closed?(e=(u-1+r.length)%r.length,i=u%r.length,s=(u+1)%r.length,o=(u+2)%r.length):(e=0==u?u:u-1,i=u,s=u>r.length-2?u:u+1,o=u>r.length-3?u:u+2);var l=new n;return l.x=this.interpolate(r[e].x,r[i].x,r[s].x,r[o].x,c),l.y=this.interpolate(r[e].y,r[i].y,r[s].y,r[o].y,c),l.z=this.interpolate(r[e].z,r[i].z,r[s].z,r[o].z,c),l},i.prototype.addPoint=function(t){this.dirtyLength=!0,this.points.push(t)},i.prototype.getPointAt=function(t){t=this.closed?(t+1)%1:Math.max(0,Math.min(t,1)),this.dirtyLength&&this.precalculateLength();for(var e=0,i=0;i<this.accumulatedLengthRatios.length;i++)if(this.accumulatedLengthRatios[i]>t-1/this.samplesCount){e=this.accumulatedRatios[i];break}return this.getPoint(e)},i.prototype.getClosestPoint=function(t){this.dirtyLength&&this.precalculateLength();var e=this.precalculatedPoints.reduce(function(e,i){var n=t.squareDistance(i);return n<e.dist?{dist:n,point:i}:e},{dist:1/0,point:null});return e.point},i.prototype.getClosestPointRatio=function(t){this.dirtyLength&&this.precalculateLength();var e=this.precalculatedPoints.reduce(function(e,i,n){var s=t.squareDistance(i);return s<e.dist?{dist:s,point:i,index:n}:e},{dist:1/0,point:null,index:-1});return this.accumulatedLengthRatios[e.index]},i.prototype.getTangentAt=function(t){var e=.99>t?t:t-.01,i=.99>t?t+.01:t,s=this.getPointAt(e),o=this.getPointAt(i);return n.create().asSub(o,s).normalize()},i.prototype.getPointAtIndex=function(t){return t<this.points.length?this.points[t]:null},i.prototype.getNumPoints=function(){return this.points.length},i.prototype.getLength=function(){return this.dirtyLength&&this.precalculateLength(),this.length},i.prototype.precalculateLength=function(){var t=1/this.samplesCount,e=0,i=0;this.accumulatedRatios=[],this.accumulatedLengthRatios=[],this.accumulatedLengths=[],this.precalculatedPoints=[];for(var n,s,o=0;o<this.samplesCount;o++){if(s=n,n=this.getPoint(e),o>0){var r=n.dup().sub(s).length();i+=r}this.accumulatedRatios.push(e),this.accumulatedLengths.push(i),this.precalculatedPoints.push(n),e+=t}for(var o=0;o<this.samplesCount;o++)this.accumulatedLengthRatios.push(this.accumulatedLengths[o]/i);this.length=i,this.dirtyLength=!1},i.prototype.close=function(){this.closed=!0},i.prototype.isClosed=function(){return this.closed},i.prototype.interpolate=function(t,e,i,n,s){var o=.5*(i-t),r=.5*(n-e),a=s*s,h=s*a;return(2*e-2*i+o+r)*h+(-3*e+3*i-2*o-r)*a+o*s+e},e.exports=i},{"./Vec3":25}],22:[function(t,e){function i(t,e,i){return(t.x-i.x)*(e.y-i.y)-(e.x-i.x)*(t.y-i.y)}function n(t,e,i){this.a=t,this.b=e,this.c=i}n.prototype.contains=function(t){var e=i(this.a,this.b,t)<0,n=i(this.b,this.c,t)<0,s=i(this.c,this.a,t)<0;return e==n&&n==s},n.prototype.getArea=function(){var t=this.a.distance(this.b),e=this.a.distance(this.c),i=this.b.distance(this.c),n=(t+e+i)/2;return Math.sqrt(n*(n-t)*(n-e)*(n-i))},e.exports=n},{}],23:[function(t,e){function i(t,e,i){this.a=t,this.b=e,this.c=i}i.prototype.getArea=function(){var t=this.a.distance(this.b),e=this.a.distance(this.c),i=this.b.distance(this.c),n=(t+e+i)/2;return Math.sqrt(n*(n-t)*(n-e)*(n-i))},e.exports=i},{}],24:[function(t,e){function i(t,e){this.x=null!=t?t:0,this.y=null!=e?e:0}i.create=function(t,e){return new i(t,e)},i.fromArray=function(t){return new i(t[0],t[1])},i.prototype.set=function(t,e){return this.x=t,this.y=e,this},i.prototype.equals=function(t,e){return null==e&&(e=1e-7),Math.abs(t.x-this.x)<=e&&Math.abs(t.y-this.y)<=e},i.prototype.hash=function(){return 1*this.x+12*this.y},i.prototype.setVec2=function(t){return this.x=t.x,this.y=t.y,this},i.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},i.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},i.prototype.scale=function(t){return this.x*=t,this.y*=t,this},i.prototype.distance=function(t){var e=t.x-this.x,i=t.y-this.y;return Math.sqrt(e*e+i*i)},i.prototype.squareDistance=function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},i.prototype.dot=function(t){return this.x*t.x+this.y*t.y},i.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},i.prototype.clone=function(){return new i(this.x,this.y)},i.prototype.dup=function(){return this.clone()},i.prototype.asAdd=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},i.prototype.asSub=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},i.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},i.prototype.normalize=function(){var t=this.length();return t>0&&this.scale(1/t),this},i.prototype.lerp=function(t,e){this.x=this.x+(t.x-this.x)*e,this.y=this.y+(t.y-this.y)*e},i.prototype.toString=function(){return"{"+Math.floor(1e3*this.x)/1e3+", "+Math.floor(1e3*this.y)/1e3+"}"},e.exports=i},{}],25:[function(t,e){function i(t,e,i){this.x=null!=t?t:0,this.y=null!=e?e:0,this.z=null!=i?i:0}i.create=function(t,e,n){return new i(t,e,n)},i.fromArray=function(t){return new i(t[0],t[1],t[2])},i.prototype.hash=function(){return 1*this.x+12*this.y+123*this.z},i.prototype.set=function(t,e,i){return this.x=t,this.y=e,this.z=i,this},i.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},i.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},i.prototype.scale=function(t){return this.x*=t,this.y*=t,this.z*=t,this},i.prototype.distance=function(t){var e=t.x-this.x,i=t.y-this.y,n=t.z-this.z;return Math.sqrt(e*e+i*i+n*n)},i.prototype.squareDistance=function(t){var e=t.x-this.x,i=t.y-this.y,n=t.z-this.z;return e*e+i*i+n*n},i.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},i.prototype.setVec3=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},i.prototype.clone=function(){return new i(this.x,this.y,this.z)},i.prototype.dup=function(){return this.clone()},i.prototype.cross=function(t){var e=this.x,i=this.y,n=this.z,s=t.x,o=t.y,r=t.z;return this.x=i*r-n*o,this.y=n*s-e*r,this.z=e*o-i*s,this},i.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},i.prototype.asAdd=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},i.prototype.asSub=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},i.prototype.asCross=function(t,e){return this.copy(t).cross(e)},i.prototype.addScaled=function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},i.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},i.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},i.prototype.normalize=function(){var t=this.length();return t>0&&this.scale(1/t),this},i.prototype.transformQuat=function(t){var e=this.x,i=this.y,n=this.z,s=t.x,o=t.y,r=t.z,a=t.w,h=a*e+o*n-r*i,u=a*i+r*e-s*n,c=a*n+s*i-o*e,l=-s*e-o*i-r*n;return this.x=h*a+l*-s+u*-r-c*-o,this.y=u*a+l*-o+c*-s-h*-r,this.z=c*a+l*-r+h*-o-u*-s,this},i.prototype.transformMat4=function(t){var e=t.a14+t.a11*this.x+t.a12*this.y+t.a13*this.z,i=t.a24+t.a21*this.x+t.a22*this.y+t.a23*this.z,n=t.a34+t.a31*this.x+t.a32*this.y+t.a33*this.z;return this.x=e,this.y=i,this.z=n,this},i.prototype.equals=function(t,e){return e=null!=e?e:1e-7,Math.abs(t.x-this.x)<=e&&Math.abs(t.y-this.y)<=e&&Math.abs(t.z-this.z)<=e},i.prototype.toString=function(){return"{"+Math.floor(1e3*this.x)/1e3+", "+Math.floor(1e3*this.y)/1e3+", "+Math.floor(1e3*this.z)/1e3+"}"},i.prototype.lerp=function(t,e){this.x=this.x+(t.x-this.x)*e,this.y=this.y+(t.y-this.y)*e,this.z=this.z+(t.z-this.z)*e},i.Zero=new i(0,0,0),e.exports=i},{}],26:[function(t,e){function i(t,e,i,n){this.x=null!=t?t:0,this.y=null!=e?e:0,this.z=null!=i?i:0,this.w=null!=n?n:0}i.prototype.equals=function(t,e){return null==e&&(e=1e-7),Math.abs(t.x-this.x)<=e&&Math.abs(t.y-this.y)<=e&&Math.abs(t.z-this.z)<=e&&Math.abs(t.w-this.w)<=e},i.prototype.hash=function(){return 1*this.x+12*this.y+123*this.z+1234*this.w},i.create=function(t,e,n,s){return new i(t,e,n,s)},i.fromArray=function(t){return new i(t[0],t[1],t[2],t[3])},i.prototype.set=function(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this},i.prototype.setVec4=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},i.prototype.transformMat4=function(t){var e=t.a14*this.w+t.a11*this.x+t.a12*this.y+t.a13*this.z,i=t.a24*this.w+t.a21*this.x+t.a22*this.y+t.a23*this.z,n=t.a34*this.w+t.a31*this.x+t.a32*this.y+t.a33*this.z,s=t.a44*this.w+t.a41*this.x+t.a42*this.y+t.a43*this.z;return this.x=e,this.y=i,this.z=n,this.w=s,this},i.prototype.toString=function(){return"{"+Math.floor(1e3*this.x)/1e3+", "+Math.floor(1e3*this.y)/1e3+", "+Math.floor(1e3*this.z)/1e3+", "+Math.floor(1e3*this.w)/1e3+"}"},e.exports=i},{}],27:[function(t,e){!function(t,e,i,n,s,o,r,a,h){function u(t){var e,i=t.length,s=this,o=0,r=s.i=s.j=0,a=s.S=[];for(i||(t=[i++]);n>o;)a[o]=o++;for(o=0;n>o;o++)a[o]=a[r=m&r+t[o%i]+(e=a[o])],a[r]=e;(s.g=function(t){for(var e,i=0,o=s.i,r=s.j,a=s.S;t--;)e=a[o=m&o+1],i=i*n+a[m&(a[o]=a[r=m&r+e])+(a[r]=e)];return s.i=o,s.j=r,i})(n)}function c(t,e){var i,n=[],s=typeof t;if(e&&"object"==s)for(i in t)try{n.push(c(t[i],e-1))}catch(o){}return n.length?n:"string"==s?t:t+"\x00"}function l(t,e){for(var i,n=t+"",s=0;s<n.length;)e[m&s]=m&(i^=19*e[m&s])+n.charCodeAt(s++);return d(e)}function p(i){try{return t.crypto.getRandomValues(i=new Uint8Array(n)),d(i)}catch(s){return[+new Date,t,(i=t.navigator)&&i.plugins,t.screen,d(e)]}}function d(t){return String.fromCharCode.apply(0,t)}var f=i.pow(n,s),y=i.pow(2,o),g=2*y,m=n-1,x=i["seed"+h]=function(t,o,r){var a=[],m=l(c(o?[t,d(e)]:null==t?p():t,3),a),x=new u(a);return l(d(x.S),e),(r||function(t,e,n){return n?(i[h]=t,e):t})(function(){for(var t=x.g(s),e=f,i=0;y>t;)t=(t+i)*n,e*=n,i=x.g(1);for(;t>=g;)t/=2,e/=2,i>>>=1;return(t+i)/e},m,this==i)};l(i[h](),e),r&&r.exports?r.exports=x:a&&a.amd&&a(function(){return x})}(this,[],Math,256,6,52,"object"==typeof e&&e,"function"==typeof define&&define,"random")},{}],28:[function(t,e){e.exports.Platform=t("./lib/Platform"),e.exports.Window=t("./lib/Window"),e.exports.Time=t("./lib/Time"),e.exports.IO=t("./lib/IO"),e.exports.Log=t("./lib/Log")},{"./lib/IO":30,"./lib/Log":31,"./lib/Platform":32,"./lib/Time":33,"./lib/Window":34}],29:[function(t,e){function i(t,e){for(var i=0;i<m.length;i++)m[i].eventType==t&&m[i].handler(e)}function n(t){s(t),o(t),r(t),a(t),h(t),u(t),c(t),l(t),p(t)}function s(t){t.addEventListener("mousedown",function(t){i("leftMouseDown",{x:(t.offsetX||t.layerX||t.clientX-t.target.offsetLeft)*window.devicePixelRatio,y:(t.offsetY||t.layerY||t.clientY-t.target.offsetTop)*window.devicePixelRatio,option:t.altKey,shift:t.shiftKey,control:t.ctrlKey})})}function o(t){t.addEventListener("mouseup",function(t){i("leftMouseUp",{x:(t.offsetX||t.layerX||t.clientX-t.target.offsetLeft)*window.devicePixelRatio,y:(t.offsetY||t.layerY||t.clientY-t.target.offsetTop)*window.devicePixelRatio,option:t.altKey,shift:t.shiftKey,control:t.ctrlKey})})}function r(t){var e=!1,n=0,s=0;t.addEventListener("mousedown",function(t){e=!0,n=(t.offsetX||t.layerX||t.clientX-t.target.offsetLeft)*window.devicePixelRatio,s=(t.offsetY||t.layerY||t.clientY-t.target.offsetTop)*window.devicePixelRatio}),t.addEventListener("mouseup",function(){e=!1}),t.addEventListener("mousemove",function(t){if(e){var o=(t.offsetX||t.layerX||t.clientX-t.target.offsetLeft)*window.devicePixelRatio,r=(t.offsetY||t.layerY||t.clientY-t.target.offsetTop)*window.devicePixelRatio;i("mouseDragged",{x:o,y:r,dx:o-n,dy:r-s,option:t.altKey,shift:t.shiftKey,control:t.ctrlKey}),n=o,s=r}})}function a(t){t.addEventListener("mousemove",function(t){i("mouseMoved",{x:(t.offsetX||t.layerX||t.clientX-t.target.offsetLeft)*window.devicePixelRatio,y:(t.offsetY||t.layerY||t.clientY-t.target.offsetTop)*window.devicePixelRatio,option:t.altKey,shift:t.shiftKey,control:t.ctrlKey})})}function h(){var t=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";document.addEventListener(t,function(t){i("scrollWheel",{x:(t.offsetX||t.layerX)*window.devicePixelRatio,y:(t.offsetY||t.layerY)*window.devicePixelRatio,dy:t.wheelDelta/10||-t.detail/10,option:t.altKey,shift:t.shiftKey,control:t.ctrlKey})})}function u(t){t.addEventListener("touchstart",function(t){x={clientX:t.touches[0].clientX*window.devicePixelRatio,clientY:t.touches[0].clientY*window.devicePixelRatio};var e=t.touches.map(function(t){return t.x=t.clientX*window.devicePixelRatio,t.y=t.clientY*window.devicePixelRatio,t});i("leftMouseDown",{x:t.touches[0].clientX*window.devicePixelRatio,y:t.touches[0].clientY*window.devicePixelRatio,option:!1,shift:!1,control:!1,touches:e})})}function c(t){t.addEventListener("touchend",function(t){var e=t.touches.map(function(t){return t.x=t.clientX*window.devicePixelRatio,t.y=t.clientY*window.devicePixelRatio,t});i("leftMouseUp",{x:x?x.clientX:0,y:x?x.clientY:0,option:!1,shift:!1,control:!1,touches:e}),x=null})}function l(t){t.addEventListener("touchmove",function(t){x={clientX:t.touches[0].clientX*window.devicePixelRatio,clientY:t.touches[0].clientY*window.devicePixelRatio};var e=t.touches.map(function(t){return t.x=t.clientX*window.devicePixelRatio,t.y=t.clientY*window.devicePixelRatio,t});i("mouseDragged",{x:t.touches[0].clientX*window.devicePixelRatio,y:t.touches[0].clientY*window.devicePixelRatio,option:!1,shift:!1,control:!1,touches:e})})}function p(){var t=0;window.addEventListener("keydown",function(e){t=setTimeout(function(){i("keyDown",{str:"",keyCode:e.keyCode,option:e.altKey,shift:e.shiftKey,control:e.ctrlKey},1)})}),window.addEventListener("keypress",function(e){t&&(clearTimeout(t),t=0),i("keyDown",{str:String.fromCharCode(e.charCode),keyCode:e.keyCode,option:e.altKey,shift:e.shiftKey,control:e.ctrlKey})})}function d(t){function e(){function e(){t.__disposed||(t.draw(),requestAnimFrame(e))}void 0===t.stencil&&(t.stencil=!1),t.settings.fullscreen&&(document.body.style.margin="0",document.body.style.padding="0",document.body.style.overflow="hidden");var s=null,o=null;if("3d"==t.settings.type){try{s=i.getContext("experimental-webgl",{antialias:!0,stencil:t.settings.stencil,premultipliedAlpha:t.settings.premultipliedAlpha,preserveDrawingBuffer:t.settings.preserveDrawingBuffer})}catch(r){return void y.error(r.message)}if(null===s)throw"No WebGL context is available."}else"2d"==t.settings.type&&(o=i.getContext("2d"));t.framerate=function(t){g=t},t.on=function(t,e){m.push({eventType:t,handler:e})},n(i),t.dispose=function(){t.__disposed=!0},t.gl=s,t.ctx=o,t.init(),requestAnimFrame(e)}var i=t.settings.canvas;return t.settings.fullscreen&&(t.settings.width=window.innerWidth,t.settings.height=window.innerHeight),i?t.settings.width&&t.settings.height?(i.width=t.settings.width,i.height=t.settings.height):(t.settings.width=i.width,t.settings.height=i.height):i=document.getElementById("canvas"),i||(i=document.createElement("canvas"),i.width=t.settings.width,i.height=t.settings.height),2==window.devicePixelRatio&&(i.width=2*t.settings.width,i.height=2*t.settings.height,i.style.width=t.settings.width+"px",i.style.height=t.settings.height+"px",i.msaaEnabled=!0,i.msaaSamples=2,t.settings.width*=2,t.settings.height*=2,t.settings.highdpi=2),t.width=t.settings.width,t.height=t.settings.height,t.canvas=i,i.style.backgroundColor="#000000",i.parentNode?e():document.body?(document.body.appendChild(i),e()):window.addEventListener("load",function(){document.body.appendChild(i),e()},!1),t}var f=t("./Platform"),y=t("./Log"),g=(t("merge"),60);f.isBrowser&&(window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/g)}}());var m=[],x=null,v={simpleWindow:d};e.exports=v},{"./Log":31,"./Platform":32,merge:1}],30:[function(t,e){(function(i){var n=t("./Platform"),s=t("./Log"),o=t("plask"),r=t("path"),a=t("merge"),h=function(){function t(){}return t.loadTextFile=function(e,i){var n=r.resolve(t.getWorkingDirectory(),e);if(!fs.existsSync(n)&&i)return i(null);var s=fs.readFileSync(n,"utf8");i&&i(s)},t.getWorkingDirectory=function(){return r.dirname(i.mainModule.filename)},t.loadImageData=function(e,i,n,s,h,u,c){var l={flip:!1,lod:0};u=a(l,u);var p=r.resolve(t.getWorkingDirectory(),h);e.activeTexture(e.TEXTURE0),e.bindTexture(n,i);var d=o.SkCanvas.createFromImage(p);u.flip?e.texImage2DSkCanvas(s,u.lod,d):e.texImage2DSkCanvasNoFlip(s,u.lod,d),c&&c(d)},t.watchTextFile=function(t,e){fs.watch(t,{},function(i){if("change"==i){var n=fs.readFileSync(t,"utf8");e&&e(n)}})},t.saveTextFile=function(t,e){fs.writeFileSync(t,e)},t},u=function(){function t(){}return t.getWorkingDirectory=function(){return"."},t.loadTextFile=function(t,e){var i=new XMLHttpRequest;i.open("GET",t,!0),i.onreadystatechange=function(){4==i.readyState&&(200==i.status?e&&e(i.responseText):s.error("WebIO.loadTextFile error : "+i.statusText))},i.send(null)},t.loadImageData=function(t,e,i,n,s,o,r){var h={flip:!1,lod:0};o=a(h,o);var u=new Image;o.crossOrigin&&(u.crossOrigin=o.crossOrigin),u.onload=function(){t.activeTexture(t.TEXTURE0),t.bindTexture(i,e),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,o.flip),t.texImage2D(n,o.lod,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,u),r&&r(u)},u.src=s},t.watchTextFile=function(){console.log("Warning: WebIO.watch is not implemented!")},t.saveTextFile=function(t,e,i){var n=new XMLHttpRequest;n.open("POST",t,!0),n.onreadystatechange=function(){4==n.readyState&&(200==n.status?i&&i(n.responseText,n):s.error("WebIO.saveTextFile error : "+n.statusText))},n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send("data="+encodeURIComponent(e))},t};n.isPlask?e.exports=h():n.isBrowser&&(e.exports=u())
}).call(this,t("/Users/vorg/Workspace/vorg-pex/experiments/v3/node_modules/pex-examples/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))},{"./Log":31,"./Platform":32,"/Users/vorg/Workspace/vorg-pex/experiments/v3/node_modules/pex-examples/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":5,merge:1,path:6,plask:4}],31:[function(t,e){function i(){}i.message=function(){if(void 0!==console){var t=Array.prototype.slice.call(arguments);console.log(t.join(" "))}},i.error=function(){var t=Array.prototype.slice.call(arguments);void 0!==console&&console.log("ERROR: "+t.join(" "))},e.exports=i},{}],32:[function(t,e){(function(t){e.exports.isPlask="undefined"==typeof window&&"object"==typeof t,e.exports.isBrowser="object"==typeof window&&"object"==typeof document,e.exports.isEjecta="object"==typeof ejecta&&"function"==typeof ejecta.include}).call(this,t("/Users/vorg/Workspace/vorg-pex/experiments/v3/node_modules/pex-examples/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))},{"/Users/vorg/Workspace/vorg-pex/experiments/v3/node_modules/pex-examples/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":5}],33:[function(t,e){var i=t("./Log"),n={now:0,prev:0,delta:0,seconds:0,frameNumber:0,fpsFrames:0,fpsTime:0,fps:0,fpsFrequency:3,paused:!1,verbose:!1};n.update=function(t){return n.paused?void 0:(0===n.prev&&(n.prev=Date.now()),n.now=Date.now(),n.delta=void 0!==t?t:(n.now-n.prev)/1e3,n.delta>1&&(n.delta=0),n.prev=n.now,n.seconds+=n.delta,n.fpsTime+=n.delta,n.frameNumber++,n.fpsFrames++,n.fpsTime>n.fpsFrequency&&(n.fps=n.fpsFrames/n.fpsTime,n.fpsTime=0,n.fpsFrames=0,this.verbose&&i.message("FPS: "+n.fps)),n.seconds)};var s=0;n.startMeasuringTime=function(){s=Date.now()},n.stopMeasuringTime=function(t){var e=Date.now(),i=(e-s)/1e3;return t&&console.log(t+i),i},n.pause=function(){n.paused=!0},n.togglePause=function(){n.paused=!n.paused},e.exports=n},{"./Log":31}],34:[function(t,e){var i=t("./Platform"),n=t("./BrowserWindow"),s=t("./Time"),o=(t("./Log"),t("merge")),r=t("plask"),a={width:1280,height:720,type:"3d",vsync:!0,multisample:!0,fullscreen:!1,center:!0,hdpi:1,stencil:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1},h={currentWindow:null,create:function(t){t.settings=t.settings||{},t.settings=o(a,t.settings),t.__init=t.init,t.init=function(){h.currentWindow=this,t.framerate(60),t.__init&&t.__init()},t.__draw=t.draw,t.draw=function(){h.currentWindow=this,s.update(),t.__draw&&t.__draw()},i.isPlask?r.simpleWindow(t):(i.isBrowser||i.isEjecta)&&n.simpleWindow(t)}};e.exports=h},{"./BrowserWindow":29,"./Log":31,"./Platform":32,"./Time":33,merge:1,plask:4}]},{},[7]);