<!DOCTYPE html>

<html>
<head>
  <title>ScreenImage.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>ScreenImage.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> geom = <span class="hljs-built_in">require</span>(<span class="hljs-string">'pex-geom'</span>);
<span class="hljs-keyword">var</span> Vec2 = geom.Vec2;
<span class="hljs-keyword">var</span> Geometry = geom.Geometry;
<span class="hljs-keyword">var</span> Program = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./Program'</span>);
<span class="hljs-keyword">var</span> Material = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./Material'</span>);
<span class="hljs-keyword">var</span> Mesh = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./Mesh'</span>);
<span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);

<span class="hljs-keyword">var</span> ScreenImageGLSL = fs.readFileSync(__dirname + <span class="hljs-string">'/ScreenImage.glsl'</span>, <span class="hljs-string">'utf8'</span>);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ScreenImage</span><span class="hljs-params">(image, x, y, w, h, screenWidth, screenHeight)</span> </span>{
  x = x !== <span class="hljs-literal">undefined</span> ? x : <span class="hljs-number">0</span>;
  y = y !== <span class="hljs-literal">undefined</span> ? y : <span class="hljs-number">0</span>;
  w = w !== <span class="hljs-literal">undefined</span> ? w : <span class="hljs-number">1</span>;
  h = h !== <span class="hljs-literal">undefined</span> ? h : <span class="hljs-number">1</span>;
  screenWidth = screenWidth !== <span class="hljs-literal">undefined</span> ? screenWidth : <span class="hljs-number">1</span>;
  screenHeight = screenHeight !== <span class="hljs-literal">undefined</span> ? screenHeight : <span class="hljs-number">1</span>;
  <span class="hljs-keyword">this</span>.image = image;
  <span class="hljs-keyword">var</span> program = <span class="hljs-keyword">new</span> Program(ScreenImageGLSL);
  <span class="hljs-keyword">var</span> uniforms = {
    screenSize: Vec2.create(screenWidth, screenHeight),
    pixelPosition: Vec2.create(x, y),
    pixelSize: Vec2.create(w, h),
    alpha: <span class="hljs-number">1</span>
  };
  <span class="hljs-keyword">if</span> (image) {
    uniforms.image = image;
  }
  <span class="hljs-keyword">var</span> material = <span class="hljs-keyword">new</span> Material(program, uniforms);
  <span class="hljs-keyword">var</span> vertices = [
    <span class="hljs-keyword">new</span> Vec2(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>),
    <span class="hljs-keyword">new</span> Vec2(-<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>),
    <span class="hljs-keyword">new</span> Vec2(<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>),
    <span class="hljs-keyword">new</span> Vec2(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>)
  ];
  <span class="hljs-keyword">var</span> texCoords = [
    <span class="hljs-keyword">new</span> Vec2(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>),
    <span class="hljs-keyword">new</span> Vec2(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>),
    <span class="hljs-keyword">new</span> Vec2(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>),
    <span class="hljs-keyword">new</span> Vec2(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>)
  ];
  <span class="hljs-keyword">var</span> geometry = <span class="hljs-keyword">new</span> Geometry({
    vertices: vertices,
    texCoords: texCoords,
    faces: <span class="hljs-literal">true</span>
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>0——3  0,1   1,1
| \  |      u
|  \ |      v
1——2  0,0   0,1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  geometry.faces.push([<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>]);
  geometry.faces.push([<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]);
  <span class="hljs-keyword">this</span>.mesh = <span class="hljs-keyword">new</span> Mesh(geometry, material);
}

ScreenImage.prototype.setAlpha = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(alpha)</span> </span>{
  <span class="hljs-keyword">this</span>.mesh.material.uniforms.alpha = alpha;
};

ScreenImage.prototype.setPosition = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(position)</span> </span>{
  <span class="hljs-keyword">this</span>.mesh.material.uniforms.pixelPosition = position;
};

ScreenImage.prototype.setSize = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(size)</span> </span>{
  <span class="hljs-keyword">this</span>.mesh.material.uniforms.pixelSize = size;
};

ScreenImage.prototype.setWindowSize = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(size)</span> </span>{
  <span class="hljs-keyword">this</span>.mesh.material.uniforms.windowSize = size;
};

ScreenImage.prototype.setBounds = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(bounds)</span> </span>{
  <span class="hljs-keyword">this</span>.mesh.material.uniforms.pixelPosition.x = bounds.x;
  <span class="hljs-keyword">this</span>.mesh.material.uniforms.pixelPosition.y = bounds.y;
  <span class="hljs-keyword">this</span>.mesh.material.uniforms.pixelSize.x = bounds.width;
  <span class="hljs-keyword">this</span>.mesh.material.uniforms.pixelSize.y = bounds.height;
};

ScreenImage.prototype.setImage = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(image)</span> </span>{
  <span class="hljs-keyword">this</span>.image = image;
  <span class="hljs-keyword">this</span>.mesh.material.uniforms.image = image;
};

ScreenImage.prototype.draw = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(image, program)</span> </span>{
  <span class="hljs-keyword">var</span> oldImage = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">if</span> (image) {
    oldImage = <span class="hljs-keyword">this</span>.mesh.material.uniforms.image;
    <span class="hljs-keyword">this</span>.mesh.material.uniforms.image = image;
  }
  <span class="hljs-keyword">var</span> oldProgram = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">if</span> (program) {
    oldProgram = <span class="hljs-keyword">this</span>.mesh.getProgram();
    <span class="hljs-keyword">this</span>.mesh.setProgram(program);
  }
  <span class="hljs-keyword">this</span>.mesh.draw();
  <span class="hljs-keyword">if</span> (oldProgram) {
    <span class="hljs-keyword">this</span>.mesh.setProgram(oldProgram);
  }
  <span class="hljs-keyword">if</span> (oldImage) {
    <span class="hljs-keyword">this</span>.mesh.material.uniforms.image = oldImage;
  }
};

<span class="hljs-built_in">module</span>.exports = ScreenImage;</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
